{"meta":{"version":1,"warehouse":"4.0.2"},"models":{"Asset":[{"_id":"themes/hexo-theme-claudia/source/favicon.ico","path":"favicon.ico","modified":0,"renderable":1},{"_id":"themes/hexo-theme-claudia/source/js/common.js","path":"js/common.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-claudia/source/js/highlight.pack.js","path":"js/highlight.pack.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-claudia/source/js/post.js","path":"js/post.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-claudia/source/style/about.scss","path":"style/about.scss","modified":0,"renderable":1},{"_id":"themes/hexo-theme-claudia/source/style/archive.scss","path":"style/archive.scss","modified":0,"renderable":1},{"_id":"themes/hexo-theme-claudia/source/style/base.scss","path":"style/base.scss","modified":0,"renderable":1},{"_id":"themes/hexo-theme-claudia/source/style/post.scss","path":"style/post.scss","modified":0,"renderable":1},{"_id":"themes/hexo-theme-claudia/source/style/widget-header.scss","path":"style/widget-header.scss","modified":0,"renderable":1},{"_id":"themes/hexo-theme-claudia/source/style/widget-post-list.scss","path":"style/widget-post-list.scss","modified":0,"renderable":1},{"_id":"themes/hexo-theme-claudia/source/style/common/helper.scss","path":"style/common/helper.scss","modified":0,"renderable":1},{"_id":"themes/hexo-theme-claudia/source/style/common/bulma.css","path":"style/common/bulma.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-claudia/source/style/themes/default-dark.scss","path":"style/themes/default-dark.scss","modified":0,"renderable":1},{"_id":"themes/hexo-theme-claudia/source/style/common/variable.scss","path":"style/common/variable.scss","modified":0,"renderable":1},{"_id":"themes/hexo-theme-claudia/source/style/themes/default-light.scss","path":"style/themes/default-light.scss","modified":0,"renderable":1},{"_id":"themes/hexo-theme-claudia/source/style/themes/highlight-theme-light.css","path":"style/themes/highlight-theme-light.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-claudia/source/style/themes/theme.scss","path":"style/themes/theme.scss","modified":0,"renderable":1},{"_id":"source/images/ASO-PRACTICA1.png","path":"images/ASO-PRACTICA1.png","modified":0,"renderable":0},{"_id":"source/images/Ansible.png","path":"images/Ansible.png","modified":0,"renderable":0},{"_id":"source/images/DeepinScreenshot_Seleccionar área_20230109125013.png","path":"images/DeepinScreenshot_Seleccionar área_20230109125013.png","modified":0,"renderable":0},{"_id":"source/images/LDAP-LOGO.png","path":"images/LDAP-LOGO.png","modified":0,"renderable":0},{"_id":"source/images/LOGO-LDAP.png","path":"images/LOGO-LDAP.png","modified":0,"renderable":0},{"_id":"source/images/Untitled-2023-01-10-0143.png","path":"images/Untitled-2023-01-10-0143.png","modified":0,"renderable":0},{"_id":"source/images/ansibleandvagrant.jpg","path":"images/ansibleandvagrant.jpg","modified":0,"renderable":0},{"_id":"source/images/avatar.jpg","path":"images/avatar.jpg","modified":0,"renderable":0},{"_id":"source/images/debian-11.jpg","path":"images/debian-11.jpg","modified":0,"renderable":0},{"_id":"source/images/interfaces.png","path":"images/interfaces.png","modified":0,"renderable":0},{"_id":"source/images/iscsi-1.png","path":"images/iscsi-1.png","modified":0,"renderable":0},{"_id":"source/images/iscsi-2.png","path":"images/iscsi-2.png","modified":0,"renderable":0},{"_id":"source/images/iscsi-3.png","path":"images/iscsi-3.png","modified":0,"renderable":0},{"_id":"source/images/linux-6.0.jpg","path":"images/linux-6.0.jpg","modified":0,"renderable":0},{"_id":"source/images/logo-wireguard.png","path":"images/logo-wireguard.png","modified":0,"renderable":0},{"_id":"source/images/obelix-2.png","path":"images/obelix-2.png","modified":0,"renderable":0},{"_id":"source/images/obelix-3.png","path":"images/obelix-3.png","modified":0,"renderable":0},{"_id":"source/images/obelix-4.jpg","path":"images/obelix-4.jpg","modified":0,"renderable":0},{"_id":"source/images/obelix.png","path":"images/obelix.png","modified":0,"renderable":0},{"_id":"source/images/openstack-1.png","path":"images/openstack-1.png","modified":0,"renderable":0},{"_id":"source/images/oracle-ejercicio1.png","path":"images/oracle-ejercicio1.png","modified":0,"renderable":0},{"_id":"source/images/oracle-ejercicio10.png","path":"images/oracle-ejercicio10.png","modified":0,"renderable":0},{"_id":"source/images/oracle-ejercicio2.png","path":"images/oracle-ejercicio2.png","modified":0,"renderable":0},{"_id":"source/images/oracle-ejercicio3.png","path":"images/oracle-ejercicio3.png","modified":0,"renderable":0},{"_id":"source/images/oracle-ejercicio4.png","path":"images/oracle-ejercicio4.png","modified":0,"renderable":0},{"_id":"source/images/oracle-ejercicio5.png","path":"images/oracle-ejercicio5.png","modified":0,"renderable":0},{"_id":"source/images/oracle-ejercicio6.png","path":"images/oracle-ejercicio6.png","modified":0,"renderable":0},{"_id":"source/images/oracle-ejercicio7.png","path":"images/oracle-ejercicio7.png","modified":0,"renderable":0},{"_id":"source/images/oracle-ejercicio8.png","path":"images/oracle-ejercicio8.png","modified":0,"renderable":0},{"_id":"source/images/oracle-ejercicio9.png","path":"images/oracle-ejercicio9.png","modified":0,"renderable":0},{"_id":"source/images/oracle-postgres.png","path":"images/oracle-postgres.png","modified":0,"renderable":0},{"_id":"source/images/oraclepostgres.jpg","path":"images/oraclepostgres.jpg","modified":0,"renderable":0},{"_id":"source/images/postgres-ejercicio1.png","path":"images/postgres-ejercicio1.png","modified":0,"renderable":0},{"_id":"source/images/postgres-ejercicio2.png","path":"images/postgres-ejercicio2.png","modified":0,"renderable":0},{"_id":"source/images/postgres-oracle.png","path":"images/postgres-oracle.png","modified":0,"renderable":0},{"_id":"source/images/postgres-postgres.png","path":"images/postgres-postgres.png","modified":0,"renderable":0},{"_id":"source/images/prueba-dns-mysql.png","path":"images/prueba-dns-mysql.png","modified":0,"renderable":0},{"_id":"source/images/prueba-dns-mysql2.png","path":"images/prueba-dns-mysql2.png","modified":0,"renderable":0},{"_id":"source/images/slap-1-1.png","path":"images/slap-1-1.png","modified":0,"renderable":0},{"_id":"source/images/slap-1-10.png","path":"images/slap-1-10.png","modified":0,"renderable":0},{"_id":"source/images/slap-1-11.png","path":"images/slap-1-11.png","modified":0,"renderable":0},{"_id":"source/images/slap-1-2.png","path":"images/slap-1-2.png","modified":0,"renderable":0},{"_id":"source/images/slap-1-3.png","path":"images/slap-1-3.png","modified":0,"renderable":0},{"_id":"source/images/slap-1-4.png","path":"images/slap-1-4.png","modified":0,"renderable":0},{"_id":"source/images/slap-1-5.png","path":"images/slap-1-5.png","modified":0,"renderable":0},{"_id":"source/images/slap-1-6.png","path":"images/slap-1-6.png","modified":0,"renderable":0},{"_id":"source/images/slap-1-7.png","path":"images/slap-1-7.png","modified":0,"renderable":0},{"_id":"source/images/slap-1-8.png","path":"images/slap-1-8.png","modified":0,"renderable":0},{"_id":"source/images/slap-1-9.png","path":"images/slap-1-9.png","modified":0,"renderable":0},{"_id":"source/images/systemd-1.png","path":"images/systemd-1.png","modified":0,"renderable":0},{"_id":"source/images/systemd-2.png","path":"images/systemd-2.png","modified":0,"renderable":0},{"_id":"source/images/systemd-3.png","path":"images/systemd-3.png","modified":0,"renderable":0},{"_id":"source/images/systemd-title.jpg","path":"images/systemd-title.jpg","modified":0,"renderable":0},{"_id":"source/images/traceroute-openvpn.png","path":"images/traceroute-openvpn.png","modified":0,"renderable":0},{"_id":"source/images/vistas-dns-1.png","path":"images/vistas-dns-1.png","modified":0,"renderable":0},{"_id":"source/images/vpn-acceso-remoto-ssh-openvpn.png","path":"images/vpn-acceso-remoto-ssh-openvpn.png","modified":0,"renderable":0},{"_id":"source/images/vpn-cliente-C-lin.png","path":"images/vpn-cliente-C-lin.png","modified":0,"renderable":0},{"_id":"source/images/vpn-cliente-C-win.png","path":"images/vpn-cliente-C-win.png","modified":0,"renderable":0},{"_id":"source/images/vpn-cliente-C-win2.png","path":"images/vpn-cliente-C-win2.png","modified":0,"renderable":0},{"_id":"source/images/vpn-cliente1-traceroute.png","path":"images/vpn-cliente1-traceroute.png","modified":0,"renderable":0},{"_id":"source/images/vpn-cliente1.png","path":"images/vpn-cliente1.png","modified":0,"renderable":0},{"_id":"source/images/vpn-cliente2-traceroute.png","path":"images/vpn-cliente2-traceroute.png","modified":0,"renderable":0},{"_id":"source/images/vpn-cliente2.png","path":"images/vpn-cliente2.png","modified":0,"renderable":0},{"_id":"source/images/vpn-logo.png","path":"images/vpn-logo.png","modified":0,"renderable":0},{"_id":"source/images/vpn-site-esquema.png","path":"images/vpn-site-esquema.png","modified":0,"renderable":0},{"_id":"source/images/web-alfa.png","path":"images/web-alfa.png","modified":0,"renderable":0},{"_id":"source/images/wireguard-site-1.png","path":"images/wireguard-site-1.png","modified":0,"renderable":0},{"_id":"source/images/wireguard-site-2.png","path":"images/wireguard-site-2.png","modified":0,"renderable":0},{"_id":"source/images/wireguard-site-3.png","path":"images/wireguard-site-3.png","modified":0,"renderable":0},{"_id":"source/images/wireguard-site-4.png","path":"images/wireguard-site-4.png","modified":0,"renderable":0},{"_id":"source/images/xconfig.png","path":"images/xconfig.png","modified":0,"renderable":0},{"_id":"source/images/xorriso-1.png","path":"images/xorriso-1.png","modified":0,"renderable":0},{"_id":"source/images/xorriso-2.png","path":"images/xorriso-2.png","modified":0,"renderable":0},{"_id":"source/images/xorriso-3.png","path":"images/xorriso-3.png","modified":0,"renderable":0},{"_id":"source/images/xorriso-4.png","path":"images/xorriso-4.png","modified":0,"renderable":0}],"Cache":[{"_id":"source/_posts/integrar-apps-java","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1674094242851},{"_id":"source/_posts/Ansible+Vagrant.md","hash":"f16fe692a015725f692752efe5e6430dcd695ae4","modified":1672839760307},{"_id":"source/_posts/Compilar-en-debian.md","hash":"fa42ea6c4789d8bf4e23a64c1dbf7d6fc2778feb","modified":1666182858078},{"_id":"source/_posts/Compilar-linux-a-medida.md","hash":"e87c177dbbd2247c36fec26bdeb1a9b7e81b3183","modified":1672839773119},{"_id":"source/_posts/Interconexiones.md","hash":"b6e505842945cb1181d5d76d52085c84f21257ee","modified":1672838971339},{"_id":"source/_posts/LXC","hash":"b7e3389db1f6f9654fca496228c1339f2a20fec6","modified":1674719359758},{"_id":"source/_posts/Migrar-Apache-Nginx","hash":"45deaffa752a62f106eebe8f414c017e420ee937","modified":1672838744195},{"_id":"source/_posts/Preseed-pxe.md","hash":"377da3a373b4325a735fe22e2f9fd34265088f13","modified":1672839284707},{"_id":"source/_posts/dns-vistas.md","hash":"f036b799301c17913ee260fe322a0ae43070aa1a","modified":1673790153828},{"_id":"source/_posts/docker","hash":"9edf035944a3ae6c4c7af8f35152eb42cc19561c","modified":1674739897009},{"_id":"source/_posts/dns.md","hash":"f1d0e3097a857c33ac318c26cc870dcc5804569a","modified":1673311092677},{"_id":"source/_posts/examen-bdd","hash":"2852041b1361ba39ef3ac8472858c649151850c1","modified":1669803039552},{"_id":"source/_posts/iscsi","hash":"b1c8a6a4f752da6c9794685e5acb2acb080214d6","modified":1674725929836},{"_id":"source/_posts/nfs-systemd.md","hash":"d74bf35c0585dc6621b77730035e1ce5344c3b52","modified":1672839266899},{"_id":"source/_posts/openstack","hash":"5f022847f33542c6e74e3d8d3fd78ec91625a29a","modified":1669704201096},{"_id":"source/_posts/plsql_basico.md","hash":"fe43194e95bafcc1f6b3054a8f8a527fbdae6f58","modified":1672838975751},{"_id":"source/_posts/preseed.md","hash":"37a4971423621f4da09879289ffcc57dca512a24","modified":1672839306211},{"_id":"source/_posts/slap-nfs.md","hash":"5e44649a6a5cef55c446a8669375f8505f481a14","modified":1675228683220},{"_id":"source/_posts/compilar-kernel-linux","hash":"d11a382baafc4e825524880b2c67ab93eb00e386","modified":1666783344286},{"_id":"source/_posts/systemd","hash":"559b8a756bad066ef47dc3a6b0f19e7602f8e352","modified":1670920562645},{"_id":"source/about/index.md","hash":"cd386b326ee9bedd85b97a3150818e01d337450c","modified":1664448166932},{"_id":"source/_posts/vpn-wireguard.md","hash":"967694db5e4145f8edb7ed0dba1927f132862191","modified":1675172009550},{"_id":"source/_posts/ASO-apt","hash":"58651a3afad1eaf2dc57fbad5ea100fa0203e374","modified":1666079919771},{"_id":"source/_posts/vpn.md","hash":"6aab9fe31e16f7800a0e93cf3db5ee60d60d9845","modified":1674943004525},{"_id":"source/archives/index.md","hash":"7d0c0d0627957bdb2cc8295ec97687aea1473cd0","modified":1664448164348},{"_id":"source/categories/index.md","hash":"4f4b2d0a3dea2866229a4071a48902cccc436dd7","modified":1664448165208},{"_id":"source/images/DeepinScreenshot_Seleccionar área_20230109125013.png","hash":"c8f5fe4a30991d0d1a1580a8a75b12915aa7c6db","modified":1673265013059},{"_id":"source/images/LDAP-LOGO.png","hash":"4ca32c33412131db35a8211279b273bb2dbd205a","modified":1675228539368},{"_id":"source/images/LOGO-LDAP.png","hash":"8f0e96e3751a0e4132a324130b509037142e1923","modified":1675228667048},{"_id":"source/_posts/Oracle","hash":"9f470338d2d0c089e71abcd6a13cf79b98d63150","modified":1665053428959},{"_id":"source/images/ansibleandvagrant.jpg","hash":"971466418b3ab8273ecadd85ee0e4db1b0dca8aa","modified":1665683165056},{"_id":"source/images/debian-11.jpg","hash":"0ec714f3546f8aa4e1dec561f22200a1a7e834f7","modified":1665957485105},{"_id":"source/images/iscsi-2.png","hash":"076c2dce4bd63bf158886b17464625bc004ba0bd","modified":1674721499735},{"_id":"source/images/logo-wireguard.png","hash":"ba7901e5e8974e849fcd5ee9fc346ab6c38f058a","modified":1674786738124},{"_id":"source/images/iscsi-3.png","hash":"30612c83110853a0aecf9c74cb01b864a2066394","modified":1674723991383},{"_id":"source/images/oracle-ejercicio10.png","hash":"e76c08f41feb072224354119f1f301707e9801e3","modified":1670380058755},{"_id":"source/images/obelix-4.jpg","hash":"41deba00d16881be564bc3c2b6c38b6c9edcbbe2","modified":1670973813189},{"_id":"source/images/oracle-ejercicio2.png","hash":"e8048be041d163e7a1985897b2f139bc3fa8cc37","modified":1670378563000},{"_id":"source/images/oracle-ejercicio3.png","hash":"ea378d9e3203e7277679b0b1cf0fe7005c649864","modified":1670379090152},{"_id":"source/images/oracle-ejercicio5.png","hash":"6cec63601b96812d96b3287b95a34f1b1bd8b164","modified":1670379436679},{"_id":"source/images/oracle-ejercicio4.png","hash":"33cdc878dffce0c026dcf2955486ed7cf924b801","modified":1670379189912},{"_id":"source/images/oracle-ejercicio1.png","hash":"29dd25a06447a8f4fa535a383e0031d72338c00d","modified":1670378458548},{"_id":"source/images/oracle-ejercicio8.png","hash":"df6b429fec204dc994166f53f45d9b57f45b5e3b","modified":1670379724671},{"_id":"source/images/oracle-ejercicio7.png","hash":"7e2e58dfc9f67bbb26c2b2eff374da3ae8241f07","modified":1670379678807},{"_id":"source/images/oraclepostgres.jpg","hash":"49f24db75b5a65e82eebf7885eb3144e93fece84","modified":1670380544431},{"_id":"source/images/postgres-ejercicio2.png","hash":"04c9e70b5f3190ceda891bb9f955800af866de84","modified":1670378374568},{"_id":"source/images/postgres-ejercicio1.png","hash":"c779d6d4b5d87523b52d110370412caa5a33e406","modified":1670378122360},{"_id":"source/images/oracle-postgres.png","hash":"7e094bc8ebd39321abae95dcb7ba2b791f832ce8","modified":1669294309291},{"_id":"source/images/postgres-postgres.png","hash":"3088be58cdf85b4b7a2bdfad7fee66d2b4361707","modified":1669303696740},{"_id":"source/images/prueba-dns-mysql2.png","hash":"e3771b76bcef65de8246116704b2b1b72116d06c","modified":1673315034461},{"_id":"source/images/slap-1-2.png","hash":"f0095156418e8020d57e46705c923dbe3adb2cc2","modified":1675210551744},{"_id":"source/images/slap-1-4.png","hash":"33cd347b0bc84ef8055c883d03b8908dcc023bc9","modified":1675212175016},{"_id":"source/images/slap-1-5.png","hash":"07e3c259878958b9e172bd578f978ec0997fe2d0","modified":1675212820148},{"_id":"source/images/slap-1-7.png","hash":"b50e3a83c85685c034a8701d49ef3c2cd496b3ad","modified":1675215049140},{"_id":"source/images/slap-1-6.png","hash":"8f5455d42738ec8b3fa94559d431a07f57e029b0","modified":1675212995596},{"_id":"source/images/slap-1-8.png","hash":"911ce0b78c9d5656525d2e5b390ee418b6bd63a1","modified":1675218253732},{"_id":"source/images/slap-1-9.png","hash":"ea5552dcbd876cbf921fe633ed7d40d52c21a6e6","modified":1675220818296},{"_id":"source/images/traceroute-openvpn.png","hash":"df547bcd8779208925a87598dba72a929255f148","modified":1674685997933},{"_id":"source/images/vpn-cliente-C-lin.png","hash":"41207c845de1a19270fdf2c30c84473c494541f4","modified":1674931269609},{"_id":"source/images/vpn-cliente1-traceroute.png","hash":"f7f6b6f4b5343a04dec8fe9f3955d70ceaea9618","modified":1674699944617},{"_id":"source/images/vpn-cliente2-traceroute.png","hash":"6df66844ef593a700cfcbde2f12beaab9a62fcd8","modified":1674699995721},{"_id":"source/images/vpn-logo.png","hash":"6ff76f203702e5484a9a31ac88bb57beab17e1fc","modified":1674701026469},{"_id":"source/images/wireguard-site-2.png","hash":"df98cec5dafd87ce85a1e0006e20260278537fbd","modified":1674785920272},{"_id":"source/tags/index.md","hash":"d1e1645001288189b944c03ddac11c48b3964413","modified":1664968155316},{"_id":"source/images/ASO-PRACTICA1.png","hash":"7835d5258c3db2e4ff89d9a3b68d878de321a2d7","modified":1664474618526},{"_id":"source/images/Ansible.png","hash":"bb2219f79f255fd314a7a30ff5c1ea836e59e45c","modified":1665684412756},{"_id":"source/images/obelix-2.png","hash":"095139626f99764efecc71aa7ec3c9dd277bcfe8","modified":1670970878781},{"_id":"source/images/obelix-3.png","hash":"df792e4fbc26d4e49cf0d96a29cc7fdb5fe22df2","modified":1670973080209},{"_id":"source/images/obelix.png","hash":"0685e54f4641567c507545d0a5f62849a53c30f6","modified":1670969485265},{"_id":"source/images/oracle-ejercicio9.png","hash":"65cf3e3f684daab8b4d4350955d2d5549ae58635","modified":1670379782275},{"_id":"source/images/postgres-oracle.png","hash":"2108b5c5062f5ac874786078e55637dadd245c4a","modified":1669301117092},{"_id":"source/images/prueba-dns-mysql.png","hash":"24be237fd026bae7bf47101b51597d5488de393d","modified":1673314889313},{"_id":"source/images/slap-1-1.png","hash":"26cc09b1e5b77a9b1fac8c5ada98fcd7f94c32f6","modified":1675209625676},{"_id":"source/images/slap-1-11.png","hash":"88d064d8b4ce0f77ac41c958e6cdf4c51f918c1b","modified":1675228261924},{"_id":"source/images/slap-1-10.png","hash":"c39b04a4fd8e580f1b801f097484b6a712a6a4c0","modified":1675221664808},{"_id":"source/images/systemd-1.png","hash":"f5a54a913b85f7e815e3fe1eed43eee11e5abc28","modified":1672754513717},{"_id":"source/images/systemd-2.png","hash":"bb80e91aeffeb304d5d5800148da30a2ee1d0e4b","modified":1672777624132},{"_id":"source/images/systemd-3.png","hash":"2bfcf433b7417607980bc503982e0a7f906d5e05","modified":1672777820092},{"_id":"source/images/systemd-title.jpg","hash":"6552098416a1ccecd84c86102e815b231d426d4a","modified":1672778567432},{"_id":"source/images/vpn-acceso-remoto-ssh-openvpn.png","hash":"2feeb9b251549130bda54d5a0416816e778f770a","modified":1674685019653},{"_id":"source/images/vpn-cliente2.png","hash":"26f92ef87cb189c9bc86cd010ea2639bc79f696d","modified":1674699678533},{"_id":"source/images/vpn-cliente1.png","hash":"ce417062cef920c7cf46b9d860bc50900571f00d","modified":1674699642877},{"_id":"source/images/xorriso-2.png","hash":"c14d072f96c297e98913ea1492395b3069b0568e","modified":1665958312449},{"_id":"source/images/xorriso-3.png","hash":"73ec7f50ca43b000120a460d765b1305ad064cf1","modified":1665958689513},{"_id":"source/images/xorriso-4.png","hash":"a6bbd021a01b5873eee676f8dc395a1b6c4020fc","modified":1665963675157},{"_id":"source/images/interfaces.png","hash":"09b65917ff81f7ab32727becb66e124b50f1c3a8","modified":1665684992696},{"_id":"source/images/iscsi-1.png","hash":"074def37d31e717f64aeeeb9b661d58d44e84d51","modified":1674720336582},{"_id":"source/images/openstack-1.png","hash":"bef024c334c2c76de1b1e424da669f59fa30a2ba","modified":1669547985501},{"_id":"source/images/oracle-ejercicio6.png","hash":"991b7d4599d67b9be602b678359993197118e535","modified":1670379503791},{"_id":"source/images/slap-1-3.png","hash":"578d1bc0e5451eb1128f7f290122759a17e3a4a8","modified":1675210720108},{"_id":"source/images/vpn-cliente-C-win2.png","hash":"9181fc162112c31a8cced20c9df3cacfa5274d44","modified":1674931443137},{"_id":"source/images/web-alfa.png","hash":"5e12750488680d46f2b3898f53ea433fd529a30f","modified":1673317144944},{"_id":"source/images/xorriso-1.png","hash":"22495b789d51bab231b0ebd499e931751cd926af","modified":1665958115337},{"_id":"source/images/Untitled-2023-01-10-0143.png","hash":"595586ea75d531b1bc561d405d2fa330d46a1338","modified":1673312269233},{"_id":"source/images/linux-6.0.jpg","hash":"e89d19a4881437b2fafd6449282aa8167c29f555","modified":1668647690461},{"_id":"source/images/vpn-cliente-C-win.png","hash":"ca4c33a76a761fe8bc7af32e8172d2b0af02d78e","modified":1674931028117},{"_id":"source/images/vpn-site-esquema.png","hash":"a9e5d42add7c2c3737a08247cf3a0b5c669566a7","modified":1674698416261},{"_id":"source/images/wireguard-site-3.png","hash":"602695aee2eccb46a58d08c52135cdeb7bb58b0b","modified":1674786232292},{"_id":"source/images/wireguard-site-4.png","hash":"f049ed5685dc7a251f59a43d9061cc1d8d339fc8","modified":1674786315832},{"_id":"source/images/vistas-dns-1.png","hash":"296a712b836268cd0c5652317898f20dcc6807fa","modified":1673317770068},{"_id":"source/images/xconfig.png","hash":"51356565c80c184def49c0519c7d69b5f645ba49","modified":1668647275249},{"_id":"themes/hexo-theme-claudia/.gitignore","hash":"bd20d54c57507594cd16a21021c3600f9311a1f5","modified":1664451874440},{"_id":"themes/hexo-theme-claudia/LICENSE","hash":"9812afb9d0aa8596067b6fd30cf6089345b7b678","modified":1664451874440},{"_id":"themes/hexo-theme-claudia/CHANGELOG.md","hash":"6a2a5c3e4399d19fa06c175bc7e78c9b18413251","modified":1664451874440},{"_id":"themes/hexo-theme-claudia/CODE_OF_CONDUCT.md","hash":"787b987cd6079f93c7846b69c3b4dfa41cb3ac03","modified":1664451874440},{"_id":"themes/hexo-theme-claudia/_config.yml","hash":"68f14c8f5f276e7d306d23c5b9fd6b61c6ecc9ee","modified":1664969298756},{"_id":"themes/hexo-theme-claudia/package.json","hash":"c59cb2089c51ed56deb2df69171d7adc63c1148f","modified":1664451874444},{"_id":"themes/hexo-theme-claudia/README.md","hash":"17911c948337830658d8322b6b9e37e8431b7b64","modified":1664451874440},{"_id":"themes/hexo-theme-claudia/CONTRIBUTING.md","hash":"618215987cc9a774c37cc70efa1cb8545457a49c","modified":1664451874440},{"_id":"themes/hexo-theme-claudia/languages/en.yml","hash":"52f0fa56a60333dccc19c3be1e4bcc8085668d5a","modified":1664969412168},{"_id":"themes/hexo-theme-claudia/languages/zh-CN.yml","hash":"9d8b1f0a337f56907aadddf406c5977435d34fc1","modified":1664451874440},{"_id":"themes/hexo-theme-claudia/layout/about.pug","hash":"98dea176f76053d5deaf35ed25518d218d70be7d","modified":1664451874440},{"_id":"themes/hexo-theme-claudia/layout/archive.pug","hash":"68c709495bc39a659d9c4b19216714a5ac2b5579","modified":1664451874440},{"_id":"themes/hexo-theme-claudia/layout/category.pug","hash":"2147f3d66640bc6604c9b15325a480d196a4df3d","modified":1664451874440},{"_id":"themes/hexo-theme-claudia/layout/index.pug","hash":"b84b3b89b3ecd0f3c604c2517ccd694d6a8489f4","modified":1664451874440},{"_id":"themes/hexo-theme-claudia/layout/page.pug","hash":"6c5db904a03adb4794b7ada222389da12d395bc7","modified":1664451874440},{"_id":"themes/hexo-theme-claudia/layout/post.pug","hash":"c76194840b5d6b7b881651cb492ab4b6963d1725","modified":1664451874440},{"_id":"themes/hexo-theme-claudia/layout/tag.pug","hash":"16dac6e0a6ef939ceb6adb21dfbe0276538ff269","modified":1664451874440},{"_id":"themes/hexo-theme-claudia/README-CN.md","hash":"2dddb18f2761b5e495d6f71ab9880797af839926","modified":1664451874440},{"_id":"themes/hexo-theme-claudia/.github/FUNDING.yml","hash":"dd672081ec4678929f6c1ac3ebbef4d990291ecd","modified":1664451874440},{"_id":"themes/hexo-theme-claudia/source/favicon.ico","hash":"96b9a549337c2bec483c2879eeafa4d1f8748fed","modified":1664451874460},{"_id":"themes/hexo-theme-claudia/.github/ISSUE_TEMPLATE/bug_report.md","hash":"b38365fec9b6cac6bbb75441082f041c4efd35bf","modified":1664451874440},{"_id":"themes/hexo-theme-claudia/.github/PULL_REQUEST_TEMPLATE.md","hash":"35751990a36fffe5a5f6fd682452fe5594cadde9","modified":1664451874440},{"_id":"themes/hexo-theme-claudia/layout/widget/base.pug","hash":"b75bac1f7c8b76c555c53fb062b85a2c15822326","modified":1664970310036},{"_id":"themes/hexo-theme-claudia/layout/widget/methods.pug","hash":"fa62f6ad95d1a4cda5038595d19d4d11b4b39e17","modified":1664451874440},{"_id":"themes/hexo-theme-claudia/layout/widget/widget-archives.pug","hash":"e6bcf8b09a5e06119baf3f97f7798ef7600ab65c","modified":1664451874440},{"_id":"themes/hexo-theme-claudia/layout/widget/widget-categories.pug","hash":"ea3bcd5f5fb06e26d8b67f30f224e7c129672980","modified":1664451874444},{"_id":"themes/hexo-theme-claudia/layout/widget/widget-header.pug","hash":"d7cf01cbe962a02dc03788eafcfb9a32780032a0","modified":1664969029568},{"_id":"themes/hexo-theme-claudia/layout/widget/widget-post-list.pug","hash":"f034a4b8231f7933d06e364671b11847c74b9a5c","modified":1664451874444},{"_id":"themes/hexo-theme-claudia/layout/widget/widget-profile.pug","hash":"fbe18f3dd5e8d2850f8e6510da4fbd499d5096f0","modified":1664451874444},{"_id":"themes/hexo-theme-claudia/layout/widget/widget-recent.pug","hash":"7512dceae690ea219d562a6e450d633e29916072","modified":1664451874444},{"_id":"themes/hexo-theme-claudia/layout/widget/widget-search.pug","hash":"c17612dd4ae2d439d757818ec0e4215d71dd9ad5","modified":1664451874444},{"_id":"themes/hexo-theme-claudia/layout/widget/widget-sns.pug","hash":"8ec154d321b36a5f3bf5974c75668b45ec660c1d","modified":1664451874444},{"_id":"themes/hexo-theme-claudia/layout/widget/widget-tag.pug","hash":"714a05148758e1e3cc12635c875cb6ef1753c6ab","modified":1664451874444},{"_id":"themes/hexo-theme-claudia/source/js/common.js","hash":"7f62c8c148ee0b528a2bea47b248b2a7f5501142","modified":1664451874460},{"_id":"themes/hexo-theme-claudia/source/js/post.js","hash":"04edd583f103ba444d8174d55e7f45e27b8f2549","modified":1664451874460},{"_id":"themes/hexo-theme-claudia/source/style/about.scss","hash":"4a1beebb317c598b11fc4815e70b07bbb6d2aed7","modified":1664451874460},{"_id":"themes/hexo-theme-claudia/source/style/archive.scss","hash":"cd1dc16dfa7c482cc88ddabaf8c9a459299a98cf","modified":1664451874460},{"_id":"themes/hexo-theme-claudia/source/style/base.scss","hash":"da7457c952b6b433f273d7ecc562d24dcd4aa431","modified":1664451874460},{"_id":"themes/hexo-theme-claudia/source/style/post.scss","hash":"8a3520a0ceb22a2fde35b09485e2df6dd5a23b6f","modified":1664451874464},{"_id":"themes/hexo-theme-claudia/.github/ISSUE_TEMPLATE/feature_request.md","hash":"9d8447814c3ac93d7fbd336015e7ef80c4a32831","modified":1664451874440},{"_id":"themes/hexo-theme-claudia/source/style/widget-header.scss","hash":"18782c2ab206abbeb0ee59632864251acfd20d85","modified":1664451874464},{"_id":"themes/hexo-theme-claudia/source/style/widget-post-list.scss","hash":"db24becef1636806767dfaa33b3f90c40450de8d","modified":1664451874464},{"_id":"themes/hexo-theme-claudia/source/style/common/helper.scss","hash":"7cd0982fe839e760523f8f85ea6f06f2b5d2111a","modified":1664451874464},{"_id":"themes/hexo-theme-claudia/source/style/themes/default-dark.scss","hash":"0cbdc5738503f55e5b84e1bd00e445c98c7d56d2","modified":1664451874464},{"_id":"themes/hexo-theme-claudia/source/style/common/variable.scss","hash":"fffe6eacfa4d814626a1e1d84dc651233eded060","modified":1664451874464},{"_id":"themes/hexo-theme-claudia/source/style/themes/default-light.scss","hash":"23e7c1f87e252db80d34d36a2129e98dde7b1b55","modified":1664451874464},{"_id":"themes/hexo-theme-claudia/source/style/themes/highlight-theme-light.css","hash":"f7b19080f00e10723bc86e6819fc25143a0137c5","modified":1664451874464},{"_id":"themes/hexo-theme-claudia/source/style/themes/theme.scss","hash":"caf7517c9200bbf7152a7f5edba4298fbf9ae629","modified":1664451874464},{"_id":"themes/hexo-theme-claudia/source/js/highlight.pack.js","hash":"2ef9bbbc688ce413686ce0eb64d0b25af4ea34e2","modified":1664451874460},{"_id":"themes/hexo-theme-claudia/images/avatar.jpg","hash":"51120c892d8c6d78ab7a76540be50f8cd40afc73","modified":1664454009184},{"_id":"source/images/wireguard-site-1.png","hash":"b72c57eec7956096a4f21e0ebecf7199a616e231","modified":1674785744944},{"_id":"themes/hexo-theme-claudia/source/style/common/bulma.css","hash":"7ede761951c6f274850a1038416559a8f648c493","modified":1664451874460},{"_id":"themes/hexo-theme-claudia/screenshot/claudia-cover.png","hash":"757680cd3648e3569d6a18abaf33180dc427d620","modified":1664451874460},{"_id":"themes/hexo-theme-claudia/screenshot/claudia-cover-v2.png","hash":"f477d90d327a638a46b3caa172332e931955a532","modified":1664451874452},{"_id":"source/images/avatar.jpg","hash":"88cc5b48d09f7f81bad425206dc76a47084aaf99","modified":1664647815576},{"_id":"public/rss.xml","hash":"43b3b6b86745fa19195e910ec62b085bfffbb9ae","modified":1675229309261},{"_id":"public/tag/servicios de red e internet/rss.xml","hash":"56934184c03286b65083a7a75e8fcf98a4388609","modified":1675229309261},{"_id":"public/tag/sistemas operativos/rss.xml","hash":"883d24b04b26bfe50b3ca8b1ed27986786e9cde8","modified":1675229309261},{"_id":"public/tag/seguridad/rss.xml","hash":"2a2f73e8f32f45772549b15dc1692597b40801d9","modified":1675229309261},{"_id":"public/category/servicios de red e internet/rss.xml","hash":"1652930ccaa036da54f216403d087cb71ac28f90","modified":1675229309261},{"_id":"public/category/sistemas operativos/rss.xml","hash":"cd8ae28bfbddbcc5671e313144d2f86ad8c0d18e","modified":1675229309261},{"_id":"public/category/bases de datos/rss.xml","hash":"619be9589fb23e70b9e732987c971dc9cbd4bbd4","modified":1675229309261},{"_id":"public/category/seguridad/rss.xml","hash":"91d5c4953e2683ac4f1f94338745ab2a1a48cabf","modified":1675229309261},{"_id":"public/category/administración de sistemas/rss.xml","hash":"91d0d0fcf433de5fe1345d890ba0b4894a405e95","modified":1675229309261},{"_id":"public/atom.xml","hash":"793b0b418f3d140c661ad9928ee7e5a0b361894c","modified":1675229309261},{"_id":"public/feed.json","hash":"2691b70af314797d946fb4222a2486353142dc15","modified":1675229309261},{"_id":"public/tag/servicios de red e internet/feed.json","hash":"ac5c17879a2893b1903de4a2790f350f0adbfeb1","modified":1675229309261},{"_id":"public/tag/sistemas operativos/feed.json","hash":"a45bda71f2ef2745fbccd4ada0fdf772b1df0971","modified":1675229309261},{"_id":"public/tag/seguridad/feed.json","hash":"589ec8883908b3fb4973d43377146bd0638961f2","modified":1675229309261},{"_id":"public/category/servicios de red e internet/feed.json","hash":"fd2fc445d079c8f71af934a18460d05c040a7237","modified":1675229309261},{"_id":"public/category/sistemas operativos/feed.json","hash":"6078354d0d6909684ef80805d7ebf0f21c6e4b34","modified":1675229309261},{"_id":"public/category/bases de datos/feed.json","hash":"ea7ac3a6c48d92cffd74c0bdd975f37c9339ff3c","modified":1675229309261},{"_id":"public/category/seguridad/feed.json","hash":"86cbea25d303169e34328a207f5a8156ca84d6d0","modified":1675229309261},{"_id":"public/category/administración de sistemas/feed.json","hash":"c018ab66cedd97221ed2c0130f7a8c20a8dd15aa","modified":1675229309261},{"_id":"public/search.xml","hash":"0662f7da616011029ce2cf16664f9325c7ac0a37","modified":1675229309261},{"_id":"public/about/index.html","hash":"e0d9b2c843a2c75eef5ea0251e420be306f3200c","modified":1675229309261},{"_id":"public/categories/index.html","hash":"514d1fb526cdb45a93c7dd132309144ca92fda02","modified":1675229309261},{"_id":"public/tags/index.html","hash":"326ae74800092ce15f375c1139b1b44dfa7ceeae","modified":1675229309261},{"_id":"public/2023/01/26/vpn-wireguard/index.html","hash":"edbb429a48b45ac0387a06f84f1f79a17391218c","modified":1675229309261},{"_id":"public/2023/01/24/vpn/index.html","hash":"ab7b206c1c118523999981a9f8675ec32ece1bc0","modified":1675229309261},{"_id":"public/2023/01/10/dns-vistas/index.html","hash":"53272411f06a01c45e984421e876f49c4ddd655d","modified":1675229309261},{"_id":"public/2023/01/03/nfs-systemd/index.html","hash":"85fd1aea0888df4b0b0eedd0f366d72c2a643c7a","modified":1675229309261},{"_id":"public/2022/11/16/Compilar-linux-a-medida/index.html","hash":"e99af0d446627ea1656bd2ae90b1dd81d5786ebc","modified":1675229309261},{"_id":"public/2022/10/13/Ansible+Vagrant/index.html","hash":"a2b4e8b6e7f77ea3f050f04859d15fe0cf623a06","modified":1675229309261},{"_id":"public/2022/10/04/Preseed-pxe/index.html","hash":"545137f702a34781b7aa8230d083bf02d7a08fb2","modified":1675229309261},{"_id":"public/2022/09/30/preseed/index.html","hash":"4d9c3e3a134bab08907b674c2ac9146449622d97","modified":1675229309261},{"_id":"public/2022/09/30/Compilar-en-debian/index.html","hash":"e1b60cc68d81b7e8de4ffd5e99b11345c00f66b1","modified":1675229309261},{"_id":"public/archives/page/2/index.html","hash":"12a37353e325402a484bdf17d7a0673b5d326d5b","modified":1675229309261},{"_id":"public/archives/2022/index.html","hash":"dee5596ca24a5ad6d75ce1ba27c90c8201bbccba","modified":1675229309261},{"_id":"public/archives/2022/09/index.html","hash":"fa3c5680304ff23f0cb52eaa9a64560b1988e7d2","modified":1675229309261},{"_id":"public/archives/2022/10/index.html","hash":"08697053d473db014d1c116a6253598e91e104d6","modified":1675229309261},{"_id":"public/archives/2022/11/index.html","hash":"c909afa7dea148a737f12ac2856092a663e2a739","modified":1675229309261},{"_id":"public/archives/2022/12/index.html","hash":"741c9f8792aaee758ce27b9cba2026ce4154ed13","modified":1675229309261},{"_id":"public/archives/2023/index.html","hash":"97ce588b1319b7857d3d8447531d6e97d41007e2","modified":1675229309261},{"_id":"public/archives/2023/01/index.html","hash":"438364ed8c11a5b2e7af6cc56e435451275f95bd","modified":1675229309261},{"_id":"public/archives/2023/02/index.html","hash":"7ef127ca0bedd4985d91135cda4001f2711097aa","modified":1675229309261},{"_id":"public/categories/Servicios-de-Red-e-Internet/index.html","hash":"a711ff9431b7ee2ef588790c6a3344cf33e89406","modified":1675229309261},{"_id":"public/categories/Sistemas-Operativos/index.html","hash":"5c475d552001dee7e846d90e2a26749368548b3e","modified":1675229309261},{"_id":"public/categories/Bases-de-Datos/index.html","hash":"b4618c046aee82c811ee5d72344473d568e130f5","modified":1675229309261},{"_id":"public/categories/Seguridad/index.html","hash":"243a86fc890094feb189fbde0dc590cc0935f9b1","modified":1675229309261},{"_id":"public/categories/Administracion-de-Sistemas/index.html","hash":"f876dc375a6eee467c2d74228070dc95c1a0ed4c","modified":1675229309261},{"_id":"public/tags/Servicios-de-Red-e-Internet/index.html","hash":"f73d45cf9363a7434ddd1ba38ac9e66b5d391b8d","modified":1675229309261},{"_id":"public/tags/Sistemas-Operativos/index.html","hash":"c1722e24141140b2810225f1683ed8fead7069d8","modified":1675229309261},{"_id":"public/tags/Seguridad/index.html","hash":"bb67f2dc51ca89320a2399ab9002e3da881ffa5b","modified":1675229309261},{"_id":"public/archives/index.html","hash":"687d7666274b65a9a0c122342f0398c6278ea935","modified":1675229309261},{"_id":"public/2023/02/01/slap-nfs/index.html","hash":"24cec4a1ad377eca06e544f1c108385fd5721509","modified":1675229309261},{"_id":"public/2022/12/13/dns/index.html","hash":"02078079ac410b7f7ecf738eea1bb8561c24341d","modified":1675229309261},{"_id":"public/2022/12/07/plsql_basico/index.html","hash":"4bae14e35b5817b5cd0dc7ab806a136fcf6994a0","modified":1675229309261},{"_id":"public/2022/11/09/Interconexiones/index.html","hash":"b771e0a21e906927b4cceba31132eadff2b4b232","modified":1675229309261},{"_id":"public/index.html","hash":"6c3472f127510c40b9be4bc8cf885b7cd40aa3c9","modified":1675229309261},{"_id":"public/page/2/index.html","hash":"aaf761758c85dc05833d185f554903c5fc39a91b","modified":1675229309261},{"_id":"public/favicon.ico","hash":"96b9a549337c2bec483c2879eeafa4d1f8748fed","modified":1675229309261},{"_id":"public/images/LDAP-LOGO.png","hash":"4ca32c33412131db35a8211279b273bb2dbd205a","modified":1675229309261},{"_id":"public/images/DeepinScreenshot_Seleccionar área_20230109125013.png","hash":"c8f5fe4a30991d0d1a1580a8a75b12915aa7c6db","modified":1675229309261},{"_id":"public/images/LOGO-LDAP.png","hash":"8f0e96e3751a0e4132a324130b509037142e1923","modified":1675229309261},{"_id":"public/images/ansibleandvagrant.jpg","hash":"971466418b3ab8273ecadd85ee0e4db1b0dca8aa","modified":1675229309261},{"_id":"public/images/debian-11.jpg","hash":"0ec714f3546f8aa4e1dec561f22200a1a7e834f7","modified":1675229309261},{"_id":"public/images/iscsi-2.png","hash":"076c2dce4bd63bf158886b17464625bc004ba0bd","modified":1675229309261},{"_id":"public/images/iscsi-3.png","hash":"30612c83110853a0aecf9c74cb01b864a2066394","modified":1675229309261},{"_id":"public/images/logo-wireguard.png","hash":"ba7901e5e8974e849fcd5ee9fc346ab6c38f058a","modified":1675229309261},{"_id":"public/images/obelix-4.jpg","hash":"41deba00d16881be564bc3c2b6c38b6c9edcbbe2","modified":1675229309261},{"_id":"public/images/oracle-ejercicio1.png","hash":"29dd25a06447a8f4fa535a383e0031d72338c00d","modified":1675229309261},{"_id":"public/images/oracle-ejercicio10.png","hash":"e76c08f41feb072224354119f1f301707e9801e3","modified":1675229309261},{"_id":"public/images/oracle-ejercicio2.png","hash":"e8048be041d163e7a1985897b2f139bc3fa8cc37","modified":1675229309261},{"_id":"public/images/oracle-ejercicio3.png","hash":"ea378d9e3203e7277679b0b1cf0fe7005c649864","modified":1675229309261},{"_id":"public/images/oracle-ejercicio4.png","hash":"33cdc878dffce0c026dcf2955486ed7cf924b801","modified":1675229309261},{"_id":"public/images/oracle-ejercicio5.png","hash":"6cec63601b96812d96b3287b95a34f1b1bd8b164","modified":1675229309261},{"_id":"public/images/oracle-ejercicio7.png","hash":"7e2e58dfc9f67bbb26c2b2eff374da3ae8241f07","modified":1675229309261},{"_id":"public/images/oracle-ejercicio8.png","hash":"df6b429fec204dc994166f53f45d9b57f45b5e3b","modified":1675229309261},{"_id":"public/images/oracle-postgres.png","hash":"7e094bc8ebd39321abae95dcb7ba2b791f832ce8","modified":1675229309261},{"_id":"public/images/oraclepostgres.jpg","hash":"49f24db75b5a65e82eebf7885eb3144e93fece84","modified":1675229309261},{"_id":"public/images/postgres-ejercicio1.png","hash":"c779d6d4b5d87523b52d110370412caa5a33e406","modified":1675229309261},{"_id":"public/images/postgres-ejercicio2.png","hash":"04c9e70b5f3190ceda891bb9f955800af866de84","modified":1675229309261},{"_id":"public/images/postgres-postgres.png","hash":"3088be58cdf85b4b7a2bdfad7fee66d2b4361707","modified":1675229309261},{"_id":"public/images/prueba-dns-mysql2.png","hash":"e3771b76bcef65de8246116704b2b1b72116d06c","modified":1675229309261},{"_id":"public/images/slap-1-2.png","hash":"f0095156418e8020d57e46705c923dbe3adb2cc2","modified":1675229309261},{"_id":"public/images/slap-1-4.png","hash":"33cd347b0bc84ef8055c883d03b8908dcc023bc9","modified":1675229309261},{"_id":"public/images/slap-1-5.png","hash":"07e3c259878958b9e172bd578f978ec0997fe2d0","modified":1675229309261},{"_id":"public/images/slap-1-6.png","hash":"8f5455d42738ec8b3fa94559d431a07f57e029b0","modified":1675229309261},{"_id":"public/images/slap-1-7.png","hash":"b50e3a83c85685c034a8701d49ef3c2cd496b3ad","modified":1675229309261},{"_id":"public/images/slap-1-8.png","hash":"911ce0b78c9d5656525d2e5b390ee418b6bd63a1","modified":1675229309261},{"_id":"public/images/slap-1-9.png","hash":"ea5552dcbd876cbf921fe633ed7d40d52c21a6e6","modified":1675229309261},{"_id":"public/images/traceroute-openvpn.png","hash":"df547bcd8779208925a87598dba72a929255f148","modified":1675229309261},{"_id":"public/images/vpn-cliente-C-lin.png","hash":"41207c845de1a19270fdf2c30c84473c494541f4","modified":1675229309261},{"_id":"public/images/vpn-cliente1-traceroute.png","hash":"f7f6b6f4b5343a04dec8fe9f3955d70ceaea9618","modified":1675229309261},{"_id":"public/images/vpn-cliente2-traceroute.png","hash":"6df66844ef593a700cfcbde2f12beaab9a62fcd8","modified":1675229309261},{"_id":"public/images/vpn-logo.png","hash":"6ff76f203702e5484a9a31ac88bb57beab17e1fc","modified":1675229309261},{"_id":"public/images/wireguard-site-2.png","hash":"df98cec5dafd87ce85a1e0006e20260278537fbd","modified":1675229309261},{"_id":"public/images/ASO-PRACTICA1.png","hash":"7835d5258c3db2e4ff89d9a3b68d878de321a2d7","modified":1675229309261},{"_id":"public/images/Ansible.png","hash":"bb2219f79f255fd314a7a30ff5c1ea836e59e45c","modified":1675229309261},{"_id":"public/images/obelix-2.png","hash":"095139626f99764efecc71aa7ec3c9dd277bcfe8","modified":1675229309261},{"_id":"public/images/obelix-3.png","hash":"df792e4fbc26d4e49cf0d96a29cc7fdb5fe22df2","modified":1675229309261},{"_id":"public/images/obelix.png","hash":"0685e54f4641567c507545d0a5f62849a53c30f6","modified":1675229309261},{"_id":"public/images/oracle-ejercicio9.png","hash":"65cf3e3f684daab8b4d4350955d2d5549ae58635","modified":1675229309261},{"_id":"public/images/postgres-oracle.png","hash":"2108b5c5062f5ac874786078e55637dadd245c4a","modified":1675229309261},{"_id":"public/images/prueba-dns-mysql.png","hash":"24be237fd026bae7bf47101b51597d5488de393d","modified":1675229309261},{"_id":"public/images/slap-1-1.png","hash":"26cc09b1e5b77a9b1fac8c5ada98fcd7f94c32f6","modified":1675229309261},{"_id":"public/images/slap-1-10.png","hash":"c39b04a4fd8e580f1b801f097484b6a712a6a4c0","modified":1675229309261},{"_id":"public/images/slap-1-11.png","hash":"88d064d8b4ce0f77ac41c958e6cdf4c51f918c1b","modified":1675229309261},{"_id":"public/images/systemd-1.png","hash":"f5a54a913b85f7e815e3fe1eed43eee11e5abc28","modified":1675229309261},{"_id":"public/images/systemd-2.png","hash":"bb80e91aeffeb304d5d5800148da30a2ee1d0e4b","modified":1675229309261},{"_id":"public/images/systemd-3.png","hash":"2bfcf433b7417607980bc503982e0a7f906d5e05","modified":1675229309261},{"_id":"public/images/systemd-title.jpg","hash":"6552098416a1ccecd84c86102e815b231d426d4a","modified":1675229309261},{"_id":"public/images/vpn-acceso-remoto-ssh-openvpn.png","hash":"2feeb9b251549130bda54d5a0416816e778f770a","modified":1675229309261},{"_id":"public/images/vpn-cliente1.png","hash":"ce417062cef920c7cf46b9d860bc50900571f00d","modified":1675229309261},{"_id":"public/images/vpn-cliente2.png","hash":"26f92ef87cb189c9bc86cd010ea2639bc79f696d","modified":1675229309261},{"_id":"public/images/xorriso-2.png","hash":"c14d072f96c297e98913ea1492395b3069b0568e","modified":1675229309261},{"_id":"public/images/xorriso-3.png","hash":"73ec7f50ca43b000120a460d765b1305ad064cf1","modified":1675229309261},{"_id":"public/images/xorriso-4.png","hash":"a6bbd021a01b5873eee676f8dc395a1b6c4020fc","modified":1675229309261},{"_id":"public/js/common.js","hash":"7f62c8c148ee0b528a2bea47b248b2a7f5501142","modified":1675229309261},{"_id":"public/js/post.js","hash":"04edd583f103ba444d8174d55e7f45e27b8f2549","modified":1675229309261},{"_id":"public/style/themes/highlight-theme-light.css","hash":"f7b19080f00e10723bc86e6819fc25143a0137c5","modified":1675229309261},{"_id":"public/js/highlight.pack.js","hash":"2ef9bbbc688ce413686ce0eb64d0b25af4ea34e2","modified":1675229309261},{"_id":"public/style/common/bulma.css","hash":"337aa6363e207135f5ea4ca3f25e18f820220f52","modified":1675229309261},{"_id":"public/images/interfaces.png","hash":"09b65917ff81f7ab32727becb66e124b50f1c3a8","modified":1675229309261},{"_id":"public/images/iscsi-1.png","hash":"074def37d31e717f64aeeeb9b661d58d44e84d51","modified":1675229309261},{"_id":"public/images/openstack-1.png","hash":"bef024c334c2c76de1b1e424da669f59fa30a2ba","modified":1675229309261},{"_id":"public/images/oracle-ejercicio6.png","hash":"991b7d4599d67b9be602b678359993197118e535","modified":1675229309261},{"_id":"public/images/slap-1-3.png","hash":"578d1bc0e5451eb1128f7f290122759a17e3a4a8","modified":1675229309261},{"_id":"public/images/vpn-cliente-C-win2.png","hash":"9181fc162112c31a8cced20c9df3cacfa5274d44","modified":1675229309261},{"_id":"public/images/web-alfa.png","hash":"5e12750488680d46f2b3898f53ea433fd529a30f","modified":1675229309261},{"_id":"public/images/xorriso-1.png","hash":"22495b789d51bab231b0ebd499e931751cd926af","modified":1675229309261},{"_id":"public/style/themes/default-dark.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1675229309261},{"_id":"public/style/themes/default-light.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1675229309261},{"_id":"public/style/common/variable.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1675229309261},{"_id":"public/style/archive.css","hash":"fc79cddde5b0ee019889337bb3098d73bb6824cb","modified":1675229309261},{"_id":"public/style/about.css","hash":"9a244b903c425bb5d8c7f0859c620574e834a38e","modified":1675229309261},{"_id":"public/style/widget-header.css","hash":"80113d3a162a87b0574b478700242e8bb8cc9cf0","modified":1675229309261},{"_id":"public/style/common/helper.css","hash":"a3e09c0e185f4e960f4a83124306e7589f0a01c1","modified":1675229309261},{"_id":"public/style/themes/theme.css","hash":"a334f9eaa157eda2bce485b22237a5d24cdf7d70","modified":1675229309261},{"_id":"public/style/post.css","hash":"9e42bd627735bf438d97c1709f76b853f2989a25","modified":1675229309261},{"_id":"public/style/base.css","hash":"e83bb81e864a736a80abe2901485cf43a1d86a87","modified":1675229309261},{"_id":"public/style/widget-post-list.css","hash":"456f9bee783a92b40774d48d250be118e2602f36","modified":1675229309261},{"_id":"public/images/Untitled-2023-01-10-0143.png","hash":"595586ea75d531b1bc561d405d2fa330d46a1338","modified":1675229309261},{"_id":"public/images/linux-6.0.jpg","hash":"e89d19a4881437b2fafd6449282aa8167c29f555","modified":1675229309261},{"_id":"public/images/vpn-cliente-C-win.png","hash":"ca4c33a76a761fe8bc7af32e8172d2b0af02d78e","modified":1675229309261},{"_id":"public/images/vpn-site-esquema.png","hash":"a9e5d42add7c2c3737a08247cf3a0b5c669566a7","modified":1675229309261},{"_id":"public/images/wireguard-site-3.png","hash":"602695aee2eccb46a58d08c52135cdeb7bb58b0b","modified":1675229309261},{"_id":"public/images/wireguard-site-4.png","hash":"f049ed5685dc7a251f59a43d9061cc1d8d339fc8","modified":1675229309261},{"_id":"public/images/vistas-dns-1.png","hash":"296a712b836268cd0c5652317898f20dcc6807fa","modified":1675229309261},{"_id":"public/images/xconfig.png","hash":"51356565c80c184def49c0519c7d69b5f645ba49","modified":1675229309261},{"_id":"public/images/wireguard-site-1.png","hash":"b72c57eec7956096a4f21e0ebecf7199a616e231","modified":1675229309261},{"_id":"public/images/avatar.jpg","hash":"88cc5b48d09f7f81bad425206dc76a47084aaf99","modified":1675229309261}],"Category":[{"name":"Servicios de Red e Internet","_id":"cldl8a0p200042fi5c1wu7fjk"},{"name":"Sistemas Operativos","_id":"cldl8a0p6000b2fi5dj8ifaxg"},{"name":"Bases de Datos","_id":"cldl8a0p8000h2fi53a7za8oj"},{"name":"Seguridad","_id":"cldl8a0pf000y2fi57w27d65j"},{"name":"Administración de Sistemas","_id":"cldl8a0pf00122fi5dh1f1o1b"}],"Data":[],"Page":[{"title":"about","date":"2022-09-29T10:42:46.000Z","_content":"","source":"about/index.md","raw":"---\ntitle: about\ndate: 2022-09-29 12:42:46\n---\n","updated":"2022-09-29T10:42:46.932Z","path":"about/index.html","comments":1,"layout":"page","_id":"cldl8a0ov00002fi53bu0gp6d","content":"","site":{"data":{}},"length":0,"excerpt":"","more":""},{"title":"archives","date":"2022-09-29T10:42:44.000Z","_content":"","source":"archives/index.md","raw":"---\ntitle: archives\ndate: 2022-09-29 12:42:44\n---\n","updated":"2022-09-29T10:42:44.348Z","path":"archives/index.html","comments":1,"layout":"page","_id":"cldl8a0p000022fi50bu3100t","content":"","site":{"data":{}},"length":0,"excerpt":"","more":""},{"title":"categories","date":"2022-09-29T10:42:45.000Z","_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2022-09-29 12:42:45\n---\n","updated":"2022-09-29T10:42:45.208Z","path":"categories/index.html","comments":1,"layout":"page","_id":"cldl8a0p300062fi57kruas4o","content":"","site":{"data":{}},"length":0,"excerpt":"","more":""},{"title":"tags","date":"2022-09-29T10:42:46.000Z","_content":"\n","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2022-09-29 12:42:46\n---\n\n","updated":"2022-10-05T11:09:15.316Z","path":"tags/index.html","comments":1,"layout":"page","_id":"cldl8a0p500082fi598lb5nfy","content":"","site":{"data":{}},"length":0,"excerpt":"","more":""}],"Post":[{"title":"Ansible + Vagrant, configurar y enrutar servidor web.","_content":"\n\n![Descripción de la imagen](/images/ansibleandvagrant.jpg)\n\n\nComenzaremos este post viendo como adjuntamos una box https://app.vagrantup.com/boxes/search\nbuscamos por ejemplo la de debian/ullseye, vamos a nuestra terminal y escribimos lo siguiente:\n`vagrant box add debian/bullseye64`\n\nEn ese momento se guardará en `~/.vagrant.d/boxes`\nBueno, dicho esto procedemos a crear la carpeta donde vamos a trabajar y hacemos un `vagrant init`, esto hará que se cree un archivo llamado vagrantfile, el cual debe quedar de la siguiente manera:\n\n```\nVagrant.configure(\"2\") do |config|\n    config.vm.define :nodo1 do |nodo1|\n      nodo1.vm.box = \"debian/bullseye64\"\n      nodo1.vm.hostname= \"nodo1\"\n      nodo1.vm.synced_folder \".\", \"/vagrant\", disabled: true\n      nodo1.vm.network :public_network,\n        :dev => \"br0\",\n        :mode => \"bridge\",\n        :type => \"bridge\",\n        use_dhcp_assigned_default_route: true\n      nodo1.vm.network :private_network,\n        :libvirt__network_name => \"red1\",\n        :libvirt__dhcp_enabled => false,\n        :ip => \"10.0.0.10\",\n        :libvirt__forward_mode => \"veryisolated\"\n    end\n    config.vm.define :nodo2 do |nodo2|\n      nodo2.vm.box = \"debian/bullseye64\"\n      nodo2.vm.hostname = \"nodo2\"\n      nodo2.vm.synced_folder \".\", \"/vagrant\", disabled: true\n      nodo2.vm.network :private_network,\n        :libvirt__network_name => \"red1\",\n        :libvirt__dhcp_enabled => false,\n        :ip => \"10.0.0.11\",\n        :libvirt__forward_mode => \"veryisolated\",\n        use_dhcp_assigned_default_route: true\n    end\nend\n\n```\n\nVamos a explicar paso por paso qué vemos en el código:\n- El vagrantfile debe estar perfectamente alineado, los end con sus respectivos config.\n- Al ser dos máquinas las vamos a llamar nodo1 y nodo2, que una será el router y la segunda el servidor que aloje apache\n- Si nos fijamos con atención podemos ver que **nodo1** tiene dos redes, una será pública, la cual tiene un bridge por donde saldrá a internet, y una red privada muy aislada, la cual no contendrá nada más que una ip estática, pondremos que la ruta por defecto va a ser el bridge que nos llevará a internet.\n- En **nodo2** tendremos una red privada, más tarde procederemos a ejecutar unas reglas que nos permitan salir por el exterior a través de la red muy aislada con **nat**\n  \nUna vez hecho esto procedemos a ver de cerca lo que contiene Ansible, el cual ejecutaremos tras iniciar las máquinas de Vagrant junto con sus redes.\n\n![Descripción de la imagen](/images/Ansible.png)\n\nComo podemos ver, hay una serie de carpetas llamadas roles, cada rol va a ejecutar una o varias tareas dependiendo de lo que se trate, por lo tanto así quedaría por ejemplo el activado del bit de forwarding del router:\n\n```\n- ansible.posix.sysctl:\n    name: net.ipv4.ip_forward\n    value: '1'\n    sysctl_set: yes\n```\n\nEstas tareas tienen un orden, y se realiza dentro de site.yml:\n```\n- hosts: nodo1\n  become: true\n  roles:\n   - role: copy\n\n- hosts: all\n  become: true\n  roles:\n   - role: commons\n\n- hosts: nodo2\n  become: true\n  roles:\n   - role: copy2\n   - role: apache2\n\n- hosts: nodo1\n  become: true\n  roles:\n   - role: ipv4\n\n```\n\nCon un poco de conocimientos en sistemas podemos ver claramente qué realiza cada rol.\n\nAhora vamos a poner la lupa en `roles/commons/handlers/main.yaml`, una parte muy importante de la ejecución de Ansible:\n```\n- name: reiniciando maquina\n  ansible.builtin.reboot:\n    msg: \"reboot by Ansible\"\n    pre_reboot_delay: 5\n    post_reboot_delay: 10\n    test_command: \"whoami\"\n```\n\nEste handler se ejecuta en el momento en el que se hace un llamamiento, en nuestro caso es cuando copiamos al router un fichero configurado para etc/network/interfaces, con sus interfaces, ruta por defecto e iptables:\n\n![Descripción de la imagen](/images/interfaces.png)\n\npodemos ver como en `roles/copy/tasks/main.yaml` hace el llamamiento al **handler** en el notify:\n\n```\n- name: Copiando al etc/network/interfaces\n  ansible.builtin.copy:\n    src: interfaz_nodo1/interfaces\n    dest: /etc/network/\n    owner: root\n    group: root\n    mode: u-rw,g-wx,o-rwx\n  notify:\n    - reiniciando maquina\n\n```\n\nA continuación podemos copiar nuestra clave pública a través de la tarea **commons** que será lo que nos permita atravesar por ssh sin utilizar la clave vagrant, es decir, la nuestra.\n\n```\n- name: Ensure system is updated\n  apt: update_cache=yes upgrade=yes\n\n- name: Set authorized key took from file\n  authorized_key:\n    user: vagrant\n    state: present\n    key: \"{{ lookup('file', '/home/antonio/.ssh/id_rsa.pub') }}\"\n\n```\n\nLuego pasamos a la instalación de Apache,a través del módulo apt para instalar apache2, ports.conf es la configuración de los puertos por los que escucha, también alberga el fichero index.html y una plantilla jinja2.\n\nPor último pero no menos importante está el fichero hosts, el cual será el inventario por el cual el sistema sabrá cuál será nodo1 y cuál nodo2, a través de las correspondientes ips que asignaremos,el usuario más la clave privada que asignará vagrant:\n\n```\nall:\n  children:\n    servidores_web:\n      hosts:\n        nodo1:\n          ansible_ssh_host: 192.168.121.212\n          ansible_ssh_user: vagrant\n          ansible_ssh_private_key_file: ../.vagrant/machines/nodo1/libvirt/private_key\n        nodo2:\n          ansible_ssh_host: 192.168.121.111\n          ansible_ssh_user: vagrant\n          ansible_ssh_private_key_file: ../.vagrant/machines/nodo2/libvirt/private_key\n\n```\n\ncon esto solo necesitaremos ejecutar el `ansible-playbook site.yaml` y tendremos enrutado y configurado nuestro servidor web.","source":"_posts/Ansible+Vagrant.md","raw":"---\ntitle: Ansible + Vagrant, configurar y enrutar servidor web.\ncategories: Servicios de Red e Internet\ntags: Servicios de Red e Internet\n---\n\n\n![Descripción de la imagen](/images/ansibleandvagrant.jpg)\n\n\nComenzaremos este post viendo como adjuntamos una box https://app.vagrantup.com/boxes/search\nbuscamos por ejemplo la de debian/ullseye, vamos a nuestra terminal y escribimos lo siguiente:\n`vagrant box add debian/bullseye64`\n\nEn ese momento se guardará en `~/.vagrant.d/boxes`\nBueno, dicho esto procedemos a crear la carpeta donde vamos a trabajar y hacemos un `vagrant init`, esto hará que se cree un archivo llamado vagrantfile, el cual debe quedar de la siguiente manera:\n\n```\nVagrant.configure(\"2\") do |config|\n    config.vm.define :nodo1 do |nodo1|\n      nodo1.vm.box = \"debian/bullseye64\"\n      nodo1.vm.hostname= \"nodo1\"\n      nodo1.vm.synced_folder \".\", \"/vagrant\", disabled: true\n      nodo1.vm.network :public_network,\n        :dev => \"br0\",\n        :mode => \"bridge\",\n        :type => \"bridge\",\n        use_dhcp_assigned_default_route: true\n      nodo1.vm.network :private_network,\n        :libvirt__network_name => \"red1\",\n        :libvirt__dhcp_enabled => false,\n        :ip => \"10.0.0.10\",\n        :libvirt__forward_mode => \"veryisolated\"\n    end\n    config.vm.define :nodo2 do |nodo2|\n      nodo2.vm.box = \"debian/bullseye64\"\n      nodo2.vm.hostname = \"nodo2\"\n      nodo2.vm.synced_folder \".\", \"/vagrant\", disabled: true\n      nodo2.vm.network :private_network,\n        :libvirt__network_name => \"red1\",\n        :libvirt__dhcp_enabled => false,\n        :ip => \"10.0.0.11\",\n        :libvirt__forward_mode => \"veryisolated\",\n        use_dhcp_assigned_default_route: true\n    end\nend\n\n```\n\nVamos a explicar paso por paso qué vemos en el código:\n- El vagrantfile debe estar perfectamente alineado, los end con sus respectivos config.\n- Al ser dos máquinas las vamos a llamar nodo1 y nodo2, que una será el router y la segunda el servidor que aloje apache\n- Si nos fijamos con atención podemos ver que **nodo1** tiene dos redes, una será pública, la cual tiene un bridge por donde saldrá a internet, y una red privada muy aislada, la cual no contendrá nada más que una ip estática, pondremos que la ruta por defecto va a ser el bridge que nos llevará a internet.\n- En **nodo2** tendremos una red privada, más tarde procederemos a ejecutar unas reglas que nos permitan salir por el exterior a través de la red muy aislada con **nat**\n  \nUna vez hecho esto procedemos a ver de cerca lo que contiene Ansible, el cual ejecutaremos tras iniciar las máquinas de Vagrant junto con sus redes.\n\n![Descripción de la imagen](/images/Ansible.png)\n\nComo podemos ver, hay una serie de carpetas llamadas roles, cada rol va a ejecutar una o varias tareas dependiendo de lo que se trate, por lo tanto así quedaría por ejemplo el activado del bit de forwarding del router:\n\n```\n- ansible.posix.sysctl:\n    name: net.ipv4.ip_forward\n    value: '1'\n    sysctl_set: yes\n```\n\nEstas tareas tienen un orden, y se realiza dentro de site.yml:\n```\n- hosts: nodo1\n  become: true\n  roles:\n   - role: copy\n\n- hosts: all\n  become: true\n  roles:\n   - role: commons\n\n- hosts: nodo2\n  become: true\n  roles:\n   - role: copy2\n   - role: apache2\n\n- hosts: nodo1\n  become: true\n  roles:\n   - role: ipv4\n\n```\n\nCon un poco de conocimientos en sistemas podemos ver claramente qué realiza cada rol.\n\nAhora vamos a poner la lupa en `roles/commons/handlers/main.yaml`, una parte muy importante de la ejecución de Ansible:\n```\n- name: reiniciando maquina\n  ansible.builtin.reboot:\n    msg: \"reboot by Ansible\"\n    pre_reboot_delay: 5\n    post_reboot_delay: 10\n    test_command: \"whoami\"\n```\n\nEste handler se ejecuta en el momento en el que se hace un llamamiento, en nuestro caso es cuando copiamos al router un fichero configurado para etc/network/interfaces, con sus interfaces, ruta por defecto e iptables:\n\n![Descripción de la imagen](/images/interfaces.png)\n\npodemos ver como en `roles/copy/tasks/main.yaml` hace el llamamiento al **handler** en el notify:\n\n```\n- name: Copiando al etc/network/interfaces\n  ansible.builtin.copy:\n    src: interfaz_nodo1/interfaces\n    dest: /etc/network/\n    owner: root\n    group: root\n    mode: u-rw,g-wx,o-rwx\n  notify:\n    - reiniciando maquina\n\n```\n\nA continuación podemos copiar nuestra clave pública a través de la tarea **commons** que será lo que nos permita atravesar por ssh sin utilizar la clave vagrant, es decir, la nuestra.\n\n```\n- name: Ensure system is updated\n  apt: update_cache=yes upgrade=yes\n\n- name: Set authorized key took from file\n  authorized_key:\n    user: vagrant\n    state: present\n    key: \"{{ lookup('file', '/home/antonio/.ssh/id_rsa.pub') }}\"\n\n```\n\nLuego pasamos a la instalación de Apache,a través del módulo apt para instalar apache2, ports.conf es la configuración de los puertos por los que escucha, también alberga el fichero index.html y una plantilla jinja2.\n\nPor último pero no menos importante está el fichero hosts, el cual será el inventario por el cual el sistema sabrá cuál será nodo1 y cuál nodo2, a través de las correspondientes ips que asignaremos,el usuario más la clave privada que asignará vagrant:\n\n```\nall:\n  children:\n    servidores_web:\n      hosts:\n        nodo1:\n          ansible_ssh_host: 192.168.121.212\n          ansible_ssh_user: vagrant\n          ansible_ssh_private_key_file: ../.vagrant/machines/nodo1/libvirt/private_key\n        nodo2:\n          ansible_ssh_host: 192.168.121.111\n          ansible_ssh_user: vagrant\n          ansible_ssh_private_key_file: ../.vagrant/machines/nodo2/libvirt/private_key\n\n```\n\ncon esto solo necesitaremos ejecutar el `ansible-playbook site.yaml` y tendremos enrutado y configurado nuestro servidor web.","slug":"Ansible+Vagrant","published":1,"date":"2022-10-13T17:45:40.684Z","updated":"2023-01-04T13:42:40.307Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cldl8a0oy00012fi5gkzic1ri","content":"<p><img src=\"/images/ansibleandvagrant.jpg\" alt=\"Descripción de la imagen\"></p>\n<p>Comenzaremos este post viendo como adjuntamos una box <a href=\"https://app.vagrantup.com/boxes/search\">https://app.vagrantup.com/boxes/search</a><br>\nbuscamos por ejemplo la de debian/ullseye, vamos a nuestra terminal y escribimos lo siguiente:<br>\n <code>vagrant box add debian/bullseye64</code></p>\n<p>En ese momento se guardará en  <code>~/.vagrant.d/boxes</code> <br>\nBueno, dicho esto procedemos a crear la carpeta donde vamos a trabajar y hacemos un  <code>vagrant init</code> , esto hará que se cree un archivo llamado vagrantfile, el cual debe quedar de la siguiente manera:</p>\n<pre><code>Vagrant.configure(&quot;2&quot;) do |config|\n    config.vm.define :nodo1 do |nodo1|\n      nodo1.vm.box = &quot;debian/bullseye64&quot;\n      nodo1.vm.hostname= &quot;nodo1&quot;\n      nodo1.vm.synced_folder &quot;.&quot;, &quot;/vagrant&quot;, disabled: true\n      nodo1.vm.network :public_network,\n        :dev =&gt; &quot;br0&quot;,\n        :mode =&gt; &quot;bridge&quot;,\n        :type =&gt; &quot;bridge&quot;,\n        use_dhcp_assigned_default_route: true\n      nodo1.vm.network :private_network,\n        :libvirt__network_name =&gt; &quot;red1&quot;,\n        :libvirt__dhcp_enabled =&gt; false,\n        :ip =&gt; &quot;10.0.0.10&quot;,\n        :libvirt__forward_mode =&gt; &quot;veryisolated&quot;\n    end\n    config.vm.define :nodo2 do |nodo2|\n      nodo2.vm.box = &quot;debian/bullseye64&quot;\n      nodo2.vm.hostname = &quot;nodo2&quot;\n      nodo2.vm.synced_folder &quot;.&quot;, &quot;/vagrant&quot;, disabled: true\n      nodo2.vm.network :private_network,\n        :libvirt__network_name =&gt; &quot;red1&quot;,\n        :libvirt__dhcp_enabled =&gt; false,\n        :ip =&gt; &quot;10.0.0.11&quot;,\n        :libvirt__forward_mode =&gt; &quot;veryisolated&quot;,\n        use_dhcp_assigned_default_route: true\n    end\nend\n\n</code></pre>\n<p>Vamos a explicar paso por paso qué vemos en el código:</p>\n<ul>\n<li>El vagrantfile debe estar perfectamente alineado, los end con sus respectivos config.</li>\n<li>Al ser dos máquinas las vamos a llamar nodo1 y nodo2, que una será el router y la segunda el servidor que aloje apache</li>\n<li>Si nos fijamos con atención podemos ver que <strong>nodo1</strong> tiene dos redes, una será pública, la cual tiene un bridge por donde saldrá a internet, y una red privada muy aislada, la cual no contendrá nada más que una ip estática, pondremos que la ruta por defecto va a ser el bridge que nos llevará a internet.</li>\n<li>En <strong>nodo2</strong> tendremos una red privada, más tarde procederemos a ejecutar unas reglas que nos permitan salir por el exterior a través de la red muy aislada con <strong>nat</strong></li>\n</ul>\n<p>Una vez hecho esto procedemos a ver de cerca lo que contiene Ansible, el cual ejecutaremos tras iniciar las máquinas de Vagrant junto con sus redes.</p>\n<p><img src=\"/images/Ansible.png\" alt=\"Descripción de la imagen\"></p>\n<p>Como podemos ver, hay una serie de carpetas llamadas roles, cada rol va a ejecutar una o varias tareas dependiendo de lo que se trate, por lo tanto así quedaría por ejemplo el activado del bit de forwarding del router:</p>\n<pre><code>- ansible.posix.sysctl:\n    name: net.ipv4.ip_forward\n    value: '1'\n    sysctl_set: yes\n</code></pre>\n<p>Estas tareas tienen un orden, y se realiza dentro de site.yml:</p>\n<pre><code>- hosts: nodo1\n  become: true\n  roles:\n   - role: copy\n\n- hosts: all\n  become: true\n  roles:\n   - role: commons\n\n- hosts: nodo2\n  become: true\n  roles:\n   - role: copy2\n   - role: apache2\n\n- hosts: nodo1\n  become: true\n  roles:\n   - role: ipv4\n\n</code></pre>\n<p>Con un poco de conocimientos en sistemas podemos ver claramente qué realiza cada rol.</p>\n<p>Ahora vamos a poner la lupa en  <code>roles/commons/handlers/main.yaml</code> , una parte muy importante de la ejecución de Ansible:</p>\n<pre><code>- name: reiniciando maquina\n  ansible.builtin.reboot:\n    msg: &quot;reboot by Ansible&quot;\n    pre_reboot_delay: 5\n    post_reboot_delay: 10\n    test_command: &quot;whoami&quot;\n</code></pre>\n<p>Este handler se ejecuta en el momento en el que se hace un llamamiento, en nuestro caso es cuando copiamos al router un fichero configurado para etc/network/interfaces, con sus interfaces, ruta por defecto e iptables:</p>\n<p><img src=\"/images/interfaces.png\" alt=\"Descripción de la imagen\"></p>\n<p>podemos ver como en  <code>roles/copy/tasks/main.yaml</code>  hace el llamamiento al <strong>handler</strong> en el notify:</p>\n<pre><code>- name: Copiando al etc/network/interfaces\n  ansible.builtin.copy:\n    src: interfaz_nodo1/interfaces\n    dest: /etc/network/\n    owner: root\n    group: root\n    mode: u-rw,g-wx,o-rwx\n  notify:\n    - reiniciando maquina\n\n</code></pre>\n<p>A continuación podemos copiar nuestra clave pública a través de la tarea <strong>commons</strong> que será lo que nos permita atravesar por ssh sin utilizar la clave vagrant, es decir, la nuestra.</p>\n<pre><code>- name: Ensure system is updated\n  apt: update_cache=yes upgrade=yes\n\n- name: Set authorized key took from file\n  authorized_key:\n    user: vagrant\n    state: present\n    key: &quot;&#123;&#123; lookup('file', '/home/antonio/.ssh/id_rsa.pub') &#125;&#125;&quot;\n\n</code></pre>\n<p>Luego pasamos a la instalación de Apache,a través del módulo apt para instalar apache2, ports.conf es la configuración de los puertos por los que escucha, también alberga el fichero index.html y una plantilla jinja2.</p>\n<p>Por último pero no menos importante está el fichero hosts, el cual será el inventario por el cual el sistema sabrá cuál será nodo1 y cuál nodo2, a través de las correspondientes ips que asignaremos,el usuario más la clave privada que asignará vagrant:</p>\n<pre><code>all:\n  children:\n    servidores_web:\n      hosts:\n        nodo1:\n          ansible_ssh_host: 192.168.121.212\n          ansible_ssh_user: vagrant\n          ansible_ssh_private_key_file: ../.vagrant/machines/nodo1/libvirt/private_key\n        nodo2:\n          ansible_ssh_host: 192.168.121.111\n          ansible_ssh_user: vagrant\n          ansible_ssh_private_key_file: ../.vagrant/machines/nodo2/libvirt/private_key\n\n</code></pre>\n<p>con esto solo necesitaremos ejecutar el  <code>ansible-playbook site.yaml</code>  y tendremos enrutado y configurado nuestro servidor web.</p>\n","site":{"data":{}},"length":4487,"excerpt":"","more":"<p><img src=\"/images/ansibleandvagrant.jpg\" alt=\"Descripción de la imagen\"></p>\n<p>Comenzaremos este post viendo como adjuntamos una box <a href=\"https://app.vagrantup.com/boxes/search\">https://app.vagrantup.com/boxes/search</a><br>\nbuscamos por ejemplo la de debian/ullseye, vamos a nuestra terminal y escribimos lo siguiente:<br>\n <code>vagrant box add debian/bullseye64</code></p>\n<p>En ese momento se guardará en  <code>~/.vagrant.d/boxes</code> <br>\nBueno, dicho esto procedemos a crear la carpeta donde vamos a trabajar y hacemos un  <code>vagrant init</code> , esto hará que se cree un archivo llamado vagrantfile, el cual debe quedar de la siguiente manera:</p>\n<pre><code>Vagrant.configure(&quot;2&quot;) do |config|\n    config.vm.define :nodo1 do |nodo1|\n      nodo1.vm.box = &quot;debian/bullseye64&quot;\n      nodo1.vm.hostname= &quot;nodo1&quot;\n      nodo1.vm.synced_folder &quot;.&quot;, &quot;/vagrant&quot;, disabled: true\n      nodo1.vm.network :public_network,\n        :dev =&gt; &quot;br0&quot;,\n        :mode =&gt; &quot;bridge&quot;,\n        :type =&gt; &quot;bridge&quot;,\n        use_dhcp_assigned_default_route: true\n      nodo1.vm.network :private_network,\n        :libvirt__network_name =&gt; &quot;red1&quot;,\n        :libvirt__dhcp_enabled =&gt; false,\n        :ip =&gt; &quot;10.0.0.10&quot;,\n        :libvirt__forward_mode =&gt; &quot;veryisolated&quot;\n    end\n    config.vm.define :nodo2 do |nodo2|\n      nodo2.vm.box = &quot;debian/bullseye64&quot;\n      nodo2.vm.hostname = &quot;nodo2&quot;\n      nodo2.vm.synced_folder &quot;.&quot;, &quot;/vagrant&quot;, disabled: true\n      nodo2.vm.network :private_network,\n        :libvirt__network_name =&gt; &quot;red1&quot;,\n        :libvirt__dhcp_enabled =&gt; false,\n        :ip =&gt; &quot;10.0.0.11&quot;,\n        :libvirt__forward_mode =&gt; &quot;veryisolated&quot;,\n        use_dhcp_assigned_default_route: true\n    end\nend\n\n</code></pre>\n<p>Vamos a explicar paso por paso qué vemos en el código:</p>\n<ul>\n<li>El vagrantfile debe estar perfectamente alineado, los end con sus respectivos config.</li>\n<li>Al ser dos máquinas las vamos a llamar nodo1 y nodo2, que una será el router y la segunda el servidor que aloje apache</li>\n<li>Si nos fijamos con atención podemos ver que <strong>nodo1</strong> tiene dos redes, una será pública, la cual tiene un bridge por donde saldrá a internet, y una red privada muy aislada, la cual no contendrá nada más que una ip estática, pondremos que la ruta por defecto va a ser el bridge que nos llevará a internet.</li>\n<li>En <strong>nodo2</strong> tendremos una red privada, más tarde procederemos a ejecutar unas reglas que nos permitan salir por el exterior a través de la red muy aislada con <strong>nat</strong></li>\n</ul>\n<p>Una vez hecho esto procedemos a ver de cerca lo que contiene Ansible, el cual ejecutaremos tras iniciar las máquinas de Vagrant junto con sus redes.</p>\n<p><img src=\"/images/Ansible.png\" alt=\"Descripción de la imagen\"></p>\n<p>Como podemos ver, hay una serie de carpetas llamadas roles, cada rol va a ejecutar una o varias tareas dependiendo de lo que se trate, por lo tanto así quedaría por ejemplo el activado del bit de forwarding del router:</p>\n<pre><code>- ansible.posix.sysctl:\n    name: net.ipv4.ip_forward\n    value: '1'\n    sysctl_set: yes\n</code></pre>\n<p>Estas tareas tienen un orden, y se realiza dentro de site.yml:</p>\n<pre><code>- hosts: nodo1\n  become: true\n  roles:\n   - role: copy\n\n- hosts: all\n  become: true\n  roles:\n   - role: commons\n\n- hosts: nodo2\n  become: true\n  roles:\n   - role: copy2\n   - role: apache2\n\n- hosts: nodo1\n  become: true\n  roles:\n   - role: ipv4\n\n</code></pre>\n<p>Con un poco de conocimientos en sistemas podemos ver claramente qué realiza cada rol.</p>\n<p>Ahora vamos a poner la lupa en  <code>roles/commons/handlers/main.yaml</code> , una parte muy importante de la ejecución de Ansible:</p>\n<pre><code>- name: reiniciando maquina\n  ansible.builtin.reboot:\n    msg: &quot;reboot by Ansible&quot;\n    pre_reboot_delay: 5\n    post_reboot_delay: 10\n    test_command: &quot;whoami&quot;\n</code></pre>\n<p>Este handler se ejecuta en el momento en el que se hace un llamamiento, en nuestro caso es cuando copiamos al router un fichero configurado para etc/network/interfaces, con sus interfaces, ruta por defecto e iptables:</p>\n<p><img src=\"/images/interfaces.png\" alt=\"Descripción de la imagen\"></p>\n<p>podemos ver como en  <code>roles/copy/tasks/main.yaml</code>  hace el llamamiento al <strong>handler</strong> en el notify:</p>\n<pre><code>- name: Copiando al etc/network/interfaces\n  ansible.builtin.copy:\n    src: interfaz_nodo1/interfaces\n    dest: /etc/network/\n    owner: root\n    group: root\n    mode: u-rw,g-wx,o-rwx\n  notify:\n    - reiniciando maquina\n\n</code></pre>\n<p>A continuación podemos copiar nuestra clave pública a través de la tarea <strong>commons</strong> que será lo que nos permita atravesar por ssh sin utilizar la clave vagrant, es decir, la nuestra.</p>\n<pre><code>- name: Ensure system is updated\n  apt: update_cache=yes upgrade=yes\n\n- name: Set authorized key took from file\n  authorized_key:\n    user: vagrant\n    state: present\n    key: &quot;&#123;&#123; lookup('file', '/home/antonio/.ssh/id_rsa.pub') &#125;&#125;&quot;\n\n</code></pre>\n<p>Luego pasamos a la instalación de Apache,a través del módulo apt para instalar apache2, ports.conf es la configuración de los puertos por los que escucha, también alberga el fichero index.html y una plantilla jinja2.</p>\n<p>Por último pero no menos importante está el fichero hosts, el cual será el inventario por el cual el sistema sabrá cuál será nodo1 y cuál nodo2, a través de las correspondientes ips que asignaremos,el usuario más la clave privada que asignará vagrant:</p>\n<pre><code>all:\n  children:\n    servidores_web:\n      hosts:\n        nodo1:\n          ansible_ssh_host: 192.168.121.212\n          ansible_ssh_user: vagrant\n          ansible_ssh_private_key_file: ../.vagrant/machines/nodo1/libvirt/private_key\n        nodo2:\n          ansible_ssh_host: 192.168.121.111\n          ansible_ssh_user: vagrant\n          ansible_ssh_private_key_file: ../.vagrant/machines/nodo2/libvirt/private_key\n\n</code></pre>\n<p>con esto solo necesitaremos ejecutar el  <code>ansible-playbook site.yaml</code>  y tendremos enrutado y configurado nuestro servidor web.</p>\n"},{"title":"Compilar en debian","_content":"\n![Descripción de la imagen](/images/debian-11.jpg)\n\n\nNecesitamos descargar el código fuente de xorriso:\n`apt source xorriso`\nNos pide que instalemos dpkg-dev debido a que necesita el paquete dpkg-source\n`apt install dpkg-dev`\nCon esto al descargar el código fuente de un paquete este se descomprimirá, también podemos hacerlo a través de tar:\n\n`tar -xvf libisoburn_1.5.2.orig.tar.gz`\n\n![Descripción de la imagen](/images/xorriso-1.png)\n\nnos metemos en la carpeta de xorriso y leemos el archivo.dsc\n\nComo podemos ver en la imagen dentro del paquete libisoburn está las diferentes dependencias para el binario que queremos compilar.\n\n\n![Descripción de la imagen](/images/xorriso-2.png)\n\nComo podemos observar hay dos makefile, pero estos no son más que unas plantillas que no lograremos compilar ya que solo sirven de guía.\n\n\nnecesitaremos las dependencias así que procuraremos hacer un `apt build-dep xorriso`.\n\n\nUna vez instaladas las dependencias ejecutamos `./configure --prefix /usr/local/xorriso/`, con esto se habrá generado el makefile, y el binario generado se guardará en /usr/local/xorriso\n\n\n![Descripción de la imagen](/images/xorriso-3.png)\n\n\n\nAhora una vez tengamos el archivo del makefile, ejecutamos un `make` en el directorio del makefile, una vez compilado realizamos un `make install`\n\n\n![Descripción de la imagen](/images/xorriso-4.png)\n\nComo podemos ver existe el binario que ejecutaremos y viene incluído el archivo de ayuda.\n\nOtra forma después de proceder con el make a través de dpkg sería `dpkg-buildpackage -b`, se creará elarchivo .deb con el que emplearemos `dpkg -i archivo.deb`","source":"_posts/Compilar-en-debian.md","raw":"---\ntitle: Compilar en debian\n---\n\n![Descripción de la imagen](/images/debian-11.jpg)\n\n\nNecesitamos descargar el código fuente de xorriso:\n`apt source xorriso`\nNos pide que instalemos dpkg-dev debido a que necesita el paquete dpkg-source\n`apt install dpkg-dev`\nCon esto al descargar el código fuente de un paquete este se descomprimirá, también podemos hacerlo a través de tar:\n\n`tar -xvf libisoburn_1.5.2.orig.tar.gz`\n\n![Descripción de la imagen](/images/xorriso-1.png)\n\nnos metemos en la carpeta de xorriso y leemos el archivo.dsc\n\nComo podemos ver en la imagen dentro del paquete libisoburn está las diferentes dependencias para el binario que queremos compilar.\n\n\n![Descripción de la imagen](/images/xorriso-2.png)\n\nComo podemos observar hay dos makefile, pero estos no son más que unas plantillas que no lograremos compilar ya que solo sirven de guía.\n\n\nnecesitaremos las dependencias así que procuraremos hacer un `apt build-dep xorriso`.\n\n\nUna vez instaladas las dependencias ejecutamos `./configure --prefix /usr/local/xorriso/`, con esto se habrá generado el makefile, y el binario generado se guardará en /usr/local/xorriso\n\n\n![Descripción de la imagen](/images/xorriso-3.png)\n\n\n\nAhora una vez tengamos el archivo del makefile, ejecutamos un `make` en el directorio del makefile, una vez compilado realizamos un `make install`\n\n\n![Descripción de la imagen](/images/xorriso-4.png)\n\nComo podemos ver existe el binario que ejecutaremos y viene incluído el archivo de ayuda.\n\nOtra forma después de proceder con el make a través de dpkg sería `dpkg-buildpackage -b`, se creará elarchivo .deb con el que emplearemos `dpkg -i archivo.deb`","slug":"Compilar-en-debian","published":1,"date":"2022-09-30T06:41:07.316Z","updated":"2022-10-19T12:34:18.078Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cldl8a0p100032fi581z45tby","content":"<p><img src=\"/images/debian-11.jpg\" alt=\"Descripción de la imagen\"></p>\n<p>Necesitamos descargar el código fuente de xorriso:<br>\n <code>apt source xorriso</code> <br>\nNos pide que instalemos dpkg-dev debido a que necesita el paquete dpkg-source<br>\n <code>apt install dpkg-dev</code> <br>\nCon esto al descargar el código fuente de un paquete este se descomprimirá, también podemos hacerlo a través de tar:</p>\n<p><code>tar -xvf libisoburn_1.5.2.orig.tar.gz</code></p>\n<p><img src=\"/images/xorriso-1.png\" alt=\"Descripción de la imagen\"></p>\n<p>nos metemos en la carpeta de xorriso y leemos el archivo.dsc</p>\n<p>Como podemos ver en la imagen dentro del paquete libisoburn está las diferentes dependencias para el binario que queremos compilar.</p>\n<p><img src=\"/images/xorriso-2.png\" alt=\"Descripción de la imagen\"></p>\n<p>Como podemos observar hay dos makefile, pero estos no son más que unas plantillas que no lograremos compilar ya que solo sirven de guía.</p>\n<p>necesitaremos las dependencias así que procuraremos hacer un  <code>apt build-dep xorriso</code> .</p>\n<p>Una vez instaladas las dependencias ejecutamos  <code>./configure --prefix /usr/local/xorriso/</code> , con esto se habrá generado el makefile, y el binario generado se guardará en /usr/local/xorriso</p>\n<p><img src=\"/images/xorriso-3.png\" alt=\"Descripción de la imagen\"></p>\n<p>Ahora una vez tengamos el archivo del makefile, ejecutamos un  <code>make</code>  en el directorio del makefile, una vez compilado realizamos un  <code>make install</code></p>\n<p><img src=\"/images/xorriso-4.png\" alt=\"Descripción de la imagen\"></p>\n<p>Como podemos ver existe el binario que ejecutaremos y viene incluído el archivo de ayuda.</p>\n<p>Otra forma después de proceder con el make a través de dpkg sería  <code>dpkg-buildpackage -b</code> , se creará elarchivo .deb con el que emplearemos  <code>dpkg -i archivo.deb</code></p>\n","site":{"data":{}},"length":1110,"excerpt":"","more":"<p><img src=\"/images/debian-11.jpg\" alt=\"Descripción de la imagen\"></p>\n<p>Necesitamos descargar el código fuente de xorriso:<br>\n <code>apt source xorriso</code> <br>\nNos pide que instalemos dpkg-dev debido a que necesita el paquete dpkg-source<br>\n <code>apt install dpkg-dev</code> <br>\nCon esto al descargar el código fuente de un paquete este se descomprimirá, también podemos hacerlo a través de tar:</p>\n<p><code>tar -xvf libisoburn_1.5.2.orig.tar.gz</code></p>\n<p><img src=\"/images/xorriso-1.png\" alt=\"Descripción de la imagen\"></p>\n<p>nos metemos en la carpeta de xorriso y leemos el archivo.dsc</p>\n<p>Como podemos ver en la imagen dentro del paquete libisoburn está las diferentes dependencias para el binario que queremos compilar.</p>\n<p><img src=\"/images/xorriso-2.png\" alt=\"Descripción de la imagen\"></p>\n<p>Como podemos observar hay dos makefile, pero estos no son más que unas plantillas que no lograremos compilar ya que solo sirven de guía.</p>\n<p>necesitaremos las dependencias así que procuraremos hacer un  <code>apt build-dep xorriso</code> .</p>\n<p>Una vez instaladas las dependencias ejecutamos  <code>./configure --prefix /usr/local/xorriso/</code> , con esto se habrá generado el makefile, y el binario generado se guardará en /usr/local/xorriso</p>\n<p><img src=\"/images/xorriso-3.png\" alt=\"Descripción de la imagen\"></p>\n<p>Ahora una vez tengamos el archivo del makefile, ejecutamos un  <code>make</code>  en el directorio del makefile, una vez compilado realizamos un  <code>make install</code></p>\n<p><img src=\"/images/xorriso-4.png\" alt=\"Descripción de la imagen\"></p>\n<p>Como podemos ver existe el binario que ejecutaremos y viene incluído el archivo de ayuda.</p>\n<p>Otra forma después de proceder con el make a través de dpkg sería  <code>dpkg-buildpackage -b</code> , se creará elarchivo .deb con el que emplearemos  <code>dpkg -i archivo.deb</code></p>\n"},{"title":"Configurar kernel a medida","_content":"\n![Descripción de la imagen](/images/linux-6.0.jpg)\n\nComenzaremos creando una carpeta que nos sirva de entorno de trabajo\n\n`mkdir kernel && cd kernel`\n\n\nInstalamos las dependencias que nos ayudarán a compilar el kernel, el cual nos ahorrará errores en la compilación:\n\n\n`sudo apt install build-essential flex nbison openssl libssl-dev dkms libncurses-dev ncurses-dev qtbase5-dev libelf-dev`\n\nNos vamos ahora a kernel.org a descargarnos la última versión del kernel de linux.\n\nUna vez descargado el kernel lo descomprimimos con el comando tar -xvf linux-6.0.7.tar.gz, ingresamos dentro y vemos que entre muchos archivos, encontramos un makefile, entramos dentro y encontraremos el archivo EXTRAVERSION, el cual pondremos una versión para poder llevar un control de versiones.\n\nEntramos dentro del directorio descomprimido y procedemos a generar el `make oldconfig` que creará el archivo .config con los módulos que deberemos compilar, intentamos contestar a las preguntas de forma negativa para que no genere módulos opcionales.\n\nUna vez hecho esto debemos de adaptar los módulos que está utilizando nuestra máquina para compilar el kernel a medida, entonces utilizaremos un `make localyesconfig`\n\n```\n╭─antonio@debian ~/Programas/kernel/linux-6.0.7  \n╰─➤  egrep '=y' .config | wc -l                                                                                                 130 ↵\n1934\n╭─antonio@debian ~/Programas/kernel/linux-6.0.7  \n╰─➤  egrep '=m' .config | wc -l\n3\n```\n\nUna vez hecho esto procederemos a probar nuestro kernel a medida `make -j8 bindeb-pkg` pudiendo así compilar el kernel, le otorgaremos 8 jobs y si agregamos un time `time make -j8 bindeb-pkg` podemos ver la duración que ha tardado el sistema en compilarlo.\n\nReiniciamos nuestra máquina y entramos en el nuevo kernel, utilizamos `uname -r`\n\nLuego volvemos a nuestro kernel, y en concreto a nuestro espacio de trabajo, ejecutamos un `make clean` para eliminar los 'residuos' generados tras al compilación, y hacemos un control de versiones del .config, como nos funcionó la primera versión realizamos un `cp .config ../v1.config`\n\n![Descripción de la imagen](/images/xconfig.png)","source":"_posts/Compilar-linux-a-medida.md","raw":"\n---\ntitle: Configurar kernel a medida\ncategories: Sistemas Operativos\ntags: Sistemas Operativos\n---\n\n![Descripción de la imagen](/images/linux-6.0.jpg)\n\nComenzaremos creando una carpeta que nos sirva de entorno de trabajo\n\n`mkdir kernel && cd kernel`\n\n\nInstalamos las dependencias que nos ayudarán a compilar el kernel, el cual nos ahorrará errores en la compilación:\n\n\n`sudo apt install build-essential flex nbison openssl libssl-dev dkms libncurses-dev ncurses-dev qtbase5-dev libelf-dev`\n\nNos vamos ahora a kernel.org a descargarnos la última versión del kernel de linux.\n\nUna vez descargado el kernel lo descomprimimos con el comando tar -xvf linux-6.0.7.tar.gz, ingresamos dentro y vemos que entre muchos archivos, encontramos un makefile, entramos dentro y encontraremos el archivo EXTRAVERSION, el cual pondremos una versión para poder llevar un control de versiones.\n\nEntramos dentro del directorio descomprimido y procedemos a generar el `make oldconfig` que creará el archivo .config con los módulos que deberemos compilar, intentamos contestar a las preguntas de forma negativa para que no genere módulos opcionales.\n\nUna vez hecho esto debemos de adaptar los módulos que está utilizando nuestra máquina para compilar el kernel a medida, entonces utilizaremos un `make localyesconfig`\n\n```\n╭─antonio@debian ~/Programas/kernel/linux-6.0.7  \n╰─➤  egrep '=y' .config | wc -l                                                                                                 130 ↵\n1934\n╭─antonio@debian ~/Programas/kernel/linux-6.0.7  \n╰─➤  egrep '=m' .config | wc -l\n3\n```\n\nUna vez hecho esto procederemos a probar nuestro kernel a medida `make -j8 bindeb-pkg` pudiendo así compilar el kernel, le otorgaremos 8 jobs y si agregamos un time `time make -j8 bindeb-pkg` podemos ver la duración que ha tardado el sistema en compilarlo.\n\nReiniciamos nuestra máquina y entramos en el nuevo kernel, utilizamos `uname -r`\n\nLuego volvemos a nuestro kernel, y en concreto a nuestro espacio de trabajo, ejecutamos un `make clean` para eliminar los 'residuos' generados tras al compilación, y hacemos un control de versiones del .config, como nos funcionó la primera versión realizamos un `cp .config ../v1.config`\n\n![Descripción de la imagen](/images/xconfig.png)","slug":"Compilar-linux-a-medida","published":1,"date":"2022-11-16T21:49:54.792Z","updated":"2023-01-04T13:42:53.119Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cldl8a0p400072fi5b1yh1ank","content":"<p><img src=\"/images/linux-6.0.jpg\" alt=\"Descripción de la imagen\"></p>\n<p>Comenzaremos creando una carpeta que nos sirva de entorno de trabajo</p>\n<p><code>mkdir kernel &amp;&amp; cd kernel</code></p>\n<p>Instalamos las dependencias que nos ayudarán a compilar el kernel, el cual nos ahorrará errores en la compilación:</p>\n<p><code>sudo apt install build-essential flex nbison openssl libssl-dev dkms libncurses-dev ncurses-dev qtbase5-dev libelf-dev</code></p>\n<p>Nos vamos ahora a <a href=\"http://kernel.org\">kernel.org</a> a descargarnos la última versión del kernel de linux.</p>\n<p>Una vez descargado el kernel lo descomprimimos con el comando tar -xvf linux-6.0.7.tar.gz, ingresamos dentro y vemos que entre muchos archivos, encontramos un makefile, entramos dentro y encontraremos el archivo EXTRAVERSION, el cual pondremos una versión para poder llevar un control de versiones.</p>\n<p>Entramos dentro del directorio descomprimido y procedemos a generar el  <code>make oldconfig</code>  que creará el archivo .config con los módulos que deberemos compilar, intentamos contestar a las preguntas de forma negativa para que no genere módulos opcionales.</p>\n<p>Una vez hecho esto debemos de adaptar los módulos que está utilizando nuestra máquina para compilar el kernel a medida, entonces utilizaremos un  <code>make localyesconfig</code></p>\n<pre><code>╭─antonio@debian ~/Programas/kernel/linux-6.0.7  \n╰─➤  egrep '=y' .config | wc -l                                                                                                 130 ↵\n1934\n╭─antonio@debian ~/Programas/kernel/linux-6.0.7  \n╰─➤  egrep '=m' .config | wc -l\n3\n</code></pre>\n<p>Una vez hecho esto procederemos a probar nuestro kernel a medida  <code>make -j8 bindeb-pkg</code>  pudiendo así compilar el kernel, le otorgaremos 8 jobs y si agregamos un time  <code>time make -j8 bindeb-pkg</code>  podemos ver la duración que ha tardado el sistema en compilarlo.</p>\n<p>Reiniciamos nuestra máquina y entramos en el nuevo kernel, utilizamos  <code>uname -r</code></p>\n<p>Luego volvemos a nuestro kernel, y en concreto a nuestro espacio de trabajo, ejecutamos un  <code>make clean</code>  para eliminar los ‘residuos’ generados tras al compilación, y hacemos un control de versiones del .config, como nos funcionó la primera versión realizamos un  <code>cp .config ../v1.config</code></p>\n<p><img src=\"/images/xconfig.png\" alt=\"Descripción de la imagen\"></p>\n","site":{"data":{}},"length":1634,"excerpt":"","more":"<p><img src=\"/images/linux-6.0.jpg\" alt=\"Descripción de la imagen\"></p>\n<p>Comenzaremos creando una carpeta que nos sirva de entorno de trabajo</p>\n<p><code>mkdir kernel &amp;&amp; cd kernel</code></p>\n<p>Instalamos las dependencias que nos ayudarán a compilar el kernel, el cual nos ahorrará errores en la compilación:</p>\n<p><code>sudo apt install build-essential flex nbison openssl libssl-dev dkms libncurses-dev ncurses-dev qtbase5-dev libelf-dev</code></p>\n<p>Nos vamos ahora a <a href=\"http://kernel.org\">kernel.org</a> a descargarnos la última versión del kernel de linux.</p>\n<p>Una vez descargado el kernel lo descomprimimos con el comando tar -xvf linux-6.0.7.tar.gz, ingresamos dentro y vemos que entre muchos archivos, encontramos un makefile, entramos dentro y encontraremos el archivo EXTRAVERSION, el cual pondremos una versión para poder llevar un control de versiones.</p>\n<p>Entramos dentro del directorio descomprimido y procedemos a generar el  <code>make oldconfig</code>  que creará el archivo .config con los módulos que deberemos compilar, intentamos contestar a las preguntas de forma negativa para que no genere módulos opcionales.</p>\n<p>Una vez hecho esto debemos de adaptar los módulos que está utilizando nuestra máquina para compilar el kernel a medida, entonces utilizaremos un  <code>make localyesconfig</code></p>\n<pre><code>╭─antonio@debian ~/Programas/kernel/linux-6.0.7  \n╰─➤  egrep '=y' .config | wc -l                                                                                                 130 ↵\n1934\n╭─antonio@debian ~/Programas/kernel/linux-6.0.7  \n╰─➤  egrep '=m' .config | wc -l\n3\n</code></pre>\n<p>Una vez hecho esto procederemos a probar nuestro kernel a medida  <code>make -j8 bindeb-pkg</code>  pudiendo así compilar el kernel, le otorgaremos 8 jobs y si agregamos un time  <code>time make -j8 bindeb-pkg</code>  podemos ver la duración que ha tardado el sistema en compilarlo.</p>\n<p>Reiniciamos nuestra máquina y entramos en el nuevo kernel, utilizamos  <code>uname -r</code></p>\n<p>Luego volvemos a nuestro kernel, y en concreto a nuestro espacio de trabajo, ejecutamos un  <code>make clean</code>  para eliminar los ‘residuos’ generados tras al compilación, y hacemos un control de versiones del .config, como nos funcionó la primera versión realizamos un  <code>cp .config ../v1.config</code></p>\n<p><img src=\"/images/xconfig.png\" alt=\"Descripción de la imagen\"></p>\n"},{"title":"Interconexiones entre Bases de Datos","_content":"![remoto](/images/oracle-19c-logo.png)\n\n\n## Interconexión entre dos bases de datos Oracle.\n\nAntes que nada debemos saber que para conectarnos a una base de datos, debemos tener activados los listener y seguidamente tener en el tsnames.ora la base de datos a la que queremos conectarnos, de esta manera:\nsudo nano /opt/oracle/product/19c/dbhome_1/network/admin/tnsnames.ora\n\n```\nORCLCDB =\n  (DESCRIPTION =\n    (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.122.20)(PORT = 1521))\n    (CONNECT_DATA =\n      (SERVER = DEDICATED)\n      (SERVICE_NAME = ORCLCDB)\n    )\n  )\n\nLISTENER_ORCLCDB =\n  (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.122.20)(PORT = 1521))\n\nORACLESERV =\n  (DESCRIPTION =\n    (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.122.168)(PORT = 1521))\n    (CONNECT_DATA =\n      (SERVER = DEDICATED)\n      (SERVICE_NAME = ORCLCDB)\n    )\n  )\n```\nHemos creado una nueva conexión llamada ORACLESERV en el cual procederemos a ingresar la ip del servidor del que queremos recibir los datos, tras esto debemos crear en la otra máquina la tabla de ejemplo que queremos extraer:\n\n```\nCREATE TABLE armas (\ncodarma varchar2 (3),\nnombre varchar2 (20),\nfuerza number (2),\ndestreza number (2),\ninteligencia number (2),\nrareza varchar2 (10),\nnivel number (2),\nCONSTRAINT pk_armas PRIMARY KEY (codarma)\n);\n\ninsert into armas values ('001','Espada Corta',8,10,0,'D',5);\ninsert into armas values ('002','Espada Larga',10,10,0,'C',8);\ninsert into armas values ('003','Espada Artorias',24,18,20,'S',30);\ninsert into armas values ('004','Hacha de Mano',8,8,0,'D',6);\ninsert into armas values ('005','Hacha de Gárgola',14,14,0,'A',15);\ninsert into armas values ('006','Hacha de Demonio',46,0,0,'S',40);\n```\n\nUna vez hecho esto, **nos vamos a la máquina en la que vamos a trabajar con la consulta**, debemos crear un enlace a la base de datos, el cual hemos predefinido como ORACLESERV:\n\n`create database link ORACLESERVIDOR connect to antonio identified by antonio using 'ORACLESERV';`\n\nTras esto, viene una parte un poco compleja, ya que la tabla que vamos a consultar en el otro servidor viene relacionada, y a la hora de crear relaciones entre tablas no se puede especificar una base de datos remota en el DDL, entonces, cómo podemos hacer que esto funcione? bueno pues mi idea ha sido crear una vista materializada:\n\n`create materialized view mv_armas as select codarma from armas@ORACLESERVIDOR;`\n\nUna vez hecho esto, procedemos a crear las tablas personaje y equipar, siendo una relación N,M.\n\n```\nCREATE TABLE personaje (\ncodpersonaje varchar2 (3),\nnombre varchar2 (15),\naltura number (3,2),\npeso number (3),\nraza varchar2 (10),\nCONSTRAINT pk_codpersonaje PRIMARY KEY (codpersonaje),\nCONSTRAINT ck_codpersonaje CHECK (REGEXP_LIKE(codpersonaje,'^1.*$'))\n);\n\ninsert into personaje values ('101','Solaire',1.70,80,'humano');\ninsert into personaje values ('102','Artorias',1.90,90,'hueco');\ninsert into personaje values ('103','Gargola',3.10,680,'Gárgola');\n\nCREATE TABLE equipar (\ncodpersonaje varchar2 (3),\ncodarma varchar2 (3),\nfecha date,\nCONSTRAINT pk_equipar PRIMARY KEY (codpersonaje,codarma,fecha),\nCONSTRAINT fk_codpersonaje FOREIGN KEY (codpersonaje) REFERENCES personaje (codpersonaje),\nCONSTRAINT fk_codarma FOREIGN KEY (codarma) REFERENCES mv_armas(codarma);\n);\n\ninsert into equipar values ('102','003',to_date('2011/02/11','YYYY/MM/DD'));\ninsert into equipar values ('103','005',to_date('2011/05/04','YYYY/MM/DD'));\ninsert into equipar values ('101','002',to_date('2011/06/03','YYYY/MM/DD'));\ninsert into equipar values ('103','002',to_date('2011/09/02','YYYY/MM/DD'));\ninsert into equipar values ('101','006',to_date('2011/08/03','YYYY/MM/DD'));\ninsert into equipar values ('102','004',to_date('2011/07/01','YYYY/MM/DD'));\n\n```\n\n¡¡Mucho ojo!! la restricción que he establecido en equipar, que es la foreign key que relaciona el código de armas con nuestra base de datos, llamará a la view que hemos creado y contendrá los datos de la consulta al servidor externo.\n\n\n\n\n\n![remoto](/images/sql-remoto.png)\n\n\n![remoto](/images/sql-remoto2.png)\n\n\n## Interconexión entre dos bases de datos Postgres.\n\nPrimero vamos a modificar el fichero /etc/postgresql/13/main/postgresql.conf para abrir la escucha a la ip que quiera conectarse:\n`listen_addresses = '*'`\n\nModificamos el fichero /etc/postgresql/13/main/pg_hba.conf, y aladimos la siguiente línea:\n`host    all             all             192.168.122.0/24        md5`\n\nProcedemos a reiniciar Postgres para efectuar los cambios:\n`sudo systemctl restart postgresql`\n\nLuego vamos a crear la base de datos souls, luego vamos a darle permiso al usuario antonio2 para poder manejar la base de datos:\n\n```\npostgres=# create database souls\npostgres-# ;\nCREATE DATABASE\nGRANT ALL PRIVILEGES ON DATABASE souls TO antonio2;\npostgres=# grant connect on database souls to antonio2;\nGRANT\npostgres=# grant usage on schema public to antonio2;\nGRANT\n```\n\nEn el otro servidor establecemos la configuración de antonio1:\n\n```\npostgres=# create user antonio1 with password 'antonio1';\nCREATE ROLE\npostgres=# create database souls;\nCREATE DATABASE\nGRANT ALL PRIVILEGES ON DATABASE souls TO antonio1;\npostgres=# grant connect on database souls to antonio1;\nGRANT\npostgres=# grant usage on schema public to antonio1;\nGRANT\npostgres=# \\c souls;\n```\n\nAhora vamos a instalar el paquete que nos permitirá realizar el dblink:\n`sudo apt install postgresql-contrib`\n\n\n\nDe modo que si hacemos una consulta con dblink especificando el host, usuario y base de datos del que se habla, podremos sacar la información de las bases de datos respectivamente.\n\n\n`select * from dblink('dbname=souls host=192.168.122.168 user=antonio2 password=antonio2', 'select nombre from armas') as armas (Nombre VARCHAR);`\n\n![Descripción de la imagen](/images/postgres-postgres.png)\n\n\n\n## Interconexión entre bases de datos Oracle y Postgres.\n\nEn nuestro caso la paquetería que necesitamos para conectar Oracle a Postgres es la de Debian Bullseye, por tanto el comando sería el siguiente:\n`sudo apt install odbc-postgresql unixodbc -y`\n\nAhora vamos a entrar en /etc/odbc.ini y vamos a ingresar los siguientes parámetros adaptándolos a nuestro usuario, host y base de datos:\n\n```\n[PSQLA]\nDebug = 0\nCommLog = 0\nReadOnly = 1\nDriver = PostgreSQL ANSI\nServername = 192.168.122.168\nUsername = antonio2\nPassword = antonio2\nPort = 5432\nDatabase = souls\nTrace = 0\nTraceFile = /tmp/sql.log\n\n[PSQLU]\nDebug = 0\nCommLog = 0\nReadOnly = 0\nDriver = PostgreSQL Unicode\nServername = 192.168.122.168\nUsername = antonio2\nPassword = antonio2\nPort = 5432\nDatabase = souls\nTrace = 0\nTraceFile = /tmp/sql.log\n\n[Default]\nDriver = /usr/lib/x86_64-linux-gnu/odbc/liboplodbcS.so\n```\nAhora vamos a comprobar el fichero /etc/ocdbinst.ini y debe venir configurado como se muestra abajo.\n\n```\n[PostgreSQL ANSI]\nDescription=PostgreSQL ODBC driver (ANSI version)\nDriver=psqlodbca.so\nSetup=libodbcpsqlS.so\nDebug=0\nCommLog=1\nUsageCount=1\n\n[PostgreSQL Unicode]\nDescription=PostgreSQL ODBC driver (Unicode version)\nDriver=psqlodbcw.so\nSetup=libodbcpsqlS.so\nDebug=0\nCommLog=1\nUsageCount=1\n```\n\n\nPodemos comprobar la configuración ingresando los siguientes comandos:\n\n```\nodbcinst -q -d\n    [PostgreSQL ANSI]\n    [PostgreSQL Unicode]\n\n\nodbcinst -q -s\n    [PSQLA]\n    [PSQLU]\n    [Default]\n```\n\nejecutamos `isql -v PSQLU` y si todo ha ido bien nos devolverá esto:\n```\n+---------------------------------------+\n| Connected!                            |\n|                                       |\n| sql-statement                         |\n| help [tablename]                      |\n| quit                                  |\n|                                       |\n+---------------------------------------+\n```\n\nA continuación vamos a `/opt/oracle/product/19c/dbhome_1/hs/admin/initPSQLU.ora` e ingresamos los siguientes datos:\n\n```\nHS_FDS_CONNECT_INFO = PSQLU\nHS_FDS_TRACE_LEVEL = Debug\nHS_FDS_SHAREABLE_NAME = /usr/lib/x86_64-linux-gnu/odbc/psqlodbcw.so\nHS_LANGUAGE = AMERICAN_AMERICA.WE8ISO8859P1\nset ODBCINI=/etc/odbc.ini\n```\n\nVamos al listener.ora e ingresamos los siguentes parámetros:\n\n\n```\nSID_LIST_LISTENER =\n (SID_LIST =\n  (SID_DESC =\n   (GLOBAL_DBNAME = ORCLCDB)\n   (ORACLE_HOME = /opt/oracle/product/19c/dbhome_1)\n   (SID_NAME = ORCLCDB)\n  )\n  (SID_DESC =\n    (SID_NAME = PSQLU)\n    (PROGRAM = dg4odbc)\n    (ORACLE_HOME = /opt/oracle/product/19c/dbhome_1)\n  )\n )\n```\n\nAhora realizaremos un lsnrctl stop y lisnrctl start, y nos debe salir un mensaje como el siguiente:\n\n```\nService \"PSQLU\" has 1 instance(s).\n  Instance \"PSQLU\", status UNKNOWN, has 1 handler(s) for this service...\nService \"orcl\" has 1 instance(s).\n  Instance \"orcl\", status UNKNOWN, has 1 handler(s) for this service...\nThe command completed successfully\n\n```\nAhora nos vamos al tnsnames.ora y añadimos lo siguiente:\n```\nPSQLU =\n (DESCRIPTION =\n (ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521))\n   (CONNECT_DATA = (SID = PSQLU))\n   (HS = OK)\n  )\n```\n\nEn localhost estamos especificando que la ip de la máquina sería la misma en la que está alojado el servicio postgre, esto es debido a que se redirecciona a través de la configuración en odbc.ini entonces ya tan solo quedaría conceder permisos de conexión publica de la base de datos a antonio:\n\n```\nGRANT CREATE PUBLIC DATABASE LINK to antonio;\n\nConcesion terminada correctamente.\n```\n\nAhora solo nos queda realizar la conexión:\n```\nCREATE PUBLIC DATABASE LINK CONEXIONPOSTGRES2\nCONNECT TO \"antonio2\"\nIDENTIFIED BY \"antonio2\"\nUSING 'PSQLU';\n\nEnlace con la base de datos creado.\n```\n\nComprobamos que se pueda consultar el nombre de las armas en **CONEXIONPOSTGRES2**\n\n![Descripción de la imagen](/images/oracle-postgres.png)\n\n\n\n## Interconexión entre bases de datos Postgres y Oracle.\n\n\nPrimero vamos a instalar unos paquetes que nos servirán tanto para establecer la conexión con Oracle como a la hora de compilar el Makefile que necesitaremos más adelante:\n\n`apt install git build-essential libaio1 postgresql-server-dev-all -y`\n\nPara realizar la interconexión entre Postgres y Oracle necesitaremos software de terceros, en mi caso vamos a descargar los paquetes que se encuentran en el siguiente enlace:\n\nhttps://drive.google.com/file/d/1UmBNjVLffaj-hXDXdi6hPGpz6CIZr8eN/view?usp=share_link\n\nEn él se encuentran los paquetes en formato.deb, del cual me ocupé de transformar con alien.\n\nAhora procedemos a instalar los paquetes que adaptarán el formato sqlplus:\n```\nsudo dpkg -i oracle-instantclient19.5-devel_19.5.0.0.0-2_amd64.deb\nsudo dpkg -i oracle-instantclient19.5-basic_19.5.0.0.0-2_amd64.deb\nsudo dpkg -i oracle-instantclient19.5-tools_19.5.0.0.0-2_amd64.deb\nsudo dpkg -i oracle-instantclient19.5-sqlplus_19.5.0.0.0-2_amd64.deb\n```\n\nAhora vamos a clonar el repositorio con el que trabajaremos para establecer la conexión de Postgres a Oracle:\n\ngit clone https://github.com/laurenz/oracle_fdw.git\n\nAhora en nuestra máquina postgres necesitaremos crear las variables de entorno de Oracle, para ello ingresaremos lo siguiente al final de nuestro .bashrc\n\n```\nsudo nano ~/.bashrc\n\nexport ORACLE_HOME=\"/usr/lib/oracle/19.5/client64\"\nexport LD_LIBRARY_PATH=\"/usr/lib/oracle/19.5/client64/lib\"\nexport PATH=$ORACLE_HOME:$PATH\nexport USE_PGXS=1\n```\n\nAhora vamos a generar el makefile ejecutando un `make` dentro del directorio que hemos clonado.\n\nUNa vez hecho esto, ante de proceder a instalar el binario, debamo incluir las siguientes líneas a nuestro makefile.\n```\nPG_CPPFLAGS = -I\"$(ORACLE_HOME)/sdk/include\" -I\"$(ORACLE_HOME)/oci/include\" -I\"$(ORACLE_HOME)/rdbms/public\" -I\"$(ORACLE_HOME)/\" $(FIN>\n\nSHLIB_LINK = -L\"$(ORACLE_HOME)/\" -L\"$(ORACLE_HOME)/bin\" -L\"$(ORACLE_HOME)/lib\" -L\"$(ORACLE_HOME)/lib/amd64\" $(FIND_LDFLAGS) -l$(ORACL>\n```\n\nAhora podemos ejecutar un `make install` sin errores ya que las dependencias necesarias para la instalación fueron descargadas con anterioridad.\n\nLuego entramos en nuestra base de datos con el usuario postgres para crear nuestro enlace a Oracle, debemos especificar la ip que tendrá el sevidor y el nombre de la base de datos que en nuestro caso será el por defecto 'ORCLCDB'.\n\n```\nCREATE SERVER oracleantonio FOREIGN DATA WRAPPER oracle_fdw OPTIONS(dbserver '//192.168.122.168:1521/ORCLCDB');\n```\n\nUna vez hecho esto vamos a enlazar la conexión de nuestro oracleantonio con el usuario que tenga acceso a los registros de la tabla armas, de forma que quedaría de la siguiente manera:\n\n```\ncreate user mapping for postgres server oracleantonio options(user 'antonio',password 'antonio');\nDROP user mapping for postgres server oracleantonio; (En caso de que haya algún tipo de error).\n```\n\nCrearemos el esqueleto de la tabla que necesitamos en la base de datos pero sin restricciones ni unique, ya que colisionan con la ejecución de la conexión remota, solo necesitaremos los campos que vayan a ser rellenados:\n\n\n```\nCREATE FOREIGN TABLE personaje (\ncodpersonaje varchar (3),\nnombre varchar (15),\naltura numeric (3,2),\npeso numeric (3),\nraza varchar (10) DEFAULT ('Humano'))\nSERVER oracleantonio OPTIONS(schema 'ANTONIO', table 'PERSONAJE'\n);\n```\n\nAhora solo nos queda realizar la consulta y podemos comprobar como esta se resuelve con éxito.\n\n\n![Descripción de la imagen](/images/postgres-oracle.png)\n","source":"_posts/Interconexiones.md","raw":"---\ntitle: Interconexiones entre Bases de Datos\ncategories: Bases de Datos\n---\n![remoto](/images/oracle-19c-logo.png)\n\n\n## Interconexión entre dos bases de datos Oracle.\n\nAntes que nada debemos saber que para conectarnos a una base de datos, debemos tener activados los listener y seguidamente tener en el tsnames.ora la base de datos a la que queremos conectarnos, de esta manera:\nsudo nano /opt/oracle/product/19c/dbhome_1/network/admin/tnsnames.ora\n\n```\nORCLCDB =\n  (DESCRIPTION =\n    (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.122.20)(PORT = 1521))\n    (CONNECT_DATA =\n      (SERVER = DEDICATED)\n      (SERVICE_NAME = ORCLCDB)\n    )\n  )\n\nLISTENER_ORCLCDB =\n  (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.122.20)(PORT = 1521))\n\nORACLESERV =\n  (DESCRIPTION =\n    (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.122.168)(PORT = 1521))\n    (CONNECT_DATA =\n      (SERVER = DEDICATED)\n      (SERVICE_NAME = ORCLCDB)\n    )\n  )\n```\nHemos creado una nueva conexión llamada ORACLESERV en el cual procederemos a ingresar la ip del servidor del que queremos recibir los datos, tras esto debemos crear en la otra máquina la tabla de ejemplo que queremos extraer:\n\n```\nCREATE TABLE armas (\ncodarma varchar2 (3),\nnombre varchar2 (20),\nfuerza number (2),\ndestreza number (2),\ninteligencia number (2),\nrareza varchar2 (10),\nnivel number (2),\nCONSTRAINT pk_armas PRIMARY KEY (codarma)\n);\n\ninsert into armas values ('001','Espada Corta',8,10,0,'D',5);\ninsert into armas values ('002','Espada Larga',10,10,0,'C',8);\ninsert into armas values ('003','Espada Artorias',24,18,20,'S',30);\ninsert into armas values ('004','Hacha de Mano',8,8,0,'D',6);\ninsert into armas values ('005','Hacha de Gárgola',14,14,0,'A',15);\ninsert into armas values ('006','Hacha de Demonio',46,0,0,'S',40);\n```\n\nUna vez hecho esto, **nos vamos a la máquina en la que vamos a trabajar con la consulta**, debemos crear un enlace a la base de datos, el cual hemos predefinido como ORACLESERV:\n\n`create database link ORACLESERVIDOR connect to antonio identified by antonio using 'ORACLESERV';`\n\nTras esto, viene una parte un poco compleja, ya que la tabla que vamos a consultar en el otro servidor viene relacionada, y a la hora de crear relaciones entre tablas no se puede especificar una base de datos remota en el DDL, entonces, cómo podemos hacer que esto funcione? bueno pues mi idea ha sido crear una vista materializada:\n\n`create materialized view mv_armas as select codarma from armas@ORACLESERVIDOR;`\n\nUna vez hecho esto, procedemos a crear las tablas personaje y equipar, siendo una relación N,M.\n\n```\nCREATE TABLE personaje (\ncodpersonaje varchar2 (3),\nnombre varchar2 (15),\naltura number (3,2),\npeso number (3),\nraza varchar2 (10),\nCONSTRAINT pk_codpersonaje PRIMARY KEY (codpersonaje),\nCONSTRAINT ck_codpersonaje CHECK (REGEXP_LIKE(codpersonaje,'^1.*$'))\n);\n\ninsert into personaje values ('101','Solaire',1.70,80,'humano');\ninsert into personaje values ('102','Artorias',1.90,90,'hueco');\ninsert into personaje values ('103','Gargola',3.10,680,'Gárgola');\n\nCREATE TABLE equipar (\ncodpersonaje varchar2 (3),\ncodarma varchar2 (3),\nfecha date,\nCONSTRAINT pk_equipar PRIMARY KEY (codpersonaje,codarma,fecha),\nCONSTRAINT fk_codpersonaje FOREIGN KEY (codpersonaje) REFERENCES personaje (codpersonaje),\nCONSTRAINT fk_codarma FOREIGN KEY (codarma) REFERENCES mv_armas(codarma);\n);\n\ninsert into equipar values ('102','003',to_date('2011/02/11','YYYY/MM/DD'));\ninsert into equipar values ('103','005',to_date('2011/05/04','YYYY/MM/DD'));\ninsert into equipar values ('101','002',to_date('2011/06/03','YYYY/MM/DD'));\ninsert into equipar values ('103','002',to_date('2011/09/02','YYYY/MM/DD'));\ninsert into equipar values ('101','006',to_date('2011/08/03','YYYY/MM/DD'));\ninsert into equipar values ('102','004',to_date('2011/07/01','YYYY/MM/DD'));\n\n```\n\n¡¡Mucho ojo!! la restricción que he establecido en equipar, que es la foreign key que relaciona el código de armas con nuestra base de datos, llamará a la view que hemos creado y contendrá los datos de la consulta al servidor externo.\n\n\n\n\n\n![remoto](/images/sql-remoto.png)\n\n\n![remoto](/images/sql-remoto2.png)\n\n\n## Interconexión entre dos bases de datos Postgres.\n\nPrimero vamos a modificar el fichero /etc/postgresql/13/main/postgresql.conf para abrir la escucha a la ip que quiera conectarse:\n`listen_addresses = '*'`\n\nModificamos el fichero /etc/postgresql/13/main/pg_hba.conf, y aladimos la siguiente línea:\n`host    all             all             192.168.122.0/24        md5`\n\nProcedemos a reiniciar Postgres para efectuar los cambios:\n`sudo systemctl restart postgresql`\n\nLuego vamos a crear la base de datos souls, luego vamos a darle permiso al usuario antonio2 para poder manejar la base de datos:\n\n```\npostgres=# create database souls\npostgres-# ;\nCREATE DATABASE\nGRANT ALL PRIVILEGES ON DATABASE souls TO antonio2;\npostgres=# grant connect on database souls to antonio2;\nGRANT\npostgres=# grant usage on schema public to antonio2;\nGRANT\n```\n\nEn el otro servidor establecemos la configuración de antonio1:\n\n```\npostgres=# create user antonio1 with password 'antonio1';\nCREATE ROLE\npostgres=# create database souls;\nCREATE DATABASE\nGRANT ALL PRIVILEGES ON DATABASE souls TO antonio1;\npostgres=# grant connect on database souls to antonio1;\nGRANT\npostgres=# grant usage on schema public to antonio1;\nGRANT\npostgres=# \\c souls;\n```\n\nAhora vamos a instalar el paquete que nos permitirá realizar el dblink:\n`sudo apt install postgresql-contrib`\n\n\n\nDe modo que si hacemos una consulta con dblink especificando el host, usuario y base de datos del que se habla, podremos sacar la información de las bases de datos respectivamente.\n\n\n`select * from dblink('dbname=souls host=192.168.122.168 user=antonio2 password=antonio2', 'select nombre from armas') as armas (Nombre VARCHAR);`\n\n![Descripción de la imagen](/images/postgres-postgres.png)\n\n\n\n## Interconexión entre bases de datos Oracle y Postgres.\n\nEn nuestro caso la paquetería que necesitamos para conectar Oracle a Postgres es la de Debian Bullseye, por tanto el comando sería el siguiente:\n`sudo apt install odbc-postgresql unixodbc -y`\n\nAhora vamos a entrar en /etc/odbc.ini y vamos a ingresar los siguientes parámetros adaptándolos a nuestro usuario, host y base de datos:\n\n```\n[PSQLA]\nDebug = 0\nCommLog = 0\nReadOnly = 1\nDriver = PostgreSQL ANSI\nServername = 192.168.122.168\nUsername = antonio2\nPassword = antonio2\nPort = 5432\nDatabase = souls\nTrace = 0\nTraceFile = /tmp/sql.log\n\n[PSQLU]\nDebug = 0\nCommLog = 0\nReadOnly = 0\nDriver = PostgreSQL Unicode\nServername = 192.168.122.168\nUsername = antonio2\nPassword = antonio2\nPort = 5432\nDatabase = souls\nTrace = 0\nTraceFile = /tmp/sql.log\n\n[Default]\nDriver = /usr/lib/x86_64-linux-gnu/odbc/liboplodbcS.so\n```\nAhora vamos a comprobar el fichero /etc/ocdbinst.ini y debe venir configurado como se muestra abajo.\n\n```\n[PostgreSQL ANSI]\nDescription=PostgreSQL ODBC driver (ANSI version)\nDriver=psqlodbca.so\nSetup=libodbcpsqlS.so\nDebug=0\nCommLog=1\nUsageCount=1\n\n[PostgreSQL Unicode]\nDescription=PostgreSQL ODBC driver (Unicode version)\nDriver=psqlodbcw.so\nSetup=libodbcpsqlS.so\nDebug=0\nCommLog=1\nUsageCount=1\n```\n\n\nPodemos comprobar la configuración ingresando los siguientes comandos:\n\n```\nodbcinst -q -d\n    [PostgreSQL ANSI]\n    [PostgreSQL Unicode]\n\n\nodbcinst -q -s\n    [PSQLA]\n    [PSQLU]\n    [Default]\n```\n\nejecutamos `isql -v PSQLU` y si todo ha ido bien nos devolverá esto:\n```\n+---------------------------------------+\n| Connected!                            |\n|                                       |\n| sql-statement                         |\n| help [tablename]                      |\n| quit                                  |\n|                                       |\n+---------------------------------------+\n```\n\nA continuación vamos a `/opt/oracle/product/19c/dbhome_1/hs/admin/initPSQLU.ora` e ingresamos los siguientes datos:\n\n```\nHS_FDS_CONNECT_INFO = PSQLU\nHS_FDS_TRACE_LEVEL = Debug\nHS_FDS_SHAREABLE_NAME = /usr/lib/x86_64-linux-gnu/odbc/psqlodbcw.so\nHS_LANGUAGE = AMERICAN_AMERICA.WE8ISO8859P1\nset ODBCINI=/etc/odbc.ini\n```\n\nVamos al listener.ora e ingresamos los siguentes parámetros:\n\n\n```\nSID_LIST_LISTENER =\n (SID_LIST =\n  (SID_DESC =\n   (GLOBAL_DBNAME = ORCLCDB)\n   (ORACLE_HOME = /opt/oracle/product/19c/dbhome_1)\n   (SID_NAME = ORCLCDB)\n  )\n  (SID_DESC =\n    (SID_NAME = PSQLU)\n    (PROGRAM = dg4odbc)\n    (ORACLE_HOME = /opt/oracle/product/19c/dbhome_1)\n  )\n )\n```\n\nAhora realizaremos un lsnrctl stop y lisnrctl start, y nos debe salir un mensaje como el siguiente:\n\n```\nService \"PSQLU\" has 1 instance(s).\n  Instance \"PSQLU\", status UNKNOWN, has 1 handler(s) for this service...\nService \"orcl\" has 1 instance(s).\n  Instance \"orcl\", status UNKNOWN, has 1 handler(s) for this service...\nThe command completed successfully\n\n```\nAhora nos vamos al tnsnames.ora y añadimos lo siguiente:\n```\nPSQLU =\n (DESCRIPTION =\n (ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521))\n   (CONNECT_DATA = (SID = PSQLU))\n   (HS = OK)\n  )\n```\n\nEn localhost estamos especificando que la ip de la máquina sería la misma en la que está alojado el servicio postgre, esto es debido a que se redirecciona a través de la configuración en odbc.ini entonces ya tan solo quedaría conceder permisos de conexión publica de la base de datos a antonio:\n\n```\nGRANT CREATE PUBLIC DATABASE LINK to antonio;\n\nConcesion terminada correctamente.\n```\n\nAhora solo nos queda realizar la conexión:\n```\nCREATE PUBLIC DATABASE LINK CONEXIONPOSTGRES2\nCONNECT TO \"antonio2\"\nIDENTIFIED BY \"antonio2\"\nUSING 'PSQLU';\n\nEnlace con la base de datos creado.\n```\n\nComprobamos que se pueda consultar el nombre de las armas en **CONEXIONPOSTGRES2**\n\n![Descripción de la imagen](/images/oracle-postgres.png)\n\n\n\n## Interconexión entre bases de datos Postgres y Oracle.\n\n\nPrimero vamos a instalar unos paquetes que nos servirán tanto para establecer la conexión con Oracle como a la hora de compilar el Makefile que necesitaremos más adelante:\n\n`apt install git build-essential libaio1 postgresql-server-dev-all -y`\n\nPara realizar la interconexión entre Postgres y Oracle necesitaremos software de terceros, en mi caso vamos a descargar los paquetes que se encuentran en el siguiente enlace:\n\nhttps://drive.google.com/file/d/1UmBNjVLffaj-hXDXdi6hPGpz6CIZr8eN/view?usp=share_link\n\nEn él se encuentran los paquetes en formato.deb, del cual me ocupé de transformar con alien.\n\nAhora procedemos a instalar los paquetes que adaptarán el formato sqlplus:\n```\nsudo dpkg -i oracle-instantclient19.5-devel_19.5.0.0.0-2_amd64.deb\nsudo dpkg -i oracle-instantclient19.5-basic_19.5.0.0.0-2_amd64.deb\nsudo dpkg -i oracle-instantclient19.5-tools_19.5.0.0.0-2_amd64.deb\nsudo dpkg -i oracle-instantclient19.5-sqlplus_19.5.0.0.0-2_amd64.deb\n```\n\nAhora vamos a clonar el repositorio con el que trabajaremos para establecer la conexión de Postgres a Oracle:\n\ngit clone https://github.com/laurenz/oracle_fdw.git\n\nAhora en nuestra máquina postgres necesitaremos crear las variables de entorno de Oracle, para ello ingresaremos lo siguiente al final de nuestro .bashrc\n\n```\nsudo nano ~/.bashrc\n\nexport ORACLE_HOME=\"/usr/lib/oracle/19.5/client64\"\nexport LD_LIBRARY_PATH=\"/usr/lib/oracle/19.5/client64/lib\"\nexport PATH=$ORACLE_HOME:$PATH\nexport USE_PGXS=1\n```\n\nAhora vamos a generar el makefile ejecutando un `make` dentro del directorio que hemos clonado.\n\nUNa vez hecho esto, ante de proceder a instalar el binario, debamo incluir las siguientes líneas a nuestro makefile.\n```\nPG_CPPFLAGS = -I\"$(ORACLE_HOME)/sdk/include\" -I\"$(ORACLE_HOME)/oci/include\" -I\"$(ORACLE_HOME)/rdbms/public\" -I\"$(ORACLE_HOME)/\" $(FIN>\n\nSHLIB_LINK = -L\"$(ORACLE_HOME)/\" -L\"$(ORACLE_HOME)/bin\" -L\"$(ORACLE_HOME)/lib\" -L\"$(ORACLE_HOME)/lib/amd64\" $(FIND_LDFLAGS) -l$(ORACL>\n```\n\nAhora podemos ejecutar un `make install` sin errores ya que las dependencias necesarias para la instalación fueron descargadas con anterioridad.\n\nLuego entramos en nuestra base de datos con el usuario postgres para crear nuestro enlace a Oracle, debemos especificar la ip que tendrá el sevidor y el nombre de la base de datos que en nuestro caso será el por defecto 'ORCLCDB'.\n\n```\nCREATE SERVER oracleantonio FOREIGN DATA WRAPPER oracle_fdw OPTIONS(dbserver '//192.168.122.168:1521/ORCLCDB');\n```\n\nUna vez hecho esto vamos a enlazar la conexión de nuestro oracleantonio con el usuario que tenga acceso a los registros de la tabla armas, de forma que quedaría de la siguiente manera:\n\n```\ncreate user mapping for postgres server oracleantonio options(user 'antonio',password 'antonio');\nDROP user mapping for postgres server oracleantonio; (En caso de que haya algún tipo de error).\n```\n\nCrearemos el esqueleto de la tabla que necesitamos en la base de datos pero sin restricciones ni unique, ya que colisionan con la ejecución de la conexión remota, solo necesitaremos los campos que vayan a ser rellenados:\n\n\n```\nCREATE FOREIGN TABLE personaje (\ncodpersonaje varchar (3),\nnombre varchar (15),\naltura numeric (3,2),\npeso numeric (3),\nraza varchar (10) DEFAULT ('Humano'))\nSERVER oracleantonio OPTIONS(schema 'ANTONIO', table 'PERSONAJE'\n);\n```\n\nAhora solo nos queda realizar la consulta y podemos comprobar como esta se resuelve con éxito.\n\n\n![Descripción de la imagen](/images/postgres-oracle.png)\n","slug":"Interconexiones","published":1,"date":"2022-11-09T19:27:01.893Z","updated":"2023-01-04T13:29:31.339Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cldl8a0p500092fi5chzsbi8c","content":"<p><img src=\"/images/oracle-19c-logo.png\" alt=\"remoto\"></p>\n<h2 id=\"interconexión-entre-dos-bases-de-datos-oracle\"><a class=\"markdownIt-Anchor\" href=\"#interconexión-entre-dos-bases-de-datos-oracle\">#</a> Interconexión entre dos bases de datos Oracle.</h2>\n<p>Antes que nada debemos saber que para conectarnos a una base de datos, debemos tener activados los listener y seguidamente tener en el tsnames.ora la base de datos a la que queremos conectarnos, de esta manera:<br>\nsudo nano /opt/oracle/product/19c/dbhome_1/network/admin/tnsnames.ora</p>\n<pre><code>ORCLCDB =\n  (DESCRIPTION =\n    (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.122.20)(PORT = 1521))\n    (CONNECT_DATA =\n      (SERVER = DEDICATED)\n      (SERVICE_NAME = ORCLCDB)\n    )\n  )\n\nLISTENER_ORCLCDB =\n  (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.122.20)(PORT = 1521))\n\nORACLESERV =\n  (DESCRIPTION =\n    (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.122.168)(PORT = 1521))\n    (CONNECT_DATA =\n      (SERVER = DEDICATED)\n      (SERVICE_NAME = ORCLCDB)\n    )\n  )\n</code></pre>\n<p>Hemos creado una nueva conexión llamada ORACLESERV en el cual procederemos a ingresar la ip del servidor del que queremos recibir los datos, tras esto debemos crear en la otra máquina la tabla de ejemplo que queremos extraer:</p>\n<pre><code>CREATE TABLE armas (\ncodarma varchar2 (3),\nnombre varchar2 (20),\nfuerza number (2),\ndestreza number (2),\ninteligencia number (2),\nrareza varchar2 (10),\nnivel number (2),\nCONSTRAINT pk_armas PRIMARY KEY (codarma)\n);\n\ninsert into armas values ('001','Espada Corta',8,10,0,'D',5);\ninsert into armas values ('002','Espada Larga',10,10,0,'C',8);\ninsert into armas values ('003','Espada Artorias',24,18,20,'S',30);\ninsert into armas values ('004','Hacha de Mano',8,8,0,'D',6);\ninsert into armas values ('005','Hacha de Gárgola',14,14,0,'A',15);\ninsert into armas values ('006','Hacha de Demonio',46,0,0,'S',40);\n</code></pre>\n<p>Una vez hecho esto, <strong>nos vamos a la máquina en la que vamos a trabajar con la consulta</strong>, debemos crear un enlace a la base de datos, el cual hemos predefinido como ORACLESERV:</p>\n<p><code>create database link ORACLESERVIDOR connect to antonio identified by antonio using 'ORACLESERV';</code></p>\n<p>Tras esto, viene una parte un poco compleja, ya que la tabla que vamos a consultar en el otro servidor viene relacionada, y a la hora de crear relaciones entre tablas no se puede especificar una base de datos remota en el DDL, entonces, cómo podemos hacer que esto funcione? bueno pues mi idea ha sido crear una vista materializada:</p>\n<p><code>create materialized view mv_armas as select codarma from armas@ORACLESERVIDOR;</code></p>\n<p>Una vez hecho esto, procedemos a crear las tablas personaje y equipar, siendo una relación N,M.</p>\n<pre><code>CREATE TABLE personaje (\ncodpersonaje varchar2 (3),\nnombre varchar2 (15),\naltura number (3,2),\npeso number (3),\nraza varchar2 (10),\nCONSTRAINT pk_codpersonaje PRIMARY KEY (codpersonaje),\nCONSTRAINT ck_codpersonaje CHECK (REGEXP_LIKE(codpersonaje,'^1.*$'))\n);\n\ninsert into personaje values ('101','Solaire',1.70,80,'humano');\ninsert into personaje values ('102','Artorias',1.90,90,'hueco');\ninsert into personaje values ('103','Gargola',3.10,680,'Gárgola');\n\nCREATE TABLE equipar (\ncodpersonaje varchar2 (3),\ncodarma varchar2 (3),\nfecha date,\nCONSTRAINT pk_equipar PRIMARY KEY (codpersonaje,codarma,fecha),\nCONSTRAINT fk_codpersonaje FOREIGN KEY (codpersonaje) REFERENCES personaje (codpersonaje),\nCONSTRAINT fk_codarma FOREIGN KEY (codarma) REFERENCES mv_armas(codarma);\n);\n\ninsert into equipar values ('102','003',to_date('2011/02/11','YYYY/MM/DD'));\ninsert into equipar values ('103','005',to_date('2011/05/04','YYYY/MM/DD'));\ninsert into equipar values ('101','002',to_date('2011/06/03','YYYY/MM/DD'));\ninsert into equipar values ('103','002',to_date('2011/09/02','YYYY/MM/DD'));\ninsert into equipar values ('101','006',to_date('2011/08/03','YYYY/MM/DD'));\ninsert into equipar values ('102','004',to_date('2011/07/01','YYYY/MM/DD'));\n\n</code></pre>\n<p>¡¡Mucho ojo!! la restricción que he establecido en equipar, que es la foreign key que relaciona el código de armas con nuestra base de datos, llamará a la view que hemos creado y contendrá los datos de la consulta al servidor externo.</p>\n<p><img src=\"/images/sql-remoto.png\" alt=\"remoto\"></p>\n<p><img src=\"/images/sql-remoto2.png\" alt=\"remoto\"></p>\n<h2 id=\"interconexión-entre-dos-bases-de-datos-postgres\"><a class=\"markdownIt-Anchor\" href=\"#interconexión-entre-dos-bases-de-datos-postgres\">#</a> Interconexión entre dos bases de datos Postgres.</h2>\n<p>Primero vamos a modificar el fichero /etc/postgresql/13/main/postgresql.conf para abrir la escucha a la ip que quiera conectarse:<br>\n <code>listen_addresses = '*'</code></p>\n<p>Modificamos el fichero /etc/postgresql/13/main/pg_hba.conf, y aladimos la siguiente línea:<br>\n <code>host    all             all             192.168.122.0/24        md5</code></p>\n<p>Procedemos a reiniciar Postgres para efectuar los cambios:<br>\n <code>sudo systemctl restart postgresql</code></p>\n<p>Luego vamos a crear la base de datos souls, luego vamos a darle permiso al usuario antonio2 para poder manejar la base de datos:</p>\n<pre><code>postgres=# create database souls\npostgres-# ;\nCREATE DATABASE\nGRANT ALL PRIVILEGES ON DATABASE souls TO antonio2;\npostgres=# grant connect on database souls to antonio2;\nGRANT\npostgres=# grant usage on schema public to antonio2;\nGRANT\n</code></pre>\n<p>En el otro servidor establecemos la configuración de antonio1:</p>\n<pre><code>postgres=# create user antonio1 with password 'antonio1';\nCREATE ROLE\npostgres=# create database souls;\nCREATE DATABASE\nGRANT ALL PRIVILEGES ON DATABASE souls TO antonio1;\npostgres=# grant connect on database souls to antonio1;\nGRANT\npostgres=# grant usage on schema public to antonio1;\nGRANT\npostgres=# \\c souls;\n</code></pre>\n<p>Ahora vamos a instalar el paquete que nos permitirá realizar el dblink:<br>\n <code>sudo apt install postgresql-contrib</code></p>\n<p>De modo que si hacemos una consulta con dblink especificando el host, usuario y base de datos del que se habla, podremos sacar la información de las bases de datos respectivamente.</p>\n<p><code>select * from dblink('dbname=souls host=192.168.122.168 user=antonio2 password=antonio2', 'select nombre from armas') as armas (Nombre VARCHAR);</code></p>\n<p><img src=\"/images/postgres-postgres.png\" alt=\"Descripción de la imagen\"></p>\n<h2 id=\"interconexión-entre-bases-de-datos-oracle-y-postgres\"><a class=\"markdownIt-Anchor\" href=\"#interconexión-entre-bases-de-datos-oracle-y-postgres\">#</a> Interconexión entre bases de datos Oracle y Postgres.</h2>\n<p>En nuestro caso la paquetería que necesitamos para conectar Oracle a Postgres es la de Debian Bullseye, por tanto el comando sería el siguiente:<br>\n <code>sudo apt install odbc-postgresql unixodbc -y</code></p>\n<p>Ahora vamos a entrar en /etc/odbc.ini y vamos a ingresar los siguientes parámetros adaptándolos a nuestro usuario, host y base de datos:</p>\n<pre><code>[PSQLA]\nDebug = 0\nCommLog = 0\nReadOnly = 1\nDriver = PostgreSQL ANSI\nServername = 192.168.122.168\nUsername = antonio2\nPassword = antonio2\nPort = 5432\nDatabase = souls\nTrace = 0\nTraceFile = /tmp/sql.log\n\n[PSQLU]\nDebug = 0\nCommLog = 0\nReadOnly = 0\nDriver = PostgreSQL Unicode\nServername = 192.168.122.168\nUsername = antonio2\nPassword = antonio2\nPort = 5432\nDatabase = souls\nTrace = 0\nTraceFile = /tmp/sql.log\n\n[Default]\nDriver = /usr/lib/x86_64-linux-gnu/odbc/liboplodbcS.so\n</code></pre>\n<p>Ahora vamos a comprobar el fichero /etc/ocdbinst.ini y debe venir configurado como se muestra abajo.</p>\n<pre><code>[PostgreSQL ANSI]\nDescription=PostgreSQL ODBC driver (ANSI version)\nDriver=psqlodbca.so\nSetup=libodbcpsqlS.so\nDebug=0\nCommLog=1\nUsageCount=1\n\n[PostgreSQL Unicode]\nDescription=PostgreSQL ODBC driver (Unicode version)\nDriver=psqlodbcw.so\nSetup=libodbcpsqlS.so\nDebug=0\nCommLog=1\nUsageCount=1\n</code></pre>\n<p>Podemos comprobar la configuración ingresando los siguientes comandos:</p>\n<pre><code>odbcinst -q -d\n    [PostgreSQL ANSI]\n    [PostgreSQL Unicode]\n\n\nodbcinst -q -s\n    [PSQLA]\n    [PSQLU]\n    [Default]\n</code></pre>\n<p>ejecutamos  <code>isql -v PSQLU</code>  y si todo ha ido bien nos devolverá esto:</p>\n<pre><code>+---------------------------------------+\n| Connected!                            |\n|                                       |\n| sql-statement                         |\n| help [tablename]                      |\n| quit                                  |\n|                                       |\n+---------------------------------------+\n</code></pre>\n<p>A continuación vamos a  <code>/opt/oracle/product/19c/dbhome_1/hs/admin/initPSQLU.ora</code>  e ingresamos los siguientes datos:</p>\n<pre><code>HS_FDS_CONNECT_INFO = PSQLU\nHS_FDS_TRACE_LEVEL = Debug\nHS_FDS_SHAREABLE_NAME = /usr/lib/x86_64-linux-gnu/odbc/psqlodbcw.so\nHS_LANGUAGE = AMERICAN_AMERICA.WE8ISO8859P1\nset ODBCINI=/etc/odbc.ini\n</code></pre>\n<p>Vamos al listener.ora e ingresamos los siguentes parámetros:</p>\n<pre><code>SID_LIST_LISTENER =\n (SID_LIST =\n  (SID_DESC =\n   (GLOBAL_DBNAME = ORCLCDB)\n   (ORACLE_HOME = /opt/oracle/product/19c/dbhome_1)\n   (SID_NAME = ORCLCDB)\n  )\n  (SID_DESC =\n    (SID_NAME = PSQLU)\n    (PROGRAM = dg4odbc)\n    (ORACLE_HOME = /opt/oracle/product/19c/dbhome_1)\n  )\n )\n</code></pre>\n<p>Ahora realizaremos un lsnrctl stop y lisnrctl start, y nos debe salir un mensaje como el siguiente:</p>\n<pre><code>Service &quot;PSQLU&quot; has 1 instance(s).\n  Instance &quot;PSQLU&quot;, status UNKNOWN, has 1 handler(s) for this service...\nService &quot;orcl&quot; has 1 instance(s).\n  Instance &quot;orcl&quot;, status UNKNOWN, has 1 handler(s) for this service...\nThe command completed successfully\n\n</code></pre>\n<p>Ahora nos vamos al tnsnames.ora y añadimos lo siguiente:</p>\n<pre><code>PSQLU =\n (DESCRIPTION =\n (ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521))\n   (CONNECT_DATA = (SID = PSQLU))\n   (HS = OK)\n  )\n</code></pre>\n<p>En localhost estamos especificando que la ip de la máquina sería la misma en la que está alojado el servicio postgre, esto es debido a que se redirecciona a través de la configuración en odbc.ini entonces ya tan solo quedaría conceder permisos de conexión publica de la base de datos a antonio:</p>\n<pre><code>GRANT CREATE PUBLIC DATABASE LINK to antonio;\n\nConcesion terminada correctamente.\n</code></pre>\n<p>Ahora solo nos queda realizar la conexión:</p>\n<pre><code>CREATE PUBLIC DATABASE LINK CONEXIONPOSTGRES2\nCONNECT TO &quot;antonio2&quot;\nIDENTIFIED BY &quot;antonio2&quot;\nUSING 'PSQLU';\n\nEnlace con la base de datos creado.\n</code></pre>\n<p>Comprobamos que se pueda consultar el nombre de las armas en <strong>CONEXIONPOSTGRES2</strong></p>\n<p><img src=\"/images/oracle-postgres.png\" alt=\"Descripción de la imagen\"></p>\n<h2 id=\"interconexión-entre-bases-de-datos-postgres-y-oracle\"><a class=\"markdownIt-Anchor\" href=\"#interconexión-entre-bases-de-datos-postgres-y-oracle\">#</a> Interconexión entre bases de datos Postgres y Oracle.</h2>\n<p>Primero vamos a instalar unos paquetes que nos servirán tanto para establecer la conexión con Oracle como a la hora de compilar el Makefile que necesitaremos más adelante:</p>\n<p><code>apt install git build-essential libaio1 postgresql-server-dev-all -y</code></p>\n<p>Para realizar la interconexión entre Postgres y Oracle necesitaremos software de terceros, en mi caso vamos a descargar los paquetes que se encuentran en el siguiente enlace:</p>\n<p><a href=\"https://drive.google.com/file/d/1UmBNjVLffaj-hXDXdi6hPGpz6CIZr8eN/view?usp=share_link\">https://drive.google.com/file/d/1UmBNjVLffaj-hXDXdi6hPGpz6CIZr8eN/view?usp=share_link</a></p>\n<p>En él se encuentran los paquetes en formato.deb, del cual me ocupé de transformar con alien.</p>\n<p>Ahora procedemos a instalar los paquetes que adaptarán el formato sqlplus:</p>\n<pre><code>sudo dpkg -i oracle-instantclient19.5-devel_19.5.0.0.0-2_amd64.deb\nsudo dpkg -i oracle-instantclient19.5-basic_19.5.0.0.0-2_amd64.deb\nsudo dpkg -i oracle-instantclient19.5-tools_19.5.0.0.0-2_amd64.deb\nsudo dpkg -i oracle-instantclient19.5-sqlplus_19.5.0.0.0-2_amd64.deb\n</code></pre>\n<p>Ahora vamos a clonar el repositorio con el que trabajaremos para establecer la conexión de Postgres a Oracle:</p>\n<p>git clone <a href=\"https://github.com/laurenz/oracle_fdw.git\">https://github.com/laurenz/oracle_fdw.git</a></p>\n<p>Ahora en nuestra máquina postgres necesitaremos crear las variables de entorno de Oracle, para ello ingresaremos lo siguiente al final de nuestro .bashrc</p>\n<pre><code>sudo nano ~/.bashrc\n\nexport ORACLE_HOME=&quot;/usr/lib/oracle/19.5/client64&quot;\nexport LD_LIBRARY_PATH=&quot;/usr/lib/oracle/19.5/client64/lib&quot;\nexport PATH=$ORACLE_HOME:$PATH\nexport USE_PGXS=1\n</code></pre>\n<p>Ahora vamos a generar el makefile ejecutando un  <code>make</code>  dentro del directorio que hemos clonado.</p>\n<p>UNa vez hecho esto, ante de proceder a instalar el binario, debamo incluir las siguientes líneas a nuestro makefile.</p>\n<pre><code>PG_CPPFLAGS = -I&quot;$(ORACLE_HOME)/sdk/include&quot; -I&quot;$(ORACLE_HOME)/oci/include&quot; -I&quot;$(ORACLE_HOME)/rdbms/public&quot; -I&quot;$(ORACLE_HOME)/&quot; $(FIN&gt;\n\nSHLIB_LINK = -L&quot;$(ORACLE_HOME)/&quot; -L&quot;$(ORACLE_HOME)/bin&quot; -L&quot;$(ORACLE_HOME)/lib&quot; -L&quot;$(ORACLE_HOME)/lib/amd64&quot; $(FIND_LDFLAGS) -l$(ORACL&gt;\n</code></pre>\n<p>Ahora podemos ejecutar un  <code>make install</code>  sin errores ya que las dependencias necesarias para la instalación fueron descargadas con anterioridad.</p>\n<p>Luego entramos en nuestra base de datos con el usuario postgres para crear nuestro enlace a Oracle, debemos especificar la ip que tendrá el sevidor y el nombre de la base de datos que en nuestro caso será el por defecto ‘ORCLCDB’.</p>\n<pre><code>CREATE SERVER oracleantonio FOREIGN DATA WRAPPER oracle_fdw OPTIONS(dbserver '//192.168.122.168:1521/ORCLCDB');\n</code></pre>\n<p>Una vez hecho esto vamos a enlazar la conexión de nuestro oracleantonio con el usuario que tenga acceso a los registros de la tabla armas, de forma que quedaría de la siguiente manera:</p>\n<pre><code>create user mapping for postgres server oracleantonio options(user 'antonio',password 'antonio');\nDROP user mapping for postgres server oracleantonio; (En caso de que haya algún tipo de error).\n</code></pre>\n<p>Crearemos el esqueleto de la tabla que necesitamos en la base de datos pero sin restricciones ni unique, ya que colisionan con la ejecución de la conexión remota, solo necesitaremos los campos que vayan a ser rellenados:</p>\n<pre><code>CREATE FOREIGN TABLE personaje (\ncodpersonaje varchar (3),\nnombre varchar (15),\naltura numeric (3,2),\npeso numeric (3),\nraza varchar (10) DEFAULT ('Humano'))\nSERVER oracleantonio OPTIONS(schema 'ANTONIO', table 'PERSONAJE'\n);\n</code></pre>\n<p>Ahora solo nos queda realizar la consulta y podemos comprobar como esta se resuelve con éxito.</p>\n<p><img src=\"/images/postgres-oracle.png\" alt=\"Descripción de la imagen\"></p>\n","site":{"data":{}},"length":10745,"excerpt":"","more":"<p><img src=\"/images/oracle-19c-logo.png\" alt=\"remoto\"></p>\n<h2 id=\"interconexión-entre-dos-bases-de-datos-oracle\"><a class=\"markdownIt-Anchor\" href=\"#interconexión-entre-dos-bases-de-datos-oracle\">#</a> Interconexión entre dos bases de datos Oracle.</h2>\n<p>Antes que nada debemos saber que para conectarnos a una base de datos, debemos tener activados los listener y seguidamente tener en el tsnames.ora la base de datos a la que queremos conectarnos, de esta manera:<br>\nsudo nano /opt/oracle/product/19c/dbhome_1/network/admin/tnsnames.ora</p>\n<pre><code>ORCLCDB =\n  (DESCRIPTION =\n    (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.122.20)(PORT = 1521))\n    (CONNECT_DATA =\n      (SERVER = DEDICATED)\n      (SERVICE_NAME = ORCLCDB)\n    )\n  )\n\nLISTENER_ORCLCDB =\n  (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.122.20)(PORT = 1521))\n\nORACLESERV =\n  (DESCRIPTION =\n    (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.122.168)(PORT = 1521))\n    (CONNECT_DATA =\n      (SERVER = DEDICATED)\n      (SERVICE_NAME = ORCLCDB)\n    )\n  )\n</code></pre>\n<p>Hemos creado una nueva conexión llamada ORACLESERV en el cual procederemos a ingresar la ip del servidor del que queremos recibir los datos, tras esto debemos crear en la otra máquina la tabla de ejemplo que queremos extraer:</p>\n<pre><code>CREATE TABLE armas (\ncodarma varchar2 (3),\nnombre varchar2 (20),\nfuerza number (2),\ndestreza number (2),\ninteligencia number (2),\nrareza varchar2 (10),\nnivel number (2),\nCONSTRAINT pk_armas PRIMARY KEY (codarma)\n);\n\ninsert into armas values ('001','Espada Corta',8,10,0,'D',5);\ninsert into armas values ('002','Espada Larga',10,10,0,'C',8);\ninsert into armas values ('003','Espada Artorias',24,18,20,'S',30);\ninsert into armas values ('004','Hacha de Mano',8,8,0,'D',6);\ninsert into armas values ('005','Hacha de Gárgola',14,14,0,'A',15);\ninsert into armas values ('006','Hacha de Demonio',46,0,0,'S',40);\n</code></pre>\n<p>Una vez hecho esto, <strong>nos vamos a la máquina en la que vamos a trabajar con la consulta</strong>, debemos crear un enlace a la base de datos, el cual hemos predefinido como ORACLESERV:</p>\n<p><code>create database link ORACLESERVIDOR connect to antonio identified by antonio using 'ORACLESERV';</code></p>\n<p>Tras esto, viene una parte un poco compleja, ya que la tabla que vamos a consultar en el otro servidor viene relacionada, y a la hora de crear relaciones entre tablas no se puede especificar una base de datos remota en el DDL, entonces, cómo podemos hacer que esto funcione? bueno pues mi idea ha sido crear una vista materializada:</p>\n<p><code>create materialized view mv_armas as select codarma from armas@ORACLESERVIDOR;</code></p>\n<p>Una vez hecho esto, procedemos a crear las tablas personaje y equipar, siendo una relación N,M.</p>\n<pre><code>CREATE TABLE personaje (\ncodpersonaje varchar2 (3),\nnombre varchar2 (15),\naltura number (3,2),\npeso number (3),\nraza varchar2 (10),\nCONSTRAINT pk_codpersonaje PRIMARY KEY (codpersonaje),\nCONSTRAINT ck_codpersonaje CHECK (REGEXP_LIKE(codpersonaje,'^1.*$'))\n);\n\ninsert into personaje values ('101','Solaire',1.70,80,'humano');\ninsert into personaje values ('102','Artorias',1.90,90,'hueco');\ninsert into personaje values ('103','Gargola',3.10,680,'Gárgola');\n\nCREATE TABLE equipar (\ncodpersonaje varchar2 (3),\ncodarma varchar2 (3),\nfecha date,\nCONSTRAINT pk_equipar PRIMARY KEY (codpersonaje,codarma,fecha),\nCONSTRAINT fk_codpersonaje FOREIGN KEY (codpersonaje) REFERENCES personaje (codpersonaje),\nCONSTRAINT fk_codarma FOREIGN KEY (codarma) REFERENCES mv_armas(codarma);\n);\n\ninsert into equipar values ('102','003',to_date('2011/02/11','YYYY/MM/DD'));\ninsert into equipar values ('103','005',to_date('2011/05/04','YYYY/MM/DD'));\ninsert into equipar values ('101','002',to_date('2011/06/03','YYYY/MM/DD'));\ninsert into equipar values ('103','002',to_date('2011/09/02','YYYY/MM/DD'));\ninsert into equipar values ('101','006',to_date('2011/08/03','YYYY/MM/DD'));\ninsert into equipar values ('102','004',to_date('2011/07/01','YYYY/MM/DD'));\n\n</code></pre>\n<p>¡¡Mucho ojo!! la restricción que he establecido en equipar, que es la foreign key que relaciona el código de armas con nuestra base de datos, llamará a la view que hemos creado y contendrá los datos de la consulta al servidor externo.</p>\n<p><img src=\"/images/sql-remoto.png\" alt=\"remoto\"></p>\n<p><img src=\"/images/sql-remoto2.png\" alt=\"remoto\"></p>\n<h2 id=\"interconexión-entre-dos-bases-de-datos-postgres\"><a class=\"markdownIt-Anchor\" href=\"#interconexión-entre-dos-bases-de-datos-postgres\">#</a> Interconexión entre dos bases de datos Postgres.</h2>\n<p>Primero vamos a modificar el fichero /etc/postgresql/13/main/postgresql.conf para abrir la escucha a la ip que quiera conectarse:<br>\n <code>listen_addresses = '*'</code></p>\n<p>Modificamos el fichero /etc/postgresql/13/main/pg_hba.conf, y aladimos la siguiente línea:<br>\n <code>host    all             all             192.168.122.0/24        md5</code></p>\n<p>Procedemos a reiniciar Postgres para efectuar los cambios:<br>\n <code>sudo systemctl restart postgresql</code></p>\n<p>Luego vamos a crear la base de datos souls, luego vamos a darle permiso al usuario antonio2 para poder manejar la base de datos:</p>\n<pre><code>postgres=# create database souls\npostgres-# ;\nCREATE DATABASE\nGRANT ALL PRIVILEGES ON DATABASE souls TO antonio2;\npostgres=# grant connect on database souls to antonio2;\nGRANT\npostgres=# grant usage on schema public to antonio2;\nGRANT\n</code></pre>\n<p>En el otro servidor establecemos la configuración de antonio1:</p>\n<pre><code>postgres=# create user antonio1 with password 'antonio1';\nCREATE ROLE\npostgres=# create database souls;\nCREATE DATABASE\nGRANT ALL PRIVILEGES ON DATABASE souls TO antonio1;\npostgres=# grant connect on database souls to antonio1;\nGRANT\npostgres=# grant usage on schema public to antonio1;\nGRANT\npostgres=# \\c souls;\n</code></pre>\n<p>Ahora vamos a instalar el paquete que nos permitirá realizar el dblink:<br>\n <code>sudo apt install postgresql-contrib</code></p>\n<p>De modo que si hacemos una consulta con dblink especificando el host, usuario y base de datos del que se habla, podremos sacar la información de las bases de datos respectivamente.</p>\n<p><code>select * from dblink('dbname=souls host=192.168.122.168 user=antonio2 password=antonio2', 'select nombre from armas') as armas (Nombre VARCHAR);</code></p>\n<p><img src=\"/images/postgres-postgres.png\" alt=\"Descripción de la imagen\"></p>\n<h2 id=\"interconexión-entre-bases-de-datos-oracle-y-postgres\"><a class=\"markdownIt-Anchor\" href=\"#interconexión-entre-bases-de-datos-oracle-y-postgres\">#</a> Interconexión entre bases de datos Oracle y Postgres.</h2>\n<p>En nuestro caso la paquetería que necesitamos para conectar Oracle a Postgres es la de Debian Bullseye, por tanto el comando sería el siguiente:<br>\n <code>sudo apt install odbc-postgresql unixodbc -y</code></p>\n<p>Ahora vamos a entrar en /etc/odbc.ini y vamos a ingresar los siguientes parámetros adaptándolos a nuestro usuario, host y base de datos:</p>\n<pre><code>[PSQLA]\nDebug = 0\nCommLog = 0\nReadOnly = 1\nDriver = PostgreSQL ANSI\nServername = 192.168.122.168\nUsername = antonio2\nPassword = antonio2\nPort = 5432\nDatabase = souls\nTrace = 0\nTraceFile = /tmp/sql.log\n\n[PSQLU]\nDebug = 0\nCommLog = 0\nReadOnly = 0\nDriver = PostgreSQL Unicode\nServername = 192.168.122.168\nUsername = antonio2\nPassword = antonio2\nPort = 5432\nDatabase = souls\nTrace = 0\nTraceFile = /tmp/sql.log\n\n[Default]\nDriver = /usr/lib/x86_64-linux-gnu/odbc/liboplodbcS.so\n</code></pre>\n<p>Ahora vamos a comprobar el fichero /etc/ocdbinst.ini y debe venir configurado como se muestra abajo.</p>\n<pre><code>[PostgreSQL ANSI]\nDescription=PostgreSQL ODBC driver (ANSI version)\nDriver=psqlodbca.so\nSetup=libodbcpsqlS.so\nDebug=0\nCommLog=1\nUsageCount=1\n\n[PostgreSQL Unicode]\nDescription=PostgreSQL ODBC driver (Unicode version)\nDriver=psqlodbcw.so\nSetup=libodbcpsqlS.so\nDebug=0\nCommLog=1\nUsageCount=1\n</code></pre>\n<p>Podemos comprobar la configuración ingresando los siguientes comandos:</p>\n<pre><code>odbcinst -q -d\n    [PostgreSQL ANSI]\n    [PostgreSQL Unicode]\n\n\nodbcinst -q -s\n    [PSQLA]\n    [PSQLU]\n    [Default]\n</code></pre>\n<p>ejecutamos  <code>isql -v PSQLU</code>  y si todo ha ido bien nos devolverá esto:</p>\n<pre><code>+---------------------------------------+\n| Connected!                            |\n|                                       |\n| sql-statement                         |\n| help [tablename]                      |\n| quit                                  |\n|                                       |\n+---------------------------------------+\n</code></pre>\n<p>A continuación vamos a  <code>/opt/oracle/product/19c/dbhome_1/hs/admin/initPSQLU.ora</code>  e ingresamos los siguientes datos:</p>\n<pre><code>HS_FDS_CONNECT_INFO = PSQLU\nHS_FDS_TRACE_LEVEL = Debug\nHS_FDS_SHAREABLE_NAME = /usr/lib/x86_64-linux-gnu/odbc/psqlodbcw.so\nHS_LANGUAGE = AMERICAN_AMERICA.WE8ISO8859P1\nset ODBCINI=/etc/odbc.ini\n</code></pre>\n<p>Vamos al listener.ora e ingresamos los siguentes parámetros:</p>\n<pre><code>SID_LIST_LISTENER =\n (SID_LIST =\n  (SID_DESC =\n   (GLOBAL_DBNAME = ORCLCDB)\n   (ORACLE_HOME = /opt/oracle/product/19c/dbhome_1)\n   (SID_NAME = ORCLCDB)\n  )\n  (SID_DESC =\n    (SID_NAME = PSQLU)\n    (PROGRAM = dg4odbc)\n    (ORACLE_HOME = /opt/oracle/product/19c/dbhome_1)\n  )\n )\n</code></pre>\n<p>Ahora realizaremos un lsnrctl stop y lisnrctl start, y nos debe salir un mensaje como el siguiente:</p>\n<pre><code>Service &quot;PSQLU&quot; has 1 instance(s).\n  Instance &quot;PSQLU&quot;, status UNKNOWN, has 1 handler(s) for this service...\nService &quot;orcl&quot; has 1 instance(s).\n  Instance &quot;orcl&quot;, status UNKNOWN, has 1 handler(s) for this service...\nThe command completed successfully\n\n</code></pre>\n<p>Ahora nos vamos al tnsnames.ora y añadimos lo siguiente:</p>\n<pre><code>PSQLU =\n (DESCRIPTION =\n (ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521))\n   (CONNECT_DATA = (SID = PSQLU))\n   (HS = OK)\n  )\n</code></pre>\n<p>En localhost estamos especificando que la ip de la máquina sería la misma en la que está alojado el servicio postgre, esto es debido a que se redirecciona a través de la configuración en odbc.ini entonces ya tan solo quedaría conceder permisos de conexión publica de la base de datos a antonio:</p>\n<pre><code>GRANT CREATE PUBLIC DATABASE LINK to antonio;\n\nConcesion terminada correctamente.\n</code></pre>\n<p>Ahora solo nos queda realizar la conexión:</p>\n<pre><code>CREATE PUBLIC DATABASE LINK CONEXIONPOSTGRES2\nCONNECT TO &quot;antonio2&quot;\nIDENTIFIED BY &quot;antonio2&quot;\nUSING 'PSQLU';\n\nEnlace con la base de datos creado.\n</code></pre>\n<p>Comprobamos que se pueda consultar el nombre de las armas en <strong>CONEXIONPOSTGRES2</strong></p>\n<p><img src=\"/images/oracle-postgres.png\" alt=\"Descripción de la imagen\"></p>\n<h2 id=\"interconexión-entre-bases-de-datos-postgres-y-oracle\"><a class=\"markdownIt-Anchor\" href=\"#interconexión-entre-bases-de-datos-postgres-y-oracle\">#</a> Interconexión entre bases de datos Postgres y Oracle.</h2>\n<p>Primero vamos a instalar unos paquetes que nos servirán tanto para establecer la conexión con Oracle como a la hora de compilar el Makefile que necesitaremos más adelante:</p>\n<p><code>apt install git build-essential libaio1 postgresql-server-dev-all -y</code></p>\n<p>Para realizar la interconexión entre Postgres y Oracle necesitaremos software de terceros, en mi caso vamos a descargar los paquetes que se encuentran en el siguiente enlace:</p>\n<p><a href=\"https://drive.google.com/file/d/1UmBNjVLffaj-hXDXdi6hPGpz6CIZr8eN/view?usp=share_link\">https://drive.google.com/file/d/1UmBNjVLffaj-hXDXdi6hPGpz6CIZr8eN/view?usp=share_link</a></p>\n<p>En él se encuentran los paquetes en formato.deb, del cual me ocupé de transformar con alien.</p>\n<p>Ahora procedemos a instalar los paquetes que adaptarán el formato sqlplus:</p>\n<pre><code>sudo dpkg -i oracle-instantclient19.5-devel_19.5.0.0.0-2_amd64.deb\nsudo dpkg -i oracle-instantclient19.5-basic_19.5.0.0.0-2_amd64.deb\nsudo dpkg -i oracle-instantclient19.5-tools_19.5.0.0.0-2_amd64.deb\nsudo dpkg -i oracle-instantclient19.5-sqlplus_19.5.0.0.0-2_amd64.deb\n</code></pre>\n<p>Ahora vamos a clonar el repositorio con el que trabajaremos para establecer la conexión de Postgres a Oracle:</p>\n<p>git clone <a href=\"https://github.com/laurenz/oracle_fdw.git\">https://github.com/laurenz/oracle_fdw.git</a></p>\n<p>Ahora en nuestra máquina postgres necesitaremos crear las variables de entorno de Oracle, para ello ingresaremos lo siguiente al final de nuestro .bashrc</p>\n<pre><code>sudo nano ~/.bashrc\n\nexport ORACLE_HOME=&quot;/usr/lib/oracle/19.5/client64&quot;\nexport LD_LIBRARY_PATH=&quot;/usr/lib/oracle/19.5/client64/lib&quot;\nexport PATH=$ORACLE_HOME:$PATH\nexport USE_PGXS=1\n</code></pre>\n<p>Ahora vamos a generar el makefile ejecutando un  <code>make</code>  dentro del directorio que hemos clonado.</p>\n<p>UNa vez hecho esto, ante de proceder a instalar el binario, debamo incluir las siguientes líneas a nuestro makefile.</p>\n<pre><code>PG_CPPFLAGS = -I&quot;$(ORACLE_HOME)/sdk/include&quot; -I&quot;$(ORACLE_HOME)/oci/include&quot; -I&quot;$(ORACLE_HOME)/rdbms/public&quot; -I&quot;$(ORACLE_HOME)/&quot; $(FIN&gt;\n\nSHLIB_LINK = -L&quot;$(ORACLE_HOME)/&quot; -L&quot;$(ORACLE_HOME)/bin&quot; -L&quot;$(ORACLE_HOME)/lib&quot; -L&quot;$(ORACLE_HOME)/lib/amd64&quot; $(FIND_LDFLAGS) -l$(ORACL&gt;\n</code></pre>\n<p>Ahora podemos ejecutar un  <code>make install</code>  sin errores ya que las dependencias necesarias para la instalación fueron descargadas con anterioridad.</p>\n<p>Luego entramos en nuestra base de datos con el usuario postgres para crear nuestro enlace a Oracle, debemos especificar la ip que tendrá el sevidor y el nombre de la base de datos que en nuestro caso será el por defecto ‘ORCLCDB’.</p>\n<pre><code>CREATE SERVER oracleantonio FOREIGN DATA WRAPPER oracle_fdw OPTIONS(dbserver '//192.168.122.168:1521/ORCLCDB');\n</code></pre>\n<p>Una vez hecho esto vamos a enlazar la conexión de nuestro oracleantonio con el usuario que tenga acceso a los registros de la tabla armas, de forma que quedaría de la siguiente manera:</p>\n<pre><code>create user mapping for postgres server oracleantonio options(user 'antonio',password 'antonio');\nDROP user mapping for postgres server oracleantonio; (En caso de que haya algún tipo de error).\n</code></pre>\n<p>Crearemos el esqueleto de la tabla que necesitamos en la base de datos pero sin restricciones ni unique, ya que colisionan con la ejecución de la conexión remota, solo necesitaremos los campos que vayan a ser rellenados:</p>\n<pre><code>CREATE FOREIGN TABLE personaje (\ncodpersonaje varchar (3),\nnombre varchar (15),\naltura numeric (3,2),\npeso numeric (3),\nraza varchar (10) DEFAULT ('Humano'))\nSERVER oracleantonio OPTIONS(schema 'ANTONIO', table 'PERSONAJE'\n);\n</code></pre>\n<p>Ahora solo nos queda realizar la consulta y podemos comprobar como esta se resuelve con éxito.</p>\n<p><img src=\"/images/postgres-oracle.png\" alt=\"Descripción de la imagen\"></p>\n"},{"title":"Instalación preseed PXE+APACHE","_content":"\nVamos a crear la máquina virtual como hicimos anteriormente en [Instalación automatizada basada en medio de almacenamiento extraíble.](https://entrebytes.neocities.org/2022/09/30/preseed/)\n\nEn vagrant creamos una máquina que tenga una ip estática 192.168.100.3 que va a ser la tarjeta de red por la que funcionará pxe, en mi caso no creó esa ip y la tuve que escribir a mano en el /etc/network/interfaces, la otra tarjeta de red es la de vagrant-libvirt que será la que nos conecte al exterior.\n\nPara proceder a configurar el protocolo **TFTP** Y **DHCP** para que sea el host el que conceda ip a la máquina y establezca la conexión al preseed, utilizando dnsmasq\n\napt install dnsmasq\n\n\nEstablecemos en el fichero /etc/dnsmaq.conf con los siguientes parámetros:\n\n`dhcp-range=192.168.100.100,192.168.100.200,255.255.255.0`\n\nEstablecemos el fichero con  el que va a bootear el dhcp:\n\n`dhcp-boot=pxelinux.0`\n\nHabilitamos el tftp:\n`enable-tftp`\n\nEstablecemos una ruta donde va a albergar nuestro Debian:\n`tftp-root=/srv/tftp`\n\n\nCreamos la carpeta en /srv\n`sudo mkdir /srv/tftp`\n\na continuación instalamos el wget y lo usamos en /srv/tftp\n\n\n`wget http://ftp.debian.org/debian/dists/bullseye/main/installer-amd64/current/images/netboot/netboot.tar.gz\n`\n\n`tar -zxf netboot.tar.gz` (para descomprimir los archivos)\n`rm netboot.tar.gz`\n\n\n\n`srv/tftp/debian-installer/amd64/boot-screens/txt.cfg`\n\nEn este fichero de configuración utilizamos los siguientes parámetros:\n```\nlabel install\n        menu label ^Install\n        kernel debian-installer/amd64/linux\n        append vga=788 initrd=debian-installer/amd64/initrd.gz --- quiet\nlabel unattended-gnome\n        menu label ^Instalacion Debian Desatendida Preseed\n        kernel debian-installer/amd64/linux\n        append vga=788 initrd=debian-installer/amd64/initrd.gz hostname=preseed domain=preseed preseed/url=192.168.100.5/preseed.cfg locale=en_US.UTF-8 console-setup/charmap=UTF-8 console-setup/ask_detect=false keyboard-configuration/xkb-keymap=us --\n```\n\nEn este label he puesto la url del servidor apache que vamos a utilizar, para que descargue el preseed y lo inyecte en la instalación.\n\nInstalamos apache2:\n`sudo apt install apache2`\n\nluego copiamos el preseed, lo ponemos en `/var/www/html/` junto al index.html, hacemos la página HTML que albergue el preseed y la ruta ya está establecida en el txt.cfg\n\n\nUna vez hecho esto, para que nuestra máquina que se conecta a la tarjeta de red estática que hemos creado, necesitamos establecer unas reglas de nftables que nos ayudará a conseguir que la máquina que conecte con el servidor pxe salga al exterior para descargar las dependencias.\n\nPara ello, debemos activar el bit de forwarding que se halla en `/etc/sysctl.conf` y descomentamos `#net.ipv4.ip_forward=1`\n\nInstalamos y habilitamos nftables(Todo esto siendo root):\n\n`apt install nftables`\n`systemctl start nftables.service`\n`systemctl enable nftables.service`\n`nft add table nat`\n`nft list tables`\n\nahora realizamos las reglas de nftables para conseguir que esas máquinas tengan internet:\n`nft add chain nat postrouting { type nat hook postrouting priority 100 \\; }`\n`nft add rule ip nat postrouting oifname \"eth0\" ip saddr 192.168.100.0/24 counter masquerade`\n\nAhora guardamos los cambios: `nft list ruleset > /etc/nftables.conf`\n\nAhora en virt-manager procedemos a crear y enlazar una máquina a una red aislada:\n```\n<network connections=\"2\">\n  <name>red_muy_aislada</name>\n  <uuid>b0083374-5cb6-4a8d-bd3c-32cf0d870b54</uuid>\n  <bridge name=\"virbr3\" stp=\"on\" delay=\"0\"/>\n  <mac address=\"52:54:00:e9:be:50\"/>\n</network>\n```\n\n debemos arrancarla por red como prioridad, luego de esto funcionará perfectamente nuestra instalación desatendida.\n","source":"_posts/Preseed-pxe.md","raw":"---\ntitle: Instalación preseed PXE+APACHE\ncategories: Sistemas Operativos\n---\n\nVamos a crear la máquina virtual como hicimos anteriormente en [Instalación automatizada basada en medio de almacenamiento extraíble.](https://entrebytes.neocities.org/2022/09/30/preseed/)\n\nEn vagrant creamos una máquina que tenga una ip estática 192.168.100.3 que va a ser la tarjeta de red por la que funcionará pxe, en mi caso no creó esa ip y la tuve que escribir a mano en el /etc/network/interfaces, la otra tarjeta de red es la de vagrant-libvirt que será la que nos conecte al exterior.\n\nPara proceder a configurar el protocolo **TFTP** Y **DHCP** para que sea el host el que conceda ip a la máquina y establezca la conexión al preseed, utilizando dnsmasq\n\napt install dnsmasq\n\n\nEstablecemos en el fichero /etc/dnsmaq.conf con los siguientes parámetros:\n\n`dhcp-range=192.168.100.100,192.168.100.200,255.255.255.0`\n\nEstablecemos el fichero con  el que va a bootear el dhcp:\n\n`dhcp-boot=pxelinux.0`\n\nHabilitamos el tftp:\n`enable-tftp`\n\nEstablecemos una ruta donde va a albergar nuestro Debian:\n`tftp-root=/srv/tftp`\n\n\nCreamos la carpeta en /srv\n`sudo mkdir /srv/tftp`\n\na continuación instalamos el wget y lo usamos en /srv/tftp\n\n\n`wget http://ftp.debian.org/debian/dists/bullseye/main/installer-amd64/current/images/netboot/netboot.tar.gz\n`\n\n`tar -zxf netboot.tar.gz` (para descomprimir los archivos)\n`rm netboot.tar.gz`\n\n\n\n`srv/tftp/debian-installer/amd64/boot-screens/txt.cfg`\n\nEn este fichero de configuración utilizamos los siguientes parámetros:\n```\nlabel install\n        menu label ^Install\n        kernel debian-installer/amd64/linux\n        append vga=788 initrd=debian-installer/amd64/initrd.gz --- quiet\nlabel unattended-gnome\n        menu label ^Instalacion Debian Desatendida Preseed\n        kernel debian-installer/amd64/linux\n        append vga=788 initrd=debian-installer/amd64/initrd.gz hostname=preseed domain=preseed preseed/url=192.168.100.5/preseed.cfg locale=en_US.UTF-8 console-setup/charmap=UTF-8 console-setup/ask_detect=false keyboard-configuration/xkb-keymap=us --\n```\n\nEn este label he puesto la url del servidor apache que vamos a utilizar, para que descargue el preseed y lo inyecte en la instalación.\n\nInstalamos apache2:\n`sudo apt install apache2`\n\nluego copiamos el preseed, lo ponemos en `/var/www/html/` junto al index.html, hacemos la página HTML que albergue el preseed y la ruta ya está establecida en el txt.cfg\n\n\nUna vez hecho esto, para que nuestra máquina que se conecta a la tarjeta de red estática que hemos creado, necesitamos establecer unas reglas de nftables que nos ayudará a conseguir que la máquina que conecte con el servidor pxe salga al exterior para descargar las dependencias.\n\nPara ello, debemos activar el bit de forwarding que se halla en `/etc/sysctl.conf` y descomentamos `#net.ipv4.ip_forward=1`\n\nInstalamos y habilitamos nftables(Todo esto siendo root):\n\n`apt install nftables`\n`systemctl start nftables.service`\n`systemctl enable nftables.service`\n`nft add table nat`\n`nft list tables`\n\nahora realizamos las reglas de nftables para conseguir que esas máquinas tengan internet:\n`nft add chain nat postrouting { type nat hook postrouting priority 100 \\; }`\n`nft add rule ip nat postrouting oifname \"eth0\" ip saddr 192.168.100.0/24 counter masquerade`\n\nAhora guardamos los cambios: `nft list ruleset > /etc/nftables.conf`\n\nAhora en virt-manager procedemos a crear y enlazar una máquina a una red aislada:\n```\n<network connections=\"2\">\n  <name>red_muy_aislada</name>\n  <uuid>b0083374-5cb6-4a8d-bd3c-32cf0d870b54</uuid>\n  <bridge name=\"virbr3\" stp=\"on\" delay=\"0\"/>\n  <mac address=\"52:54:00:e9:be:50\"/>\n</network>\n```\n\n debemos arrancarla por red como prioridad, luego de esto funcionará perfectamente nuestra instalación desatendida.\n","slug":"Preseed-pxe","published":1,"date":"2022-10-04T19:21:24.436Z","updated":"2023-01-04T13:34:44.707Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cldl8a0p6000a2fi533dvex6r","content":"<p>Vamos a crear la máquina virtual como hicimos anteriormente en <a href=\"https://entrebytes.neocities.org/2022/09/30/preseed/\">Instalación automatizada basada en medio de almacenamiento extraíble.</a></p>\n<p>En vagrant creamos una máquina que tenga una ip estática 192.168.100.3 que va a ser la tarjeta de red por la que funcionará pxe, en mi caso no creó esa ip y la tuve que escribir a mano en el /etc/network/interfaces, la otra tarjeta de red es la de vagrant-libvirt que será la que nos conecte al exterior.</p>\n<p>Para proceder a configurar el protocolo <strong>TFTP</strong> Y <strong>DHCP</strong> para que sea el host el que conceda ip a la máquina y establezca la conexión al preseed, utilizando dnsmasq</p>\n<p>apt install dnsmasq</p>\n<p>Establecemos en el fichero /etc/dnsmaq.conf con los siguientes parámetros:</p>\n<p><code>dhcp-range=192.168.100.100,192.168.100.200,255.255.255.0</code></p>\n<p>Establecemos el fichero con  el que va a bootear el dhcp:</p>\n<p><code>dhcp-boot=pxelinux.0</code></p>\n<p>Habilitamos el tftp:<br>\n <code>enable-tftp</code></p>\n<p>Establecemos una ruta donde va a albergar nuestro Debian:<br>\n <code>tftp-root=/srv/tftp</code></p>\n<p>Creamos la carpeta en /srv<br>\n <code>sudo mkdir /srv/tftp</code></p>\n<p>a continuación instalamos el wget y lo usamos en /srv/tftp</p>\n<p><code>wget http://ftp.debian.org/debian/dists/bullseye/main/installer-amd64/current/images/netboot/netboot.tar.gz </code></p>\n<p><code>tar -zxf netboot.tar.gz</code>  (para descomprimir los archivos)<br>\n <code>rm netboot.tar.gz</code></p>\n<p><code>srv/tftp/debian-installer/amd64/boot-screens/txt.cfg</code></p>\n<p>En este fichero de configuración utilizamos los siguientes parámetros:</p>\n<pre><code>label install\n        menu label ^Install\n        kernel debian-installer/amd64/linux\n        append vga=788 initrd=debian-installer/amd64/initrd.gz --- quiet\nlabel unattended-gnome\n        menu label ^Instalacion Debian Desatendida Preseed\n        kernel debian-installer/amd64/linux\n        append vga=788 initrd=debian-installer/amd64/initrd.gz hostname=preseed domain=preseed preseed/url=192.168.100.5/preseed.cfg locale=en_US.UTF-8 console-setup/charmap=UTF-8 console-setup/ask_detect=false keyboard-configuration/xkb-keymap=us --\n</code></pre>\n<p>En este label he puesto la url del servidor apache que vamos a utilizar, para que descargue el preseed y lo inyecte en la instalación.</p>\n<p>Instalamos apache2:<br>\n <code>sudo apt install apache2</code></p>\n<p>luego copiamos el preseed, lo ponemos en  <code>/var/www/html/</code>  junto al index.html, hacemos la página HTML que albergue el preseed y la ruta ya está establecida en el txt.cfg</p>\n<p>Una vez hecho esto, para que nuestra máquina que se conecta a la tarjeta de red estática que hemos creado, necesitamos establecer unas reglas de nftables que nos ayudará a conseguir que la máquina que conecte con el servidor pxe salga al exterior para descargar las dependencias.</p>\n<p>Para ello, debemos activar el bit de forwarding que se halla en  <code>/etc/sysctl.conf</code>  y descomentamos  <code>#net.ipv4.ip_forward=1</code></p>\n<p>Instalamos y habilitamos nftables(Todo esto siendo root):</p>\n<p><code>apt install nftables</code> <br>\n <code>systemctl start nftables.service</code> <br>\n <code>systemctl enable nftables.service</code> <br>\n <code>nft add table nat</code> <br>\n <code>nft list tables</code></p>\n<p>ahora realizamos las reglas de nftables para conseguir que esas máquinas tengan internet:<br>\n <code>nft add chain nat postrouting &#123; type nat hook postrouting priority 100 \\; &#125;</code> <br>\n <code>nft add rule ip nat postrouting oifname &quot;eth0&quot; ip saddr 192.168.100.0/24 counter masquerade</code></p>\n<p>Ahora guardamos los cambios:  <code>nft list ruleset &gt; /etc/nftables.conf</code></p>\n<p>Ahora en virt-manager procedemos a crear y enlazar una máquina a una red aislada:</p>\n<pre><code>&lt;network connections=&quot;2&quot;&gt;\n  &lt;name&gt;red_muy_aislada&lt;/name&gt;\n  &lt;uuid&gt;b0083374-5cb6-4a8d-bd3c-32cf0d870b54&lt;/uuid&gt;\n  &lt;bridge name=&quot;virbr3&quot; stp=&quot;on&quot; delay=&quot;0&quot;/&gt;\n  &lt;mac address=&quot;52:54:00:e9:be:50&quot;/&gt;\n&lt;/network&gt;\n</code></pre>\n<p>debemos arrancarla por red como prioridad, luego de esto funcionará perfectamente nuestra instalación desatendida.</p>\n","site":{"data":{}},"length":3157,"excerpt":"","more":"<p>Vamos a crear la máquina virtual como hicimos anteriormente en <a href=\"https://entrebytes.neocities.org/2022/09/30/preseed/\">Instalación automatizada basada en medio de almacenamiento extraíble.</a></p>\n<p>En vagrant creamos una máquina que tenga una ip estática 192.168.100.3 que va a ser la tarjeta de red por la que funcionará pxe, en mi caso no creó esa ip y la tuve que escribir a mano en el /etc/network/interfaces, la otra tarjeta de red es la de vagrant-libvirt que será la que nos conecte al exterior.</p>\n<p>Para proceder a configurar el protocolo <strong>TFTP</strong> Y <strong>DHCP</strong> para que sea el host el que conceda ip a la máquina y establezca la conexión al preseed, utilizando dnsmasq</p>\n<p>apt install dnsmasq</p>\n<p>Establecemos en el fichero /etc/dnsmaq.conf con los siguientes parámetros:</p>\n<p><code>dhcp-range=192.168.100.100,192.168.100.200,255.255.255.0</code></p>\n<p>Establecemos el fichero con  el que va a bootear el dhcp:</p>\n<p><code>dhcp-boot=pxelinux.0</code></p>\n<p>Habilitamos el tftp:<br>\n <code>enable-tftp</code></p>\n<p>Establecemos una ruta donde va a albergar nuestro Debian:<br>\n <code>tftp-root=/srv/tftp</code></p>\n<p>Creamos la carpeta en /srv<br>\n <code>sudo mkdir /srv/tftp</code></p>\n<p>a continuación instalamos el wget y lo usamos en /srv/tftp</p>\n<p><code>wget http://ftp.debian.org/debian/dists/bullseye/main/installer-amd64/current/images/netboot/netboot.tar.gz </code></p>\n<p><code>tar -zxf netboot.tar.gz</code>  (para descomprimir los archivos)<br>\n <code>rm netboot.tar.gz</code></p>\n<p><code>srv/tftp/debian-installer/amd64/boot-screens/txt.cfg</code></p>\n<p>En este fichero de configuración utilizamos los siguientes parámetros:</p>\n<pre><code>label install\n        menu label ^Install\n        kernel debian-installer/amd64/linux\n        append vga=788 initrd=debian-installer/amd64/initrd.gz --- quiet\nlabel unattended-gnome\n        menu label ^Instalacion Debian Desatendida Preseed\n        kernel debian-installer/amd64/linux\n        append vga=788 initrd=debian-installer/amd64/initrd.gz hostname=preseed domain=preseed preseed/url=192.168.100.5/preseed.cfg locale=en_US.UTF-8 console-setup/charmap=UTF-8 console-setup/ask_detect=false keyboard-configuration/xkb-keymap=us --\n</code></pre>\n<p>En este label he puesto la url del servidor apache que vamos a utilizar, para que descargue el preseed y lo inyecte en la instalación.</p>\n<p>Instalamos apache2:<br>\n <code>sudo apt install apache2</code></p>\n<p>luego copiamos el preseed, lo ponemos en  <code>/var/www/html/</code>  junto al index.html, hacemos la página HTML que albergue el preseed y la ruta ya está establecida en el txt.cfg</p>\n<p>Una vez hecho esto, para que nuestra máquina que se conecta a la tarjeta de red estática que hemos creado, necesitamos establecer unas reglas de nftables que nos ayudará a conseguir que la máquina que conecte con el servidor pxe salga al exterior para descargar las dependencias.</p>\n<p>Para ello, debemos activar el bit de forwarding que se halla en  <code>/etc/sysctl.conf</code>  y descomentamos  <code>#net.ipv4.ip_forward=1</code></p>\n<p>Instalamos y habilitamos nftables(Todo esto siendo root):</p>\n<p><code>apt install nftables</code> <br>\n <code>systemctl start nftables.service</code> <br>\n <code>systemctl enable nftables.service</code> <br>\n <code>nft add table nat</code> <br>\n <code>nft list tables</code></p>\n<p>ahora realizamos las reglas de nftables para conseguir que esas máquinas tengan internet:<br>\n <code>nft add chain nat postrouting &#123; type nat hook postrouting priority 100 \\; &#125;</code> <br>\n <code>nft add rule ip nat postrouting oifname &quot;eth0&quot; ip saddr 192.168.100.0/24 counter masquerade</code></p>\n<p>Ahora guardamos los cambios:  <code>nft list ruleset &gt; /etc/nftables.conf</code></p>\n<p>Ahora en virt-manager procedemos a crear y enlazar una máquina a una red aislada:</p>\n<pre><code>&lt;network connections=&quot;2&quot;&gt;\n  &lt;name&gt;red_muy_aislada&lt;/name&gt;\n  &lt;uuid&gt;b0083374-5cb6-4a8d-bd3c-32cf0d870b54&lt;/uuid&gt;\n  &lt;bridge name=&quot;virbr3&quot; stp=&quot;on&quot; delay=&quot;0&quot;/&gt;\n  &lt;mac address=&quot;52:54:00:e9:be:50&quot;/&gt;\n&lt;/network&gt;\n</code></pre>\n<p>debemos arrancarla por red como prioridad, luego de esto funcionará perfectamente nuestra instalación desatendida.</p>\n"},{"title":"Configurar un entorno DNS con vistas.","_content":"\n\n![Descripción de la imagen](/images/vistas-dns-1.png)\n\n\n\nInstalaremos un servidor DNS en charlie, de tal forma que todos los nombres de las máquinas deben tener resolución unas con otras al preguntar a charlie.\n\n![Descripción de la imagen](/images/Untitled-2023-01-10-0143.png)\n\nLas vistas sirven para que cada máquina en un entorno pueda ver las correspondientes salidas a nombres que se hallan dentro del entorno, para esto debemos hacer una configuración en el /etc/bind/named.conf.local, que quedaría de la siguiente manera:\n\n```\nview interna {\n    match-clients { 192.168.0.0/24; 127.0.0.1; };\n    allow-recursion { any; };\n        zone \"antonio.gonzalonazareno.org\"\n        {\n               type master;\n               file \"db.interna.antonio.gonzalonazareno.org\";\n        };\n        zone \"0.168.192.in-addr.arpa\"\n        {\n               type master;\n               file \"db.0.168.192\";\n        };\n        zone \"16.172.in-addr.arpa\"\n        {\n               type master;\n               file \"db.16.172\";\n        };\n        include \"/etc/bind/zones.rfc1918\";\n        include \"/etc/bind/named.conf.default-zones\";\n};\n\nview externa {\n    match-clients { 172.22.0.0/16; 192.168.202.2; 172.29.0.0/16;};\n    allow-recursion { any; };\n        zone \"antonio.gonzalonazareno.org\"\n        {\n               type master;\n               file \"db.externa.antonio.gonzalonazareno.org\";\n        };\n        include \"/etc/bind/zones.rfc1918\";\n        include \"/etc/bind/named.conf.default-zones\";\n};\n\nview dmz {\n    match-clients {172.22.0.0/16; 172.16.0.0/16; 172.29.0.0/16;};\n    allow-recursion { any; };\n        zone \"antonio.gonzalonazareno.org\"\n        {\n               type master;\n               file \"db.dmz.antonio.gonzalonazareno.org\";\n        };\n        zone \"16.172.in-addr.arpa\"\n        {\n               type master;\n               file \"db.16.172\";\n        };\n        zone \"0.168.192.in-addr.arpa\"\n        {\n               type master;\n               file \"db.0.168.192\";\n        };\n        include \"/etc/bind/zones.rfc1918\";\n        include \"/etc/bind/named.conf.default-zones\";\n};\n\n```\n\nPor cada rango de ips, tenemos una vista, ¿por qué tenemos 5 vistas? pues la respuesta sería la siguiente:\n- La vista interna que será la vista que tendrán alfa, charlie y delta que contendrá 192.168.0.0\n- La vista externa que será la que se muestre al exterior con 172.22.0.0\n- La vista dmz que tendrá a bravo con 172.16.0.0\n- Tanto la vista dmz como la interna tendrán respuesta sobre resoluciones inversas, pero en la externa no la tenemos, esto es debido a que no debemos proporcionar más información de la esencial a las preguntas desde la vista externa, ya que proviene del exterior y por tanto es menos seguro.\n\nUna vez creada las zonas debemos crear los ficheros en /var/cache/bind/\n\n## Zona externa:\n\n```\n$TTL    86400\n@       IN      SOA     alfa.antonio.gonzalonazareno.org. root.antonio.gonzalonazareno.org. (\n                              1         ; Serial\n                         604800         ; Refresh\n                          86400         ; Retry\n                        2419200         ; Expire\n                          86400 )       ; Negative Cache TTL\n;\n@       IN      NS              alfa.antonio.gonzalonazareno.org.\n\n$ORIGIN antonio.gonzalonazareno.org.\n\nalfa                    IN      A               172.22.200.193\ndns                     IN      CNAME           alfa\nwww                     IN      CNAME           alfa\n```\n\nComo podemos ver, hay varios cname, esto significa que en las preguntas dns que se realizarán desde el exterior a alfa, la respuesta sería tanto que alfa es el dns como el www, ya que no hay que proporcionar la información del interior.\n\n## Zona interna:\n\n```\n$TTL    86400\n@       IN      SOA     charlie.antonio.gonzalonazareno.org. root.antonio.gonzalonazareno.org. (\n                              1         ; Serial\n                         604800         ; Refresh\n                          86400         ; Retry\n                        2419200         ; Expire\n                          86400 )       ; Negative Cache TTL\n;\n@       IN      NS              charlie.antonio.gonzalonazareno.org.\n\n$ORIGIN antonio.gonzalonazareno.org.\n\nalfa                    IN      A               192.168.0.1\nbravo                   IN      A               172.16.0.200\ncharlie                 IN      A               192.168.0.2\ndelta                   IN      A               192.168.0.3\nbd                      IN      CNAME           delta\ndns                     IN      CNAME           charlie\nwww                     IN      CNAME           bravo\n```\n\nAhora en la vista interna podemos ver la información de las ip de las máquinas ya que es un entorno de producción seguro.\n\n## Zona interna inversa:\n\n```\n$TTL    86400\n@       IN      SOA     charlie.antonio.gonzalonazareno.org. root.antonio.gonzalonazareno.org. (\n                              1         ; Serial\n                         604800         ; Refresh\n                          86400         ; Retry\n                        2419200         ; Expire\n                          86400 )       ; Negative Cache TTL\n;\n@       IN      NS              charlie.antonio.gonzalonazareno.org.\n\n$ORIGIN 0.168.192.in-addr.arpa.\n\n1                       IN      PTR             alfa.antonio.gonzalonazareno.org.\n2                       IN      PTR             charlie.antonio.gonzalonazareno.org.\n3                       IN      PTR             delta.antonio.gonzalonazareno.org.\n```\n\nEs importante el '.' después del nombre del fdqn de la máquina ya que si no lo hacemos lo concatenará en la resolución con la ip inversa.\n\n\n## Zona DMZ:\n\n```\n$TTL    86400\n@       IN      SOA     charlie.antonio.gonzalonazareno.org. root.antonio.gonzalonazareno.org. (\n                              1         ; Serial\n                         604800         ; Refresh\n                          86400         ; Retry\n                        2419200         ; Expire\n                          86400 )       ; Negative Cache TTL\n;\n@       IN      NS              charlie.antonio.gonzalonazareno.org.\n\n$ORIGIN antonio.gonzalonazareno.org.\n\nalfa                    IN      A               172.16.0.1\nbravo                   IN      A               172.16.0.200\ncharlie                 IN      A               192.168.0.2\ndelta                   IN      A               192.168.0.3\nbd                      IN      CNAME           delta\ndns                     IN      CNAME           charlie\nwww                     IN      CNAME           bravo\n```\n\nLa diferencia que podemos apreciar de esta vista es que alfa posee el gateway 172.16.0.1, que es la que verá bravo.\n\n## Zona DMZ inversa:\n\n```\n$TTL    86400\n@       IN      SOA     charlie.antonio.gonzalonazareno.org. root.antonio.gonzalonazareno.org. (\n                              1         ; Serial\n                         604800         ; Refresh\n                          86400         ; Retry\n                        2419200         ; Expire\n                          86400 )       ; Negative Cache TTL\n;\n@       IN      NS              charlie.antonio.gonzalonazareno.org.\n\n$ORIGIN 16.172.in-addr.arpa.\n\n0.200                   IN      PTR             bravo.antonio.gonzalonazareno.org\n```\n\nUna vez hecho esto debemos hacer systemctl restart bind9 y comprobamos que no haya errores de sintaxis, después podemos porbar a realizar consultas con dig.\n\nAhora una vez realizadas las configuraciones, podemos jugar un poco con esto! y es que por ejemplo si tenemos una base de datos en delta y el cliente de esta base de datos está en bravo, podemos entrar poniendo el cname que especificamos en el dns.\n\n\n![Descripción de la imagen](/images/prueba-dns-mysql.png)\n\n\nY si en el caso que en el /etc/resolv.conf ponemos un search con el nombre del dominio `search antonio.gonzalonazareno.org` pues no haría falta especificar siquiera el dominio, como en el siguiente ejemplo:\n\n![Descripción de la imagen](/images/prueba-dns-mysql2.png)\n\nPor último dejamos la web de alfa que realmente estará alojada en bravo:\n\n![Descripción de la imagen](/images/web-alfa.png)\n\n\n## Tips\n\nSi queremos servir una web que está en un servidor que no pasa por alfa pero no es alfa, debemos poner una regla de iptables que nos permita dirigir el tráfico por el puerto que especifiquemos a bravo, para poder así acceder desde fuera.\n\nSi necesitamos acceder a este entorno desde un servidor dns que lo controle, debemos editar el archivo /etc/bind/named.conf.options\n\n```\n forwarders {\n      192.168.202.2;\n };\n\n```","source":"_posts/dns-vistas.md","raw":"---\ntitle: Configurar un entorno DNS con vistas.\ncategories: Servicios de Red e Internet\ntags: Servicios de Red e Internet\n---\n\n\n![Descripción de la imagen](/images/vistas-dns-1.png)\n\n\n\nInstalaremos un servidor DNS en charlie, de tal forma que todos los nombres de las máquinas deben tener resolución unas con otras al preguntar a charlie.\n\n![Descripción de la imagen](/images/Untitled-2023-01-10-0143.png)\n\nLas vistas sirven para que cada máquina en un entorno pueda ver las correspondientes salidas a nombres que se hallan dentro del entorno, para esto debemos hacer una configuración en el /etc/bind/named.conf.local, que quedaría de la siguiente manera:\n\n```\nview interna {\n    match-clients { 192.168.0.0/24; 127.0.0.1; };\n    allow-recursion { any; };\n        zone \"antonio.gonzalonazareno.org\"\n        {\n               type master;\n               file \"db.interna.antonio.gonzalonazareno.org\";\n        };\n        zone \"0.168.192.in-addr.arpa\"\n        {\n               type master;\n               file \"db.0.168.192\";\n        };\n        zone \"16.172.in-addr.arpa\"\n        {\n               type master;\n               file \"db.16.172\";\n        };\n        include \"/etc/bind/zones.rfc1918\";\n        include \"/etc/bind/named.conf.default-zones\";\n};\n\nview externa {\n    match-clients { 172.22.0.0/16; 192.168.202.2; 172.29.0.0/16;};\n    allow-recursion { any; };\n        zone \"antonio.gonzalonazareno.org\"\n        {\n               type master;\n               file \"db.externa.antonio.gonzalonazareno.org\";\n        };\n        include \"/etc/bind/zones.rfc1918\";\n        include \"/etc/bind/named.conf.default-zones\";\n};\n\nview dmz {\n    match-clients {172.22.0.0/16; 172.16.0.0/16; 172.29.0.0/16;};\n    allow-recursion { any; };\n        zone \"antonio.gonzalonazareno.org\"\n        {\n               type master;\n               file \"db.dmz.antonio.gonzalonazareno.org\";\n        };\n        zone \"16.172.in-addr.arpa\"\n        {\n               type master;\n               file \"db.16.172\";\n        };\n        zone \"0.168.192.in-addr.arpa\"\n        {\n               type master;\n               file \"db.0.168.192\";\n        };\n        include \"/etc/bind/zones.rfc1918\";\n        include \"/etc/bind/named.conf.default-zones\";\n};\n\n```\n\nPor cada rango de ips, tenemos una vista, ¿por qué tenemos 5 vistas? pues la respuesta sería la siguiente:\n- La vista interna que será la vista que tendrán alfa, charlie y delta que contendrá 192.168.0.0\n- La vista externa que será la que se muestre al exterior con 172.22.0.0\n- La vista dmz que tendrá a bravo con 172.16.0.0\n- Tanto la vista dmz como la interna tendrán respuesta sobre resoluciones inversas, pero en la externa no la tenemos, esto es debido a que no debemos proporcionar más información de la esencial a las preguntas desde la vista externa, ya que proviene del exterior y por tanto es menos seguro.\n\nUna vez creada las zonas debemos crear los ficheros en /var/cache/bind/\n\n## Zona externa:\n\n```\n$TTL    86400\n@       IN      SOA     alfa.antonio.gonzalonazareno.org. root.antonio.gonzalonazareno.org. (\n                              1         ; Serial\n                         604800         ; Refresh\n                          86400         ; Retry\n                        2419200         ; Expire\n                          86400 )       ; Negative Cache TTL\n;\n@       IN      NS              alfa.antonio.gonzalonazareno.org.\n\n$ORIGIN antonio.gonzalonazareno.org.\n\nalfa                    IN      A               172.22.200.193\ndns                     IN      CNAME           alfa\nwww                     IN      CNAME           alfa\n```\n\nComo podemos ver, hay varios cname, esto significa que en las preguntas dns que se realizarán desde el exterior a alfa, la respuesta sería tanto que alfa es el dns como el www, ya que no hay que proporcionar la información del interior.\n\n## Zona interna:\n\n```\n$TTL    86400\n@       IN      SOA     charlie.antonio.gonzalonazareno.org. root.antonio.gonzalonazareno.org. (\n                              1         ; Serial\n                         604800         ; Refresh\n                          86400         ; Retry\n                        2419200         ; Expire\n                          86400 )       ; Negative Cache TTL\n;\n@       IN      NS              charlie.antonio.gonzalonazareno.org.\n\n$ORIGIN antonio.gonzalonazareno.org.\n\nalfa                    IN      A               192.168.0.1\nbravo                   IN      A               172.16.0.200\ncharlie                 IN      A               192.168.0.2\ndelta                   IN      A               192.168.0.3\nbd                      IN      CNAME           delta\ndns                     IN      CNAME           charlie\nwww                     IN      CNAME           bravo\n```\n\nAhora en la vista interna podemos ver la información de las ip de las máquinas ya que es un entorno de producción seguro.\n\n## Zona interna inversa:\n\n```\n$TTL    86400\n@       IN      SOA     charlie.antonio.gonzalonazareno.org. root.antonio.gonzalonazareno.org. (\n                              1         ; Serial\n                         604800         ; Refresh\n                          86400         ; Retry\n                        2419200         ; Expire\n                          86400 )       ; Negative Cache TTL\n;\n@       IN      NS              charlie.antonio.gonzalonazareno.org.\n\n$ORIGIN 0.168.192.in-addr.arpa.\n\n1                       IN      PTR             alfa.antonio.gonzalonazareno.org.\n2                       IN      PTR             charlie.antonio.gonzalonazareno.org.\n3                       IN      PTR             delta.antonio.gonzalonazareno.org.\n```\n\nEs importante el '.' después del nombre del fdqn de la máquina ya que si no lo hacemos lo concatenará en la resolución con la ip inversa.\n\n\n## Zona DMZ:\n\n```\n$TTL    86400\n@       IN      SOA     charlie.antonio.gonzalonazareno.org. root.antonio.gonzalonazareno.org. (\n                              1         ; Serial\n                         604800         ; Refresh\n                          86400         ; Retry\n                        2419200         ; Expire\n                          86400 )       ; Negative Cache TTL\n;\n@       IN      NS              charlie.antonio.gonzalonazareno.org.\n\n$ORIGIN antonio.gonzalonazareno.org.\n\nalfa                    IN      A               172.16.0.1\nbravo                   IN      A               172.16.0.200\ncharlie                 IN      A               192.168.0.2\ndelta                   IN      A               192.168.0.3\nbd                      IN      CNAME           delta\ndns                     IN      CNAME           charlie\nwww                     IN      CNAME           bravo\n```\n\nLa diferencia que podemos apreciar de esta vista es que alfa posee el gateway 172.16.0.1, que es la que verá bravo.\n\n## Zona DMZ inversa:\n\n```\n$TTL    86400\n@       IN      SOA     charlie.antonio.gonzalonazareno.org. root.antonio.gonzalonazareno.org. (\n                              1         ; Serial\n                         604800         ; Refresh\n                          86400         ; Retry\n                        2419200         ; Expire\n                          86400 )       ; Negative Cache TTL\n;\n@       IN      NS              charlie.antonio.gonzalonazareno.org.\n\n$ORIGIN 16.172.in-addr.arpa.\n\n0.200                   IN      PTR             bravo.antonio.gonzalonazareno.org\n```\n\nUna vez hecho esto debemos hacer systemctl restart bind9 y comprobamos que no haya errores de sintaxis, después podemos porbar a realizar consultas con dig.\n\nAhora una vez realizadas las configuraciones, podemos jugar un poco con esto! y es que por ejemplo si tenemos una base de datos en delta y el cliente de esta base de datos está en bravo, podemos entrar poniendo el cname que especificamos en el dns.\n\n\n![Descripción de la imagen](/images/prueba-dns-mysql.png)\n\n\nY si en el caso que en el /etc/resolv.conf ponemos un search con el nombre del dominio `search antonio.gonzalonazareno.org` pues no haría falta especificar siquiera el dominio, como en el siguiente ejemplo:\n\n![Descripción de la imagen](/images/prueba-dns-mysql2.png)\n\nPor último dejamos la web de alfa que realmente estará alojada en bravo:\n\n![Descripción de la imagen](/images/web-alfa.png)\n\n\n## Tips\n\nSi queremos servir una web que está en un servidor que no pasa por alfa pero no es alfa, debemos poner una regla de iptables que nos permita dirigir el tráfico por el puerto que especifiquemos a bravo, para poder así acceder desde fuera.\n\nSi necesitamos acceder a este entorno desde un servidor dns que lo controle, debemos editar el archivo /etc/bind/named.conf.options\n\n```\n forwarders {\n      192.168.202.2;\n };\n\n```","slug":"dns-vistas","published":1,"date":"2023-01-10T00:38:26.921Z","updated":"2023-01-15T13:42:33.828Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cldl8a0p7000e2fi503vkcv8z","content":"<p><img src=\"/images/vistas-dns-1.png\" alt=\"Descripción de la imagen\"></p>\n<p>Instalaremos un servidor DNS en charlie, de tal forma que todos los nombres de las máquinas deben tener resolución unas con otras al preguntar a charlie.</p>\n<p><img src=\"/images/Untitled-2023-01-10-0143.png\" alt=\"Descripción de la imagen\"></p>\n<p>Las vistas sirven para que cada máquina en un entorno pueda ver las correspondientes salidas a nombres que se hallan dentro del entorno, para esto debemos hacer una configuración en el /etc/bind/named.conf.local, que quedaría de la siguiente manera:</p>\n<pre><code>view interna &#123;\n    match-clients &#123; 192.168.0.0/24; 127.0.0.1; &#125;;\n    allow-recursion &#123; any; &#125;;\n        zone &quot;antonio.gonzalonazareno.org&quot;\n        &#123;\n               type master;\n               file &quot;db.interna.antonio.gonzalonazareno.org&quot;;\n        &#125;;\n        zone &quot;0.168.192.in-addr.arpa&quot;\n        &#123;\n               type master;\n               file &quot;db.0.168.192&quot;;\n        &#125;;\n        zone &quot;16.172.in-addr.arpa&quot;\n        &#123;\n               type master;\n               file &quot;db.16.172&quot;;\n        &#125;;\n        include &quot;/etc/bind/zones.rfc1918&quot;;\n        include &quot;/etc/bind/named.conf.default-zones&quot;;\n&#125;;\n\nview externa &#123;\n    match-clients &#123; 172.22.0.0/16; 192.168.202.2; 172.29.0.0/16;&#125;;\n    allow-recursion &#123; any; &#125;;\n        zone &quot;antonio.gonzalonazareno.org&quot;\n        &#123;\n               type master;\n               file &quot;db.externa.antonio.gonzalonazareno.org&quot;;\n        &#125;;\n        include &quot;/etc/bind/zones.rfc1918&quot;;\n        include &quot;/etc/bind/named.conf.default-zones&quot;;\n&#125;;\n\nview dmz &#123;\n    match-clients &#123;172.22.0.0/16; 172.16.0.0/16; 172.29.0.0/16;&#125;;\n    allow-recursion &#123; any; &#125;;\n        zone &quot;antonio.gonzalonazareno.org&quot;\n        &#123;\n               type master;\n               file &quot;db.dmz.antonio.gonzalonazareno.org&quot;;\n        &#125;;\n        zone &quot;16.172.in-addr.arpa&quot;\n        &#123;\n               type master;\n               file &quot;db.16.172&quot;;\n        &#125;;\n        zone &quot;0.168.192.in-addr.arpa&quot;\n        &#123;\n               type master;\n               file &quot;db.0.168.192&quot;;\n        &#125;;\n        include &quot;/etc/bind/zones.rfc1918&quot;;\n        include &quot;/etc/bind/named.conf.default-zones&quot;;\n&#125;;\n\n</code></pre>\n<p>Por cada rango de ips, tenemos una vista, ¿por qué tenemos 5 vistas? pues la respuesta sería la siguiente:</p>\n<ul>\n<li>La vista interna que será la vista que tendrán alfa, charlie y delta que contendrá 192.168.0.0</li>\n<li>La vista externa que será la que se muestre al exterior con 172.22.0.0</li>\n<li>La vista dmz que tendrá a bravo con 172.16.0.0</li>\n<li>Tanto la vista dmz como la interna tendrán respuesta sobre resoluciones inversas, pero en la externa no la tenemos, esto es debido a que no debemos proporcionar más información de la esencial a las preguntas desde la vista externa, ya que proviene del exterior y por tanto es menos seguro.</li>\n</ul>\n<p>Una vez creada las zonas debemos crear los ficheros en /var/cache/bind/</p>\n<h2 id=\"zona-externa\"><a class=\"markdownIt-Anchor\" href=\"#zona-externa\">#</a> Zona externa:</h2>\n<pre><code>$TTL    86400\n@       IN      SOA     alfa.antonio.gonzalonazareno.org. root.antonio.gonzalonazareno.org. (\n                              1         ; Serial\n                         604800         ; Refresh\n                          86400         ; Retry\n                        2419200         ; Expire\n                          86400 )       ; Negative Cache TTL\n;\n@       IN      NS              alfa.antonio.gonzalonazareno.org.\n\n$ORIGIN antonio.gonzalonazareno.org.\n\nalfa                    IN      A               172.22.200.193\ndns                     IN      CNAME           alfa\nwww                     IN      CNAME           alfa\n</code></pre>\n<p>Como podemos ver, hay varios cname, esto significa que en las preguntas dns que se realizarán desde el exterior a alfa, la respuesta sería tanto que alfa es el dns como el www, ya que no hay que proporcionar la información del interior.</p>\n<h2 id=\"zona-interna\"><a class=\"markdownIt-Anchor\" href=\"#zona-interna\">#</a> Zona interna:</h2>\n<pre><code>$TTL    86400\n@       IN      SOA     charlie.antonio.gonzalonazareno.org. root.antonio.gonzalonazareno.org. (\n                              1         ; Serial\n                         604800         ; Refresh\n                          86400         ; Retry\n                        2419200         ; Expire\n                          86400 )       ; Negative Cache TTL\n;\n@       IN      NS              charlie.antonio.gonzalonazareno.org.\n\n$ORIGIN antonio.gonzalonazareno.org.\n\nalfa                    IN      A               192.168.0.1\nbravo                   IN      A               172.16.0.200\ncharlie                 IN      A               192.168.0.2\ndelta                   IN      A               192.168.0.3\nbd                      IN      CNAME           delta\ndns                     IN      CNAME           charlie\nwww                     IN      CNAME           bravo\n</code></pre>\n<p>Ahora en la vista interna podemos ver la información de las ip de las máquinas ya que es un entorno de producción seguro.</p>\n<h2 id=\"zona-interna-inversa\"><a class=\"markdownIt-Anchor\" href=\"#zona-interna-inversa\">#</a> Zona interna inversa:</h2>\n<pre><code>$TTL    86400\n@       IN      SOA     charlie.antonio.gonzalonazareno.org. root.antonio.gonzalonazareno.org. (\n                              1         ; Serial\n                         604800         ; Refresh\n                          86400         ; Retry\n                        2419200         ; Expire\n                          86400 )       ; Negative Cache TTL\n;\n@       IN      NS              charlie.antonio.gonzalonazareno.org.\n\n$ORIGIN 0.168.192.in-addr.arpa.\n\n1                       IN      PTR             alfa.antonio.gonzalonazareno.org.\n2                       IN      PTR             charlie.antonio.gonzalonazareno.org.\n3                       IN      PTR             delta.antonio.gonzalonazareno.org.\n</code></pre>\n<p>Es importante el ‘.’ después del nombre del fdqn de la máquina ya que si no lo hacemos lo concatenará en la resolución con la ip inversa.</p>\n<h2 id=\"zona-dmz\"><a class=\"markdownIt-Anchor\" href=\"#zona-dmz\">#</a> Zona DMZ:</h2>\n<pre><code>$TTL    86400\n@       IN      SOA     charlie.antonio.gonzalonazareno.org. root.antonio.gonzalonazareno.org. (\n                              1         ; Serial\n                         604800         ; Refresh\n                          86400         ; Retry\n                        2419200         ; Expire\n                          86400 )       ; Negative Cache TTL\n;\n@       IN      NS              charlie.antonio.gonzalonazareno.org.\n\n$ORIGIN antonio.gonzalonazareno.org.\n\nalfa                    IN      A               172.16.0.1\nbravo                   IN      A               172.16.0.200\ncharlie                 IN      A               192.168.0.2\ndelta                   IN      A               192.168.0.3\nbd                      IN      CNAME           delta\ndns                     IN      CNAME           charlie\nwww                     IN      CNAME           bravo\n</code></pre>\n<p>La diferencia que podemos apreciar de esta vista es que alfa posee el gateway 172.16.0.1, que es la que verá bravo.</p>\n<h2 id=\"zona-dmz-inversa\"><a class=\"markdownIt-Anchor\" href=\"#zona-dmz-inversa\">#</a> Zona DMZ inversa:</h2>\n<pre><code>$TTL    86400\n@       IN      SOA     charlie.antonio.gonzalonazareno.org. root.antonio.gonzalonazareno.org. (\n                              1         ; Serial\n                         604800         ; Refresh\n                          86400         ; Retry\n                        2419200         ; Expire\n                          86400 )       ; Negative Cache TTL\n;\n@       IN      NS              charlie.antonio.gonzalonazareno.org.\n\n$ORIGIN 16.172.in-addr.arpa.\n\n0.200                   IN      PTR             bravo.antonio.gonzalonazareno.org\n</code></pre>\n<p>Una vez hecho esto debemos hacer systemctl restart bind9 y comprobamos que no haya errores de sintaxis, después podemos porbar a realizar consultas con dig.</p>\n<p>Ahora una vez realizadas las configuraciones, podemos jugar un poco con esto! y es que por ejemplo si tenemos una base de datos en delta y el cliente de esta base de datos está en bravo, podemos entrar poniendo el cname que especificamos en el dns.</p>\n<p><img src=\"/images/prueba-dns-mysql.png\" alt=\"Descripción de la imagen\"></p>\n<p>Y si en el caso que en el /etc/resolv.conf ponemos un search con el nombre del dominio  <code>search antonio.gonzalonazareno.org</code>  pues no haría falta especificar siquiera el dominio, como en el siguiente ejemplo:</p>\n<p><img src=\"/images/prueba-dns-mysql2.png\" alt=\"Descripción de la imagen\"></p>\n<p>Por último dejamos la web de alfa que realmente estará alojada en bravo:</p>\n<p><img src=\"/images/web-alfa.png\" alt=\"Descripción de la imagen\"></p>\n<h2 id=\"tips\"><a class=\"markdownIt-Anchor\" href=\"#tips\">#</a> Tips</h2>\n<p>Si queremos servir una web que está en un servidor que no pasa por alfa pero no es alfa, debemos poner una regla de iptables que nos permita dirigir el tráfico por el puerto que especifiquemos a bravo, para poder así acceder desde fuera.</p>\n<p>Si necesitamos acceder a este entorno desde un servidor dns que lo controle, debemos editar el archivo /etc/bind/named.conf.options</p>\n<pre><code> forwarders &#123;\n      192.168.202.2;\n &#125;;\n\n</code></pre>\n","site":{"data":{}},"length":5349,"excerpt":"","more":"<p><img src=\"/images/vistas-dns-1.png\" alt=\"Descripción de la imagen\"></p>\n<p>Instalaremos un servidor DNS en charlie, de tal forma que todos los nombres de las máquinas deben tener resolución unas con otras al preguntar a charlie.</p>\n<p><img src=\"/images/Untitled-2023-01-10-0143.png\" alt=\"Descripción de la imagen\"></p>\n<p>Las vistas sirven para que cada máquina en un entorno pueda ver las correspondientes salidas a nombres que se hallan dentro del entorno, para esto debemos hacer una configuración en el /etc/bind/named.conf.local, que quedaría de la siguiente manera:</p>\n<pre><code>view interna &#123;\n    match-clients &#123; 192.168.0.0/24; 127.0.0.1; &#125;;\n    allow-recursion &#123; any; &#125;;\n        zone &quot;antonio.gonzalonazareno.org&quot;\n        &#123;\n               type master;\n               file &quot;db.interna.antonio.gonzalonazareno.org&quot;;\n        &#125;;\n        zone &quot;0.168.192.in-addr.arpa&quot;\n        &#123;\n               type master;\n               file &quot;db.0.168.192&quot;;\n        &#125;;\n        zone &quot;16.172.in-addr.arpa&quot;\n        &#123;\n               type master;\n               file &quot;db.16.172&quot;;\n        &#125;;\n        include &quot;/etc/bind/zones.rfc1918&quot;;\n        include &quot;/etc/bind/named.conf.default-zones&quot;;\n&#125;;\n\nview externa &#123;\n    match-clients &#123; 172.22.0.0/16; 192.168.202.2; 172.29.0.0/16;&#125;;\n    allow-recursion &#123; any; &#125;;\n        zone &quot;antonio.gonzalonazareno.org&quot;\n        &#123;\n               type master;\n               file &quot;db.externa.antonio.gonzalonazareno.org&quot;;\n        &#125;;\n        include &quot;/etc/bind/zones.rfc1918&quot;;\n        include &quot;/etc/bind/named.conf.default-zones&quot;;\n&#125;;\n\nview dmz &#123;\n    match-clients &#123;172.22.0.0/16; 172.16.0.0/16; 172.29.0.0/16;&#125;;\n    allow-recursion &#123; any; &#125;;\n        zone &quot;antonio.gonzalonazareno.org&quot;\n        &#123;\n               type master;\n               file &quot;db.dmz.antonio.gonzalonazareno.org&quot;;\n        &#125;;\n        zone &quot;16.172.in-addr.arpa&quot;\n        &#123;\n               type master;\n               file &quot;db.16.172&quot;;\n        &#125;;\n        zone &quot;0.168.192.in-addr.arpa&quot;\n        &#123;\n               type master;\n               file &quot;db.0.168.192&quot;;\n        &#125;;\n        include &quot;/etc/bind/zones.rfc1918&quot;;\n        include &quot;/etc/bind/named.conf.default-zones&quot;;\n&#125;;\n\n</code></pre>\n<p>Por cada rango de ips, tenemos una vista, ¿por qué tenemos 5 vistas? pues la respuesta sería la siguiente:</p>\n<ul>\n<li>La vista interna que será la vista que tendrán alfa, charlie y delta que contendrá 192.168.0.0</li>\n<li>La vista externa que será la que se muestre al exterior con 172.22.0.0</li>\n<li>La vista dmz que tendrá a bravo con 172.16.0.0</li>\n<li>Tanto la vista dmz como la interna tendrán respuesta sobre resoluciones inversas, pero en la externa no la tenemos, esto es debido a que no debemos proporcionar más información de la esencial a las preguntas desde la vista externa, ya que proviene del exterior y por tanto es menos seguro.</li>\n</ul>\n<p>Una vez creada las zonas debemos crear los ficheros en /var/cache/bind/</p>\n<h2 id=\"zona-externa\"><a class=\"markdownIt-Anchor\" href=\"#zona-externa\">#</a> Zona externa:</h2>\n<pre><code>$TTL    86400\n@       IN      SOA     alfa.antonio.gonzalonazareno.org. root.antonio.gonzalonazareno.org. (\n                              1         ; Serial\n                         604800         ; Refresh\n                          86400         ; Retry\n                        2419200         ; Expire\n                          86400 )       ; Negative Cache TTL\n;\n@       IN      NS              alfa.antonio.gonzalonazareno.org.\n\n$ORIGIN antonio.gonzalonazareno.org.\n\nalfa                    IN      A               172.22.200.193\ndns                     IN      CNAME           alfa\nwww                     IN      CNAME           alfa\n</code></pre>\n<p>Como podemos ver, hay varios cname, esto significa que en las preguntas dns que se realizarán desde el exterior a alfa, la respuesta sería tanto que alfa es el dns como el www, ya que no hay que proporcionar la información del interior.</p>\n<h2 id=\"zona-interna\"><a class=\"markdownIt-Anchor\" href=\"#zona-interna\">#</a> Zona interna:</h2>\n<pre><code>$TTL    86400\n@       IN      SOA     charlie.antonio.gonzalonazareno.org. root.antonio.gonzalonazareno.org. (\n                              1         ; Serial\n                         604800         ; Refresh\n                          86400         ; Retry\n                        2419200         ; Expire\n                          86400 )       ; Negative Cache TTL\n;\n@       IN      NS              charlie.antonio.gonzalonazareno.org.\n\n$ORIGIN antonio.gonzalonazareno.org.\n\nalfa                    IN      A               192.168.0.1\nbravo                   IN      A               172.16.0.200\ncharlie                 IN      A               192.168.0.2\ndelta                   IN      A               192.168.0.3\nbd                      IN      CNAME           delta\ndns                     IN      CNAME           charlie\nwww                     IN      CNAME           bravo\n</code></pre>\n<p>Ahora en la vista interna podemos ver la información de las ip de las máquinas ya que es un entorno de producción seguro.</p>\n<h2 id=\"zona-interna-inversa\"><a class=\"markdownIt-Anchor\" href=\"#zona-interna-inversa\">#</a> Zona interna inversa:</h2>\n<pre><code>$TTL    86400\n@       IN      SOA     charlie.antonio.gonzalonazareno.org. root.antonio.gonzalonazareno.org. (\n                              1         ; Serial\n                         604800         ; Refresh\n                          86400         ; Retry\n                        2419200         ; Expire\n                          86400 )       ; Negative Cache TTL\n;\n@       IN      NS              charlie.antonio.gonzalonazareno.org.\n\n$ORIGIN 0.168.192.in-addr.arpa.\n\n1                       IN      PTR             alfa.antonio.gonzalonazareno.org.\n2                       IN      PTR             charlie.antonio.gonzalonazareno.org.\n3                       IN      PTR             delta.antonio.gonzalonazareno.org.\n</code></pre>\n<p>Es importante el ‘.’ después del nombre del fdqn de la máquina ya que si no lo hacemos lo concatenará en la resolución con la ip inversa.</p>\n<h2 id=\"zona-dmz\"><a class=\"markdownIt-Anchor\" href=\"#zona-dmz\">#</a> Zona DMZ:</h2>\n<pre><code>$TTL    86400\n@       IN      SOA     charlie.antonio.gonzalonazareno.org. root.antonio.gonzalonazareno.org. (\n                              1         ; Serial\n                         604800         ; Refresh\n                          86400         ; Retry\n                        2419200         ; Expire\n                          86400 )       ; Negative Cache TTL\n;\n@       IN      NS              charlie.antonio.gonzalonazareno.org.\n\n$ORIGIN antonio.gonzalonazareno.org.\n\nalfa                    IN      A               172.16.0.1\nbravo                   IN      A               172.16.0.200\ncharlie                 IN      A               192.168.0.2\ndelta                   IN      A               192.168.0.3\nbd                      IN      CNAME           delta\ndns                     IN      CNAME           charlie\nwww                     IN      CNAME           bravo\n</code></pre>\n<p>La diferencia que podemos apreciar de esta vista es que alfa posee el gateway 172.16.0.1, que es la que verá bravo.</p>\n<h2 id=\"zona-dmz-inversa\"><a class=\"markdownIt-Anchor\" href=\"#zona-dmz-inversa\">#</a> Zona DMZ inversa:</h2>\n<pre><code>$TTL    86400\n@       IN      SOA     charlie.antonio.gonzalonazareno.org. root.antonio.gonzalonazareno.org. (\n                              1         ; Serial\n                         604800         ; Refresh\n                          86400         ; Retry\n                        2419200         ; Expire\n                          86400 )       ; Negative Cache TTL\n;\n@       IN      NS              charlie.antonio.gonzalonazareno.org.\n\n$ORIGIN 16.172.in-addr.arpa.\n\n0.200                   IN      PTR             bravo.antonio.gonzalonazareno.org\n</code></pre>\n<p>Una vez hecho esto debemos hacer systemctl restart bind9 y comprobamos que no haya errores de sintaxis, después podemos porbar a realizar consultas con dig.</p>\n<p>Ahora una vez realizadas las configuraciones, podemos jugar un poco con esto! y es que por ejemplo si tenemos una base de datos en delta y el cliente de esta base de datos está en bravo, podemos entrar poniendo el cname que especificamos en el dns.</p>\n<p><img src=\"/images/prueba-dns-mysql.png\" alt=\"Descripción de la imagen\"></p>\n<p>Y si en el caso que en el /etc/resolv.conf ponemos un search con el nombre del dominio  <code>search antonio.gonzalonazareno.org</code>  pues no haría falta especificar siquiera el dominio, como en el siguiente ejemplo:</p>\n<p><img src=\"/images/prueba-dns-mysql2.png\" alt=\"Descripción de la imagen\"></p>\n<p>Por último dejamos la web de alfa que realmente estará alojada en bravo:</p>\n<p><img src=\"/images/web-alfa.png\" alt=\"Descripción de la imagen\"></p>\n<h2 id=\"tips\"><a class=\"markdownIt-Anchor\" href=\"#tips\">#</a> Tips</h2>\n<p>Si queremos servir una web que está en un servidor que no pasa por alfa pero no es alfa, debemos poner una regla de iptables que nos permita dirigir el tráfico por el puerto que especifiquemos a bravo, para poder así acceder desde fuera.</p>\n<p>Si necesitamos acceder a este entorno desde un servidor dns que lo controle, debemos editar el archivo /etc/bind/named.conf.options</p>\n<pre><code> forwarders &#123;\n      192.168.202.2;\n &#125;;\n\n</code></pre>\n"},{"title":"Configurar un servidor DNS.","_content":"\n![Descripción de la imagen](/images/obelix-4.jpg)\n\n\n## Servidor maestro\n\nPrimero comenzaremos actualizando el sistema e instalando el servidor dns bind9, la máquina deberá tener un nombre full qualificated como en mi caso que sería **dns1.antonio.org**\n\n`apt update && apt install bind9 -y`\n\nVamos a forzar la salida de las peutciones por ipv4, ya que al no estar configurado de esta forma pueden perderse paquetes al tratar de viajar a través de ipv6, esto lo haremos en /etc/default/named, especificando esta sentencia en  `OPTIONS=\"-4 -f -u bind\"`.\n\nPrimero debemos permitir el tráfico desde las diferentes ip en el fichero /etc/bind/named.conf.options.\n\n```\nallow-query {172.29.0.0/16; 172.22.0.0/16;};\nallow-transfer { none ;};\n```\n\nAllow-query se encargará de permitir las consultas a través de los distintos rangos de ip, yo al estar conectado a una vpn debo poner también ese rango para así poder realizar las consultas desde casa.\n\nAllow-transfer none hará que no se realicen transpasos completos en la información de la zona, esto nos permitirá que no podamos exponer información sensible dentro del servidor dns al realizar las consultas con dig.\n\nTras esto, comenzaremos editando el fichero de configuración de zonas, el cual se encargará de administrar las plantillas a las que se les va a realizar una consulta dns con dig.\n\n/etc/bind/named.conf.local\n\n```shell\ninclude \"/etc/bind/zones.rfc1918\";\nzone \"antonio.org\" {\n    type master;\n    file \"db.antonio.org\";\n    allow-transfer { 172.22.7.171; };\n    notify yes;\n};\n\nzone \"22.172.in-addr.arpa\" {\n    type master;\n    file \"db.172.22.0.0\";\n    allow-transfer { 172.22.7.171; };\n    notify yes;\n};\n\n```\n\nNuestra zona será antonio.org, el cual tendrá el fichero db.antonio.org, hasta ahí será necesario para ralizar solo un dns, para realizar el dns respaldado por un esclavo necesitaremos conceder el traspaso a la ip 172.22.7.171 que será la ip de la máquina esclava, más abajo nos econtraremos con el fichero de zona de resolución inversa, el cual tendrá el nombre del rango de ip que abarcará, y la misma transferencia de zona y el notify que será lo que avise al esclavo que ha habido un cambio en el maestro.\n\nSi nos vamos al fichero /var/cache/bind/db.antonio.org podemos ver los siguientes componentes:\n\n```shell\n$TTL    86400\n@       IN      SOA     dns1.antonio.org. root.antonio.org. (\n                              6         ; Serial\n                         604800         ; Refresh\n                          86400         ; Retry\n                        2419200         ; Expire\n                          86400 )       ; Negative Cache TTL\n;\n\n@       IN      NS              dns1.antonio.org.\n@       IN      NS              dns2.antonio.org.\n@       IN      MX      10      correo.antonio.org.\n\n\n$ORIGIN antonio.org.\n\ndns1                    IN      A       172.22.7.155\ndns2                    IN      A       172.22.7.171\ncorreo                  IN      A       172.22.200.101\nasterix                 IN      A       172.22.200.102\nobelix                  IN      A       172.22.200.103\nprueba                  IN      A       172.22.200.120\nwww                     IN      CNAME   asterix\n;informatica             IN      CNAME   asterix\nftp                     IN      CNAME   obelix\nentrebytes              IN      A       172.22.200.166\n\n$ORIGIN informatica.antonio.org.\n@       IN      NS    dns\ndns     IN      A     172.22.7.177\n\n```\n\nPues bien, deberemos cumplimentar de la siguiente forma el fichero, el cual tiene las siguientes definiciones:\nLa primera parte es el SOA, que es fdqn de la máquina maestra, acompañado del correo del administrador, el cual será con puntos.\n\nEn la segunda parte podemos ver los nameservers, el cual tendrá el @, esto mostrará las máquinas a disposición del fdqn que hemos elegido, en nuestro caso tendremos el de la máquina maestra, la del esclavo y la del correo.\n\nOrigin es la variable que va a tener antonio.org. para no tener que repetir continuamente el nombre del dominio en los registros.\n\nLos registros de tipo A tendrán una ip asociada, estos se encargan de darle nombre a la ip de dentro del dominio, como dns1 que tiene una 172.22.7.155 o la del esclavo, que tendrá la 172.22.7.171\n\nLos registros de tipo CNAME son nombres relacionados a otros nombres, como por ejemplo ftp, que va relacionado al nombre obelix y que tendrá la ip 172.22.200.103. entonces al realizar la consulta en el apartado ANSWER nos daría el nombre completo al que está asociado.\n\n![Descripción de la imagen](/images/obelix.png)\n\n\nAhora vamos con el fichero de zona de resolución inversa, el cual crearemos en /var/cache/bind/db.172.22.0.0\n\n```shell\n$TTL    86400\n@       IN      SOA     dns1.antonio.org. root.antonio.org. (\n                              1         ; Serial\n                         604800         ; Refresh\n                          86400         ; Retry\n                        2419200         ; Expire\n                          86400 )       ; Negative Cache TTL\n;\n@      IN      NS              dns1.antonio.org.\n@      IN      NS              dns2.antonio.org.\n\n$ORIGIN 22.172.in-addr.arpa.\n\n155.7                  IN      PTR             dns1.antonio.org.\n171.7                  IN      PTR             dns2.antonio.org.\n101.200                IN      PTR             correo.antonio.org.\n102.200                IN      PTR             asterix.antonio.org.\n200.103                IN      PTR             obelix.antonio.org.\n200.166                IN      PTR             entrebytes.antonio.org.\n\n```\n\nEl fichero es muy similar al de la resolución directa, pero en este caso especificaremos la IP de la manera opuesta, con PTR conseguiremos obtener el nombre gracias a una petición inversa a la ip que hemos configurado, también pondremos la del servidor esclavo.\n\n![Descripción de la imagen](/images/obelix-2.png)\n\nPor último, debemos editar el fichero /etc/bind/zones.rfc1918 que se encarga de proporcionar la plantilla empty para las resoluciones no configuradas, de manera que debamos comentar el rango de ips de `//zone \"22.172.in-addr.arpa\"  { type master; file \"/etc/bind/db.empty\"; };` ya que nosotros hemos configurado anteriormente.\n\nahora solo nos queda realizar un `systemctl restart bind9` y `systemctl status bind9` para comprobar de que el servicio está activo y sin errores.\n\n## Servidor esclavo\n\nPrimero comenzaremos actualizando el sistema e instalando el servidor dns bind9, la máquina deberá tener un nombre full qualificated como en mi caso que sería **dns2.antonio.org**\n\n`apt update && apt install bind9 -y`\n\nVamos a forzar la salida de las peutciones por ipv4, ya que al no estar configurado de esta forma pueden perderse paquetes al tratar de viajar a través de ipv6, esto lo haremos en /etc/default/named, especificando esta sentencia en  `OPTIONS=\"-4 -f -u bind\"`.\n\n/etc/bind/named.conf.local\n\n```shell\ninclude \"/etc/bind/zones.rfc1918\";\nzone \"antonio.org\" {\n    type slave;\n    file \"db.antonio.org\";\n    masters { 172.22.7.155; };\n};\nzone \"22.172.in-addr.arpa\" {\n    type slave;\n    file \"db.172.22.0.0\";\n    masters { 172.22.7.155; };\n};\n```\n\nHacemos un `systemctl restart bind9` y `systemctl status bind9` para comprobar de que el servicio está activo y sin errores.\n\nTras esto, cuando modifiquemos el servidor maestro subimos el serial de tal forma que sea mayor al de la máquina esclava, y de esta manera realizará la transferencia.\n\n![Descripción de la imagen](/images/obelix-3.png)\n\n## Delegación de subdominio\n\nPra delegar un subdominio primero comenzaremos actualizando el sistema e instalando el servidor dns bind9, la máquina deberá tener un nombre full qualificated como en mi caso que sería **dns.informatica.antonio.org**\n\n`apt update && apt install bind9 -y`\n\nVamos a forzar la salida de las peutciones por ipv4, ya que al no estar configurado de esta forma pueden perderse paquetes al tratar de viajar a través de ipv6, esto lo haremos en /etc/default/named, especificando esta sentencia en  `OPTIONS=\"-4 -f -u bind\"`.\n\nUna vez hecho esto, como podemos ver en la máquina maestra, tenemos un apartado en db.antonio.org en el cual especificamos los siguientes parámetros:\n\n```shell\n$ORIGIN informatica.antonio.org.\n@       IN      NS    dns\ndns     IN      A     172.22.7.177\n```\n\nCon esto estaremos delegando el subdominio para que lo gestione dns.informatica.antonio.org, si nos vamos a esta máquina, debemos configurar el dominio de la siguiente forma:\n\n/etc/bind/named.conf.local\n```\nzone \"informatica.antonio.org\" {\n    type master;\n    file \"db.informatica.antonio.org\";\n};\n```\n\nLuego nos vamos a /var/cache/bind/db.informatica.antonio.org\n\n```shell\n$TTL    86400\n@       IN      SOA     dns.informatica.antonio.org. root.informatica.antonio.org. (\n                              1         ; Serial\n                         604800         ; Refresh\n                          86400         ; Retry\n                        2419200         ; Expire\n                          86400 )       ; Negative Cache TTL\n;\n@       IN      NS              dns.informatica.antonio.org.\n@       IN      MX      10      mail.informatica.antonio.org.\n\n$ORIGIN informatica.antonio.org.\n\ndns                     IN      A               172.22.7.177\nmail                    IN      A               172.22.7.177\nweb                     IN      A               172.22.7.177\nwww                     IN      CNAME           web\nentrebytes              IN      CNAME           web\n\n```\n\n\n## Tips\n\nSi realizamos cambios a veces no se verán reflejados ya que el servicio DNS la almacena en caché, para borrarla necesitaremos ejecutar `rndc flush` en la máquina maestra.\n\nPara poder realizar las consultas sin especificar la ip a través de @, necesitaremos agregar un nameserver XXX.XXX.XXX.XXX en /etc/resolv.conf\n\nEn el caso de dns.informatica.antonio.org no es necesario descomentar el include \"/etc/bind/zones.rfc1918\"; ya que se ocupará de gestionarlo la máquina maestra.\n\nPara detectar con información más detallada los errores de plantillas db, necesitaremos ejecutar `named-checkzone antonio.org /var/cache/bind/db.antonio.org`\n\nSi queremos detectar los errores del fichero de zonas, necesitaremos ejecutar `named-checkconf`\n\n","source":"_posts/dns.md","raw":"---\ntitle: Configurar un servidor DNS.\ncategories: Servicios de Red e Internet\ntags: Servicios de Red e Internet\n---\n\n![Descripción de la imagen](/images/obelix-4.jpg)\n\n\n## Servidor maestro\n\nPrimero comenzaremos actualizando el sistema e instalando el servidor dns bind9, la máquina deberá tener un nombre full qualificated como en mi caso que sería **dns1.antonio.org**\n\n`apt update && apt install bind9 -y`\n\nVamos a forzar la salida de las peutciones por ipv4, ya que al no estar configurado de esta forma pueden perderse paquetes al tratar de viajar a través de ipv6, esto lo haremos en /etc/default/named, especificando esta sentencia en  `OPTIONS=\"-4 -f -u bind\"`.\n\nPrimero debemos permitir el tráfico desde las diferentes ip en el fichero /etc/bind/named.conf.options.\n\n```\nallow-query {172.29.0.0/16; 172.22.0.0/16;};\nallow-transfer { none ;};\n```\n\nAllow-query se encargará de permitir las consultas a través de los distintos rangos de ip, yo al estar conectado a una vpn debo poner también ese rango para así poder realizar las consultas desde casa.\n\nAllow-transfer none hará que no se realicen transpasos completos en la información de la zona, esto nos permitirá que no podamos exponer información sensible dentro del servidor dns al realizar las consultas con dig.\n\nTras esto, comenzaremos editando el fichero de configuración de zonas, el cual se encargará de administrar las plantillas a las que se les va a realizar una consulta dns con dig.\n\n/etc/bind/named.conf.local\n\n```shell\ninclude \"/etc/bind/zones.rfc1918\";\nzone \"antonio.org\" {\n    type master;\n    file \"db.antonio.org\";\n    allow-transfer { 172.22.7.171; };\n    notify yes;\n};\n\nzone \"22.172.in-addr.arpa\" {\n    type master;\n    file \"db.172.22.0.0\";\n    allow-transfer { 172.22.7.171; };\n    notify yes;\n};\n\n```\n\nNuestra zona será antonio.org, el cual tendrá el fichero db.antonio.org, hasta ahí será necesario para ralizar solo un dns, para realizar el dns respaldado por un esclavo necesitaremos conceder el traspaso a la ip 172.22.7.171 que será la ip de la máquina esclava, más abajo nos econtraremos con el fichero de zona de resolución inversa, el cual tendrá el nombre del rango de ip que abarcará, y la misma transferencia de zona y el notify que será lo que avise al esclavo que ha habido un cambio en el maestro.\n\nSi nos vamos al fichero /var/cache/bind/db.antonio.org podemos ver los siguientes componentes:\n\n```shell\n$TTL    86400\n@       IN      SOA     dns1.antonio.org. root.antonio.org. (\n                              6         ; Serial\n                         604800         ; Refresh\n                          86400         ; Retry\n                        2419200         ; Expire\n                          86400 )       ; Negative Cache TTL\n;\n\n@       IN      NS              dns1.antonio.org.\n@       IN      NS              dns2.antonio.org.\n@       IN      MX      10      correo.antonio.org.\n\n\n$ORIGIN antonio.org.\n\ndns1                    IN      A       172.22.7.155\ndns2                    IN      A       172.22.7.171\ncorreo                  IN      A       172.22.200.101\nasterix                 IN      A       172.22.200.102\nobelix                  IN      A       172.22.200.103\nprueba                  IN      A       172.22.200.120\nwww                     IN      CNAME   asterix\n;informatica             IN      CNAME   asterix\nftp                     IN      CNAME   obelix\nentrebytes              IN      A       172.22.200.166\n\n$ORIGIN informatica.antonio.org.\n@       IN      NS    dns\ndns     IN      A     172.22.7.177\n\n```\n\nPues bien, deberemos cumplimentar de la siguiente forma el fichero, el cual tiene las siguientes definiciones:\nLa primera parte es el SOA, que es fdqn de la máquina maestra, acompañado del correo del administrador, el cual será con puntos.\n\nEn la segunda parte podemos ver los nameservers, el cual tendrá el @, esto mostrará las máquinas a disposición del fdqn que hemos elegido, en nuestro caso tendremos el de la máquina maestra, la del esclavo y la del correo.\n\nOrigin es la variable que va a tener antonio.org. para no tener que repetir continuamente el nombre del dominio en los registros.\n\nLos registros de tipo A tendrán una ip asociada, estos se encargan de darle nombre a la ip de dentro del dominio, como dns1 que tiene una 172.22.7.155 o la del esclavo, que tendrá la 172.22.7.171\n\nLos registros de tipo CNAME son nombres relacionados a otros nombres, como por ejemplo ftp, que va relacionado al nombre obelix y que tendrá la ip 172.22.200.103. entonces al realizar la consulta en el apartado ANSWER nos daría el nombre completo al que está asociado.\n\n![Descripción de la imagen](/images/obelix.png)\n\n\nAhora vamos con el fichero de zona de resolución inversa, el cual crearemos en /var/cache/bind/db.172.22.0.0\n\n```shell\n$TTL    86400\n@       IN      SOA     dns1.antonio.org. root.antonio.org. (\n                              1         ; Serial\n                         604800         ; Refresh\n                          86400         ; Retry\n                        2419200         ; Expire\n                          86400 )       ; Negative Cache TTL\n;\n@      IN      NS              dns1.antonio.org.\n@      IN      NS              dns2.antonio.org.\n\n$ORIGIN 22.172.in-addr.arpa.\n\n155.7                  IN      PTR             dns1.antonio.org.\n171.7                  IN      PTR             dns2.antonio.org.\n101.200                IN      PTR             correo.antonio.org.\n102.200                IN      PTR             asterix.antonio.org.\n200.103                IN      PTR             obelix.antonio.org.\n200.166                IN      PTR             entrebytes.antonio.org.\n\n```\n\nEl fichero es muy similar al de la resolución directa, pero en este caso especificaremos la IP de la manera opuesta, con PTR conseguiremos obtener el nombre gracias a una petición inversa a la ip que hemos configurado, también pondremos la del servidor esclavo.\n\n![Descripción de la imagen](/images/obelix-2.png)\n\nPor último, debemos editar el fichero /etc/bind/zones.rfc1918 que se encarga de proporcionar la plantilla empty para las resoluciones no configuradas, de manera que debamos comentar el rango de ips de `//zone \"22.172.in-addr.arpa\"  { type master; file \"/etc/bind/db.empty\"; };` ya que nosotros hemos configurado anteriormente.\n\nahora solo nos queda realizar un `systemctl restart bind9` y `systemctl status bind9` para comprobar de que el servicio está activo y sin errores.\n\n## Servidor esclavo\n\nPrimero comenzaremos actualizando el sistema e instalando el servidor dns bind9, la máquina deberá tener un nombre full qualificated como en mi caso que sería **dns2.antonio.org**\n\n`apt update && apt install bind9 -y`\n\nVamos a forzar la salida de las peutciones por ipv4, ya que al no estar configurado de esta forma pueden perderse paquetes al tratar de viajar a través de ipv6, esto lo haremos en /etc/default/named, especificando esta sentencia en  `OPTIONS=\"-4 -f -u bind\"`.\n\n/etc/bind/named.conf.local\n\n```shell\ninclude \"/etc/bind/zones.rfc1918\";\nzone \"antonio.org\" {\n    type slave;\n    file \"db.antonio.org\";\n    masters { 172.22.7.155; };\n};\nzone \"22.172.in-addr.arpa\" {\n    type slave;\n    file \"db.172.22.0.0\";\n    masters { 172.22.7.155; };\n};\n```\n\nHacemos un `systemctl restart bind9` y `systemctl status bind9` para comprobar de que el servicio está activo y sin errores.\n\nTras esto, cuando modifiquemos el servidor maestro subimos el serial de tal forma que sea mayor al de la máquina esclava, y de esta manera realizará la transferencia.\n\n![Descripción de la imagen](/images/obelix-3.png)\n\n## Delegación de subdominio\n\nPra delegar un subdominio primero comenzaremos actualizando el sistema e instalando el servidor dns bind9, la máquina deberá tener un nombre full qualificated como en mi caso que sería **dns.informatica.antonio.org**\n\n`apt update && apt install bind9 -y`\n\nVamos a forzar la salida de las peutciones por ipv4, ya que al no estar configurado de esta forma pueden perderse paquetes al tratar de viajar a través de ipv6, esto lo haremos en /etc/default/named, especificando esta sentencia en  `OPTIONS=\"-4 -f -u bind\"`.\n\nUna vez hecho esto, como podemos ver en la máquina maestra, tenemos un apartado en db.antonio.org en el cual especificamos los siguientes parámetros:\n\n```shell\n$ORIGIN informatica.antonio.org.\n@       IN      NS    dns\ndns     IN      A     172.22.7.177\n```\n\nCon esto estaremos delegando el subdominio para que lo gestione dns.informatica.antonio.org, si nos vamos a esta máquina, debemos configurar el dominio de la siguiente forma:\n\n/etc/bind/named.conf.local\n```\nzone \"informatica.antonio.org\" {\n    type master;\n    file \"db.informatica.antonio.org\";\n};\n```\n\nLuego nos vamos a /var/cache/bind/db.informatica.antonio.org\n\n```shell\n$TTL    86400\n@       IN      SOA     dns.informatica.antonio.org. root.informatica.antonio.org. (\n                              1         ; Serial\n                         604800         ; Refresh\n                          86400         ; Retry\n                        2419200         ; Expire\n                          86400 )       ; Negative Cache TTL\n;\n@       IN      NS              dns.informatica.antonio.org.\n@       IN      MX      10      mail.informatica.antonio.org.\n\n$ORIGIN informatica.antonio.org.\n\ndns                     IN      A               172.22.7.177\nmail                    IN      A               172.22.7.177\nweb                     IN      A               172.22.7.177\nwww                     IN      CNAME           web\nentrebytes              IN      CNAME           web\n\n```\n\n\n## Tips\n\nSi realizamos cambios a veces no se verán reflejados ya que el servicio DNS la almacena en caché, para borrarla necesitaremos ejecutar `rndc flush` en la máquina maestra.\n\nPara poder realizar las consultas sin especificar la ip a través de @, necesitaremos agregar un nameserver XXX.XXX.XXX.XXX en /etc/resolv.conf\n\nEn el caso de dns.informatica.antonio.org no es necesario descomentar el include \"/etc/bind/zones.rfc1918\"; ya que se ocupará de gestionarlo la máquina maestra.\n\nPara detectar con información más detallada los errores de plantillas db, necesitaremos ejecutar `named-checkzone antonio.org /var/cache/bind/db.antonio.org`\n\nSi queremos detectar los errores del fichero de zonas, necesitaremos ejecutar `named-checkconf`\n\n","slug":"dns","published":1,"date":"2022-12-13T21:49:01.673Z","updated":"2023-01-10T00:38:12.677Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cldl8a0p8000f2fi5dnewbw0b","content":"<p><img src=\"/images/obelix-4.jpg\" alt=\"Descripción de la imagen\"></p>\n<h2 id=\"servidor-maestro\"><a class=\"markdownIt-Anchor\" href=\"#servidor-maestro\">#</a> Servidor maestro</h2>\n<p>Primero comenzaremos actualizando el sistema e instalando el servidor dns bind9, la máquina deberá tener un nombre full qualificated como en mi caso que sería <strong><a href=\"http://dns1.antonio.org\">dns1.antonio.org</a></strong></p>\n<p><code>apt update &amp;&amp; apt install bind9 -y</code></p>\n<p>Vamos a forzar la salida de las peutciones por ipv4, ya que al no estar configurado de esta forma pueden perderse paquetes al tratar de viajar a través de ipv6, esto lo haremos en /etc/default/named, especificando esta sentencia en   <code>OPTIONS=&quot;-4 -f -u bind&quot;</code> .</p>\n<p>Primero debemos permitir el tráfico desde las diferentes ip en el fichero /etc/bind/named.conf.options.</p>\n<pre><code>allow-query &#123;172.29.0.0/16; 172.22.0.0/16;&#125;;\nallow-transfer &#123; none ;&#125;;\n</code></pre>\n<p>Allow-query se encargará de permitir las consultas a través de los distintos rangos de ip, yo al estar conectado a una vpn debo poner también ese rango para así poder realizar las consultas desde casa.</p>\n<p>Allow-transfer none hará que no se realicen transpasos completos en la información de la zona, esto nos permitirá que no podamos exponer información sensible dentro del servidor dns al realizar las consultas con dig.</p>\n<p>Tras esto, comenzaremos editando el fichero de configuración de zonas, el cual se encargará de administrar las plantillas a las que se les va a realizar una consulta dns con dig.</p>\n<p>/etc/bind/named.conf.local</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>include <span class=\"token string\">\"/etc/bind/zones.rfc1918\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>zone <span class=\"token string\">\"antonio.org\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token builtin class-name\">type</span> master<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token function\">file</span> <span class=\"token string\">\"db.antonio.org\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    allow-transfer <span class=\"token punctuation\">&#123;</span> <span class=\"token number\">172.22</span>.7.171<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    notify <span class=\"token function\">yes</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>zone <span class=\"token string\">\"22.172.in-addr.arpa\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token builtin class-name\">type</span> master<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token function\">file</span> <span class=\"token string\">\"db.172.22.0.0\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    allow-transfer <span class=\"token punctuation\">&#123;</span> <span class=\"token number\">172.22</span>.7.171<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    notify <span class=\"token function\">yes</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>Nuestra zona será <a href=\"http://antonio.org\">antonio.org</a>, el cual tendrá el fichero <a href=\"http://db.antonio.org\">db.antonio.org</a>, hasta ahí será necesario para ralizar solo un dns, para realizar el dns respaldado por un esclavo necesitaremos conceder el traspaso a la ip 172.22.7.171 que será la ip de la máquina esclava, más abajo nos econtraremos con el fichero de zona de resolución inversa, el cual tendrá el nombre del rango de ip que abarcará, y la misma transferencia de zona y el notify que será lo que avise al esclavo que ha habido un cambio en el maestro.</p>\n<p>Si nos vamos al fichero /var/cache/bind/db.antonio.org podemos ver los siguientes componentes:</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token variable\">$TTL</span>    <span class=\"token number\">86400</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>@       IN      SOA     dns1.antonio.org. root.antonio.org. <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>                              <span class=\"token number\">6</span>         <span class=\"token punctuation\">;</span> Serial</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>                         <span class=\"token number\">604800</span>         <span class=\"token punctuation\">;</span> Refresh</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                          <span class=\"token number\">86400</span>         <span class=\"token punctuation\">;</span> Retry</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                        <span class=\"token number\">2419200</span>         <span class=\"token punctuation\">;</span> Expire</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                          <span class=\"token number\">86400</span> <span class=\"token punctuation\">)</span>       <span class=\"token punctuation\">;</span> Negative Cache TTL</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>@       IN      NS              dns1.antonio.org.</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>@       IN      NS              dns2.antonio.org.</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>@       IN      MX      <span class=\"token number\">10</span>      correo.antonio.org.</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token variable\">$ORIGIN</span> antonio.org.</pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>dns1                    IN      A       <span class=\"token number\">172.22</span>.7.155</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>dns2                    IN      A       <span class=\"token number\">172.22</span>.7.171</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>correo                  IN      A       <span class=\"token number\">172.22</span>.200.101</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>asterix                 IN      A       <span class=\"token number\">172.22</span>.200.102</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>obelix                  IN      A       <span class=\"token number\">172.22</span>.200.103</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>prueba                  IN      A       <span class=\"token number\">172.22</span>.200.120</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>www                     IN      CNAME   asterix</pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">;</span>informatica             IN      CNAME   asterix</pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token function\">ftp</span>                     IN      CNAME   obelix</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>entrebytes              IN      A       <span class=\"token number\">172.22</span>.200.166</pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token variable\">$ORIGIN</span> informatica.antonio.org.</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>@       IN      NS    dns</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>dns     IN      A     <span class=\"token number\">172.22</span>.7.177</pre></td></tr></table></figure><p>Pues bien, deberemos cumplimentar de la siguiente forma el fichero, el cual tiene las siguientes definiciones:<br>\nLa primera parte es el SOA, que es fdqn de la máquina maestra, acompañado del correo del administrador, el cual será con puntos.</p>\n<p>En la segunda parte podemos ver los nameservers, el cual tendrá el @, esto mostrará las máquinas a disposición del fdqn que hemos elegido, en nuestro caso tendremos el de la máquina maestra, la del esclavo y la del correo.</p>\n<p>Origin es la variable que va a tener <a href=\"http://antonio.org\">antonio.org</a>. para no tener que repetir continuamente el nombre del dominio en los registros.</p>\n<p>Los registros de tipo A tendrán una ip asociada, estos se encargan de darle nombre a la ip de dentro del dominio, como dns1 que tiene una 172.22.7.155 o la del esclavo, que tendrá la 172.22.7.171</p>\n<p>Los registros de tipo CNAME son nombres relacionados a otros nombres, como por ejemplo ftp, que va relacionado al nombre obelix y que tendrá la ip 172.22.200.103. entonces al realizar la consulta en el apartado ANSWER nos daría el nombre completo al que está asociado.</p>\n<p><img src=\"/images/obelix.png\" alt=\"Descripción de la imagen\"></p>\n<p>Ahora vamos con el fichero de zona de resolución inversa, el cual crearemos en /var/cache/bind/db.172.22.0.0</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token variable\">$TTL</span>    <span class=\"token number\">86400</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>@       IN      SOA     dns1.antonio.org. root.antonio.org. <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>                              <span class=\"token number\">1</span>         <span class=\"token punctuation\">;</span> Serial</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>                         <span class=\"token number\">604800</span>         <span class=\"token punctuation\">;</span> Refresh</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                          <span class=\"token number\">86400</span>         <span class=\"token punctuation\">;</span> Retry</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                        <span class=\"token number\">2419200</span>         <span class=\"token punctuation\">;</span> Expire</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                          <span class=\"token number\">86400</span> <span class=\"token punctuation\">)</span>       <span class=\"token punctuation\">;</span> Negative Cache TTL</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>@      IN      NS              dns1.antonio.org.</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>@      IN      NS              dns2.antonio.org.</pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token variable\">$ORIGIN</span> <span class=\"token number\">22.172</span>.in-addr.arpa.</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">155.7</span>                  IN      PTR             dns1.antonio.org.</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">171.7</span>                  IN      PTR             dns2.antonio.org.</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token number\">101.200</span>                IN      PTR             correo.antonio.org.</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token number\">102.200</span>                IN      PTR             asterix.antonio.org.</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token number\">200.103</span>                IN      PTR             obelix.antonio.org.</pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token number\">200.166</span>                IN      PTR             entrebytes.antonio.org.</pre></td></tr></table></figure><p>El fichero es muy similar al de la resolución directa, pero en este caso especificaremos la IP de la manera opuesta, con PTR conseguiremos obtener el nombre gracias a una petición inversa a la ip que hemos configurado, también pondremos la del servidor esclavo.</p>\n<p><img src=\"/images/obelix-2.png\" alt=\"Descripción de la imagen\"></p>\n<p>Por último, debemos editar el fichero /etc/bind/zones.rfc1918 que se encarga de proporcionar la plantilla empty para las resoluciones no configuradas, de manera que debamos comentar el rango de ips de  <code>//zone &quot;22.172.in-addr.arpa&quot;  &#123; type master; file &quot;/etc/bind/db.empty&quot;; &#125;;</code>  ya que nosotros hemos configurado anteriormente.</p>\n<p>ahora solo nos queda realizar un  <code>systemctl restart bind9</code>  y  <code>systemctl status bind9</code>  para comprobar de que el servicio está activo y sin errores.</p>\n<h2 id=\"servidor-esclavo\"><a class=\"markdownIt-Anchor\" href=\"#servidor-esclavo\">#</a> Servidor esclavo</h2>\n<p>Primero comenzaremos actualizando el sistema e instalando el servidor dns bind9, la máquina deberá tener un nombre full qualificated como en mi caso que sería <strong><a href=\"http://dns2.antonio.org\">dns2.antonio.org</a></strong></p>\n<p><code>apt update &amp;&amp; apt install bind9 -y</code></p>\n<p>Vamos a forzar la salida de las peutciones por ipv4, ya que al no estar configurado de esta forma pueden perderse paquetes al tratar de viajar a través de ipv6, esto lo haremos en /etc/default/named, especificando esta sentencia en   <code>OPTIONS=&quot;-4 -f -u bind&quot;</code> .</p>\n<p>/etc/bind/named.conf.local</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>include <span class=\"token string\">\"/etc/bind/zones.rfc1918\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>zone <span class=\"token string\">\"antonio.org\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token builtin class-name\">type</span> slave<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token function\">file</span> <span class=\"token string\">\"db.antonio.org\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    masters <span class=\"token punctuation\">&#123;</span> <span class=\"token number\">172.22</span>.7.155<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>zone <span class=\"token string\">\"22.172.in-addr.arpa\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token builtin class-name\">type</span> slave<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token function\">file</span> <span class=\"token string\">\"db.172.22.0.0\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    masters <span class=\"token punctuation\">&#123;</span> <span class=\"token number\">172.22</span>.7.155<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>Hacemos un  <code>systemctl restart bind9</code>  y  <code>systemctl status bind9</code>  para comprobar de que el servicio está activo y sin errores.</p>\n<p>Tras esto, cuando modifiquemos el servidor maestro subimos el serial de tal forma que sea mayor al de la máquina esclava, y de esta manera realizará la transferencia.</p>\n<p><img src=\"/images/obelix-3.png\" alt=\"Descripción de la imagen\"></p>\n<h2 id=\"delegación-de-subdominio\"><a class=\"markdownIt-Anchor\" href=\"#delegación-de-subdominio\">#</a> Delegación de subdominio</h2>\n<p>Pra delegar un subdominio primero comenzaremos actualizando el sistema e instalando el servidor dns bind9, la máquina deberá tener un nombre full qualificated como en mi caso que sería <strong><a href=\"http://dns.informatica.antonio.org\">dns.informatica.antonio.org</a></strong></p>\n<p><code>apt update &amp;&amp; apt install bind9 -y</code></p>\n<p>Vamos a forzar la salida de las peutciones por ipv4, ya que al no estar configurado de esta forma pueden perderse paquetes al tratar de viajar a través de ipv6, esto lo haremos en /etc/default/named, especificando esta sentencia en   <code>OPTIONS=&quot;-4 -f -u bind&quot;</code> .</p>\n<p>Una vez hecho esto, como podemos ver en la máquina maestra, tenemos un apartado en <a href=\"http://db.antonio.org\">db.antonio.org</a> en el cual especificamos los siguientes parámetros:</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token variable\">$ORIGIN</span> informatica.antonio.org.</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>@       IN      NS    dns</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>dns     IN      A     <span class=\"token number\">172.22</span>.7.177</pre></td></tr></table></figure><p>Con esto estaremos delegando el subdominio para que lo gestione <a href=\"http://dns.informatica.antonio.org\">dns.informatica.antonio.org</a>, si nos vamos a esta máquina, debemos configurar el dominio de la siguiente forma:</p>\n<p>/etc/bind/named.conf.local</p>\n<pre><code>zone &quot;informatica.antonio.org&quot; &#123;\n    type master;\n    file &quot;db.informatica.antonio.org&quot;;\n&#125;;\n</code></pre>\n<p>Luego nos vamos a /var/cache/bind/db.informatica.antonio.org</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token variable\">$TTL</span>    <span class=\"token number\">86400</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>@       IN      SOA     dns.informatica.antonio.org. root.informatica.antonio.org. <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>                              <span class=\"token number\">1</span>         <span class=\"token punctuation\">;</span> Serial</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>                         <span class=\"token number\">604800</span>         <span class=\"token punctuation\">;</span> Refresh</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                          <span class=\"token number\">86400</span>         <span class=\"token punctuation\">;</span> Retry</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                        <span class=\"token number\">2419200</span>         <span class=\"token punctuation\">;</span> Expire</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                          <span class=\"token number\">86400</span> <span class=\"token punctuation\">)</span>       <span class=\"token punctuation\">;</span> Negative Cache TTL</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>@       IN      NS              dns.informatica.antonio.org.</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>@       IN      MX      <span class=\"token number\">10</span>      mail.informatica.antonio.org.</pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token variable\">$ORIGIN</span> informatica.antonio.org.</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>dns                     IN      A               <span class=\"token number\">172.22</span>.7.177</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>mail                    IN      A               <span class=\"token number\">172.22</span>.7.177</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>web                     IN      A               <span class=\"token number\">172.22</span>.7.177</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>www                     IN      CNAME           web</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>entrebytes              IN      CNAME           web</pre></td></tr></table></figure><h2 id=\"tips\"><a class=\"markdownIt-Anchor\" href=\"#tips\">#</a> Tips</h2>\n<p>Si realizamos cambios a veces no se verán reflejados ya que el servicio DNS la almacena en caché, para borrarla necesitaremos ejecutar  <code>rndc flush</code>  en la máquina maestra.</p>\n<p>Para poder realizar las consultas sin especificar la ip a través de @, necesitaremos agregar un nameserver <a href=\"http://XXX.XXX.XXX.XXX\">XXX.XXX.XXX.XXX</a> en /etc/resolv.conf</p>\n<p>En el caso de <a href=\"http://dns.informatica.antonio.org\">dns.informatica.antonio.org</a> no es necesario descomentar el include “/etc/bind/zones.rfc1918”; ya que se ocupará de gestionarlo la máquina maestra.</p>\n<p>Para detectar con información más detallada los errores de plantillas db, necesitaremos ejecutar  <code>named-checkzone antonio.org /var/cache/bind/db.antonio.org</code></p>\n<p>Si queremos detectar los errores del fichero de zonas, necesitaremos ejecutar  <code>named-checkconf</code></p>\n","site":{"data":{}},"length":7240,"excerpt":"","more":"<p><img src=\"/images/obelix-4.jpg\" alt=\"Descripción de la imagen\"></p>\n<h2 id=\"servidor-maestro\"><a class=\"markdownIt-Anchor\" href=\"#servidor-maestro\">#</a> Servidor maestro</h2>\n<p>Primero comenzaremos actualizando el sistema e instalando el servidor dns bind9, la máquina deberá tener un nombre full qualificated como en mi caso que sería <strong><a href=\"http://dns1.antonio.org\">dns1.antonio.org</a></strong></p>\n<p><code>apt update &amp;&amp; apt install bind9 -y</code></p>\n<p>Vamos a forzar la salida de las peutciones por ipv4, ya que al no estar configurado de esta forma pueden perderse paquetes al tratar de viajar a través de ipv6, esto lo haremos en /etc/default/named, especificando esta sentencia en   <code>OPTIONS=&quot;-4 -f -u bind&quot;</code> .</p>\n<p>Primero debemos permitir el tráfico desde las diferentes ip en el fichero /etc/bind/named.conf.options.</p>\n<pre><code>allow-query &#123;172.29.0.0/16; 172.22.0.0/16;&#125;;\nallow-transfer &#123; none ;&#125;;\n</code></pre>\n<p>Allow-query se encargará de permitir las consultas a través de los distintos rangos de ip, yo al estar conectado a una vpn debo poner también ese rango para así poder realizar las consultas desde casa.</p>\n<p>Allow-transfer none hará que no se realicen transpasos completos en la información de la zona, esto nos permitirá que no podamos exponer información sensible dentro del servidor dns al realizar las consultas con dig.</p>\n<p>Tras esto, comenzaremos editando el fichero de configuración de zonas, el cual se encargará de administrar las plantillas a las que se les va a realizar una consulta dns con dig.</p>\n<p>/etc/bind/named.conf.local</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>include <span class=\"token string\">\"/etc/bind/zones.rfc1918\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>zone <span class=\"token string\">\"antonio.org\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token builtin class-name\">type</span> master<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token function\">file</span> <span class=\"token string\">\"db.antonio.org\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    allow-transfer <span class=\"token punctuation\">&#123;</span> <span class=\"token number\">172.22</span>.7.171<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    notify <span class=\"token function\">yes</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>zone <span class=\"token string\">\"22.172.in-addr.arpa\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token builtin class-name\">type</span> master<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token function\">file</span> <span class=\"token string\">\"db.172.22.0.0\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    allow-transfer <span class=\"token punctuation\">&#123;</span> <span class=\"token number\">172.22</span>.7.171<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    notify <span class=\"token function\">yes</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>Nuestra zona será <a href=\"http://antonio.org\">antonio.org</a>, el cual tendrá el fichero <a href=\"http://db.antonio.org\">db.antonio.org</a>, hasta ahí será necesario para ralizar solo un dns, para realizar el dns respaldado por un esclavo necesitaremos conceder el traspaso a la ip 172.22.7.171 que será la ip de la máquina esclava, más abajo nos econtraremos con el fichero de zona de resolución inversa, el cual tendrá el nombre del rango de ip que abarcará, y la misma transferencia de zona y el notify que será lo que avise al esclavo que ha habido un cambio en el maestro.</p>\n<p>Si nos vamos al fichero /var/cache/bind/db.antonio.org podemos ver los siguientes componentes:</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token variable\">$TTL</span>    <span class=\"token number\">86400</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>@       IN      SOA     dns1.antonio.org. root.antonio.org. <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>                              <span class=\"token number\">6</span>         <span class=\"token punctuation\">;</span> Serial</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>                         <span class=\"token number\">604800</span>         <span class=\"token punctuation\">;</span> Refresh</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                          <span class=\"token number\">86400</span>         <span class=\"token punctuation\">;</span> Retry</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                        <span class=\"token number\">2419200</span>         <span class=\"token punctuation\">;</span> Expire</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                          <span class=\"token number\">86400</span> <span class=\"token punctuation\">)</span>       <span class=\"token punctuation\">;</span> Negative Cache TTL</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>@       IN      NS              dns1.antonio.org.</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>@       IN      NS              dns2.antonio.org.</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>@       IN      MX      <span class=\"token number\">10</span>      correo.antonio.org.</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token variable\">$ORIGIN</span> antonio.org.</pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>dns1                    IN      A       <span class=\"token number\">172.22</span>.7.155</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>dns2                    IN      A       <span class=\"token number\">172.22</span>.7.171</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>correo                  IN      A       <span class=\"token number\">172.22</span>.200.101</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>asterix                 IN      A       <span class=\"token number\">172.22</span>.200.102</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>obelix                  IN      A       <span class=\"token number\">172.22</span>.200.103</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>prueba                  IN      A       <span class=\"token number\">172.22</span>.200.120</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>www                     IN      CNAME   asterix</pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">;</span>informatica             IN      CNAME   asterix</pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token function\">ftp</span>                     IN      CNAME   obelix</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>entrebytes              IN      A       <span class=\"token number\">172.22</span>.200.166</pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token variable\">$ORIGIN</span> informatica.antonio.org.</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>@       IN      NS    dns</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>dns     IN      A     <span class=\"token number\">172.22</span>.7.177</pre></td></tr></table></figure><p>Pues bien, deberemos cumplimentar de la siguiente forma el fichero, el cual tiene las siguientes definiciones:<br>\nLa primera parte es el SOA, que es fdqn de la máquina maestra, acompañado del correo del administrador, el cual será con puntos.</p>\n<p>En la segunda parte podemos ver los nameservers, el cual tendrá el @, esto mostrará las máquinas a disposición del fdqn que hemos elegido, en nuestro caso tendremos el de la máquina maestra, la del esclavo y la del correo.</p>\n<p>Origin es la variable que va a tener <a href=\"http://antonio.org\">antonio.org</a>. para no tener que repetir continuamente el nombre del dominio en los registros.</p>\n<p>Los registros de tipo A tendrán una ip asociada, estos se encargan de darle nombre a la ip de dentro del dominio, como dns1 que tiene una 172.22.7.155 o la del esclavo, que tendrá la 172.22.7.171</p>\n<p>Los registros de tipo CNAME son nombres relacionados a otros nombres, como por ejemplo ftp, que va relacionado al nombre obelix y que tendrá la ip 172.22.200.103. entonces al realizar la consulta en el apartado ANSWER nos daría el nombre completo al que está asociado.</p>\n<p><img src=\"/images/obelix.png\" alt=\"Descripción de la imagen\"></p>\n<p>Ahora vamos con el fichero de zona de resolución inversa, el cual crearemos en /var/cache/bind/db.172.22.0.0</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token variable\">$TTL</span>    <span class=\"token number\">86400</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>@       IN      SOA     dns1.antonio.org. root.antonio.org. <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>                              <span class=\"token number\">1</span>         <span class=\"token punctuation\">;</span> Serial</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>                         <span class=\"token number\">604800</span>         <span class=\"token punctuation\">;</span> Refresh</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                          <span class=\"token number\">86400</span>         <span class=\"token punctuation\">;</span> Retry</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                        <span class=\"token number\">2419200</span>         <span class=\"token punctuation\">;</span> Expire</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                          <span class=\"token number\">86400</span> <span class=\"token punctuation\">)</span>       <span class=\"token punctuation\">;</span> Negative Cache TTL</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>@      IN      NS              dns1.antonio.org.</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>@      IN      NS              dns2.antonio.org.</pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token variable\">$ORIGIN</span> <span class=\"token number\">22.172</span>.in-addr.arpa.</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">155.7</span>                  IN      PTR             dns1.antonio.org.</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">171.7</span>                  IN      PTR             dns2.antonio.org.</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token number\">101.200</span>                IN      PTR             correo.antonio.org.</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token number\">102.200</span>                IN      PTR             asterix.antonio.org.</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token number\">200.103</span>                IN      PTR             obelix.antonio.org.</pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token number\">200.166</span>                IN      PTR             entrebytes.antonio.org.</pre></td></tr></table></figure><p>El fichero es muy similar al de la resolución directa, pero en este caso especificaremos la IP de la manera opuesta, con PTR conseguiremos obtener el nombre gracias a una petición inversa a la ip que hemos configurado, también pondremos la del servidor esclavo.</p>\n<p><img src=\"/images/obelix-2.png\" alt=\"Descripción de la imagen\"></p>\n<p>Por último, debemos editar el fichero /etc/bind/zones.rfc1918 que se encarga de proporcionar la plantilla empty para las resoluciones no configuradas, de manera que debamos comentar el rango de ips de  <code>//zone &quot;22.172.in-addr.arpa&quot;  &#123; type master; file &quot;/etc/bind/db.empty&quot;; &#125;;</code>  ya que nosotros hemos configurado anteriormente.</p>\n<p>ahora solo nos queda realizar un  <code>systemctl restart bind9</code>  y  <code>systemctl status bind9</code>  para comprobar de que el servicio está activo y sin errores.</p>\n<h2 id=\"servidor-esclavo\"><a class=\"markdownIt-Anchor\" href=\"#servidor-esclavo\">#</a> Servidor esclavo</h2>\n<p>Primero comenzaremos actualizando el sistema e instalando el servidor dns bind9, la máquina deberá tener un nombre full qualificated como en mi caso que sería <strong><a href=\"http://dns2.antonio.org\">dns2.antonio.org</a></strong></p>\n<p><code>apt update &amp;&amp; apt install bind9 -y</code></p>\n<p>Vamos a forzar la salida de las peutciones por ipv4, ya que al no estar configurado de esta forma pueden perderse paquetes al tratar de viajar a través de ipv6, esto lo haremos en /etc/default/named, especificando esta sentencia en   <code>OPTIONS=&quot;-4 -f -u bind&quot;</code> .</p>\n<p>/etc/bind/named.conf.local</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>include <span class=\"token string\">\"/etc/bind/zones.rfc1918\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>zone <span class=\"token string\">\"antonio.org\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token builtin class-name\">type</span> slave<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token function\">file</span> <span class=\"token string\">\"db.antonio.org\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    masters <span class=\"token punctuation\">&#123;</span> <span class=\"token number\">172.22</span>.7.155<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>zone <span class=\"token string\">\"22.172.in-addr.arpa\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token builtin class-name\">type</span> slave<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token function\">file</span> <span class=\"token string\">\"db.172.22.0.0\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    masters <span class=\"token punctuation\">&#123;</span> <span class=\"token number\">172.22</span>.7.155<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>Hacemos un  <code>systemctl restart bind9</code>  y  <code>systemctl status bind9</code>  para comprobar de que el servicio está activo y sin errores.</p>\n<p>Tras esto, cuando modifiquemos el servidor maestro subimos el serial de tal forma que sea mayor al de la máquina esclava, y de esta manera realizará la transferencia.</p>\n<p><img src=\"/images/obelix-3.png\" alt=\"Descripción de la imagen\"></p>\n<h2 id=\"delegación-de-subdominio\"><a class=\"markdownIt-Anchor\" href=\"#delegación-de-subdominio\">#</a> Delegación de subdominio</h2>\n<p>Pra delegar un subdominio primero comenzaremos actualizando el sistema e instalando el servidor dns bind9, la máquina deberá tener un nombre full qualificated como en mi caso que sería <strong><a href=\"http://dns.informatica.antonio.org\">dns.informatica.antonio.org</a></strong></p>\n<p><code>apt update &amp;&amp; apt install bind9 -y</code></p>\n<p>Vamos a forzar la salida de las peutciones por ipv4, ya que al no estar configurado de esta forma pueden perderse paquetes al tratar de viajar a través de ipv6, esto lo haremos en /etc/default/named, especificando esta sentencia en   <code>OPTIONS=&quot;-4 -f -u bind&quot;</code> .</p>\n<p>Una vez hecho esto, como podemos ver en la máquina maestra, tenemos un apartado en <a href=\"http://db.antonio.org\">db.antonio.org</a> en el cual especificamos los siguientes parámetros:</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token variable\">$ORIGIN</span> informatica.antonio.org.</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>@       IN      NS    dns</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>dns     IN      A     <span class=\"token number\">172.22</span>.7.177</pre></td></tr></table></figure><p>Con esto estaremos delegando el subdominio para que lo gestione <a href=\"http://dns.informatica.antonio.org\">dns.informatica.antonio.org</a>, si nos vamos a esta máquina, debemos configurar el dominio de la siguiente forma:</p>\n<p>/etc/bind/named.conf.local</p>\n<pre><code>zone &quot;informatica.antonio.org&quot; &#123;\n    type master;\n    file &quot;db.informatica.antonio.org&quot;;\n&#125;;\n</code></pre>\n<p>Luego nos vamos a /var/cache/bind/db.informatica.antonio.org</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token variable\">$TTL</span>    <span class=\"token number\">86400</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>@       IN      SOA     dns.informatica.antonio.org. root.informatica.antonio.org. <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>                              <span class=\"token number\">1</span>         <span class=\"token punctuation\">;</span> Serial</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>                         <span class=\"token number\">604800</span>         <span class=\"token punctuation\">;</span> Refresh</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                          <span class=\"token number\">86400</span>         <span class=\"token punctuation\">;</span> Retry</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                        <span class=\"token number\">2419200</span>         <span class=\"token punctuation\">;</span> Expire</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                          <span class=\"token number\">86400</span> <span class=\"token punctuation\">)</span>       <span class=\"token punctuation\">;</span> Negative Cache TTL</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>@       IN      NS              dns.informatica.antonio.org.</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>@       IN      MX      <span class=\"token number\">10</span>      mail.informatica.antonio.org.</pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token variable\">$ORIGIN</span> informatica.antonio.org.</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>dns                     IN      A               <span class=\"token number\">172.22</span>.7.177</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>mail                    IN      A               <span class=\"token number\">172.22</span>.7.177</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>web                     IN      A               <span class=\"token number\">172.22</span>.7.177</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>www                     IN      CNAME           web</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>entrebytes              IN      CNAME           web</pre></td></tr></table></figure><h2 id=\"tips\"><a class=\"markdownIt-Anchor\" href=\"#tips\">#</a> Tips</h2>\n<p>Si realizamos cambios a veces no se verán reflejados ya que el servicio DNS la almacena en caché, para borrarla necesitaremos ejecutar  <code>rndc flush</code>  en la máquina maestra.</p>\n<p>Para poder realizar las consultas sin especificar la ip a través de @, necesitaremos agregar un nameserver <a href=\"http://XXX.XXX.XXX.XXX\">XXX.XXX.XXX.XXX</a> en /etc/resolv.conf</p>\n<p>En el caso de <a href=\"http://dns.informatica.antonio.org\">dns.informatica.antonio.org</a> no es necesario descomentar el include “/etc/bind/zones.rfc1918”; ya que se ocupará de gestionarlo la máquina maestra.</p>\n<p>Para detectar con información más detallada los errores de plantillas db, necesitaremos ejecutar  <code>named-checkzone antonio.org /var/cache/bind/db.antonio.org</code></p>\n<p>Si queremos detectar los errores del fichero de zonas, necesitaremos ejecutar  <code>named-checkconf</code></p>\n"},{"title":"Montaje de volumen nfs a partir de systemd","_content":"\n![status](/images/systemd-title.jpg)\n\n\nVamos a empezar en la máquina servidor, que en nuestro caso será alfa, actualizamos el sistema e instalamos los paquetes necesarios para la instalación nfs en la máquina servidora que en nuestro caso será alfa.\n\n```\napt install nfs-kernel-server nfs-common\n```\n\nTras esto vamos a ingresar el nuevo volumen, en el escenario podría ser tanto físico como virtualizado, pero antes de realizar la configuración de systemd necesitaremos darle formato al sistema de archivos, que en nuestro caso será ext4.\n\n`mkfs.ext4 /dev/vdb`\n\nUna vez hecho esto podemos crear el archivo en /etc/systemd/system/srv-compartida.mount, es necesario que pongamos la ruta en la que va a estar la carpeta compartida a partir de '-' en vez de '/' en el nombre del fichero a crear, .mount indica a systemd que es un archivo de montaje.\n\nAhora vamos a ver la sintaxis del archivo:\n\n\n```\n[Unit]\nDescription= volumen que va a ser montado para compartir nfs\n\n[Mount]\nWhat= /dev/vdb\nWhere= /srv/compartida/\nType=ext4\nOptions=defaults\n\n[Install]\nWantedBy=multi-user.target\n```\n\nEn [Unit] podemos poner la descripción de lo que va a realizar el servicio\nEn [Mount] es como una forma diferente de poner una línea del fstab, ya que se especifica el qué se va a montar, donde se va a montar, el tipo de archivo que va a ser y sus propias opciones de montaje.\nEn [Install] especificamos los usuarios a los que va a ser dirigido este servicio.\n\nUna vez hecho esto vamos a ejecutar `systemctl enable srv-compartida.mount` para activar el servicio permanentemente y `systemctl start srv-compartida.mount` para iniciarlo.\n\nTras esto si hacemos systemctl status srv-compartida podemos ver que está activo el servicio\n\n![status](/images/systemd-1.png)\n\nAhora vamos a configurar el servidor nfs, en el cual debemos escribir la siguiente línea en el archivo de /etc/exports, pero antes debe estar creada la carpeta compartida.\n\n`/srv/compartida 172.16.0.200(rw,sync,no_subtree_check,all_squash)`\n\nluego ejecutamos `exportfs -a` para que el servicio nfs lea el fichero de /etc/exports.\n\n\nAhora vamos a pasar a la máquina cliente:\n\ncrearemos la carpeta en /srv/nfs y escribiremos en el archivo de /etc/systemd/system/srv-nfs.mount lo siguiente:\n\n```\n[Unit]\nDescription= Montaje de carpeta compartida NFS  \n\n[Mount]\nWhat=172.16.0.1:/srv/compartida\nWhere=/srv/nfs\nType=nfs\nOptions=defaults\n\n[Install]\nWantedBy=multi-user.target\n```\n\nY tras esto:\n\n```\nsystemctl enable srv-nfs.mount\nsystemctl start srv-nfs.mount\n```\n\nAhora podemos comprobar que el servicio permanece activo:\n\n![status](/images/systemd-2.png)\n\n\nY vemos con un archivo de prueba que el servidor nfs funciona:\n\n\n![nfs](/images/systemd-3.png)","source":"_posts/nfs-systemd.md","raw":"---\ntitle: Montaje de volumen nfs a partir de systemd\ncategories: Sistemas Operativos\n---\n\n![status](/images/systemd-title.jpg)\n\n\nVamos a empezar en la máquina servidor, que en nuestro caso será alfa, actualizamos el sistema e instalamos los paquetes necesarios para la instalación nfs en la máquina servidora que en nuestro caso será alfa.\n\n```\napt install nfs-kernel-server nfs-common\n```\n\nTras esto vamos a ingresar el nuevo volumen, en el escenario podría ser tanto físico como virtualizado, pero antes de realizar la configuración de systemd necesitaremos darle formato al sistema de archivos, que en nuestro caso será ext4.\n\n`mkfs.ext4 /dev/vdb`\n\nUna vez hecho esto podemos crear el archivo en /etc/systemd/system/srv-compartida.mount, es necesario que pongamos la ruta en la que va a estar la carpeta compartida a partir de '-' en vez de '/' en el nombre del fichero a crear, .mount indica a systemd que es un archivo de montaje.\n\nAhora vamos a ver la sintaxis del archivo:\n\n\n```\n[Unit]\nDescription= volumen que va a ser montado para compartir nfs\n\n[Mount]\nWhat= /dev/vdb\nWhere= /srv/compartida/\nType=ext4\nOptions=defaults\n\n[Install]\nWantedBy=multi-user.target\n```\n\nEn [Unit] podemos poner la descripción de lo que va a realizar el servicio\nEn [Mount] es como una forma diferente de poner una línea del fstab, ya que se especifica el qué se va a montar, donde se va a montar, el tipo de archivo que va a ser y sus propias opciones de montaje.\nEn [Install] especificamos los usuarios a los que va a ser dirigido este servicio.\n\nUna vez hecho esto vamos a ejecutar `systemctl enable srv-compartida.mount` para activar el servicio permanentemente y `systemctl start srv-compartida.mount` para iniciarlo.\n\nTras esto si hacemos systemctl status srv-compartida podemos ver que está activo el servicio\n\n![status](/images/systemd-1.png)\n\nAhora vamos a configurar el servidor nfs, en el cual debemos escribir la siguiente línea en el archivo de /etc/exports, pero antes debe estar creada la carpeta compartida.\n\n`/srv/compartida 172.16.0.200(rw,sync,no_subtree_check,all_squash)`\n\nluego ejecutamos `exportfs -a` para que el servicio nfs lea el fichero de /etc/exports.\n\n\nAhora vamos a pasar a la máquina cliente:\n\ncrearemos la carpeta en /srv/nfs y escribiremos en el archivo de /etc/systemd/system/srv-nfs.mount lo siguiente:\n\n```\n[Unit]\nDescription= Montaje de carpeta compartida NFS  \n\n[Mount]\nWhat=172.16.0.1:/srv/compartida\nWhere=/srv/nfs\nType=nfs\nOptions=defaults\n\n[Install]\nWantedBy=multi-user.target\n```\n\nY tras esto:\n\n```\nsystemctl enable srv-nfs.mount\nsystemctl start srv-nfs.mount\n```\n\nAhora podemos comprobar que el servicio permanece activo:\n\n![status](/images/systemd-2.png)\n\n\nY vemos con un archivo de prueba que el servidor nfs funciona:\n\n\n![nfs](/images/systemd-3.png)","slug":"nfs-systemd","published":1,"date":"2023-01-03T13:43:02.309Z","updated":"2023-01-04T13:34:26.899Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cldl8a0p9000j2fi59hza4e4e","content":"<p><img src=\"/images/systemd-title.jpg\" alt=\"status\"></p>\n<p>Vamos a empezar en la máquina servidor, que en nuestro caso será alfa, actualizamos el sistema e instalamos los paquetes necesarios para la instalación nfs en la máquina servidora que en nuestro caso será alfa.</p>\n<pre><code>apt install nfs-kernel-server nfs-common\n</code></pre>\n<p>Tras esto vamos a ingresar el nuevo volumen, en el escenario podría ser tanto físico como virtualizado, pero antes de realizar la configuración de systemd necesitaremos darle formato al sistema de archivos, que en nuestro caso será ext4.</p>\n<p><code>mkfs.ext4 /dev/vdb</code></p>\n<p>Una vez hecho esto podemos crear el archivo en /etc/systemd/system/srv-compartida.mount, es necesario que pongamos la ruta en la que va a estar la carpeta compartida a partir de ‘-’ en vez de ‘/’ en el nombre del fichero a crear, .mount indica a systemd que es un archivo de montaje.</p>\n<p>Ahora vamos a ver la sintaxis del archivo:</p>\n<pre><code>[Unit]\nDescription= volumen que va a ser montado para compartir nfs\n\n[Mount]\nWhat= /dev/vdb\nWhere= /srv/compartida/\nType=ext4\nOptions=defaults\n\n[Install]\nWantedBy=multi-user.target\n</code></pre>\n<p>En [Unit] podemos poner la descripción de lo que va a realizar el servicio<br>\nEn [Mount] es como una forma diferente de poner una línea del fstab, ya que se especifica el qué se va a montar, donde se va a montar, el tipo de archivo que va a ser y sus propias opciones de montaje.<br>\nEn [Install] especificamos los usuarios a los que va a ser dirigido este servicio.</p>\n<p>Una vez hecho esto vamos a ejecutar  <code>systemctl enable srv-compartida.mount</code>  para activar el servicio permanentemente y  <code>systemctl start srv-compartida.mount</code>  para iniciarlo.</p>\n<p>Tras esto si hacemos systemctl status srv-compartida podemos ver que está activo el servicio</p>\n<p><img src=\"/images/systemd-1.png\" alt=\"status\"></p>\n<p>Ahora vamos a configurar el servidor nfs, en el cual debemos escribir la siguiente línea en el archivo de /etc/exports, pero antes debe estar creada la carpeta compartida.</p>\n<p><code>/srv/compartida 172.16.0.200(rw,sync,no_subtree_check,all_squash)</code></p>\n<p>luego ejecutamos  <code>exportfs -a</code>  para que el servicio nfs lea el fichero de /etc/exports.</p>\n<p>Ahora vamos a pasar a la máquina cliente:</p>\n<p>crearemos la carpeta en /srv/nfs y escribiremos en el archivo de /etc/systemd/system/srv-nfs.mount lo siguiente:</p>\n<pre><code>[Unit]\nDescription= Montaje de carpeta compartida NFS  \n\n[Mount]\nWhat=172.16.0.1:/srv/compartida\nWhere=/srv/nfs\nType=nfs\nOptions=defaults\n\n[Install]\nWantedBy=multi-user.target\n</code></pre>\n<p>Y tras esto:</p>\n<pre><code>systemctl enable srv-nfs.mount\nsystemctl start srv-nfs.mount\n</code></pre>\n<p>Ahora podemos comprobar que el servicio permanece activo:</p>\n<p><img src=\"/images/systemd-2.png\" alt=\"status\"></p>\n<p>Y vemos con un archivo de prueba que el servidor nfs funciona:</p>\n<p><img src=\"/images/systemd-3.png\" alt=\"nfs\"></p>\n","site":{"data":{}},"length":2113,"excerpt":"","more":"<p><img src=\"/images/systemd-title.jpg\" alt=\"status\"></p>\n<p>Vamos a empezar en la máquina servidor, que en nuestro caso será alfa, actualizamos el sistema e instalamos los paquetes necesarios para la instalación nfs en la máquina servidora que en nuestro caso será alfa.</p>\n<pre><code>apt install nfs-kernel-server nfs-common\n</code></pre>\n<p>Tras esto vamos a ingresar el nuevo volumen, en el escenario podría ser tanto físico como virtualizado, pero antes de realizar la configuración de systemd necesitaremos darle formato al sistema de archivos, que en nuestro caso será ext4.</p>\n<p><code>mkfs.ext4 /dev/vdb</code></p>\n<p>Una vez hecho esto podemos crear el archivo en /etc/systemd/system/srv-compartida.mount, es necesario que pongamos la ruta en la que va a estar la carpeta compartida a partir de ‘-’ en vez de ‘/’ en el nombre del fichero a crear, .mount indica a systemd que es un archivo de montaje.</p>\n<p>Ahora vamos a ver la sintaxis del archivo:</p>\n<pre><code>[Unit]\nDescription= volumen que va a ser montado para compartir nfs\n\n[Mount]\nWhat= /dev/vdb\nWhere= /srv/compartida/\nType=ext4\nOptions=defaults\n\n[Install]\nWantedBy=multi-user.target\n</code></pre>\n<p>En [Unit] podemos poner la descripción de lo que va a realizar el servicio<br>\nEn [Mount] es como una forma diferente de poner una línea del fstab, ya que se especifica el qué se va a montar, donde se va a montar, el tipo de archivo que va a ser y sus propias opciones de montaje.<br>\nEn [Install] especificamos los usuarios a los que va a ser dirigido este servicio.</p>\n<p>Una vez hecho esto vamos a ejecutar  <code>systemctl enable srv-compartida.mount</code>  para activar el servicio permanentemente y  <code>systemctl start srv-compartida.mount</code>  para iniciarlo.</p>\n<p>Tras esto si hacemos systemctl status srv-compartida podemos ver que está activo el servicio</p>\n<p><img src=\"/images/systemd-1.png\" alt=\"status\"></p>\n<p>Ahora vamos a configurar el servidor nfs, en el cual debemos escribir la siguiente línea en el archivo de /etc/exports, pero antes debe estar creada la carpeta compartida.</p>\n<p><code>/srv/compartida 172.16.0.200(rw,sync,no_subtree_check,all_squash)</code></p>\n<p>luego ejecutamos  <code>exportfs -a</code>  para que el servicio nfs lea el fichero de /etc/exports.</p>\n<p>Ahora vamos a pasar a la máquina cliente:</p>\n<p>crearemos la carpeta en /srv/nfs y escribiremos en el archivo de /etc/systemd/system/srv-nfs.mount lo siguiente:</p>\n<pre><code>[Unit]\nDescription= Montaje de carpeta compartida NFS  \n\n[Mount]\nWhat=172.16.0.1:/srv/compartida\nWhere=/srv/nfs\nType=nfs\nOptions=defaults\n\n[Install]\nWantedBy=multi-user.target\n</code></pre>\n<p>Y tras esto:</p>\n<pre><code>systemctl enable srv-nfs.mount\nsystemctl start srv-nfs.mount\n</code></pre>\n<p>Ahora podemos comprobar que el servicio permanece activo:</p>\n<p><img src=\"/images/systemd-2.png\" alt=\"status\"></p>\n<p>Y vemos con un archivo de prueba que el servidor nfs funciona:</p>\n<p><img src=\"/images/systemd-3.png\" alt=\"nfs\"></p>\n"},{"title":"Instalación automatizada basada en medio de almacenamiento extraíble.","_content":"\nHe comenzado descargando el archivo iso para poder abrirlo y colocar el preseed en él, el comando que he utilizado es xorriso.\nTras esto he utilizado una plantilla de la web de debian\n\nhttps://www.debian.org/releases/buster/example-preseed.txt\n\nTras esto he estado configurando preseed.cfg para poner la hora, el país y el teclado en español y resulta que estuve un tiempo estancado en esto porque hay que corroborar los cambios en el archivo isofiles/isolinux/txt.cfg\nA su vez también debemos indicar la ruta donde vama a estar el preseed para que el sistema lo localice, en mi caso estará en la raíz de la ISO (CDROM)\n```\nlabel install\n        menu label ^Install\n        kernel /install.amd/vmlinuz\n        append vga=788 initrd=/install.amd/initrd.gz --- quiet\nlabel unattended-gnome\n menu label ^Instalación Debian Desatendida Preseed Antonio\n kernel /install.amd/gtk/vmlinuz\n append vga=788 initrd=/install.amd/gtk/initrd.gz preseed/file=/cdrom/preseed.cfg locale=es_ES console-setup/ask_detect=false keyboard-configuration/xkb-keymap=es\n```\nAl tener que desensamblar y ensamblar constantemente el iso para poner el preseed actualizado llegó un momento en el que se hacía inviable seguir probando sin hacer un script con los pasos que se repetían, entonces lo realicé:\n\n```\n#!/usr/bin/env bash\nfichero=/home/antonio/Descargas/preseed-instalacion/preseed-debian-10.1.0-amd64-script-netinst.iso\nchmod u+w isofiles\ncp preseed.cfg ~/Descargas/preseed-instalacion/isofiles\nchmod u-w isofiles\ncd ~/Descargas/preseed-instalacion\nchmod a+w isofiles/isolinux/isolinux.bin\nif [ -f $fichero ]\nthen\n        rm -f $fichero\nfi      \ngenisoimage -r -J -b isolinux/isolinux.bin -c isolinux/boot.cat -no-emul-boot -boot-load-size 4 -boot-info-table -o preseed-debian-10>\n```\nTuve que meter la condición de que si el iso creado existía lo borrara porque al ejecutar genisoimage si el nombre ya existe provoca conflictos.\n\nEntonces estuve probando, metiendo el usuario de la máquina con la contraseña sin encriptar, para ver el funcionamiento y que lo anterior configurado fuese por buen camino.\n\nEstuve probando formas de encriptar la contraseña, la plantilla me recomendaba que usara  **Crypt 3** pero es un método muy vulnerable, así que mirando la documentación vi que podía meter un hash **md5**.\n\nEntonces empecé a encriptar la contraseña, para ello utilicé `mkpasswd -m sha-512` el cual al ingresar la contraseña me la devuelve encriptada, activo la opción de `d-i passwd/user-password-crypted password` junto con la contraseña encriptada\n\nYa entonces, con la localización y el teclado en español, la cuenta del usuario con su contraseña encriptada decido comenzar a realizar las particiones de lvm.\nTuve muchísimos errores de sintaxis pero gracias al script podía probar de manera más rápida las diferentes combinaciones de particionado y ajustando la sintaxis conseguí realizarlo:\n\n![Descripción de la imagen](/images/ASO-PRACTICA1.png)\n","source":"_posts/preseed.md","raw":"---\ntitle: Instalación automatizada basada en medio de almacenamiento extraíble.\ncategories: Sistemas Operativos\n---\n\nHe comenzado descargando el archivo iso para poder abrirlo y colocar el preseed en él, el comando que he utilizado es xorriso.\nTras esto he utilizado una plantilla de la web de debian\n\nhttps://www.debian.org/releases/buster/example-preseed.txt\n\nTras esto he estado configurando preseed.cfg para poner la hora, el país y el teclado en español y resulta que estuve un tiempo estancado en esto porque hay que corroborar los cambios en el archivo isofiles/isolinux/txt.cfg\nA su vez también debemos indicar la ruta donde vama a estar el preseed para que el sistema lo localice, en mi caso estará en la raíz de la ISO (CDROM)\n```\nlabel install\n        menu label ^Install\n        kernel /install.amd/vmlinuz\n        append vga=788 initrd=/install.amd/initrd.gz --- quiet\nlabel unattended-gnome\n menu label ^Instalación Debian Desatendida Preseed Antonio\n kernel /install.amd/gtk/vmlinuz\n append vga=788 initrd=/install.amd/gtk/initrd.gz preseed/file=/cdrom/preseed.cfg locale=es_ES console-setup/ask_detect=false keyboard-configuration/xkb-keymap=es\n```\nAl tener que desensamblar y ensamblar constantemente el iso para poner el preseed actualizado llegó un momento en el que se hacía inviable seguir probando sin hacer un script con los pasos que se repetían, entonces lo realicé:\n\n```\n#!/usr/bin/env bash\nfichero=/home/antonio/Descargas/preseed-instalacion/preseed-debian-10.1.0-amd64-script-netinst.iso\nchmod u+w isofiles\ncp preseed.cfg ~/Descargas/preseed-instalacion/isofiles\nchmod u-w isofiles\ncd ~/Descargas/preseed-instalacion\nchmod a+w isofiles/isolinux/isolinux.bin\nif [ -f $fichero ]\nthen\n        rm -f $fichero\nfi      \ngenisoimage -r -J -b isolinux/isolinux.bin -c isolinux/boot.cat -no-emul-boot -boot-load-size 4 -boot-info-table -o preseed-debian-10>\n```\nTuve que meter la condición de que si el iso creado existía lo borrara porque al ejecutar genisoimage si el nombre ya existe provoca conflictos.\n\nEntonces estuve probando, metiendo el usuario de la máquina con la contraseña sin encriptar, para ver el funcionamiento y que lo anterior configurado fuese por buen camino.\n\nEstuve probando formas de encriptar la contraseña, la plantilla me recomendaba que usara  **Crypt 3** pero es un método muy vulnerable, así que mirando la documentación vi que podía meter un hash **md5**.\n\nEntonces empecé a encriptar la contraseña, para ello utilicé `mkpasswd -m sha-512` el cual al ingresar la contraseña me la devuelve encriptada, activo la opción de `d-i passwd/user-password-crypted password` junto con la contraseña encriptada\n\nYa entonces, con la localización y el teclado en español, la cuenta del usuario con su contraseña encriptada decido comenzar a realizar las particiones de lvm.\nTuve muchísimos errores de sintaxis pero gracias al script podía probar de manera más rápida las diferentes combinaciones de particionado y ajustando la sintaxis conseguí realizarlo:\n\n![Descripción de la imagen](/images/ASO-PRACTICA1.png)\n","slug":"preseed","published":1,"date":"2022-09-30T07:12:30.816Z","updated":"2023-01-04T13:35:06.211Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cldl8a0p9000l2fi581r8aiod","content":"<p>He comenzado descargando el archivo iso para poder abrirlo y colocar el preseed en él, el comando que he utilizado es xorriso.<br>\nTras esto he utilizado una plantilla de la web de debian</p>\n<p><a href=\"https://www.debian.org/releases/buster/example-preseed.txt\">https://www.debian.org/releases/buster/example-preseed.txt</a></p>\n<p>Tras esto he estado configurando preseed.cfg para poner la hora, el país y el teclado en español y resulta que estuve un tiempo estancado en esto porque hay que corroborar los cambios en el archivo isofiles/isolinux/txt.cfg<br>\nA su vez también debemos indicar la ruta donde vama a estar el preseed para que el sistema lo localice, en mi caso estará en la raíz de la ISO (CDROM)</p>\n<pre><code>label install\n        menu label ^Install\n        kernel /install.amd/vmlinuz\n        append vga=788 initrd=/install.amd/initrd.gz --- quiet\nlabel unattended-gnome\n menu label ^Instalación Debian Desatendida Preseed Antonio\n kernel /install.amd/gtk/vmlinuz\n append vga=788 initrd=/install.amd/gtk/initrd.gz preseed/file=/cdrom/preseed.cfg locale=es_ES console-setup/ask_detect=false keyboard-configuration/xkb-keymap=es\n</code></pre>\n<p>Al tener que desensamblar y ensamblar constantemente el iso para poner el preseed actualizado llegó un momento en el que se hacía inviable seguir probando sin hacer un script con los pasos que se repetían, entonces lo realicé:</p>\n<pre><code>#!/usr/bin/env bash\nfichero=/home/antonio/Descargas/preseed-instalacion/preseed-debian-10.1.0-amd64-script-netinst.iso\nchmod u+w isofiles\ncp preseed.cfg ~/Descargas/preseed-instalacion/isofiles\nchmod u-w isofiles\ncd ~/Descargas/preseed-instalacion\nchmod a+w isofiles/isolinux/isolinux.bin\nif [ -f $fichero ]\nthen\n        rm -f $fichero\nfi      \ngenisoimage -r -J -b isolinux/isolinux.bin -c isolinux/boot.cat -no-emul-boot -boot-load-size 4 -boot-info-table -o preseed-debian-10&gt;\n</code></pre>\n<p>Tuve que meter la condición de que si el iso creado existía lo borrara porque al ejecutar genisoimage si el nombre ya existe provoca conflictos.</p>\n<p>Entonces estuve probando, metiendo el usuario de la máquina con la contraseña sin encriptar, para ver el funcionamiento y que lo anterior configurado fuese por buen camino.</p>\n<p>Estuve probando formas de encriptar la contraseña, la plantilla me recomendaba que usara  <strong>Crypt 3</strong> pero es un método muy vulnerable, así que mirando la documentación vi que podía meter un hash <strong>md5</strong>.</p>\n<p>Entonces empecé a encriptar la contraseña, para ello utilicé  <code>mkpasswd -m sha-512</code>  el cual al ingresar la contraseña me la devuelve encriptada, activo la opción de  <code>d-i passwd/user-password-crypted password</code>  junto con la contraseña encriptada</p>\n<p>Ya entonces, con la localización y el teclado en español, la cuenta del usuario con su contraseña encriptada decido comenzar a realizar las particiones de lvm.<br>\nTuve muchísimos errores de sintaxis pero gracias al script podía probar de manera más rápida las diferentes combinaciones de particionado y ajustando la sintaxis conseguí realizarlo:</p>\n<p><img src=\"/images/ASO-PRACTICA1.png\" alt=\"Descripción de la imagen\"></p>\n","site":{"data":{}},"length":2423,"excerpt":"","more":"<p>He comenzado descargando el archivo iso para poder abrirlo y colocar el preseed en él, el comando que he utilizado es xorriso.<br>\nTras esto he utilizado una plantilla de la web de debian</p>\n<p><a href=\"https://www.debian.org/releases/buster/example-preseed.txt\">https://www.debian.org/releases/buster/example-preseed.txt</a></p>\n<p>Tras esto he estado configurando preseed.cfg para poner la hora, el país y el teclado en español y resulta que estuve un tiempo estancado en esto porque hay que corroborar los cambios en el archivo isofiles/isolinux/txt.cfg<br>\nA su vez también debemos indicar la ruta donde vama a estar el preseed para que el sistema lo localice, en mi caso estará en la raíz de la ISO (CDROM)</p>\n<pre><code>label install\n        menu label ^Install\n        kernel /install.amd/vmlinuz\n        append vga=788 initrd=/install.amd/initrd.gz --- quiet\nlabel unattended-gnome\n menu label ^Instalación Debian Desatendida Preseed Antonio\n kernel /install.amd/gtk/vmlinuz\n append vga=788 initrd=/install.amd/gtk/initrd.gz preseed/file=/cdrom/preseed.cfg locale=es_ES console-setup/ask_detect=false keyboard-configuration/xkb-keymap=es\n</code></pre>\n<p>Al tener que desensamblar y ensamblar constantemente el iso para poner el preseed actualizado llegó un momento en el que se hacía inviable seguir probando sin hacer un script con los pasos que se repetían, entonces lo realicé:</p>\n<pre><code>#!/usr/bin/env bash\nfichero=/home/antonio/Descargas/preseed-instalacion/preseed-debian-10.1.0-amd64-script-netinst.iso\nchmod u+w isofiles\ncp preseed.cfg ~/Descargas/preseed-instalacion/isofiles\nchmod u-w isofiles\ncd ~/Descargas/preseed-instalacion\nchmod a+w isofiles/isolinux/isolinux.bin\nif [ -f $fichero ]\nthen\n        rm -f $fichero\nfi      \ngenisoimage -r -J -b isolinux/isolinux.bin -c isolinux/boot.cat -no-emul-boot -boot-load-size 4 -boot-info-table -o preseed-debian-10&gt;\n</code></pre>\n<p>Tuve que meter la condición de que si el iso creado existía lo borrara porque al ejecutar genisoimage si el nombre ya existe provoca conflictos.</p>\n<p>Entonces estuve probando, metiendo el usuario de la máquina con la contraseña sin encriptar, para ver el funcionamiento y que lo anterior configurado fuese por buen camino.</p>\n<p>Estuve probando formas de encriptar la contraseña, la plantilla me recomendaba que usara  <strong>Crypt 3</strong> pero es un método muy vulnerable, así que mirando la documentación vi que podía meter un hash <strong>md5</strong>.</p>\n<p>Entonces empecé a encriptar la contraseña, para ello utilicé  <code>mkpasswd -m sha-512</code>  el cual al ingresar la contraseña me la devuelve encriptada, activo la opción de  <code>d-i passwd/user-password-crypted password</code>  junto con la contraseña encriptada</p>\n<p>Ya entonces, con la localización y el teclado en español, la cuenta del usuario con su contraseña encriptada decido comenzar a realizar las particiones de lvm.<br>\nTuve muchísimos errores de sintaxis pero gracias al script podía probar de manera más rápida las diferentes combinaciones de particionado y ajustando la sintaxis conseguí realizarlo:</p>\n<p><img src=\"/images/ASO-PRACTICA1.png\" alt=\"Descripción de la imagen\"></p>\n"},{"title":"Procedimientos en Oracle y Postgres","_content":"\n![remoto](/images/oraclepostgres.jpg)\n\n## ORACLE\n\nComenzaremos adjuntando el script de creación de tablas e inserciones de Oracle:\n\n```sql\nCREATE TABLE DEPT\n(\n DEPTNO NUMBER(2),\n DNAME VARCHAR2(14),\n LOC VARCHAR2(13),\n CONSTRAINT PK_DEPT PRIMARY KEY (DEPTNO)\n);\nCREATE TABLE EMP\n(\n EMPNO NUMBER(4),\n ENAME VARCHAR2(10),\n JOB VARCHAR2(9),\n MGR NUMBER(4),\n HIREDATE DATE,\n SAL NUMBER(7, 2),\n COMM NUMBER(7, 2),\n DEPTNO NUMBER(2),\n CONSTRAINT FK_DEPTNO FOREIGN KEY (DEPTNO) REFERENCES DEPT (DEPTNO),\n CONSTRAINT PK_EMP PRIMARY KEY (EMPNO)\n);\nINSERT INTO DEPT VALUES (10, 'ACCOUNTING', 'NEW YORK');\nINSERT INTO DEPT VALUES (20, 'RESEARCH', 'DALLAS');\nINSERT INTO DEPT VALUES (30, 'SALES', 'CHICAGO');\nINSERT INTO DEPT VALUES (40, 'OPERATIONS', 'BOSTON');\nINSERT INTO EMP VALUES(7369, 'SMITH', 'CLERK', 7902,TO_DATE('17-DIC-1980', 'DD-MON-YYYY'), 800, NULL, 20);\nINSERT INTO EMP VALUES(7499, 'ALLEN', 'SALESMAN', 7698,TO_DATE('20-FEB-1981', 'DD-MON-YYYY'), 1600, 300, 30);\nINSERT INTO EMP VALUES(7521, 'WARD', 'SALESMAN', 7698,TO_DATE('22-FEB-1981', 'DD-MON-YYYY'), 1250, 500, 30);\nINSERT INTO EMP VALUES(7566, 'JONES', 'MANAGER', 7839,TO_DATE('2-ABR-1981', 'DD-MON-YYYY'), 2975, NULL, 20);\nINSERT INTO EMP VALUES(7654, 'MARTIN', 'SALESMAN', 7698,TO_DATE('28-SEP-1981', 'DD-MON-YYYY'), 1250, 1400, 30);\nINSERT INTO EMP VALUES(7698, 'BLAKE', 'MANAGER', 7839,TO_DATE('1-MAY-1981', 'DD-MON-YYYY'), 2850, NULL, 30);\nINSERT INTO EMP VALUES(7782, 'CLARK', 'MANAGER', 7839,TO_DATE('9-JUN-1981', 'DD-MON-YYYY'), 2450, NULL, 10);\nINSERT INTO EMP VALUES(7788, 'SCOTT', 'ANALYST', 7566,TO_DATE('09-DIC-1982', 'DD-MON-YYYY'), 3000, NULL, 20);\nINSERT INTO EMP VALUES(7839, 'KING', 'PRESIDENT', NULL,TO_DATE('17-NOV-1981', 'DD-MON-YYYY'), 5000, NULL, 10);\nINSERT INTO EMP VALUES(7844, 'TURNER', 'SALESMAN', 7698,TO_DATE('8-SEP-1981', 'DD-MON-YYYY'), 1500, 0, 30);\nINSERT INTO EMP VALUES(7876, 'ADAMS', 'CLERK', 7788,TO_DATE('12-ENE-1983', 'DD-MON-YYYY'), 1100, NULL, 20);\nINSERT INTO EMP VALUES(7900, 'JAMES', 'CLERK', 7698,TO_DATE('3-DIC-1981', 'DD-MON-YYYY'), 950, NULL, 30);\nINSERT INTO EMP VALUES(7902, 'FORD', 'ANALYST', 7566,TO_DATE('3-DIC-1981', 'DD-MON-YYYY'), 3000, NULL, 20);\nINSERT INTO EMP VALUES(7934, 'MILLER', 'CLERK', 7782,TO_DATE('23-ENE-1982', 'DD-MON-YYYY'), 1300, NULL, 10);\n\nCOMMIT;\n```\n\n\n\n### 1. Hacer un procedimiento que muestre el nombre y el salario del empleado cuyo código es 7082\n```sql\ncreate or replace procedure mostrar_7082\nIS\n    v_nombre emp.ename%type;\n    v_sal emp.sal%type;\nBEGIN\n    select ename,sal into v_nombre,v_sal \n    from emp\n    where empno= 7782;\n    dbms_output.put_line('El nombre del empleado 7082 es ' || v_nombre || ' y su salario es ' || v_sal );\nEND;\n/\n```\n\n![remoto](/images/oracle-ejercicio1.png)\n\n### 2. Hacer un procedimiento que reciba como parámetro un código de empleado y devuelva su nombre\n```sql\nCreate or replace procedure codigoanombreemp (p_codempleado emp.empno%type)\nIS\n    v_nombre emp.ename%type;\nBEGIN\n    select ename into v_nombre from emp where empno=p_codempleado;\n    dbms_output.put_line ('El empleado con el código ' || p_codempleado || ' es ' || v_nombre);\nEND;\n/\n```\n\n![remoto](/images/oracle-ejercicio2.png)\n\n### 3. Hacer un procedimiento que devuelva los nombres de los tres empleados más antiguos\n```sql\ncreate or replace procedure tresempleadosmasantiguos\nIS\ncursor c_empleados is\nselect ename from emp WHERE ROWNUM <= 3 order by hiredate asc;\nBEGIN\nFOR v_empleados in c_empleados loop\n    dbms_output.put_line (v_empleados.ename);\nend loop;\nEND;\n/\n```\n\n![remoto](/images/oracle-ejercicio5.png)\n\n### 4. Hacer un procedimiento que reciba el nombre de un tablespace y muestre los nombres de los usuarios que lo tienen como tablespace por defecto (Vista DBA_USERS)\n```sql\ncreate or replace procedure tablespacedefecto (p_tablespace DBA_USERS.DEFAULT_TABLESPACE%type)\nIS\ncursor c_tablespace is\nSELECT USERNAME from DBA_USERS where DEFAULT_TABLESPACE=p_tablespace;\nBEGIN\nFOR v_usuarios in c_tablespace loop\n    dbms_output.put_line (v_usuarios.USERNAME);\nend loop;\nEND;\n/\n```\n\n![remoto](/images/oracle-ejercicio3.png)\n\n### 5. Modificar el procedimiento anterior para que haga lo mismo pero devolviendo el número de usuarios que tienen ese tablespace como tablespace por defecto. Nota: Hay que convertir el procedimiento en función\n```sql\ncreate or replace function tablespacedefecto (p_tablespace DBA_USERS.DEFAULT_TABLESPACE%type)\nreturn number\nIS\nv_num number (4);\nBEGIN\nSELECT count(USERNAME) into v_num from DBA_USERS where DEFAULT_TABLESPACE=p_tablespace;\nreturn v_num;\nEND;\n/\n\ncreate or replace procedure mostrarfunciontablespacedefecto (p_tablespace DBA_USERS.DEFAULT_TABLESPACE%type)\nis\nv_num number;\nBEGIN\n    v_num:=tablespacedefecto(p_tablespace);\n    dbms_output.put_line ('El tablespace ' || p_tablespace || ' lo tienen ' || v_num || ' usuarios.');\nend;\n/\n```\n\n![remoto](/images/oracle-ejercicio4.png)\n\n### 6. Hacer un procedimiento llamado mostrar_usuarios_por_tablespace que muestre por pantalla un listado de los tablespaces existentes con la lista de usuarios de cada uno y el número de los mismos, así: (Vistas DBA_TABLESPACES y DBA_USERS)\n\nEn  este ejercicio en concreto utilizaremos una función creada en el anterior ejercicio para este propósito.\n\n```sql\ncreate or replace procedure mostrar_usuarios_por_tablespace\nis\ncursor c_tablespace is\nselect DISTINCT DEFAULT_TABLESPACE from DBA_USERS;\nBEGIN\nfor v_tablespace in c_tablespace loop\ndbms_output.put_line('Tablespace ' || v_tablespace.DEFAULT_TABLESPACE || ':');\nMOSTRARUSUARIOS(v_tablespace.DEFAULT_TABLESPACE);\ndbms_output.put_line('Total Usuarios Tablespace '|| v_tablespace.DEFAULT_TABLESPACE || ': ' || tablespacedefecto(v_tablespace.DEFAULT_TABLESPACE));\nend loop;\nend;\n/\n\n\nCREATE OR REPLACE PROCEDURE MOSTRARUSUARIOS (p_tablespace in out varchar2)\nis\ncursor c_nombre is\nselect USERNAME FROM DBA_USERS WHERE DEFAULT_TABLESPACE=p_tablespace;\nBEGIN\nFOR v_nombre in c_nombre loop\n    dbms_output.put_line('Usuario ' || v_nombre.USERNAME );\nend loop;\nend;\n/\n```\n\n![remoto](/images/oracle-ejercicio6.png)\n\n### 7. Hacer un procedimiento llamado mostrar_codigo_fuente  que reciba el nombre de otro procedimiento y muestre su código fuente. (DBA_SOURCE)\n```sql\ncreate or replace procedure mostrar_codigo_fuente (p_procedimiento varchar2)\nIS\ncursor c_fuente is\nselect text from DBA_SOURCE where NAME=p_procedimiento;\nBEGIN\nFOR v_fuente in c_fuente loop\n    dbms_output.put_line(v_fuente.text);\nend loop;\nend;\n/\n```\n\n![remoto](/images/oracle-ejercicio7.png)\n\n### 8. Hacer un procedimiento llamado mostrar_privilegios_usuario que reciba el nombre de un usuario y muestre sus privilegios de sistema y sus privilegios sobre objetos. (DBA_SYS_PRIVS y DBA_TAB_PRIVS)\n\n```sql\nCREATE OR REPLACE PROCEDURE mostrar_privilegios_usuario (p_usuario DBA_USERS.USERNAME%TYPE)\nis\ncursor c_sistema is\nSELECT GRANTEE,PRIVILEGE FROM DBA_SYS_PRIVS WHERE GRANTEE=p_usuario;\ncursor c_objeto is\nSELECT GRANTEE,PRIVILEGE FROM DBA_TAB_PRIVS WHERE GRANTEE=p_usuario;\nBEGIN\nFOR v_sistema in c_sistema loop\n    dbms_output.put_line('Privilegio de sistema: ' || v_sistema.PRIVILEGE);\nend loop;\nFOR v_objeto in c_objeto loop\n    dbms_output.put_line('Privilegiode objetos: ' || v_objeto.PRIVILEGE);\nend loop;\nEND;\n/\n```\n\n![remoto](/images/oracle-ejercicio8.png)\n\n### 9. Realiza un procedimiento llamado listar_comisiones que nos muestre por pantalla un listado de las comisiones de los empleados agrupados según la localidad donde está ubicado su departamento con el siguiente formato:\n```sql\nCREATE OR REPLACE PROCEDURE Listar_comisiones\nIS\ncursor c_localidad is\nselect dname,loc from dept;\nv_total number(5);\nBEGIN\nselect sum(comm) into v_total from emp; \nFOR v_localidad in c_localidad loop\n    dbms_output.put_line('Localidad: ' || v_localidad.loc);\n    dbms_output.put_line('Departamento: ' || v_localidad.dname);\n    MOSTRARCOMISIONES(v_localidad.loc);\nend loop;\ndbms_output.put_line('Total comisiones en la empresa es de: ' || v_total);\nexception\nWHEN NO_DATA_FOUND then\ndbms_output.put_line('Hay tablas vacías');\nend;\n/\n\nCREATE OR REPLACE PROCEDURE MOSTRARCOMISIONES (p_localidad in out varchar2)\nIS\ncursor c_comisiones is\nselect ename,comm from emp where deptno in (select deptno from dept where loc = p_localidad);\nv_total number(5);\nBEGIN\nselect sum(comm) into v_total from emp where deptno in  (select deptno from dept where loc = p_localidad);\nFOR v_empleado in c_comisiones loop\n    dbms_output.put_line('Empleado: ' || v_empleado.ename || '..................' || v_empleado.comm);\n    if v_empleado.comm > 10000 then\n        raise_application_error(-20001,'Hay algún empleado con más de 10.000 de comisión');\n    end if;\nend loop;\ndbms_output.put_line('Total comisiones departamento: ' || p_localidad || ' es de: ' || v_total);\nEND;\n/\n```\n\nPodemos ver en la imagen que se produce un raise ya que hay un usuario con más de 10.000 de comm.\n\n![remoto](/images/oracle-ejercicio9.png)\n\n### 10. Realiza un procedimiento que reciba el nombre de una tabla y muestre los nombres de las restricciones que tiene, a qué columna afectan y en qué consisten exactamente. (DBA_TABLES, DBA_CONSTRAINTS, DBA_CONS_COLUMNS)\n```sql\nSELECT CONSTRAINT_NAME,CONSTRAINT_TYPE,SEARCH_CONDITION_VC FROM DBA_CONSTRAINTS WHERE TABLE_NAME='EQUIPAR';\nSELECT CONSTRAINT_NAME,COLUMN_NAME FROM DBA_CONS_COLUMNS WHERE TABLE_NAME = 'PERSONAJE';\n\nCREATE OR REPLACE PROCEDURE MOSTRARRESTRICCIONES (p_tabla varchar2)\nis\nv_tabla varchar2(50);\nBEGIN\nv_tabla:=p_tabla;\nMOSTRARCONSSYS (v_tabla);\nMOSTRARCONSTABS (v_tabla);\nend;\n/\n\nCREATE OR REPLACE PROCEDURE MOSTRARCONSSYS (p_tabla in out varchar2)\nIS\ncursor c_system is\nSELECT CONSTRAINT_NAME,CONSTRAINT_TYPE,SEARCH_CONDITION_VC FROM DBA_CONSTRAINTS WHERE TABLE_NAME=p_tabla;\nBEGIN\nFOR v_system in c_system loop\n    dbms_output.put_line(v_system.CONSTRAINT_NAME || 'Tipo de restricción: ' || v_system.CONSTRAINT_TYPE || v_system.SEARCH_CONDITION_VC);\nend loop;\nEND;\n/\n\n\nCREATE OR REPLACE PROCEDURE MOSTRARCONSTABS (p_tabla in out varchar2)\nIS\ncursor c_tabs is\nSELECT CONSTRAINT_NAME,COLUMN_NAME FROM DBA_CONS_COLUMNS WHERE TABLE_NAME = p_tabla;\nBEGIN\nFOR v_tabs in c_tabs loop\n    dbms_output.put_line('Restricción: ' || v_tabs.CONSTRAINT_NAME || ' y la columna a la que hace referencia es: ' || v_tabs.COLUMN_NAME);\nend loop;\nEND;\n/\n```\n\n![remoto](/images/oracle-ejercicio10.png)\n\n## POSTGRESQL\n\nComenzaremos adjuntando el script de creación de tablas e inserciones de Postgres:\n\n```sql\ncreate table dept(\n  deptno   decimal(2,0) not null,\n  dname    varchar(14),\n  loc      varchar(13));\ncreate table emp(\n  empno    decimal(4,0) not null,\n  ename    varchar(10),\n  job      varchar(9),\n  mgr      decimal(4,0),\n  hiredate date,\n  sal      decimal(7,2),\n  comm     decimal(7,2),  \n  deptno   decimal(2,0) not null);\ncreate table bonus(\n  ename    varchar(10),\n  job      varchar(9),\n  sal      decimal,\n  comm     decimal);\ncreate table salgrade(\n  grade    decimal,\n  losal    decimal,\n  hisal    decimal);\ncreate table dummy (\n  dummy    decimal);\ninsert into dummy values (0);\ninsert into DEPT (DEPTNO, DNAME, LOC)\n  select 10, 'ACCOUNTING', 'NEW YORK' from dummy union all\n  select 20, 'RESEARCH',   'DALLAS'   from dummy union all\n  select 30, 'SALES',      'CHICAGO'  from dummy union all\n  select 40, 'OPERATIONS', 'BOSTON'   from dummy;\ninsert into emp (EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM, DEPTNO)\n  select 7839, 'KING',   'PRESIDENT', cast(null as integer), to_date('17-11-1981','dd-mm-yyyy'),    5000, cast(null as integer), 10 from dummy union all\n  select 7698, 'BLAKE',  'MANAGER',   7839, to_date('1-5-1981','dd-mm-yyyy'),      2850, cast(null as integer), 30 from dummy union all\n  select 7782, 'CLARK',  'MANAGER',   7839, to_date('9-6-1981','dd-mm-yyyy'),      2450, cast(null as integer), 10 from dummy union all\n  select 7566, 'JONES',  'MANAGER',   7839, to_date('2-4-1981','dd-mm-yyyy'),      2975, cast(null as integer), 20 from dummy union all\n  select 7788, 'SCOTT',  'ANALYST',   7566, to_date('13-7-87','dd-mm-rr') - 85,  3000, cast(null as integer), 20 from dummy union all\n  select 7902, 'FORD',   'ANALYST',   7566, to_date('3-12-1981','dd-mm-yyyy'),     3000, cast(null as integer), 20 from dummy union all\n  select 7369, 'SMITH',  'CLERK',     7902, to_date('17-12-1980','dd-mm-yyyy'),     800, cast(null as integer), 20 from dummy union all\n  select 7499, 'ALLEN',  'SALESMAN',  7698, to_date('20-2-1981','dd-mm-yyyy'),     1600,  300, 30 from dummy union all\n  select 7521, 'WARD',   'SALESMAN',  7698, to_date('22-2-1981','dd-mm-yyyy'),     1250,  500, 30 from dummy union all\n  select 7654, 'MARTIN', 'SALESMAN',  7698, to_date('28-9-1981','dd-mm-yyyy'),     1250, 1400, 30 from dummy union all\n  select 7844, 'TURNER', 'SALESMAN',  7698, to_date('8-9-1981','dd-mm-yyyy'),      1500,    0, 30 from dummy union all\n  select 7876, 'ADAMS',  'CLERK',     7788, to_date('13-7-87', 'dd-mm-rr') - 51, 1100, cast(null as integer), 20 from dummy union all\n  select 7900, 'JAMES',  'CLERK',     7698, to_date('3-12-1981','dd-mm-yyyy'),      950, cast(null as integer), 30 from dummy union all\n  select 7934, 'MILLER', 'CLERK',     7782, to_date('23-1-1982','dd-mm-yyyy'),     1300, cast(null as integer), 10 from dummy;\ninsert into salgrade\n  select 1,  700, 1200 from dummy union all\n  select 2, 1201, 1400 from dummy union all\n  select 3, 1401, 2000 from dummy union all\n  select 4, 2001, 3000 from dummy union all\n  select 5, 3001, 9999 from dummy;\ncommit;\n```\n\n\n\n\n### 1. Hacer un procedimiento que muestre el nombre y el salario del empleado cuyo código es 7082\n```sql\nCREATE or replace PROCEDURE mostrar_7082() \nAS $$\nDECLARE\n    v_nombre emp.ename%type;\n    v_salario emp.sal%type;\nBEGIN\n    select ename,sal into v_nombre,v_salario from emp where empno=7782;\n    RAISE NOTICE 'El nombre del empleado es %, y su salario es %', v_nombre,v_salario;\nEND;\n$$ LANGUAGE plpgsql;\n```\n\n![remoto](/images/postgres-ejercicio2.png)\n\n### 2. Hacer un procedimiento que reciba como parámetro un código de empleado y devuelva su nombre\n```sql\nCreate or replace procedure codigoanombreemp (p_codempleado emp.empno%type) \nAS $$\nDECLARE\n    v_nombre emp.ename%type;\nBEGIN\n    select ename into v_nombre from emp where empno=p_codempleado;\n    RAISE NOTICE 'El empleado con el código %, es %', p_codempleado,v_nombre;\nEND;\n$$ LANGUAGE plpgsql;\n```\n\n![remoto](/images/postgres-ejercicio1.png)","source":"_posts/plsql_basico.md","raw":"---\ntitle: Procedimientos en Oracle y Postgres\ncategories: Bases de Datos\n---\n\n![remoto](/images/oraclepostgres.jpg)\n\n## ORACLE\n\nComenzaremos adjuntando el script de creación de tablas e inserciones de Oracle:\n\n```sql\nCREATE TABLE DEPT\n(\n DEPTNO NUMBER(2),\n DNAME VARCHAR2(14),\n LOC VARCHAR2(13),\n CONSTRAINT PK_DEPT PRIMARY KEY (DEPTNO)\n);\nCREATE TABLE EMP\n(\n EMPNO NUMBER(4),\n ENAME VARCHAR2(10),\n JOB VARCHAR2(9),\n MGR NUMBER(4),\n HIREDATE DATE,\n SAL NUMBER(7, 2),\n COMM NUMBER(7, 2),\n DEPTNO NUMBER(2),\n CONSTRAINT FK_DEPTNO FOREIGN KEY (DEPTNO) REFERENCES DEPT (DEPTNO),\n CONSTRAINT PK_EMP PRIMARY KEY (EMPNO)\n);\nINSERT INTO DEPT VALUES (10, 'ACCOUNTING', 'NEW YORK');\nINSERT INTO DEPT VALUES (20, 'RESEARCH', 'DALLAS');\nINSERT INTO DEPT VALUES (30, 'SALES', 'CHICAGO');\nINSERT INTO DEPT VALUES (40, 'OPERATIONS', 'BOSTON');\nINSERT INTO EMP VALUES(7369, 'SMITH', 'CLERK', 7902,TO_DATE('17-DIC-1980', 'DD-MON-YYYY'), 800, NULL, 20);\nINSERT INTO EMP VALUES(7499, 'ALLEN', 'SALESMAN', 7698,TO_DATE('20-FEB-1981', 'DD-MON-YYYY'), 1600, 300, 30);\nINSERT INTO EMP VALUES(7521, 'WARD', 'SALESMAN', 7698,TO_DATE('22-FEB-1981', 'DD-MON-YYYY'), 1250, 500, 30);\nINSERT INTO EMP VALUES(7566, 'JONES', 'MANAGER', 7839,TO_DATE('2-ABR-1981', 'DD-MON-YYYY'), 2975, NULL, 20);\nINSERT INTO EMP VALUES(7654, 'MARTIN', 'SALESMAN', 7698,TO_DATE('28-SEP-1981', 'DD-MON-YYYY'), 1250, 1400, 30);\nINSERT INTO EMP VALUES(7698, 'BLAKE', 'MANAGER', 7839,TO_DATE('1-MAY-1981', 'DD-MON-YYYY'), 2850, NULL, 30);\nINSERT INTO EMP VALUES(7782, 'CLARK', 'MANAGER', 7839,TO_DATE('9-JUN-1981', 'DD-MON-YYYY'), 2450, NULL, 10);\nINSERT INTO EMP VALUES(7788, 'SCOTT', 'ANALYST', 7566,TO_DATE('09-DIC-1982', 'DD-MON-YYYY'), 3000, NULL, 20);\nINSERT INTO EMP VALUES(7839, 'KING', 'PRESIDENT', NULL,TO_DATE('17-NOV-1981', 'DD-MON-YYYY'), 5000, NULL, 10);\nINSERT INTO EMP VALUES(7844, 'TURNER', 'SALESMAN', 7698,TO_DATE('8-SEP-1981', 'DD-MON-YYYY'), 1500, 0, 30);\nINSERT INTO EMP VALUES(7876, 'ADAMS', 'CLERK', 7788,TO_DATE('12-ENE-1983', 'DD-MON-YYYY'), 1100, NULL, 20);\nINSERT INTO EMP VALUES(7900, 'JAMES', 'CLERK', 7698,TO_DATE('3-DIC-1981', 'DD-MON-YYYY'), 950, NULL, 30);\nINSERT INTO EMP VALUES(7902, 'FORD', 'ANALYST', 7566,TO_DATE('3-DIC-1981', 'DD-MON-YYYY'), 3000, NULL, 20);\nINSERT INTO EMP VALUES(7934, 'MILLER', 'CLERK', 7782,TO_DATE('23-ENE-1982', 'DD-MON-YYYY'), 1300, NULL, 10);\n\nCOMMIT;\n```\n\n\n\n### 1. Hacer un procedimiento que muestre el nombre y el salario del empleado cuyo código es 7082\n```sql\ncreate or replace procedure mostrar_7082\nIS\n    v_nombre emp.ename%type;\n    v_sal emp.sal%type;\nBEGIN\n    select ename,sal into v_nombre,v_sal \n    from emp\n    where empno= 7782;\n    dbms_output.put_line('El nombre del empleado 7082 es ' || v_nombre || ' y su salario es ' || v_sal );\nEND;\n/\n```\n\n![remoto](/images/oracle-ejercicio1.png)\n\n### 2. Hacer un procedimiento que reciba como parámetro un código de empleado y devuelva su nombre\n```sql\nCreate or replace procedure codigoanombreemp (p_codempleado emp.empno%type)\nIS\n    v_nombre emp.ename%type;\nBEGIN\n    select ename into v_nombre from emp where empno=p_codempleado;\n    dbms_output.put_line ('El empleado con el código ' || p_codempleado || ' es ' || v_nombre);\nEND;\n/\n```\n\n![remoto](/images/oracle-ejercicio2.png)\n\n### 3. Hacer un procedimiento que devuelva los nombres de los tres empleados más antiguos\n```sql\ncreate or replace procedure tresempleadosmasantiguos\nIS\ncursor c_empleados is\nselect ename from emp WHERE ROWNUM <= 3 order by hiredate asc;\nBEGIN\nFOR v_empleados in c_empleados loop\n    dbms_output.put_line (v_empleados.ename);\nend loop;\nEND;\n/\n```\n\n![remoto](/images/oracle-ejercicio5.png)\n\n### 4. Hacer un procedimiento que reciba el nombre de un tablespace y muestre los nombres de los usuarios que lo tienen como tablespace por defecto (Vista DBA_USERS)\n```sql\ncreate or replace procedure tablespacedefecto (p_tablespace DBA_USERS.DEFAULT_TABLESPACE%type)\nIS\ncursor c_tablespace is\nSELECT USERNAME from DBA_USERS where DEFAULT_TABLESPACE=p_tablespace;\nBEGIN\nFOR v_usuarios in c_tablespace loop\n    dbms_output.put_line (v_usuarios.USERNAME);\nend loop;\nEND;\n/\n```\n\n![remoto](/images/oracle-ejercicio3.png)\n\n### 5. Modificar el procedimiento anterior para que haga lo mismo pero devolviendo el número de usuarios que tienen ese tablespace como tablespace por defecto. Nota: Hay que convertir el procedimiento en función\n```sql\ncreate or replace function tablespacedefecto (p_tablespace DBA_USERS.DEFAULT_TABLESPACE%type)\nreturn number\nIS\nv_num number (4);\nBEGIN\nSELECT count(USERNAME) into v_num from DBA_USERS where DEFAULT_TABLESPACE=p_tablespace;\nreturn v_num;\nEND;\n/\n\ncreate or replace procedure mostrarfunciontablespacedefecto (p_tablespace DBA_USERS.DEFAULT_TABLESPACE%type)\nis\nv_num number;\nBEGIN\n    v_num:=tablespacedefecto(p_tablespace);\n    dbms_output.put_line ('El tablespace ' || p_tablespace || ' lo tienen ' || v_num || ' usuarios.');\nend;\n/\n```\n\n![remoto](/images/oracle-ejercicio4.png)\n\n### 6. Hacer un procedimiento llamado mostrar_usuarios_por_tablespace que muestre por pantalla un listado de los tablespaces existentes con la lista de usuarios de cada uno y el número de los mismos, así: (Vistas DBA_TABLESPACES y DBA_USERS)\n\nEn  este ejercicio en concreto utilizaremos una función creada en el anterior ejercicio para este propósito.\n\n```sql\ncreate or replace procedure mostrar_usuarios_por_tablespace\nis\ncursor c_tablespace is\nselect DISTINCT DEFAULT_TABLESPACE from DBA_USERS;\nBEGIN\nfor v_tablespace in c_tablespace loop\ndbms_output.put_line('Tablespace ' || v_tablespace.DEFAULT_TABLESPACE || ':');\nMOSTRARUSUARIOS(v_tablespace.DEFAULT_TABLESPACE);\ndbms_output.put_line('Total Usuarios Tablespace '|| v_tablespace.DEFAULT_TABLESPACE || ': ' || tablespacedefecto(v_tablespace.DEFAULT_TABLESPACE));\nend loop;\nend;\n/\n\n\nCREATE OR REPLACE PROCEDURE MOSTRARUSUARIOS (p_tablespace in out varchar2)\nis\ncursor c_nombre is\nselect USERNAME FROM DBA_USERS WHERE DEFAULT_TABLESPACE=p_tablespace;\nBEGIN\nFOR v_nombre in c_nombre loop\n    dbms_output.put_line('Usuario ' || v_nombre.USERNAME );\nend loop;\nend;\n/\n```\n\n![remoto](/images/oracle-ejercicio6.png)\n\n### 7. Hacer un procedimiento llamado mostrar_codigo_fuente  que reciba el nombre de otro procedimiento y muestre su código fuente. (DBA_SOURCE)\n```sql\ncreate or replace procedure mostrar_codigo_fuente (p_procedimiento varchar2)\nIS\ncursor c_fuente is\nselect text from DBA_SOURCE where NAME=p_procedimiento;\nBEGIN\nFOR v_fuente in c_fuente loop\n    dbms_output.put_line(v_fuente.text);\nend loop;\nend;\n/\n```\n\n![remoto](/images/oracle-ejercicio7.png)\n\n### 8. Hacer un procedimiento llamado mostrar_privilegios_usuario que reciba el nombre de un usuario y muestre sus privilegios de sistema y sus privilegios sobre objetos. (DBA_SYS_PRIVS y DBA_TAB_PRIVS)\n\n```sql\nCREATE OR REPLACE PROCEDURE mostrar_privilegios_usuario (p_usuario DBA_USERS.USERNAME%TYPE)\nis\ncursor c_sistema is\nSELECT GRANTEE,PRIVILEGE FROM DBA_SYS_PRIVS WHERE GRANTEE=p_usuario;\ncursor c_objeto is\nSELECT GRANTEE,PRIVILEGE FROM DBA_TAB_PRIVS WHERE GRANTEE=p_usuario;\nBEGIN\nFOR v_sistema in c_sistema loop\n    dbms_output.put_line('Privilegio de sistema: ' || v_sistema.PRIVILEGE);\nend loop;\nFOR v_objeto in c_objeto loop\n    dbms_output.put_line('Privilegiode objetos: ' || v_objeto.PRIVILEGE);\nend loop;\nEND;\n/\n```\n\n![remoto](/images/oracle-ejercicio8.png)\n\n### 9. Realiza un procedimiento llamado listar_comisiones que nos muestre por pantalla un listado de las comisiones de los empleados agrupados según la localidad donde está ubicado su departamento con el siguiente formato:\n```sql\nCREATE OR REPLACE PROCEDURE Listar_comisiones\nIS\ncursor c_localidad is\nselect dname,loc from dept;\nv_total number(5);\nBEGIN\nselect sum(comm) into v_total from emp; \nFOR v_localidad in c_localidad loop\n    dbms_output.put_line('Localidad: ' || v_localidad.loc);\n    dbms_output.put_line('Departamento: ' || v_localidad.dname);\n    MOSTRARCOMISIONES(v_localidad.loc);\nend loop;\ndbms_output.put_line('Total comisiones en la empresa es de: ' || v_total);\nexception\nWHEN NO_DATA_FOUND then\ndbms_output.put_line('Hay tablas vacías');\nend;\n/\n\nCREATE OR REPLACE PROCEDURE MOSTRARCOMISIONES (p_localidad in out varchar2)\nIS\ncursor c_comisiones is\nselect ename,comm from emp where deptno in (select deptno from dept where loc = p_localidad);\nv_total number(5);\nBEGIN\nselect sum(comm) into v_total from emp where deptno in  (select deptno from dept where loc = p_localidad);\nFOR v_empleado in c_comisiones loop\n    dbms_output.put_line('Empleado: ' || v_empleado.ename || '..................' || v_empleado.comm);\n    if v_empleado.comm > 10000 then\n        raise_application_error(-20001,'Hay algún empleado con más de 10.000 de comisión');\n    end if;\nend loop;\ndbms_output.put_line('Total comisiones departamento: ' || p_localidad || ' es de: ' || v_total);\nEND;\n/\n```\n\nPodemos ver en la imagen que se produce un raise ya que hay un usuario con más de 10.000 de comm.\n\n![remoto](/images/oracle-ejercicio9.png)\n\n### 10. Realiza un procedimiento que reciba el nombre de una tabla y muestre los nombres de las restricciones que tiene, a qué columna afectan y en qué consisten exactamente. (DBA_TABLES, DBA_CONSTRAINTS, DBA_CONS_COLUMNS)\n```sql\nSELECT CONSTRAINT_NAME,CONSTRAINT_TYPE,SEARCH_CONDITION_VC FROM DBA_CONSTRAINTS WHERE TABLE_NAME='EQUIPAR';\nSELECT CONSTRAINT_NAME,COLUMN_NAME FROM DBA_CONS_COLUMNS WHERE TABLE_NAME = 'PERSONAJE';\n\nCREATE OR REPLACE PROCEDURE MOSTRARRESTRICCIONES (p_tabla varchar2)\nis\nv_tabla varchar2(50);\nBEGIN\nv_tabla:=p_tabla;\nMOSTRARCONSSYS (v_tabla);\nMOSTRARCONSTABS (v_tabla);\nend;\n/\n\nCREATE OR REPLACE PROCEDURE MOSTRARCONSSYS (p_tabla in out varchar2)\nIS\ncursor c_system is\nSELECT CONSTRAINT_NAME,CONSTRAINT_TYPE,SEARCH_CONDITION_VC FROM DBA_CONSTRAINTS WHERE TABLE_NAME=p_tabla;\nBEGIN\nFOR v_system in c_system loop\n    dbms_output.put_line(v_system.CONSTRAINT_NAME || 'Tipo de restricción: ' || v_system.CONSTRAINT_TYPE || v_system.SEARCH_CONDITION_VC);\nend loop;\nEND;\n/\n\n\nCREATE OR REPLACE PROCEDURE MOSTRARCONSTABS (p_tabla in out varchar2)\nIS\ncursor c_tabs is\nSELECT CONSTRAINT_NAME,COLUMN_NAME FROM DBA_CONS_COLUMNS WHERE TABLE_NAME = p_tabla;\nBEGIN\nFOR v_tabs in c_tabs loop\n    dbms_output.put_line('Restricción: ' || v_tabs.CONSTRAINT_NAME || ' y la columna a la que hace referencia es: ' || v_tabs.COLUMN_NAME);\nend loop;\nEND;\n/\n```\n\n![remoto](/images/oracle-ejercicio10.png)\n\n## POSTGRESQL\n\nComenzaremos adjuntando el script de creación de tablas e inserciones de Postgres:\n\n```sql\ncreate table dept(\n  deptno   decimal(2,0) not null,\n  dname    varchar(14),\n  loc      varchar(13));\ncreate table emp(\n  empno    decimal(4,0) not null,\n  ename    varchar(10),\n  job      varchar(9),\n  mgr      decimal(4,0),\n  hiredate date,\n  sal      decimal(7,2),\n  comm     decimal(7,2),  \n  deptno   decimal(2,0) not null);\ncreate table bonus(\n  ename    varchar(10),\n  job      varchar(9),\n  sal      decimal,\n  comm     decimal);\ncreate table salgrade(\n  grade    decimal,\n  losal    decimal,\n  hisal    decimal);\ncreate table dummy (\n  dummy    decimal);\ninsert into dummy values (0);\ninsert into DEPT (DEPTNO, DNAME, LOC)\n  select 10, 'ACCOUNTING', 'NEW YORK' from dummy union all\n  select 20, 'RESEARCH',   'DALLAS'   from dummy union all\n  select 30, 'SALES',      'CHICAGO'  from dummy union all\n  select 40, 'OPERATIONS', 'BOSTON'   from dummy;\ninsert into emp (EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM, DEPTNO)\n  select 7839, 'KING',   'PRESIDENT', cast(null as integer), to_date('17-11-1981','dd-mm-yyyy'),    5000, cast(null as integer), 10 from dummy union all\n  select 7698, 'BLAKE',  'MANAGER',   7839, to_date('1-5-1981','dd-mm-yyyy'),      2850, cast(null as integer), 30 from dummy union all\n  select 7782, 'CLARK',  'MANAGER',   7839, to_date('9-6-1981','dd-mm-yyyy'),      2450, cast(null as integer), 10 from dummy union all\n  select 7566, 'JONES',  'MANAGER',   7839, to_date('2-4-1981','dd-mm-yyyy'),      2975, cast(null as integer), 20 from dummy union all\n  select 7788, 'SCOTT',  'ANALYST',   7566, to_date('13-7-87','dd-mm-rr') - 85,  3000, cast(null as integer), 20 from dummy union all\n  select 7902, 'FORD',   'ANALYST',   7566, to_date('3-12-1981','dd-mm-yyyy'),     3000, cast(null as integer), 20 from dummy union all\n  select 7369, 'SMITH',  'CLERK',     7902, to_date('17-12-1980','dd-mm-yyyy'),     800, cast(null as integer), 20 from dummy union all\n  select 7499, 'ALLEN',  'SALESMAN',  7698, to_date('20-2-1981','dd-mm-yyyy'),     1600,  300, 30 from dummy union all\n  select 7521, 'WARD',   'SALESMAN',  7698, to_date('22-2-1981','dd-mm-yyyy'),     1250,  500, 30 from dummy union all\n  select 7654, 'MARTIN', 'SALESMAN',  7698, to_date('28-9-1981','dd-mm-yyyy'),     1250, 1400, 30 from dummy union all\n  select 7844, 'TURNER', 'SALESMAN',  7698, to_date('8-9-1981','dd-mm-yyyy'),      1500,    0, 30 from dummy union all\n  select 7876, 'ADAMS',  'CLERK',     7788, to_date('13-7-87', 'dd-mm-rr') - 51, 1100, cast(null as integer), 20 from dummy union all\n  select 7900, 'JAMES',  'CLERK',     7698, to_date('3-12-1981','dd-mm-yyyy'),      950, cast(null as integer), 30 from dummy union all\n  select 7934, 'MILLER', 'CLERK',     7782, to_date('23-1-1982','dd-mm-yyyy'),     1300, cast(null as integer), 10 from dummy;\ninsert into salgrade\n  select 1,  700, 1200 from dummy union all\n  select 2, 1201, 1400 from dummy union all\n  select 3, 1401, 2000 from dummy union all\n  select 4, 2001, 3000 from dummy union all\n  select 5, 3001, 9999 from dummy;\ncommit;\n```\n\n\n\n\n### 1. Hacer un procedimiento que muestre el nombre y el salario del empleado cuyo código es 7082\n```sql\nCREATE or replace PROCEDURE mostrar_7082() \nAS $$\nDECLARE\n    v_nombre emp.ename%type;\n    v_salario emp.sal%type;\nBEGIN\n    select ename,sal into v_nombre,v_salario from emp where empno=7782;\n    RAISE NOTICE 'El nombre del empleado es %, y su salario es %', v_nombre,v_salario;\nEND;\n$$ LANGUAGE plpgsql;\n```\n\n![remoto](/images/postgres-ejercicio2.png)\n\n### 2. Hacer un procedimiento que reciba como parámetro un código de empleado y devuelva su nombre\n```sql\nCreate or replace procedure codigoanombreemp (p_codempleado emp.empno%type) \nAS $$\nDECLARE\n    v_nombre emp.ename%type;\nBEGIN\n    select ename into v_nombre from emp where empno=p_codempleado;\n    RAISE NOTICE 'El empleado con el código %, es %', p_codempleado,v_nombre;\nEND;\n$$ LANGUAGE plpgsql;\n```\n\n![remoto](/images/postgres-ejercicio1.png)","slug":"plsql_basico","published":1,"date":"2022-12-07T01:39:06.680Z","updated":"2023-01-04T13:29:35.751Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cldl8a0pd000v2fi5czj71bgg","content":"<p><img src=\"/images/oraclepostgres.jpg\" alt=\"remoto\"></p>\n<h2 id=\"oracle\"><a class=\"markdownIt-Anchor\" href=\"#oracle\">#</a> ORACLE</h2>\n<p>Comenzaremos adjuntando el script de creación de tablas e inserciones de Oracle:</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> DEPT</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> DEPTNO NUMBER<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> DNAME VARCHAR2<span class=\"token punctuation\">(</span><span class=\"token number\">14</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre> LOC VARCHAR2<span class=\"token punctuation\">(</span><span class=\"token number\">13</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> <span class=\"token keyword\">CONSTRAINT</span> PK_DEPT <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span>DEPTNO<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> EMP</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre> EMPNO NUMBER<span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre> ENAME VARCHAR2<span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre> JOB VARCHAR2<span class=\"token punctuation\">(</span><span class=\"token number\">9</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre> MGR NUMBER<span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre> HIREDATE <span class=\"token keyword\">DATE</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre> SAL NUMBER<span class=\"token punctuation\">(</span><span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre> COMM NUMBER<span class=\"token punctuation\">(</span><span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre> DEPTNO NUMBER<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre> <span class=\"token keyword\">CONSTRAINT</span> FK_DEPTNO <span class=\"token keyword\">FOREIGN</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span>DEPTNO<span class=\"token punctuation\">)</span> <span class=\"token keyword\">REFERENCES</span> DEPT <span class=\"token punctuation\">(</span>DEPTNO<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre> <span class=\"token keyword\">CONSTRAINT</span> PK_EMP <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span>EMPNO<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> DEPT <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ACCOUNTING'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'NEW YORK'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> DEPT <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'RESEARCH'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DALLAS'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> DEPT <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SALES'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CHICAGO'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> DEPT <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">40</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'OPERATIONS'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'BOSTON'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> EMP <span class=\"token keyword\">VALUES</span><span class=\"token punctuation\">(</span><span class=\"token number\">7369</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SMITH'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CLERK'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7902</span><span class=\"token punctuation\">,</span>TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'17-DIC-1980'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DD-MON-YYYY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">800</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> EMP <span class=\"token keyword\">VALUES</span><span class=\"token punctuation\">(</span><span class=\"token number\">7499</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ALLEN'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SALESMAN'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7698</span><span class=\"token punctuation\">,</span>TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'20-FEB-1981'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DD-MON-YYYY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1600</span><span class=\"token punctuation\">,</span> <span class=\"token number\">300</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> EMP <span class=\"token keyword\">VALUES</span><span class=\"token punctuation\">(</span><span class=\"token number\">7521</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'WARD'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SALESMAN'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7698</span><span class=\"token punctuation\">,</span>TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'22-FEB-1981'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DD-MON-YYYY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1250</span><span class=\"token punctuation\">,</span> <span class=\"token number\">500</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> EMP <span class=\"token keyword\">VALUES</span><span class=\"token punctuation\">(</span><span class=\"token number\">7566</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'JONES'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'MANAGER'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7839</span><span class=\"token punctuation\">,</span>TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'2-ABR-1981'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DD-MON-YYYY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2975</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> EMP <span class=\"token keyword\">VALUES</span><span class=\"token punctuation\">(</span><span class=\"token number\">7654</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'MARTIN'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SALESMAN'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7698</span><span class=\"token punctuation\">,</span>TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'28-SEP-1981'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DD-MON-YYYY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1250</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1400</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> EMP <span class=\"token keyword\">VALUES</span><span class=\"token punctuation\">(</span><span class=\"token number\">7698</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'BLAKE'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'MANAGER'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7839</span><span class=\"token punctuation\">,</span>TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'1-MAY-1981'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DD-MON-YYYY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2850</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> EMP <span class=\"token keyword\">VALUES</span><span class=\"token punctuation\">(</span><span class=\"token number\">7782</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CLARK'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'MANAGER'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7839</span><span class=\"token punctuation\">,</span>TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'9-JUN-1981'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DD-MON-YYYY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2450</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> EMP <span class=\"token keyword\">VALUES</span><span class=\"token punctuation\">(</span><span class=\"token number\">7788</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SCOTT'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ANALYST'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7566</span><span class=\"token punctuation\">,</span>TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'09-DIC-1982'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DD-MON-YYYY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> EMP <span class=\"token keyword\">VALUES</span><span class=\"token punctuation\">(</span><span class=\"token number\">7839</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'KING'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'PRESIDENT'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'17-NOV-1981'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DD-MON-YYYY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5000</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> EMP <span class=\"token keyword\">VALUES</span><span class=\"token punctuation\">(</span><span class=\"token number\">7844</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'TURNER'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SALESMAN'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7698</span><span class=\"token punctuation\">,</span>TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'8-SEP-1981'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DD-MON-YYYY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1500</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> EMP <span class=\"token keyword\">VALUES</span><span class=\"token punctuation\">(</span><span class=\"token number\">7876</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ADAMS'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CLERK'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7788</span><span class=\"token punctuation\">,</span>TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'12-ENE-1983'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DD-MON-YYYY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1100</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> EMP <span class=\"token keyword\">VALUES</span><span class=\"token punctuation\">(</span><span class=\"token number\">7900</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'JAMES'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CLERK'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7698</span><span class=\"token punctuation\">,</span>TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'3-DIC-1981'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DD-MON-YYYY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">950</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> EMP <span class=\"token keyword\">VALUES</span><span class=\"token punctuation\">(</span><span class=\"token number\">7902</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'FORD'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ANALYST'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7566</span><span class=\"token punctuation\">,</span>TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'3-DIC-1981'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DD-MON-YYYY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> EMP <span class=\"token keyword\">VALUES</span><span class=\"token punctuation\">(</span><span class=\"token number\">7934</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'MILLER'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CLERK'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7782</span><span class=\"token punctuation\">,</span>TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'23-ENE-1982'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DD-MON-YYYY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1300</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token keyword\">COMMIT</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"1-hacer-un-procedimiento-que-muestre-el-nombre-y-el-salario-del-empleado-cuyo-código-es-7082\"><a class=\"markdownIt-Anchor\" href=\"#1-hacer-un-procedimiento-que-muestre-el-nombre-y-el-salario-del-empleado-cuyo-código-es-7082\">#</a> 1. Hacer un procedimiento que muestre el nombre y el salario del empleado cuyo código es 7082</h3>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">create</span> <span class=\"token operator\">or</span> <span class=\"token keyword\">replace</span> <span class=\"token keyword\">procedure</span> mostrar_7082</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">IS</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    v_nombre emp<span class=\"token punctuation\">.</span>ename<span class=\"token operator\">%</span><span class=\"token keyword\">type</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    v_sal emp<span class=\"token punctuation\">.</span>sal<span class=\"token operator\">%</span><span class=\"token keyword\">type</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">select</span> ename<span class=\"token punctuation\">,</span>sal <span class=\"token keyword\">into</span> v_nombre<span class=\"token punctuation\">,</span>v_sal </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">from</span> emp</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">where</span> empno<span class=\"token operator\">=</span> <span class=\"token number\">7782</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    dbms_output<span class=\"token punctuation\">.</span>put_line<span class=\"token punctuation\">(</span><span class=\"token string\">'El nombre del empleado 7082 es '</span> <span class=\"token operator\">||</span> v_nombre <span class=\"token operator\">||</span> <span class=\"token string\">' y su salario es '</span> <span class=\"token operator\">||</span> v_sal <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token operator\">/</span></pre></td></tr></table></figure><p><img src=\"/images/oracle-ejercicio1.png\" alt=\"remoto\"></p>\n<h3 id=\"2-hacer-un-procedimiento-que-reciba-como-parámetro-un-código-de-empleado-y-devuelva-su-nombre\"><a class=\"markdownIt-Anchor\" href=\"#2-hacer-un-procedimiento-que-reciba-como-parámetro-un-código-de-empleado-y-devuelva-su-nombre\">#</a> 2. Hacer un procedimiento que reciba como parámetro un código de empleado y devuelva su nombre</h3>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">Create</span> <span class=\"token operator\">or</span> <span class=\"token keyword\">replace</span> <span class=\"token keyword\">procedure</span> codigoanombreemp <span class=\"token punctuation\">(</span>p_codempleado emp<span class=\"token punctuation\">.</span>empno<span class=\"token operator\">%</span><span class=\"token keyword\">type</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">IS</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    v_nombre emp<span class=\"token punctuation\">.</span>ename<span class=\"token operator\">%</span><span class=\"token keyword\">type</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">select</span> ename <span class=\"token keyword\">into</span> v_nombre <span class=\"token keyword\">from</span> emp <span class=\"token keyword\">where</span> empno<span class=\"token operator\">=</span>p_codempleado<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    dbms_output<span class=\"token punctuation\">.</span>put_line <span class=\"token punctuation\">(</span><span class=\"token string\">'El empleado con el código '</span> <span class=\"token operator\">||</span> p_codempleado <span class=\"token operator\">||</span> <span class=\"token string\">' es '</span> <span class=\"token operator\">||</span> v_nombre<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token operator\">/</span></pre></td></tr></table></figure><p><img src=\"/images/oracle-ejercicio2.png\" alt=\"remoto\"></p>\n<h3 id=\"3-hacer-un-procedimiento-que-devuelva-los-nombres-de-los-tres-empleados-más-antiguos\"><a class=\"markdownIt-Anchor\" href=\"#3-hacer-un-procedimiento-que-devuelva-los-nombres-de-los-tres-empleados-más-antiguos\">#</a> 3. Hacer un procedimiento que devuelva los nombres de los tres empleados más antiguos</h3>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">create</span> <span class=\"token operator\">or</span> <span class=\"token keyword\">replace</span> <span class=\"token keyword\">procedure</span> tresempleadosmasantiguos</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">IS</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">cursor</span> c_empleados <span class=\"token operator\">is</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">select</span> ename <span class=\"token keyword\">from</span> emp <span class=\"token keyword\">WHERE</span> ROWNUM <span class=\"token operator\">&lt;=</span> <span class=\"token number\">3</span> <span class=\"token keyword\">order</span> <span class=\"token keyword\">by</span> hiredate <span class=\"token keyword\">asc</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">FOR</span> v_empleados <span class=\"token operator\">in</span> c_empleados <span class=\"token keyword\">loop</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    dbms_output<span class=\"token punctuation\">.</span>put_line <span class=\"token punctuation\">(</span>v_empleados<span class=\"token punctuation\">.</span>ename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">end</span> <span class=\"token keyword\">loop</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token operator\">/</span></pre></td></tr></table></figure><p><img src=\"/images/oracle-ejercicio5.png\" alt=\"remoto\"></p>\n<h3 id=\"4-hacer-un-procedimiento-que-reciba-el-nombre-de-un-tablespace-y-muestre-los-nombres-de-los-usuarios-que-lo-tienen-como-tablespace-por-defecto-vista-dba_users\"><a class=\"markdownIt-Anchor\" href=\"#4-hacer-un-procedimiento-que-reciba-el-nombre-de-un-tablespace-y-muestre-los-nombres-de-los-usuarios-que-lo-tienen-como-tablespace-por-defecto-vista-dba_users\">#</a> 4. Hacer un procedimiento que reciba el nombre de un tablespace y muestre los nombres de los usuarios que lo tienen como tablespace por defecto (Vista DBA_USERS)</h3>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">create</span> <span class=\"token operator\">or</span> <span class=\"token keyword\">replace</span> <span class=\"token keyword\">procedure</span> tablespacedefecto <span class=\"token punctuation\">(</span>p_tablespace DBA_USERS<span class=\"token punctuation\">.</span>DEFAULT_TABLESPACE<span class=\"token operator\">%</span><span class=\"token keyword\">type</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">IS</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">cursor</span> c_tablespace <span class=\"token operator\">is</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">SELECT</span> USERNAME <span class=\"token keyword\">from</span> DBA_USERS <span class=\"token keyword\">where</span> DEFAULT_TABLESPACE<span class=\"token operator\">=</span>p_tablespace<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">FOR</span> v_usuarios <span class=\"token operator\">in</span> c_tablespace <span class=\"token keyword\">loop</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    dbms_output<span class=\"token punctuation\">.</span>put_line <span class=\"token punctuation\">(</span>v_usuarios<span class=\"token punctuation\">.</span>USERNAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">end</span> <span class=\"token keyword\">loop</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token operator\">/</span></pre></td></tr></table></figure><p><img src=\"/images/oracle-ejercicio3.png\" alt=\"remoto\"></p>\n<h3 id=\"5-modificar-el-procedimiento-anterior-para-que-haga-lo-mismo-pero-devolviendo-el-número-de-usuarios-que-tienen-ese-tablespace-como-tablespace-por-defecto-nota-hay-que-convertir-el-procedimiento-en-función\"><a class=\"markdownIt-Anchor\" href=\"#5-modificar-el-procedimiento-anterior-para-que-haga-lo-mismo-pero-devolviendo-el-número-de-usuarios-que-tienen-ese-tablespace-como-tablespace-por-defecto-nota-hay-que-convertir-el-procedimiento-en-función\">#</a> 5. Modificar el procedimiento anterior para que haga lo mismo pero devolviendo el número de usuarios que tienen ese tablespace como tablespace por defecto. Nota: Hay que convertir el procedimiento en función</h3>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">create</span> <span class=\"token operator\">or</span> <span class=\"token keyword\">replace</span> <span class=\"token keyword\">function</span> tablespacedefecto <span class=\"token punctuation\">(</span>p_tablespace DBA_USERS<span class=\"token punctuation\">.</span>DEFAULT_TABLESPACE<span class=\"token operator\">%</span><span class=\"token keyword\">type</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">return</span> number</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">IS</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>v_num number <span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">SELECT</span> <span class=\"token function\">count</span><span class=\"token punctuation\">(</span>USERNAME<span class=\"token punctuation\">)</span> <span class=\"token keyword\">into</span> v_num <span class=\"token keyword\">from</span> DBA_USERS <span class=\"token keyword\">where</span> DEFAULT_TABLESPACE<span class=\"token operator\">=</span>p_tablespace<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">return</span> v_num<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token operator\">/</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">create</span> <span class=\"token operator\">or</span> <span class=\"token keyword\">replace</span> <span class=\"token keyword\">procedure</span> mostrarfunciontablespacedefecto <span class=\"token punctuation\">(</span>p_tablespace DBA_USERS<span class=\"token punctuation\">.</span>DEFAULT_TABLESPACE<span class=\"token operator\">%</span><span class=\"token keyword\">type</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token operator\">is</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>v_num number<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    v_num:<span class=\"token operator\">=</span>tablespacedefecto<span class=\"token punctuation\">(</span>p_tablespace<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    dbms_output<span class=\"token punctuation\">.</span>put_line <span class=\"token punctuation\">(</span><span class=\"token string\">'El tablespace '</span> <span class=\"token operator\">||</span> p_tablespace <span class=\"token operator\">||</span> <span class=\"token string\">' lo tienen '</span> <span class=\"token operator\">||</span> v_num <span class=\"token operator\">||</span> <span class=\"token string\">' usuarios.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">end</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token operator\">/</span></pre></td></tr></table></figure><p><img src=\"/images/oracle-ejercicio4.png\" alt=\"remoto\"></p>\n<h3 id=\"6-hacer-un-procedimiento-llamado-mostrar_usuarios_por_tablespace-que-muestre-por-pantalla-un-listado-de-los-tablespaces-existentes-con-la-lista-de-usuarios-de-cada-uno-y-el-número-de-los-mismos-así-vistas-dba_tablespaces-y-dba_users\"><a class=\"markdownIt-Anchor\" href=\"#6-hacer-un-procedimiento-llamado-mostrar_usuarios_por_tablespace-que-muestre-por-pantalla-un-listado-de-los-tablespaces-existentes-con-la-lista-de-usuarios-de-cada-uno-y-el-número-de-los-mismos-así-vistas-dba_tablespaces-y-dba_users\">#</a> 6. Hacer un procedimiento llamado mostrar_usuarios_por_tablespace que muestre por pantalla un listado de los tablespaces existentes con la lista de usuarios de cada uno y el número de los mismos, así: (Vistas DBA_TABLESPACES y DBA_USERS)</h3>\n<p>En  este ejercicio en concreto utilizaremos una función creada en el anterior ejercicio para este propósito.</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">create</span> <span class=\"token operator\">or</span> <span class=\"token keyword\">replace</span> <span class=\"token keyword\">procedure</span> mostrar_usuarios_por_tablespace</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">is</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">cursor</span> c_tablespace <span class=\"token operator\">is</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">select</span> <span class=\"token keyword\">DISTINCT</span> DEFAULT_TABLESPACE <span class=\"token keyword\">from</span> DBA_USERS<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">for</span> v_tablespace <span class=\"token operator\">in</span> c_tablespace <span class=\"token keyword\">loop</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>dbms_output<span class=\"token punctuation\">.</span>put_line<span class=\"token punctuation\">(</span><span class=\"token string\">'Tablespace '</span> <span class=\"token operator\">||</span> v_tablespace<span class=\"token punctuation\">.</span>DEFAULT_TABLESPACE <span class=\"token operator\">||</span> <span class=\"token string\">':'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>MOSTRARUSUARIOS<span class=\"token punctuation\">(</span>v_tablespace<span class=\"token punctuation\">.</span>DEFAULT_TABLESPACE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>dbms_output<span class=\"token punctuation\">.</span>put_line<span class=\"token punctuation\">(</span><span class=\"token string\">'Total Usuarios Tablespace '</span><span class=\"token operator\">||</span> v_tablespace<span class=\"token punctuation\">.</span>DEFAULT_TABLESPACE <span class=\"token operator\">||</span> <span class=\"token string\">': '</span> <span class=\"token operator\">||</span> tablespacedefecto<span class=\"token punctuation\">(</span>v_tablespace<span class=\"token punctuation\">.</span>DEFAULT_TABLESPACE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">end</span> <span class=\"token keyword\">loop</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">end</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token operator\">/</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token operator\">OR</span> <span class=\"token keyword\">REPLACE</span> <span class=\"token keyword\">PROCEDURE</span> MOSTRARUSUARIOS <span class=\"token punctuation\">(</span>p_tablespace <span class=\"token operator\">in</span> <span class=\"token keyword\">out</span> varchar2<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token operator\">is</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">cursor</span> c_nombre <span class=\"token operator\">is</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">select</span> USERNAME <span class=\"token keyword\">FROM</span> DBA_USERS <span class=\"token keyword\">WHERE</span> DEFAULT_TABLESPACE<span class=\"token operator\">=</span>p_tablespace<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">FOR</span> v_nombre <span class=\"token operator\">in</span> c_nombre <span class=\"token keyword\">loop</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    dbms_output<span class=\"token punctuation\">.</span>put_line<span class=\"token punctuation\">(</span><span class=\"token string\">'Usuario '</span> <span class=\"token operator\">||</span> v_nombre<span class=\"token punctuation\">.</span>USERNAME <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token keyword\">end</span> <span class=\"token keyword\">loop</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">end</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token operator\">/</span></pre></td></tr></table></figure><p><img src=\"/images/oracle-ejercicio6.png\" alt=\"remoto\"></p>\n<h3 id=\"7-hacer-un-procedimiento-llamado-mostrar_codigo_fuente-que-reciba-el-nombre-de-otro-procedimiento-y-muestre-su-código-fuente-dba_source\"><a class=\"markdownIt-Anchor\" href=\"#7-hacer-un-procedimiento-llamado-mostrar_codigo_fuente-que-reciba-el-nombre-de-otro-procedimiento-y-muestre-su-código-fuente-dba_source\">#</a> 7. Hacer un procedimiento llamado mostrar_codigo_fuente  que reciba el nombre de otro procedimiento y muestre su código fuente. (DBA_SOURCE)</h3>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">create</span> <span class=\"token operator\">or</span> <span class=\"token keyword\">replace</span> <span class=\"token keyword\">procedure</span> mostrar_codigo_fuente <span class=\"token punctuation\">(</span>p_procedimiento varchar2<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">IS</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">cursor</span> c_fuente <span class=\"token operator\">is</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">select</span> <span class=\"token keyword\">text</span> <span class=\"token keyword\">from</span> DBA_SOURCE <span class=\"token keyword\">where</span> NAME<span class=\"token operator\">=</span>p_procedimiento<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">FOR</span> v_fuente <span class=\"token operator\">in</span> c_fuente <span class=\"token keyword\">loop</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    dbms_output<span class=\"token punctuation\">.</span>put_line<span class=\"token punctuation\">(</span>v_fuente<span class=\"token punctuation\">.</span><span class=\"token keyword\">text</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">end</span> <span class=\"token keyword\">loop</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">end</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token operator\">/</span></pre></td></tr></table></figure><p><img src=\"/images/oracle-ejercicio7.png\" alt=\"remoto\"></p>\n<h3 id=\"8-hacer-un-procedimiento-llamado-mostrar_privilegios_usuario-que-reciba-el-nombre-de-un-usuario-y-muestre-sus-privilegios-de-sistema-y-sus-privilegios-sobre-objetos-dba_sys_privs-y-dba_tab_privs\"><a class=\"markdownIt-Anchor\" href=\"#8-hacer-un-procedimiento-llamado-mostrar_privilegios_usuario-que-reciba-el-nombre-de-un-usuario-y-muestre-sus-privilegios-de-sistema-y-sus-privilegios-sobre-objetos-dba_sys_privs-y-dba_tab_privs\">#</a> 8. Hacer un procedimiento llamado mostrar_privilegios_usuario que reciba el nombre de un usuario y muestre sus privilegios de sistema y sus privilegios sobre objetos. (DBA_SYS_PRIVS y DBA_TAB_PRIVS)</h3>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token operator\">OR</span> <span class=\"token keyword\">REPLACE</span> <span class=\"token keyword\">PROCEDURE</span> mostrar_privilegios_usuario <span class=\"token punctuation\">(</span>p_usuario DBA_USERS<span class=\"token punctuation\">.</span>USERNAME<span class=\"token operator\">%</span><span class=\"token keyword\">TYPE</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">is</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">cursor</span> c_sistema <span class=\"token operator\">is</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">SELECT</span> GRANTEE<span class=\"token punctuation\">,</span>PRIVILEGE <span class=\"token keyword\">FROM</span> DBA_SYS_PRIVS <span class=\"token keyword\">WHERE</span> GRANTEE<span class=\"token operator\">=</span>p_usuario<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">cursor</span> c_objeto <span class=\"token operator\">is</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">SELECT</span> GRANTEE<span class=\"token punctuation\">,</span>PRIVILEGE <span class=\"token keyword\">FROM</span> DBA_TAB_PRIVS <span class=\"token keyword\">WHERE</span> GRANTEE<span class=\"token operator\">=</span>p_usuario<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">FOR</span> v_sistema <span class=\"token operator\">in</span> c_sistema <span class=\"token keyword\">loop</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    dbms_output<span class=\"token punctuation\">.</span>put_line<span class=\"token punctuation\">(</span><span class=\"token string\">'Privilegio de sistema: '</span> <span class=\"token operator\">||</span> v_sistema<span class=\"token punctuation\">.</span>PRIVILEGE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">end</span> <span class=\"token keyword\">loop</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">FOR</span> v_objeto <span class=\"token operator\">in</span> c_objeto <span class=\"token keyword\">loop</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    dbms_output<span class=\"token punctuation\">.</span>put_line<span class=\"token punctuation\">(</span><span class=\"token string\">'Privilegiode objetos: '</span> <span class=\"token operator\">||</span> v_objeto<span class=\"token punctuation\">.</span>PRIVILEGE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">end</span> <span class=\"token keyword\">loop</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token operator\">/</span></pre></td></tr></table></figure><p><img src=\"/images/oracle-ejercicio8.png\" alt=\"remoto\"></p>\n<h3 id=\"9-realiza-un-procedimiento-llamado-listar_comisiones-que-nos-muestre-por-pantalla-un-listado-de-las-comisiones-de-los-empleados-agrupados-según-la-localidad-donde-está-ubicado-su-departamento-con-el-siguiente-formato\"><a class=\"markdownIt-Anchor\" href=\"#9-realiza-un-procedimiento-llamado-listar_comisiones-que-nos-muestre-por-pantalla-un-listado-de-las-comisiones-de-los-empleados-agrupados-según-la-localidad-donde-está-ubicado-su-departamento-con-el-siguiente-formato\">#</a> 9. Realiza un procedimiento llamado listar_comisiones que nos muestre por pantalla un listado de las comisiones de los empleados agrupados según la localidad donde está ubicado su departamento con el siguiente formato:</h3>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token operator\">OR</span> <span class=\"token keyword\">REPLACE</span> <span class=\"token keyword\">PROCEDURE</span> Listar_comisiones</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">IS</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">cursor</span> c_localidad <span class=\"token operator\">is</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">select</span> dname<span class=\"token punctuation\">,</span>loc <span class=\"token keyword\">from</span> dept<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>v_total number<span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">select</span> <span class=\"token function\">sum</span><span class=\"token punctuation\">(</span>comm<span class=\"token punctuation\">)</span> <span class=\"token keyword\">into</span> v_total <span class=\"token keyword\">from</span> emp<span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">FOR</span> v_localidad <span class=\"token operator\">in</span> c_localidad <span class=\"token keyword\">loop</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    dbms_output<span class=\"token punctuation\">.</span>put_line<span class=\"token punctuation\">(</span><span class=\"token string\">'Localidad: '</span> <span class=\"token operator\">||</span> v_localidad<span class=\"token punctuation\">.</span>loc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    dbms_output<span class=\"token punctuation\">.</span>put_line<span class=\"token punctuation\">(</span><span class=\"token string\">'Departamento: '</span> <span class=\"token operator\">||</span> v_localidad<span class=\"token punctuation\">.</span>dname<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    MOSTRARCOMISIONES<span class=\"token punctuation\">(</span>v_localidad<span class=\"token punctuation\">.</span>loc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">end</span> <span class=\"token keyword\">loop</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>dbms_output<span class=\"token punctuation\">.</span>put_line<span class=\"token punctuation\">(</span><span class=\"token string\">'Total comisiones en la empresa es de: '</span> <span class=\"token operator\">||</span> v_total<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>exception</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">WHEN</span> NO_DATA_FOUND <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>dbms_output<span class=\"token punctuation\">.</span>put_line<span class=\"token punctuation\">(</span><span class=\"token string\">'Hay tablas vacías'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">end</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token operator\">/</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token operator\">OR</span> <span class=\"token keyword\">REPLACE</span> <span class=\"token keyword\">PROCEDURE</span> MOSTRARCOMISIONES <span class=\"token punctuation\">(</span>p_localidad <span class=\"token operator\">in</span> <span class=\"token keyword\">out</span> varchar2<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token operator\">IS</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token keyword\">cursor</span> c_comisiones <span class=\"token operator\">is</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">select</span> ename<span class=\"token punctuation\">,</span>comm <span class=\"token keyword\">from</span> emp <span class=\"token keyword\">where</span> deptno <span class=\"token operator\">in</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">select</span> deptno <span class=\"token keyword\">from</span> dept <span class=\"token keyword\">where</span> loc <span class=\"token operator\">=</span> p_localidad<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>v_total number<span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">select</span> <span class=\"token function\">sum</span><span class=\"token punctuation\">(</span>comm<span class=\"token punctuation\">)</span> <span class=\"token keyword\">into</span> v_total <span class=\"token keyword\">from</span> emp <span class=\"token keyword\">where</span> deptno <span class=\"token operator\">in</span>  <span class=\"token punctuation\">(</span><span class=\"token keyword\">select</span> deptno <span class=\"token keyword\">from</span> dept <span class=\"token keyword\">where</span> loc <span class=\"token operator\">=</span> p_localidad<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token keyword\">FOR</span> v_empleado <span class=\"token operator\">in</span> c_comisiones <span class=\"token keyword\">loop</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    dbms_output<span class=\"token punctuation\">.</span>put_line<span class=\"token punctuation\">(</span><span class=\"token string\">'Empleado: '</span> <span class=\"token operator\">||</span> v_empleado<span class=\"token punctuation\">.</span>ename <span class=\"token operator\">||</span> <span class=\"token string\">'..................'</span> <span class=\"token operator\">||</span> v_empleado<span class=\"token punctuation\">.</span>comm<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">if</span> v_empleado<span class=\"token punctuation\">.</span>comm <span class=\"token operator\">></span> <span class=\"token number\">10000</span> <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        raise_application_error<span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">20001</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Hay algún empleado con más de 10.000 de comisión'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">end</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token keyword\">end</span> <span class=\"token keyword\">loop</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>dbms_output<span class=\"token punctuation\">.</span>put_line<span class=\"token punctuation\">(</span><span class=\"token string\">'Total comisiones departamento: '</span> <span class=\"token operator\">||</span> p_localidad <span class=\"token operator\">||</span> <span class=\"token string\">' es de: '</span> <span class=\"token operator\">||</span> v_total<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token operator\">/</span></pre></td></tr></table></figure><p>Podemos ver en la imagen que se produce un raise ya que hay un usuario con más de 10.000 de comm.</p>\n<p><img src=\"/images/oracle-ejercicio9.png\" alt=\"remoto\"></p>\n<h3 id=\"10-realiza-un-procedimiento-que-reciba-el-nombre-de-una-tabla-y-muestre-los-nombres-de-las-restricciones-que-tiene-a-qué-columna-afectan-y-en-qué-consisten-exactamente-dba_tables-dba_constraints-dba_cons_columns\"><a class=\"markdownIt-Anchor\" href=\"#10-realiza-un-procedimiento-que-reciba-el-nombre-de-una-tabla-y-muestre-los-nombres-de-las-restricciones-que-tiene-a-qué-columna-afectan-y-en-qué-consisten-exactamente-dba_tables-dba_constraints-dba_cons_columns\">#</a> 10. Realiza un procedimiento que reciba el nombre de una tabla y muestre los nombres de las restricciones que tiene, a qué columna afectan y en qué consisten exactamente. (DBA_TABLES, DBA_CONSTRAINTS, DBA_CONS_COLUMNS)</h3>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">SELECT</span> CONSTRAINT_NAME<span class=\"token punctuation\">,</span>CONSTRAINT_TYPE<span class=\"token punctuation\">,</span>SEARCH_CONDITION_VC <span class=\"token keyword\">FROM</span> DBA_CONSTRAINTS <span class=\"token keyword\">WHERE</span> TABLE_NAME<span class=\"token operator\">=</span><span class=\"token string\">'EQUIPAR'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">SELECT</span> CONSTRAINT_NAME<span class=\"token punctuation\">,</span>COLUMN_NAME <span class=\"token keyword\">FROM</span> DBA_CONS_COLUMNS <span class=\"token keyword\">WHERE</span> TABLE_NAME <span class=\"token operator\">=</span> <span class=\"token string\">'PERSONAJE'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token operator\">OR</span> <span class=\"token keyword\">REPLACE</span> <span class=\"token keyword\">PROCEDURE</span> MOSTRARRESTRICCIONES <span class=\"token punctuation\">(</span>p_tabla varchar2<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token operator\">is</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>v_tabla varchar2<span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>v_tabla:<span class=\"token operator\">=</span>p_tabla<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>MOSTRARCONSSYS <span class=\"token punctuation\">(</span>v_tabla<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>MOSTRARCONSTABS <span class=\"token punctuation\">(</span>v_tabla<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">end</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token operator\">/</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token operator\">OR</span> <span class=\"token keyword\">REPLACE</span> <span class=\"token keyword\">PROCEDURE</span> MOSTRARCONSSYS <span class=\"token punctuation\">(</span>p_tabla <span class=\"token operator\">in</span> <span class=\"token keyword\">out</span> varchar2<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token operator\">IS</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">cursor</span> c_system <span class=\"token operator\">is</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">SELECT</span> CONSTRAINT_NAME<span class=\"token punctuation\">,</span>CONSTRAINT_TYPE<span class=\"token punctuation\">,</span>SEARCH_CONDITION_VC <span class=\"token keyword\">FROM</span> DBA_CONSTRAINTS <span class=\"token keyword\">WHERE</span> TABLE_NAME<span class=\"token operator\">=</span>p_tabla<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">FOR</span> v_system <span class=\"token operator\">in</span> c_system <span class=\"token keyword\">loop</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    dbms_output<span class=\"token punctuation\">.</span>put_line<span class=\"token punctuation\">(</span>v_system<span class=\"token punctuation\">.</span>CONSTRAINT_NAME <span class=\"token operator\">||</span> <span class=\"token string\">'Tipo de restricción: '</span> <span class=\"token operator\">||</span> v_system<span class=\"token punctuation\">.</span>CONSTRAINT_TYPE <span class=\"token operator\">||</span> v_system<span class=\"token punctuation\">.</span>SEARCH_CONDITION_VC<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token keyword\">end</span> <span class=\"token keyword\">loop</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token operator\">/</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token operator\">OR</span> <span class=\"token keyword\">REPLACE</span> <span class=\"token keyword\">PROCEDURE</span> MOSTRARCONSTABS <span class=\"token punctuation\">(</span>p_tabla <span class=\"token operator\">in</span> <span class=\"token keyword\">out</span> varchar2<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token operator\">IS</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token keyword\">cursor</span> c_tabs <span class=\"token operator\">is</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token keyword\">SELECT</span> CONSTRAINT_NAME<span class=\"token punctuation\">,</span>COLUMN_NAME <span class=\"token keyword\">FROM</span> DBA_CONS_COLUMNS <span class=\"token keyword\">WHERE</span> TABLE_NAME <span class=\"token operator\">=</span> p_tabla<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token keyword\">FOR</span> v_tabs <span class=\"token operator\">in</span> c_tabs <span class=\"token keyword\">loop</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    dbms_output<span class=\"token punctuation\">.</span>put_line<span class=\"token punctuation\">(</span><span class=\"token string\">'Restricción: '</span> <span class=\"token operator\">||</span> v_tabs<span class=\"token punctuation\">.</span>CONSTRAINT_NAME <span class=\"token operator\">||</span> <span class=\"token string\">' y la columna a la que hace referencia es: '</span> <span class=\"token operator\">||</span> v_tabs<span class=\"token punctuation\">.</span>COLUMN_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token keyword\">end</span> <span class=\"token keyword\">loop</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token operator\">/</span></pre></td></tr></table></figure><p><img src=\"/images/oracle-ejercicio10.png\" alt=\"remoto\"></p>\n<h2 id=\"postgresql\"><a class=\"markdownIt-Anchor\" href=\"#postgresql\">#</a> POSTGRESQL</h2>\n<p>Comenzaremos adjuntando el script de creación de tablas e inserciones de Postgres:</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> dept<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  deptno   <span class=\"token keyword\">decimal</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  dname    <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">14</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  loc      <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">13</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> emp<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  empno    <span class=\"token keyword\">decimal</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  ename    <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  job      <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">9</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  mgr      <span class=\"token keyword\">decimal</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  hiredate <span class=\"token keyword\">date</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  sal      <span class=\"token keyword\">decimal</span><span class=\"token punctuation\">(</span><span class=\"token number\">7</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  comm     <span class=\"token keyword\">decimal</span><span class=\"token punctuation\">(</span><span class=\"token number\">7</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  deptno   <span class=\"token keyword\">decimal</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> bonus<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  ename    <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  job      <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">9</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  sal      <span class=\"token keyword\">decimal</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  comm     <span class=\"token keyword\">decimal</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> salgrade<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  grade    <span class=\"token keyword\">decimal</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  losal    <span class=\"token keyword\">decimal</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  hisal    <span class=\"token keyword\">decimal</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> <span class=\"token keyword\">dummy</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token keyword\">dummy</span>    <span class=\"token keyword\">decimal</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token keyword\">insert</span> <span class=\"token keyword\">into</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">values</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">insert</span> <span class=\"token keyword\">into</span> DEPT <span class=\"token punctuation\">(</span>DEPTNO<span class=\"token punctuation\">,</span> DNAME<span class=\"token punctuation\">,</span> LOC<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ACCOUNTING'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'NEW YORK'</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'RESEARCH'</span><span class=\"token punctuation\">,</span>   <span class=\"token string\">'DALLAS'</span>   <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SALES'</span><span class=\"token punctuation\">,</span>      <span class=\"token string\">'CHICAGO'</span>  <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">40</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'OPERATIONS'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'BOSTON'</span>   <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token keyword\">insert</span> <span class=\"token keyword\">into</span> emp <span class=\"token punctuation\">(</span>EMPNO<span class=\"token punctuation\">,</span> ENAME<span class=\"token punctuation\">,</span> JOB<span class=\"token punctuation\">,</span> MGR<span class=\"token punctuation\">,</span> HIREDATE<span class=\"token punctuation\">,</span> SAL<span class=\"token punctuation\">,</span> COMM<span class=\"token punctuation\">,</span> DEPTNO<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">7839</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'KING'</span><span class=\"token punctuation\">,</span>   <span class=\"token string\">'PRESIDENT'</span><span class=\"token punctuation\">,</span> cast<span class=\"token punctuation\">(</span><span class=\"token boolean\">null</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">integer</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> to_date<span class=\"token punctuation\">(</span><span class=\"token string\">'17-11-1981'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'dd-mm-yyyy'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>    <span class=\"token number\">5000</span><span class=\"token punctuation\">,</span> cast<span class=\"token punctuation\">(</span><span class=\"token boolean\">null</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">integer</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">7698</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'BLAKE'</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">'MANAGER'</span><span class=\"token punctuation\">,</span>   <span class=\"token number\">7839</span><span class=\"token punctuation\">,</span> to_date<span class=\"token punctuation\">(</span><span class=\"token string\">'1-5-1981'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'dd-mm-yyyy'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>      <span class=\"token number\">2850</span><span class=\"token punctuation\">,</span> cast<span class=\"token punctuation\">(</span><span class=\"token boolean\">null</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">integer</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">7782</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CLARK'</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">'MANAGER'</span><span class=\"token punctuation\">,</span>   <span class=\"token number\">7839</span><span class=\"token punctuation\">,</span> to_date<span class=\"token punctuation\">(</span><span class=\"token string\">'9-6-1981'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'dd-mm-yyyy'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>      <span class=\"token number\">2450</span><span class=\"token punctuation\">,</span> cast<span class=\"token punctuation\">(</span><span class=\"token boolean\">null</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">integer</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">7566</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'JONES'</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">'MANAGER'</span><span class=\"token punctuation\">,</span>   <span class=\"token number\">7839</span><span class=\"token punctuation\">,</span> to_date<span class=\"token punctuation\">(</span><span class=\"token string\">'2-4-1981'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'dd-mm-yyyy'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>      <span class=\"token number\">2975</span><span class=\"token punctuation\">,</span> cast<span class=\"token punctuation\">(</span><span class=\"token boolean\">null</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">integer</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">7788</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SCOTT'</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">'ANALYST'</span><span class=\"token punctuation\">,</span>   <span class=\"token number\">7566</span><span class=\"token punctuation\">,</span> to_date<span class=\"token punctuation\">(</span><span class=\"token string\">'13-7-87'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'dd-mm-rr'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">85</span><span class=\"token punctuation\">,</span>  <span class=\"token number\">3000</span><span class=\"token punctuation\">,</span> cast<span class=\"token punctuation\">(</span><span class=\"token boolean\">null</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">integer</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">7902</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'FORD'</span><span class=\"token punctuation\">,</span>   <span class=\"token string\">'ANALYST'</span><span class=\"token punctuation\">,</span>   <span class=\"token number\">7566</span><span class=\"token punctuation\">,</span> to_date<span class=\"token punctuation\">(</span><span class=\"token string\">'3-12-1981'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'dd-mm-yyyy'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>     <span class=\"token number\">3000</span><span class=\"token punctuation\">,</span> cast<span class=\"token punctuation\">(</span><span class=\"token boolean\">null</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">integer</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">7369</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SMITH'</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">'CLERK'</span><span class=\"token punctuation\">,</span>     <span class=\"token number\">7902</span><span class=\"token punctuation\">,</span> to_date<span class=\"token punctuation\">(</span><span class=\"token string\">'17-12-1980'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'dd-mm-yyyy'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>     <span class=\"token number\">800</span><span class=\"token punctuation\">,</span> cast<span class=\"token punctuation\">(</span><span class=\"token boolean\">null</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">integer</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">7499</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ALLEN'</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">'SALESMAN'</span><span class=\"token punctuation\">,</span>  <span class=\"token number\">7698</span><span class=\"token punctuation\">,</span> to_date<span class=\"token punctuation\">(</span><span class=\"token string\">'20-2-1981'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'dd-mm-yyyy'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>     <span class=\"token number\">1600</span><span class=\"token punctuation\">,</span>  <span class=\"token number\">300</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">7521</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'WARD'</span><span class=\"token punctuation\">,</span>   <span class=\"token string\">'SALESMAN'</span><span class=\"token punctuation\">,</span>  <span class=\"token number\">7698</span><span class=\"token punctuation\">,</span> to_date<span class=\"token punctuation\">(</span><span class=\"token string\">'22-2-1981'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'dd-mm-yyyy'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>     <span class=\"token number\">1250</span><span class=\"token punctuation\">,</span>  <span class=\"token number\">500</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">7654</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'MARTIN'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SALESMAN'</span><span class=\"token punctuation\">,</span>  <span class=\"token number\">7698</span><span class=\"token punctuation\">,</span> to_date<span class=\"token punctuation\">(</span><span class=\"token string\">'28-9-1981'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'dd-mm-yyyy'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>     <span class=\"token number\">1250</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1400</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">7844</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'TURNER'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SALESMAN'</span><span class=\"token punctuation\">,</span>  <span class=\"token number\">7698</span><span class=\"token punctuation\">,</span> to_date<span class=\"token punctuation\">(</span><span class=\"token string\">'8-9-1981'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'dd-mm-yyyy'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>      <span class=\"token number\">1500</span><span class=\"token punctuation\">,</span>    <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">7876</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ADAMS'</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">'CLERK'</span><span class=\"token punctuation\">,</span>     <span class=\"token number\">7788</span><span class=\"token punctuation\">,</span> to_date<span class=\"token punctuation\">(</span><span class=\"token string\">'13-7-87'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'dd-mm-rr'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">51</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1100</span><span class=\"token punctuation\">,</span> cast<span class=\"token punctuation\">(</span><span class=\"token boolean\">null</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">integer</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">7900</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'JAMES'</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">'CLERK'</span><span class=\"token punctuation\">,</span>     <span class=\"token number\">7698</span><span class=\"token punctuation\">,</span> to_date<span class=\"token punctuation\">(</span><span class=\"token string\">'3-12-1981'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'dd-mm-yyyy'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>      <span class=\"token number\">950</span><span class=\"token punctuation\">,</span> cast<span class=\"token punctuation\">(</span><span class=\"token boolean\">null</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">integer</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">7934</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'MILLER'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CLERK'</span><span class=\"token punctuation\">,</span>     <span class=\"token number\">7782</span><span class=\"token punctuation\">,</span> to_date<span class=\"token punctuation\">(</span><span class=\"token string\">'23-1-1982'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'dd-mm-yyyy'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>     <span class=\"token number\">1300</span><span class=\"token punctuation\">,</span> cast<span class=\"token punctuation\">(</span><span class=\"token boolean\">null</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">integer</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token keyword\">insert</span> <span class=\"token keyword\">into</span> salgrade</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>  <span class=\"token number\">700</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1200</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1201</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1400</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1401</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2000</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2001</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3000</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3001</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9999</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token keyword\">commit</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"1-hacer-un-procedimiento-que-muestre-el-nombre-y-el-salario-del-empleado-cuyo-código-es-7082-2\"><a class=\"markdownIt-Anchor\" href=\"#1-hacer-un-procedimiento-que-muestre-el-nombre-y-el-salario-del-empleado-cuyo-código-es-7082-2\">#</a> 1. Hacer un procedimiento que muestre el nombre y el salario del empleado cuyo código es 7082</h3>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token operator\">or</span> <span class=\"token keyword\">replace</span> <span class=\"token keyword\">PROCEDURE</span> mostrar_7082<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">AS</span> $$</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">DECLARE</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    v_nombre emp<span class=\"token punctuation\">.</span>ename<span class=\"token operator\">%</span><span class=\"token keyword\">type</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    v_salario emp<span class=\"token punctuation\">.</span>sal<span class=\"token operator\">%</span><span class=\"token keyword\">type</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">select</span> ename<span class=\"token punctuation\">,</span>sal <span class=\"token keyword\">into</span> v_nombre<span class=\"token punctuation\">,</span>v_salario <span class=\"token keyword\">from</span> emp <span class=\"token keyword\">where</span> empno<span class=\"token operator\">=</span><span class=\"token number\">7782</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    RAISE NOTICE <span class=\"token string\">'El nombre del empleado es %, y su salario es %'</span><span class=\"token punctuation\">,</span> v_nombre<span class=\"token punctuation\">,</span>v_salario<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>$$ <span class=\"token keyword\">LANGUAGE</span> plpgsql<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><img src=\"/images/postgres-ejercicio2.png\" alt=\"remoto\"></p>\n<h3 id=\"2-hacer-un-procedimiento-que-reciba-como-parámetro-un-código-de-empleado-y-devuelva-su-nombre-2\"><a class=\"markdownIt-Anchor\" href=\"#2-hacer-un-procedimiento-que-reciba-como-parámetro-un-código-de-empleado-y-devuelva-su-nombre-2\">#</a> 2. Hacer un procedimiento que reciba como parámetro un código de empleado y devuelva su nombre</h3>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">Create</span> <span class=\"token operator\">or</span> <span class=\"token keyword\">replace</span> <span class=\"token keyword\">procedure</span> codigoanombreemp <span class=\"token punctuation\">(</span>p_codempleado emp<span class=\"token punctuation\">.</span>empno<span class=\"token operator\">%</span><span class=\"token keyword\">type</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">AS</span> $$</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">DECLARE</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    v_nombre emp<span class=\"token punctuation\">.</span>ename<span class=\"token operator\">%</span><span class=\"token keyword\">type</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">select</span> ename <span class=\"token keyword\">into</span> v_nombre <span class=\"token keyword\">from</span> emp <span class=\"token keyword\">where</span> empno<span class=\"token operator\">=</span>p_codempleado<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    RAISE NOTICE <span class=\"token string\">'El empleado con el código %, es %'</span><span class=\"token punctuation\">,</span> p_codempleado<span class=\"token punctuation\">,</span>v_nombre<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>$$ <span class=\"token keyword\">LANGUAGE</span> plpgsql<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><img src=\"/images/postgres-ejercicio1.png\" alt=\"remoto\"></p>\n","site":{"data":{}},"length":11502,"excerpt":"","more":"<p><img src=\"/images/oraclepostgres.jpg\" alt=\"remoto\"></p>\n<h2 id=\"oracle\"><a class=\"markdownIt-Anchor\" href=\"#oracle\">#</a> ORACLE</h2>\n<p>Comenzaremos adjuntando el script de creación de tablas e inserciones de Oracle:</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> DEPT</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> DEPTNO NUMBER<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> DNAME VARCHAR2<span class=\"token punctuation\">(</span><span class=\"token number\">14</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre> LOC VARCHAR2<span class=\"token punctuation\">(</span><span class=\"token number\">13</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> <span class=\"token keyword\">CONSTRAINT</span> PK_DEPT <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span>DEPTNO<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> EMP</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre> EMPNO NUMBER<span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre> ENAME VARCHAR2<span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre> JOB VARCHAR2<span class=\"token punctuation\">(</span><span class=\"token number\">9</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre> MGR NUMBER<span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre> HIREDATE <span class=\"token keyword\">DATE</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre> SAL NUMBER<span class=\"token punctuation\">(</span><span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre> COMM NUMBER<span class=\"token punctuation\">(</span><span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre> DEPTNO NUMBER<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre> <span class=\"token keyword\">CONSTRAINT</span> FK_DEPTNO <span class=\"token keyword\">FOREIGN</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span>DEPTNO<span class=\"token punctuation\">)</span> <span class=\"token keyword\">REFERENCES</span> DEPT <span class=\"token punctuation\">(</span>DEPTNO<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre> <span class=\"token keyword\">CONSTRAINT</span> PK_EMP <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span>EMPNO<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> DEPT <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ACCOUNTING'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'NEW YORK'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> DEPT <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'RESEARCH'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DALLAS'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> DEPT <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SALES'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CHICAGO'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> DEPT <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">40</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'OPERATIONS'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'BOSTON'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> EMP <span class=\"token keyword\">VALUES</span><span class=\"token punctuation\">(</span><span class=\"token number\">7369</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SMITH'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CLERK'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7902</span><span class=\"token punctuation\">,</span>TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'17-DIC-1980'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DD-MON-YYYY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">800</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> EMP <span class=\"token keyword\">VALUES</span><span class=\"token punctuation\">(</span><span class=\"token number\">7499</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ALLEN'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SALESMAN'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7698</span><span class=\"token punctuation\">,</span>TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'20-FEB-1981'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DD-MON-YYYY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1600</span><span class=\"token punctuation\">,</span> <span class=\"token number\">300</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> EMP <span class=\"token keyword\">VALUES</span><span class=\"token punctuation\">(</span><span class=\"token number\">7521</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'WARD'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SALESMAN'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7698</span><span class=\"token punctuation\">,</span>TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'22-FEB-1981'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DD-MON-YYYY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1250</span><span class=\"token punctuation\">,</span> <span class=\"token number\">500</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> EMP <span class=\"token keyword\">VALUES</span><span class=\"token punctuation\">(</span><span class=\"token number\">7566</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'JONES'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'MANAGER'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7839</span><span class=\"token punctuation\">,</span>TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'2-ABR-1981'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DD-MON-YYYY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2975</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> EMP <span class=\"token keyword\">VALUES</span><span class=\"token punctuation\">(</span><span class=\"token number\">7654</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'MARTIN'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SALESMAN'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7698</span><span class=\"token punctuation\">,</span>TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'28-SEP-1981'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DD-MON-YYYY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1250</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1400</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> EMP <span class=\"token keyword\">VALUES</span><span class=\"token punctuation\">(</span><span class=\"token number\">7698</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'BLAKE'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'MANAGER'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7839</span><span class=\"token punctuation\">,</span>TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'1-MAY-1981'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DD-MON-YYYY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2850</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> EMP <span class=\"token keyword\">VALUES</span><span class=\"token punctuation\">(</span><span class=\"token number\">7782</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CLARK'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'MANAGER'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7839</span><span class=\"token punctuation\">,</span>TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'9-JUN-1981'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DD-MON-YYYY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2450</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> EMP <span class=\"token keyword\">VALUES</span><span class=\"token punctuation\">(</span><span class=\"token number\">7788</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SCOTT'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ANALYST'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7566</span><span class=\"token punctuation\">,</span>TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'09-DIC-1982'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DD-MON-YYYY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> EMP <span class=\"token keyword\">VALUES</span><span class=\"token punctuation\">(</span><span class=\"token number\">7839</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'KING'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'PRESIDENT'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'17-NOV-1981'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DD-MON-YYYY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5000</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> EMP <span class=\"token keyword\">VALUES</span><span class=\"token punctuation\">(</span><span class=\"token number\">7844</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'TURNER'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SALESMAN'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7698</span><span class=\"token punctuation\">,</span>TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'8-SEP-1981'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DD-MON-YYYY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1500</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> EMP <span class=\"token keyword\">VALUES</span><span class=\"token punctuation\">(</span><span class=\"token number\">7876</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ADAMS'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CLERK'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7788</span><span class=\"token punctuation\">,</span>TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'12-ENE-1983'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DD-MON-YYYY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1100</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> EMP <span class=\"token keyword\">VALUES</span><span class=\"token punctuation\">(</span><span class=\"token number\">7900</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'JAMES'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CLERK'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7698</span><span class=\"token punctuation\">,</span>TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'3-DIC-1981'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DD-MON-YYYY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">950</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> EMP <span class=\"token keyword\">VALUES</span><span class=\"token punctuation\">(</span><span class=\"token number\">7902</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'FORD'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ANALYST'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7566</span><span class=\"token punctuation\">,</span>TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'3-DIC-1981'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DD-MON-YYYY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> EMP <span class=\"token keyword\">VALUES</span><span class=\"token punctuation\">(</span><span class=\"token number\">7934</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'MILLER'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CLERK'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7782</span><span class=\"token punctuation\">,</span>TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'23-ENE-1982'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DD-MON-YYYY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1300</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token keyword\">COMMIT</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"1-hacer-un-procedimiento-que-muestre-el-nombre-y-el-salario-del-empleado-cuyo-código-es-7082\"><a class=\"markdownIt-Anchor\" href=\"#1-hacer-un-procedimiento-que-muestre-el-nombre-y-el-salario-del-empleado-cuyo-código-es-7082\">#</a> 1. Hacer un procedimiento que muestre el nombre y el salario del empleado cuyo código es 7082</h3>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">create</span> <span class=\"token operator\">or</span> <span class=\"token keyword\">replace</span> <span class=\"token keyword\">procedure</span> mostrar_7082</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">IS</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    v_nombre emp<span class=\"token punctuation\">.</span>ename<span class=\"token operator\">%</span><span class=\"token keyword\">type</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    v_sal emp<span class=\"token punctuation\">.</span>sal<span class=\"token operator\">%</span><span class=\"token keyword\">type</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">select</span> ename<span class=\"token punctuation\">,</span>sal <span class=\"token keyword\">into</span> v_nombre<span class=\"token punctuation\">,</span>v_sal </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">from</span> emp</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">where</span> empno<span class=\"token operator\">=</span> <span class=\"token number\">7782</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    dbms_output<span class=\"token punctuation\">.</span>put_line<span class=\"token punctuation\">(</span><span class=\"token string\">'El nombre del empleado 7082 es '</span> <span class=\"token operator\">||</span> v_nombre <span class=\"token operator\">||</span> <span class=\"token string\">' y su salario es '</span> <span class=\"token operator\">||</span> v_sal <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token operator\">/</span></pre></td></tr></table></figure><p><img src=\"/images/oracle-ejercicio1.png\" alt=\"remoto\"></p>\n<h3 id=\"2-hacer-un-procedimiento-que-reciba-como-parámetro-un-código-de-empleado-y-devuelva-su-nombre\"><a class=\"markdownIt-Anchor\" href=\"#2-hacer-un-procedimiento-que-reciba-como-parámetro-un-código-de-empleado-y-devuelva-su-nombre\">#</a> 2. Hacer un procedimiento que reciba como parámetro un código de empleado y devuelva su nombre</h3>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">Create</span> <span class=\"token operator\">or</span> <span class=\"token keyword\">replace</span> <span class=\"token keyword\">procedure</span> codigoanombreemp <span class=\"token punctuation\">(</span>p_codempleado emp<span class=\"token punctuation\">.</span>empno<span class=\"token operator\">%</span><span class=\"token keyword\">type</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">IS</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    v_nombre emp<span class=\"token punctuation\">.</span>ename<span class=\"token operator\">%</span><span class=\"token keyword\">type</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">select</span> ename <span class=\"token keyword\">into</span> v_nombre <span class=\"token keyword\">from</span> emp <span class=\"token keyword\">where</span> empno<span class=\"token operator\">=</span>p_codempleado<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    dbms_output<span class=\"token punctuation\">.</span>put_line <span class=\"token punctuation\">(</span><span class=\"token string\">'El empleado con el código '</span> <span class=\"token operator\">||</span> p_codempleado <span class=\"token operator\">||</span> <span class=\"token string\">' es '</span> <span class=\"token operator\">||</span> v_nombre<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token operator\">/</span></pre></td></tr></table></figure><p><img src=\"/images/oracle-ejercicio2.png\" alt=\"remoto\"></p>\n<h3 id=\"3-hacer-un-procedimiento-que-devuelva-los-nombres-de-los-tres-empleados-más-antiguos\"><a class=\"markdownIt-Anchor\" href=\"#3-hacer-un-procedimiento-que-devuelva-los-nombres-de-los-tres-empleados-más-antiguos\">#</a> 3. Hacer un procedimiento que devuelva los nombres de los tres empleados más antiguos</h3>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">create</span> <span class=\"token operator\">or</span> <span class=\"token keyword\">replace</span> <span class=\"token keyword\">procedure</span> tresempleadosmasantiguos</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">IS</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">cursor</span> c_empleados <span class=\"token operator\">is</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">select</span> ename <span class=\"token keyword\">from</span> emp <span class=\"token keyword\">WHERE</span> ROWNUM <span class=\"token operator\">&lt;=</span> <span class=\"token number\">3</span> <span class=\"token keyword\">order</span> <span class=\"token keyword\">by</span> hiredate <span class=\"token keyword\">asc</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">FOR</span> v_empleados <span class=\"token operator\">in</span> c_empleados <span class=\"token keyword\">loop</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    dbms_output<span class=\"token punctuation\">.</span>put_line <span class=\"token punctuation\">(</span>v_empleados<span class=\"token punctuation\">.</span>ename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">end</span> <span class=\"token keyword\">loop</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token operator\">/</span></pre></td></tr></table></figure><p><img src=\"/images/oracle-ejercicio5.png\" alt=\"remoto\"></p>\n<h3 id=\"4-hacer-un-procedimiento-que-reciba-el-nombre-de-un-tablespace-y-muestre-los-nombres-de-los-usuarios-que-lo-tienen-como-tablespace-por-defecto-vista-dba_users\"><a class=\"markdownIt-Anchor\" href=\"#4-hacer-un-procedimiento-que-reciba-el-nombre-de-un-tablespace-y-muestre-los-nombres-de-los-usuarios-que-lo-tienen-como-tablespace-por-defecto-vista-dba_users\">#</a> 4. Hacer un procedimiento que reciba el nombre de un tablespace y muestre los nombres de los usuarios que lo tienen como tablespace por defecto (Vista DBA_USERS)</h3>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">create</span> <span class=\"token operator\">or</span> <span class=\"token keyword\">replace</span> <span class=\"token keyword\">procedure</span> tablespacedefecto <span class=\"token punctuation\">(</span>p_tablespace DBA_USERS<span class=\"token punctuation\">.</span>DEFAULT_TABLESPACE<span class=\"token operator\">%</span><span class=\"token keyword\">type</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">IS</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">cursor</span> c_tablespace <span class=\"token operator\">is</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">SELECT</span> USERNAME <span class=\"token keyword\">from</span> DBA_USERS <span class=\"token keyword\">where</span> DEFAULT_TABLESPACE<span class=\"token operator\">=</span>p_tablespace<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">FOR</span> v_usuarios <span class=\"token operator\">in</span> c_tablespace <span class=\"token keyword\">loop</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    dbms_output<span class=\"token punctuation\">.</span>put_line <span class=\"token punctuation\">(</span>v_usuarios<span class=\"token punctuation\">.</span>USERNAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">end</span> <span class=\"token keyword\">loop</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token operator\">/</span></pre></td></tr></table></figure><p><img src=\"/images/oracle-ejercicio3.png\" alt=\"remoto\"></p>\n<h3 id=\"5-modificar-el-procedimiento-anterior-para-que-haga-lo-mismo-pero-devolviendo-el-número-de-usuarios-que-tienen-ese-tablespace-como-tablespace-por-defecto-nota-hay-que-convertir-el-procedimiento-en-función\"><a class=\"markdownIt-Anchor\" href=\"#5-modificar-el-procedimiento-anterior-para-que-haga-lo-mismo-pero-devolviendo-el-número-de-usuarios-que-tienen-ese-tablespace-como-tablespace-por-defecto-nota-hay-que-convertir-el-procedimiento-en-función\">#</a> 5. Modificar el procedimiento anterior para que haga lo mismo pero devolviendo el número de usuarios que tienen ese tablespace como tablespace por defecto. Nota: Hay que convertir el procedimiento en función</h3>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">create</span> <span class=\"token operator\">or</span> <span class=\"token keyword\">replace</span> <span class=\"token keyword\">function</span> tablespacedefecto <span class=\"token punctuation\">(</span>p_tablespace DBA_USERS<span class=\"token punctuation\">.</span>DEFAULT_TABLESPACE<span class=\"token operator\">%</span><span class=\"token keyword\">type</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">return</span> number</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">IS</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>v_num number <span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">SELECT</span> <span class=\"token function\">count</span><span class=\"token punctuation\">(</span>USERNAME<span class=\"token punctuation\">)</span> <span class=\"token keyword\">into</span> v_num <span class=\"token keyword\">from</span> DBA_USERS <span class=\"token keyword\">where</span> DEFAULT_TABLESPACE<span class=\"token operator\">=</span>p_tablespace<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">return</span> v_num<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token operator\">/</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">create</span> <span class=\"token operator\">or</span> <span class=\"token keyword\">replace</span> <span class=\"token keyword\">procedure</span> mostrarfunciontablespacedefecto <span class=\"token punctuation\">(</span>p_tablespace DBA_USERS<span class=\"token punctuation\">.</span>DEFAULT_TABLESPACE<span class=\"token operator\">%</span><span class=\"token keyword\">type</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token operator\">is</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>v_num number<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    v_num:<span class=\"token operator\">=</span>tablespacedefecto<span class=\"token punctuation\">(</span>p_tablespace<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    dbms_output<span class=\"token punctuation\">.</span>put_line <span class=\"token punctuation\">(</span><span class=\"token string\">'El tablespace '</span> <span class=\"token operator\">||</span> p_tablespace <span class=\"token operator\">||</span> <span class=\"token string\">' lo tienen '</span> <span class=\"token operator\">||</span> v_num <span class=\"token operator\">||</span> <span class=\"token string\">' usuarios.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">end</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token operator\">/</span></pre></td></tr></table></figure><p><img src=\"/images/oracle-ejercicio4.png\" alt=\"remoto\"></p>\n<h3 id=\"6-hacer-un-procedimiento-llamado-mostrar_usuarios_por_tablespace-que-muestre-por-pantalla-un-listado-de-los-tablespaces-existentes-con-la-lista-de-usuarios-de-cada-uno-y-el-número-de-los-mismos-así-vistas-dba_tablespaces-y-dba_users\"><a class=\"markdownIt-Anchor\" href=\"#6-hacer-un-procedimiento-llamado-mostrar_usuarios_por_tablespace-que-muestre-por-pantalla-un-listado-de-los-tablespaces-existentes-con-la-lista-de-usuarios-de-cada-uno-y-el-número-de-los-mismos-así-vistas-dba_tablespaces-y-dba_users\">#</a> 6. Hacer un procedimiento llamado mostrar_usuarios_por_tablespace que muestre por pantalla un listado de los tablespaces existentes con la lista de usuarios de cada uno y el número de los mismos, así: (Vistas DBA_TABLESPACES y DBA_USERS)</h3>\n<p>En  este ejercicio en concreto utilizaremos una función creada en el anterior ejercicio para este propósito.</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">create</span> <span class=\"token operator\">or</span> <span class=\"token keyword\">replace</span> <span class=\"token keyword\">procedure</span> mostrar_usuarios_por_tablespace</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">is</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">cursor</span> c_tablespace <span class=\"token operator\">is</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">select</span> <span class=\"token keyword\">DISTINCT</span> DEFAULT_TABLESPACE <span class=\"token keyword\">from</span> DBA_USERS<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">for</span> v_tablespace <span class=\"token operator\">in</span> c_tablespace <span class=\"token keyword\">loop</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>dbms_output<span class=\"token punctuation\">.</span>put_line<span class=\"token punctuation\">(</span><span class=\"token string\">'Tablespace '</span> <span class=\"token operator\">||</span> v_tablespace<span class=\"token punctuation\">.</span>DEFAULT_TABLESPACE <span class=\"token operator\">||</span> <span class=\"token string\">':'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>MOSTRARUSUARIOS<span class=\"token punctuation\">(</span>v_tablespace<span class=\"token punctuation\">.</span>DEFAULT_TABLESPACE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>dbms_output<span class=\"token punctuation\">.</span>put_line<span class=\"token punctuation\">(</span><span class=\"token string\">'Total Usuarios Tablespace '</span><span class=\"token operator\">||</span> v_tablespace<span class=\"token punctuation\">.</span>DEFAULT_TABLESPACE <span class=\"token operator\">||</span> <span class=\"token string\">': '</span> <span class=\"token operator\">||</span> tablespacedefecto<span class=\"token punctuation\">(</span>v_tablespace<span class=\"token punctuation\">.</span>DEFAULT_TABLESPACE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">end</span> <span class=\"token keyword\">loop</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">end</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token operator\">/</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token operator\">OR</span> <span class=\"token keyword\">REPLACE</span> <span class=\"token keyword\">PROCEDURE</span> MOSTRARUSUARIOS <span class=\"token punctuation\">(</span>p_tablespace <span class=\"token operator\">in</span> <span class=\"token keyword\">out</span> varchar2<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token operator\">is</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">cursor</span> c_nombre <span class=\"token operator\">is</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">select</span> USERNAME <span class=\"token keyword\">FROM</span> DBA_USERS <span class=\"token keyword\">WHERE</span> DEFAULT_TABLESPACE<span class=\"token operator\">=</span>p_tablespace<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">FOR</span> v_nombre <span class=\"token operator\">in</span> c_nombre <span class=\"token keyword\">loop</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    dbms_output<span class=\"token punctuation\">.</span>put_line<span class=\"token punctuation\">(</span><span class=\"token string\">'Usuario '</span> <span class=\"token operator\">||</span> v_nombre<span class=\"token punctuation\">.</span>USERNAME <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token keyword\">end</span> <span class=\"token keyword\">loop</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">end</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token operator\">/</span></pre></td></tr></table></figure><p><img src=\"/images/oracle-ejercicio6.png\" alt=\"remoto\"></p>\n<h3 id=\"7-hacer-un-procedimiento-llamado-mostrar_codigo_fuente-que-reciba-el-nombre-de-otro-procedimiento-y-muestre-su-código-fuente-dba_source\"><a class=\"markdownIt-Anchor\" href=\"#7-hacer-un-procedimiento-llamado-mostrar_codigo_fuente-que-reciba-el-nombre-de-otro-procedimiento-y-muestre-su-código-fuente-dba_source\">#</a> 7. Hacer un procedimiento llamado mostrar_codigo_fuente  que reciba el nombre de otro procedimiento y muestre su código fuente. (DBA_SOURCE)</h3>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">create</span> <span class=\"token operator\">or</span> <span class=\"token keyword\">replace</span> <span class=\"token keyword\">procedure</span> mostrar_codigo_fuente <span class=\"token punctuation\">(</span>p_procedimiento varchar2<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">IS</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">cursor</span> c_fuente <span class=\"token operator\">is</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">select</span> <span class=\"token keyword\">text</span> <span class=\"token keyword\">from</span> DBA_SOURCE <span class=\"token keyword\">where</span> NAME<span class=\"token operator\">=</span>p_procedimiento<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">FOR</span> v_fuente <span class=\"token operator\">in</span> c_fuente <span class=\"token keyword\">loop</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    dbms_output<span class=\"token punctuation\">.</span>put_line<span class=\"token punctuation\">(</span>v_fuente<span class=\"token punctuation\">.</span><span class=\"token keyword\">text</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">end</span> <span class=\"token keyword\">loop</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">end</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token operator\">/</span></pre></td></tr></table></figure><p><img src=\"/images/oracle-ejercicio7.png\" alt=\"remoto\"></p>\n<h3 id=\"8-hacer-un-procedimiento-llamado-mostrar_privilegios_usuario-que-reciba-el-nombre-de-un-usuario-y-muestre-sus-privilegios-de-sistema-y-sus-privilegios-sobre-objetos-dba_sys_privs-y-dba_tab_privs\"><a class=\"markdownIt-Anchor\" href=\"#8-hacer-un-procedimiento-llamado-mostrar_privilegios_usuario-que-reciba-el-nombre-de-un-usuario-y-muestre-sus-privilegios-de-sistema-y-sus-privilegios-sobre-objetos-dba_sys_privs-y-dba_tab_privs\">#</a> 8. Hacer un procedimiento llamado mostrar_privilegios_usuario que reciba el nombre de un usuario y muestre sus privilegios de sistema y sus privilegios sobre objetos. (DBA_SYS_PRIVS y DBA_TAB_PRIVS)</h3>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token operator\">OR</span> <span class=\"token keyword\">REPLACE</span> <span class=\"token keyword\">PROCEDURE</span> mostrar_privilegios_usuario <span class=\"token punctuation\">(</span>p_usuario DBA_USERS<span class=\"token punctuation\">.</span>USERNAME<span class=\"token operator\">%</span><span class=\"token keyword\">TYPE</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">is</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">cursor</span> c_sistema <span class=\"token operator\">is</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">SELECT</span> GRANTEE<span class=\"token punctuation\">,</span>PRIVILEGE <span class=\"token keyword\">FROM</span> DBA_SYS_PRIVS <span class=\"token keyword\">WHERE</span> GRANTEE<span class=\"token operator\">=</span>p_usuario<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">cursor</span> c_objeto <span class=\"token operator\">is</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">SELECT</span> GRANTEE<span class=\"token punctuation\">,</span>PRIVILEGE <span class=\"token keyword\">FROM</span> DBA_TAB_PRIVS <span class=\"token keyword\">WHERE</span> GRANTEE<span class=\"token operator\">=</span>p_usuario<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">FOR</span> v_sistema <span class=\"token operator\">in</span> c_sistema <span class=\"token keyword\">loop</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    dbms_output<span class=\"token punctuation\">.</span>put_line<span class=\"token punctuation\">(</span><span class=\"token string\">'Privilegio de sistema: '</span> <span class=\"token operator\">||</span> v_sistema<span class=\"token punctuation\">.</span>PRIVILEGE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">end</span> <span class=\"token keyword\">loop</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">FOR</span> v_objeto <span class=\"token operator\">in</span> c_objeto <span class=\"token keyword\">loop</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    dbms_output<span class=\"token punctuation\">.</span>put_line<span class=\"token punctuation\">(</span><span class=\"token string\">'Privilegiode objetos: '</span> <span class=\"token operator\">||</span> v_objeto<span class=\"token punctuation\">.</span>PRIVILEGE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">end</span> <span class=\"token keyword\">loop</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token operator\">/</span></pre></td></tr></table></figure><p><img src=\"/images/oracle-ejercicio8.png\" alt=\"remoto\"></p>\n<h3 id=\"9-realiza-un-procedimiento-llamado-listar_comisiones-que-nos-muestre-por-pantalla-un-listado-de-las-comisiones-de-los-empleados-agrupados-según-la-localidad-donde-está-ubicado-su-departamento-con-el-siguiente-formato\"><a class=\"markdownIt-Anchor\" href=\"#9-realiza-un-procedimiento-llamado-listar_comisiones-que-nos-muestre-por-pantalla-un-listado-de-las-comisiones-de-los-empleados-agrupados-según-la-localidad-donde-está-ubicado-su-departamento-con-el-siguiente-formato\">#</a> 9. Realiza un procedimiento llamado listar_comisiones que nos muestre por pantalla un listado de las comisiones de los empleados agrupados según la localidad donde está ubicado su departamento con el siguiente formato:</h3>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token operator\">OR</span> <span class=\"token keyword\">REPLACE</span> <span class=\"token keyword\">PROCEDURE</span> Listar_comisiones</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">IS</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">cursor</span> c_localidad <span class=\"token operator\">is</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">select</span> dname<span class=\"token punctuation\">,</span>loc <span class=\"token keyword\">from</span> dept<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>v_total number<span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">select</span> <span class=\"token function\">sum</span><span class=\"token punctuation\">(</span>comm<span class=\"token punctuation\">)</span> <span class=\"token keyword\">into</span> v_total <span class=\"token keyword\">from</span> emp<span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">FOR</span> v_localidad <span class=\"token operator\">in</span> c_localidad <span class=\"token keyword\">loop</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    dbms_output<span class=\"token punctuation\">.</span>put_line<span class=\"token punctuation\">(</span><span class=\"token string\">'Localidad: '</span> <span class=\"token operator\">||</span> v_localidad<span class=\"token punctuation\">.</span>loc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    dbms_output<span class=\"token punctuation\">.</span>put_line<span class=\"token punctuation\">(</span><span class=\"token string\">'Departamento: '</span> <span class=\"token operator\">||</span> v_localidad<span class=\"token punctuation\">.</span>dname<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    MOSTRARCOMISIONES<span class=\"token punctuation\">(</span>v_localidad<span class=\"token punctuation\">.</span>loc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">end</span> <span class=\"token keyword\">loop</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>dbms_output<span class=\"token punctuation\">.</span>put_line<span class=\"token punctuation\">(</span><span class=\"token string\">'Total comisiones en la empresa es de: '</span> <span class=\"token operator\">||</span> v_total<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>exception</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">WHEN</span> NO_DATA_FOUND <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>dbms_output<span class=\"token punctuation\">.</span>put_line<span class=\"token punctuation\">(</span><span class=\"token string\">'Hay tablas vacías'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">end</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token operator\">/</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token operator\">OR</span> <span class=\"token keyword\">REPLACE</span> <span class=\"token keyword\">PROCEDURE</span> MOSTRARCOMISIONES <span class=\"token punctuation\">(</span>p_localidad <span class=\"token operator\">in</span> <span class=\"token keyword\">out</span> varchar2<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token operator\">IS</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token keyword\">cursor</span> c_comisiones <span class=\"token operator\">is</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">select</span> ename<span class=\"token punctuation\">,</span>comm <span class=\"token keyword\">from</span> emp <span class=\"token keyword\">where</span> deptno <span class=\"token operator\">in</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">select</span> deptno <span class=\"token keyword\">from</span> dept <span class=\"token keyword\">where</span> loc <span class=\"token operator\">=</span> p_localidad<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>v_total number<span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">select</span> <span class=\"token function\">sum</span><span class=\"token punctuation\">(</span>comm<span class=\"token punctuation\">)</span> <span class=\"token keyword\">into</span> v_total <span class=\"token keyword\">from</span> emp <span class=\"token keyword\">where</span> deptno <span class=\"token operator\">in</span>  <span class=\"token punctuation\">(</span><span class=\"token keyword\">select</span> deptno <span class=\"token keyword\">from</span> dept <span class=\"token keyword\">where</span> loc <span class=\"token operator\">=</span> p_localidad<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token keyword\">FOR</span> v_empleado <span class=\"token operator\">in</span> c_comisiones <span class=\"token keyword\">loop</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    dbms_output<span class=\"token punctuation\">.</span>put_line<span class=\"token punctuation\">(</span><span class=\"token string\">'Empleado: '</span> <span class=\"token operator\">||</span> v_empleado<span class=\"token punctuation\">.</span>ename <span class=\"token operator\">||</span> <span class=\"token string\">'..................'</span> <span class=\"token operator\">||</span> v_empleado<span class=\"token punctuation\">.</span>comm<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">if</span> v_empleado<span class=\"token punctuation\">.</span>comm <span class=\"token operator\">></span> <span class=\"token number\">10000</span> <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        raise_application_error<span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">20001</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Hay algún empleado con más de 10.000 de comisión'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">end</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token keyword\">end</span> <span class=\"token keyword\">loop</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>dbms_output<span class=\"token punctuation\">.</span>put_line<span class=\"token punctuation\">(</span><span class=\"token string\">'Total comisiones departamento: '</span> <span class=\"token operator\">||</span> p_localidad <span class=\"token operator\">||</span> <span class=\"token string\">' es de: '</span> <span class=\"token operator\">||</span> v_total<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token operator\">/</span></pre></td></tr></table></figure><p>Podemos ver en la imagen que se produce un raise ya que hay un usuario con más de 10.000 de comm.</p>\n<p><img src=\"/images/oracle-ejercicio9.png\" alt=\"remoto\"></p>\n<h3 id=\"10-realiza-un-procedimiento-que-reciba-el-nombre-de-una-tabla-y-muestre-los-nombres-de-las-restricciones-que-tiene-a-qué-columna-afectan-y-en-qué-consisten-exactamente-dba_tables-dba_constraints-dba_cons_columns\"><a class=\"markdownIt-Anchor\" href=\"#10-realiza-un-procedimiento-que-reciba-el-nombre-de-una-tabla-y-muestre-los-nombres-de-las-restricciones-que-tiene-a-qué-columna-afectan-y-en-qué-consisten-exactamente-dba_tables-dba_constraints-dba_cons_columns\">#</a> 10. Realiza un procedimiento que reciba el nombre de una tabla y muestre los nombres de las restricciones que tiene, a qué columna afectan y en qué consisten exactamente. (DBA_TABLES, DBA_CONSTRAINTS, DBA_CONS_COLUMNS)</h3>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">SELECT</span> CONSTRAINT_NAME<span class=\"token punctuation\">,</span>CONSTRAINT_TYPE<span class=\"token punctuation\">,</span>SEARCH_CONDITION_VC <span class=\"token keyword\">FROM</span> DBA_CONSTRAINTS <span class=\"token keyword\">WHERE</span> TABLE_NAME<span class=\"token operator\">=</span><span class=\"token string\">'EQUIPAR'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">SELECT</span> CONSTRAINT_NAME<span class=\"token punctuation\">,</span>COLUMN_NAME <span class=\"token keyword\">FROM</span> DBA_CONS_COLUMNS <span class=\"token keyword\">WHERE</span> TABLE_NAME <span class=\"token operator\">=</span> <span class=\"token string\">'PERSONAJE'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token operator\">OR</span> <span class=\"token keyword\">REPLACE</span> <span class=\"token keyword\">PROCEDURE</span> MOSTRARRESTRICCIONES <span class=\"token punctuation\">(</span>p_tabla varchar2<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token operator\">is</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>v_tabla varchar2<span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>v_tabla:<span class=\"token operator\">=</span>p_tabla<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>MOSTRARCONSSYS <span class=\"token punctuation\">(</span>v_tabla<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>MOSTRARCONSTABS <span class=\"token punctuation\">(</span>v_tabla<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">end</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token operator\">/</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token operator\">OR</span> <span class=\"token keyword\">REPLACE</span> <span class=\"token keyword\">PROCEDURE</span> MOSTRARCONSSYS <span class=\"token punctuation\">(</span>p_tabla <span class=\"token operator\">in</span> <span class=\"token keyword\">out</span> varchar2<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token operator\">IS</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">cursor</span> c_system <span class=\"token operator\">is</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">SELECT</span> CONSTRAINT_NAME<span class=\"token punctuation\">,</span>CONSTRAINT_TYPE<span class=\"token punctuation\">,</span>SEARCH_CONDITION_VC <span class=\"token keyword\">FROM</span> DBA_CONSTRAINTS <span class=\"token keyword\">WHERE</span> TABLE_NAME<span class=\"token operator\">=</span>p_tabla<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">FOR</span> v_system <span class=\"token operator\">in</span> c_system <span class=\"token keyword\">loop</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    dbms_output<span class=\"token punctuation\">.</span>put_line<span class=\"token punctuation\">(</span>v_system<span class=\"token punctuation\">.</span>CONSTRAINT_NAME <span class=\"token operator\">||</span> <span class=\"token string\">'Tipo de restricción: '</span> <span class=\"token operator\">||</span> v_system<span class=\"token punctuation\">.</span>CONSTRAINT_TYPE <span class=\"token operator\">||</span> v_system<span class=\"token punctuation\">.</span>SEARCH_CONDITION_VC<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token keyword\">end</span> <span class=\"token keyword\">loop</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token operator\">/</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token operator\">OR</span> <span class=\"token keyword\">REPLACE</span> <span class=\"token keyword\">PROCEDURE</span> MOSTRARCONSTABS <span class=\"token punctuation\">(</span>p_tabla <span class=\"token operator\">in</span> <span class=\"token keyword\">out</span> varchar2<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token operator\">IS</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token keyword\">cursor</span> c_tabs <span class=\"token operator\">is</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token keyword\">SELECT</span> CONSTRAINT_NAME<span class=\"token punctuation\">,</span>COLUMN_NAME <span class=\"token keyword\">FROM</span> DBA_CONS_COLUMNS <span class=\"token keyword\">WHERE</span> TABLE_NAME <span class=\"token operator\">=</span> p_tabla<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token keyword\">FOR</span> v_tabs <span class=\"token operator\">in</span> c_tabs <span class=\"token keyword\">loop</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    dbms_output<span class=\"token punctuation\">.</span>put_line<span class=\"token punctuation\">(</span><span class=\"token string\">'Restricción: '</span> <span class=\"token operator\">||</span> v_tabs<span class=\"token punctuation\">.</span>CONSTRAINT_NAME <span class=\"token operator\">||</span> <span class=\"token string\">' y la columna a la que hace referencia es: '</span> <span class=\"token operator\">||</span> v_tabs<span class=\"token punctuation\">.</span>COLUMN_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token keyword\">end</span> <span class=\"token keyword\">loop</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token operator\">/</span></pre></td></tr></table></figure><p><img src=\"/images/oracle-ejercicio10.png\" alt=\"remoto\"></p>\n<h2 id=\"postgresql\"><a class=\"markdownIt-Anchor\" href=\"#postgresql\">#</a> POSTGRESQL</h2>\n<p>Comenzaremos adjuntando el script de creación de tablas e inserciones de Postgres:</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> dept<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  deptno   <span class=\"token keyword\">decimal</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  dname    <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">14</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  loc      <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">13</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> emp<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  empno    <span class=\"token keyword\">decimal</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  ename    <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  job      <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">9</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  mgr      <span class=\"token keyword\">decimal</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  hiredate <span class=\"token keyword\">date</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  sal      <span class=\"token keyword\">decimal</span><span class=\"token punctuation\">(</span><span class=\"token number\">7</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  comm     <span class=\"token keyword\">decimal</span><span class=\"token punctuation\">(</span><span class=\"token number\">7</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  deptno   <span class=\"token keyword\">decimal</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> bonus<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  ename    <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  job      <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">9</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  sal      <span class=\"token keyword\">decimal</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  comm     <span class=\"token keyword\">decimal</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> salgrade<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  grade    <span class=\"token keyword\">decimal</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  losal    <span class=\"token keyword\">decimal</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  hisal    <span class=\"token keyword\">decimal</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> <span class=\"token keyword\">dummy</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token keyword\">dummy</span>    <span class=\"token keyword\">decimal</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token keyword\">insert</span> <span class=\"token keyword\">into</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">values</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">insert</span> <span class=\"token keyword\">into</span> DEPT <span class=\"token punctuation\">(</span>DEPTNO<span class=\"token punctuation\">,</span> DNAME<span class=\"token punctuation\">,</span> LOC<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ACCOUNTING'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'NEW YORK'</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'RESEARCH'</span><span class=\"token punctuation\">,</span>   <span class=\"token string\">'DALLAS'</span>   <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SALES'</span><span class=\"token punctuation\">,</span>      <span class=\"token string\">'CHICAGO'</span>  <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">40</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'OPERATIONS'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'BOSTON'</span>   <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token keyword\">insert</span> <span class=\"token keyword\">into</span> emp <span class=\"token punctuation\">(</span>EMPNO<span class=\"token punctuation\">,</span> ENAME<span class=\"token punctuation\">,</span> JOB<span class=\"token punctuation\">,</span> MGR<span class=\"token punctuation\">,</span> HIREDATE<span class=\"token punctuation\">,</span> SAL<span class=\"token punctuation\">,</span> COMM<span class=\"token punctuation\">,</span> DEPTNO<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">7839</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'KING'</span><span class=\"token punctuation\">,</span>   <span class=\"token string\">'PRESIDENT'</span><span class=\"token punctuation\">,</span> cast<span class=\"token punctuation\">(</span><span class=\"token boolean\">null</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">integer</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> to_date<span class=\"token punctuation\">(</span><span class=\"token string\">'17-11-1981'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'dd-mm-yyyy'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>    <span class=\"token number\">5000</span><span class=\"token punctuation\">,</span> cast<span class=\"token punctuation\">(</span><span class=\"token boolean\">null</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">integer</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">7698</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'BLAKE'</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">'MANAGER'</span><span class=\"token punctuation\">,</span>   <span class=\"token number\">7839</span><span class=\"token punctuation\">,</span> to_date<span class=\"token punctuation\">(</span><span class=\"token string\">'1-5-1981'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'dd-mm-yyyy'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>      <span class=\"token number\">2850</span><span class=\"token punctuation\">,</span> cast<span class=\"token punctuation\">(</span><span class=\"token boolean\">null</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">integer</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">7782</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CLARK'</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">'MANAGER'</span><span class=\"token punctuation\">,</span>   <span class=\"token number\">7839</span><span class=\"token punctuation\">,</span> to_date<span class=\"token punctuation\">(</span><span class=\"token string\">'9-6-1981'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'dd-mm-yyyy'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>      <span class=\"token number\">2450</span><span class=\"token punctuation\">,</span> cast<span class=\"token punctuation\">(</span><span class=\"token boolean\">null</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">integer</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">7566</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'JONES'</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">'MANAGER'</span><span class=\"token punctuation\">,</span>   <span class=\"token number\">7839</span><span class=\"token punctuation\">,</span> to_date<span class=\"token punctuation\">(</span><span class=\"token string\">'2-4-1981'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'dd-mm-yyyy'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>      <span class=\"token number\">2975</span><span class=\"token punctuation\">,</span> cast<span class=\"token punctuation\">(</span><span class=\"token boolean\">null</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">integer</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">7788</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SCOTT'</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">'ANALYST'</span><span class=\"token punctuation\">,</span>   <span class=\"token number\">7566</span><span class=\"token punctuation\">,</span> to_date<span class=\"token punctuation\">(</span><span class=\"token string\">'13-7-87'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'dd-mm-rr'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">85</span><span class=\"token punctuation\">,</span>  <span class=\"token number\">3000</span><span class=\"token punctuation\">,</span> cast<span class=\"token punctuation\">(</span><span class=\"token boolean\">null</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">integer</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">7902</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'FORD'</span><span class=\"token punctuation\">,</span>   <span class=\"token string\">'ANALYST'</span><span class=\"token punctuation\">,</span>   <span class=\"token number\">7566</span><span class=\"token punctuation\">,</span> to_date<span class=\"token punctuation\">(</span><span class=\"token string\">'3-12-1981'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'dd-mm-yyyy'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>     <span class=\"token number\">3000</span><span class=\"token punctuation\">,</span> cast<span class=\"token punctuation\">(</span><span class=\"token boolean\">null</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">integer</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">7369</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SMITH'</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">'CLERK'</span><span class=\"token punctuation\">,</span>     <span class=\"token number\">7902</span><span class=\"token punctuation\">,</span> to_date<span class=\"token punctuation\">(</span><span class=\"token string\">'17-12-1980'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'dd-mm-yyyy'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>     <span class=\"token number\">800</span><span class=\"token punctuation\">,</span> cast<span class=\"token punctuation\">(</span><span class=\"token boolean\">null</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">integer</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">7499</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ALLEN'</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">'SALESMAN'</span><span class=\"token punctuation\">,</span>  <span class=\"token number\">7698</span><span class=\"token punctuation\">,</span> to_date<span class=\"token punctuation\">(</span><span class=\"token string\">'20-2-1981'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'dd-mm-yyyy'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>     <span class=\"token number\">1600</span><span class=\"token punctuation\">,</span>  <span class=\"token number\">300</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">7521</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'WARD'</span><span class=\"token punctuation\">,</span>   <span class=\"token string\">'SALESMAN'</span><span class=\"token punctuation\">,</span>  <span class=\"token number\">7698</span><span class=\"token punctuation\">,</span> to_date<span class=\"token punctuation\">(</span><span class=\"token string\">'22-2-1981'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'dd-mm-yyyy'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>     <span class=\"token number\">1250</span><span class=\"token punctuation\">,</span>  <span class=\"token number\">500</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">7654</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'MARTIN'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SALESMAN'</span><span class=\"token punctuation\">,</span>  <span class=\"token number\">7698</span><span class=\"token punctuation\">,</span> to_date<span class=\"token punctuation\">(</span><span class=\"token string\">'28-9-1981'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'dd-mm-yyyy'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>     <span class=\"token number\">1250</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1400</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">7844</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'TURNER'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SALESMAN'</span><span class=\"token punctuation\">,</span>  <span class=\"token number\">7698</span><span class=\"token punctuation\">,</span> to_date<span class=\"token punctuation\">(</span><span class=\"token string\">'8-9-1981'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'dd-mm-yyyy'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>      <span class=\"token number\">1500</span><span class=\"token punctuation\">,</span>    <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">7876</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ADAMS'</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">'CLERK'</span><span class=\"token punctuation\">,</span>     <span class=\"token number\">7788</span><span class=\"token punctuation\">,</span> to_date<span class=\"token punctuation\">(</span><span class=\"token string\">'13-7-87'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'dd-mm-rr'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">51</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1100</span><span class=\"token punctuation\">,</span> cast<span class=\"token punctuation\">(</span><span class=\"token boolean\">null</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">integer</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">7900</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'JAMES'</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">'CLERK'</span><span class=\"token punctuation\">,</span>     <span class=\"token number\">7698</span><span class=\"token punctuation\">,</span> to_date<span class=\"token punctuation\">(</span><span class=\"token string\">'3-12-1981'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'dd-mm-yyyy'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>      <span class=\"token number\">950</span><span class=\"token punctuation\">,</span> cast<span class=\"token punctuation\">(</span><span class=\"token boolean\">null</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">integer</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">7934</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'MILLER'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CLERK'</span><span class=\"token punctuation\">,</span>     <span class=\"token number\">7782</span><span class=\"token punctuation\">,</span> to_date<span class=\"token punctuation\">(</span><span class=\"token string\">'23-1-1982'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'dd-mm-yyyy'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>     <span class=\"token number\">1300</span><span class=\"token punctuation\">,</span> cast<span class=\"token punctuation\">(</span><span class=\"token boolean\">null</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">integer</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token keyword\">insert</span> <span class=\"token keyword\">into</span> salgrade</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>  <span class=\"token number\">700</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1200</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1201</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1400</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1401</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2000</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2001</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3000</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span> <span class=\"token keyword\">union</span> <span class=\"token keyword\">all</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>  <span class=\"token keyword\">select</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3001</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9999</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">dummy</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token keyword\">commit</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"1-hacer-un-procedimiento-que-muestre-el-nombre-y-el-salario-del-empleado-cuyo-código-es-7082-2\"><a class=\"markdownIt-Anchor\" href=\"#1-hacer-un-procedimiento-que-muestre-el-nombre-y-el-salario-del-empleado-cuyo-código-es-7082-2\">#</a> 1. Hacer un procedimiento que muestre el nombre y el salario del empleado cuyo código es 7082</h3>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token operator\">or</span> <span class=\"token keyword\">replace</span> <span class=\"token keyword\">PROCEDURE</span> mostrar_7082<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">AS</span> $$</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">DECLARE</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    v_nombre emp<span class=\"token punctuation\">.</span>ename<span class=\"token operator\">%</span><span class=\"token keyword\">type</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    v_salario emp<span class=\"token punctuation\">.</span>sal<span class=\"token operator\">%</span><span class=\"token keyword\">type</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">select</span> ename<span class=\"token punctuation\">,</span>sal <span class=\"token keyword\">into</span> v_nombre<span class=\"token punctuation\">,</span>v_salario <span class=\"token keyword\">from</span> emp <span class=\"token keyword\">where</span> empno<span class=\"token operator\">=</span><span class=\"token number\">7782</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    RAISE NOTICE <span class=\"token string\">'El nombre del empleado es %, y su salario es %'</span><span class=\"token punctuation\">,</span> v_nombre<span class=\"token punctuation\">,</span>v_salario<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>$$ <span class=\"token keyword\">LANGUAGE</span> plpgsql<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><img src=\"/images/postgres-ejercicio2.png\" alt=\"remoto\"></p>\n<h3 id=\"2-hacer-un-procedimiento-que-reciba-como-parámetro-un-código-de-empleado-y-devuelva-su-nombre-2\"><a class=\"markdownIt-Anchor\" href=\"#2-hacer-un-procedimiento-que-reciba-como-parámetro-un-código-de-empleado-y-devuelva-su-nombre-2\">#</a> 2. Hacer un procedimiento que reciba como parámetro un código de empleado y devuelva su nombre</h3>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">Create</span> <span class=\"token operator\">or</span> <span class=\"token keyword\">replace</span> <span class=\"token keyword\">procedure</span> codigoanombreemp <span class=\"token punctuation\">(</span>p_codempleado emp<span class=\"token punctuation\">.</span>empno<span class=\"token operator\">%</span><span class=\"token keyword\">type</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">AS</span> $$</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">DECLARE</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    v_nombre emp<span class=\"token punctuation\">.</span>ename<span class=\"token operator\">%</span><span class=\"token keyword\">type</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">BEGIN</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">select</span> ename <span class=\"token keyword\">into</span> v_nombre <span class=\"token keyword\">from</span> emp <span class=\"token keyword\">where</span> empno<span class=\"token operator\">=</span>p_codempleado<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    RAISE NOTICE <span class=\"token string\">'El empleado con el código %, es %'</span><span class=\"token punctuation\">,</span> p_codempleado<span class=\"token punctuation\">,</span>v_nombre<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>$$ <span class=\"token keyword\">LANGUAGE</span> plpgsql<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><img src=\"/images/postgres-ejercicio1.png\" alt=\"remoto\"></p>\n"},{"title":"VPN Wireguard","_content":"\n![wireguard-site-1.png](/images/logo-wireguard.png)\n\n# Site to Site\n\n## Linux\n\nPrimero vamos a cada cliente y vamos a establecer la ruta por defecto\n\n```\nCliente 1:\n    sudo ip route del default\n    sudo ip route add default via 192.168.200.1\n```\n\n```\nCliente 2:\n\n    sudo ip route del default\n    sudo ip route add default via 192.168.100.1\n```\n\n\nAhora nos conectarems a **cada servidor** de manera que en cada uno realizaremos los siguientes comandos:\n```\nInstalamos wireguard\n    sudo apt update\n    sudo apt install wireguard\n```\n\nCreamos la clave privada y pública\n\n`wg genkey | sudo tee /etc/wireguard/server_private.key | wg pubkey | sudo tee /etc/wireguard/server_public.key`\n\n```\ncat /etc/wireguard/server_private.key\ncat /etc/wireguard/server_public.key\n```\nEl resultado de los comandos será cada clave pública y privada de los servidores\n\nCreo el fichero de configuración en el que la interfaz se llamará wg0.conf\n\n    sudo nano /etc/wireguard/wg0.conf\n\nDespués de esto en vpn1 quedará el archivo de configuración de la siguiente manera:\n\n```\n[Interface]\nAddress = 10.99.99.1\nPrivateKey = UKn7oartqeJjRPk8jUtACSTYn/e23wszOBxT/Ymo1Uk=\nListenPort = 51820\n\n[Peer]\nPublicKey = PWrfuUd1UODnjTPuFCJfy/eixRTEsCq/KioI74/vDFo=\nAllowedIPs = 0.0.0.0/0\nEndpoint = 10.0.0.1:51820\nPersistentKeepAlive = 25\n\n```\n\n\nEl siguiente archivo de configuración es el de vpn2:\n\n```\n[Interface]\nAddress = 10.99.99.2\nPrivateKey = MCL13K+q/43eyF8qLtBxz9cNhvcFxQ2s98LOiseZy3w=\nListenPort = 51820\n\n[Peer]\nPublicKey = 2az5T5rW/7x1Z/YLRfX7saNteaOsoupFh07Z6VkeUjI=\nAllowedIPs = 0.0.0.0/0\nEndpoint = 10.0.0.10:51820\n```\n\nAhora en **cada servidor** emplearemos \n\n`wg-quick up wg0` para activar el servicio\n`wg-quick down wg0` para desactivar el servicio\n`wg` para poder ver el estado del servicio\n\nEn los servidores hay que intercambiar las respectivas claves públicas e ingresarlo en PublicKey.\nAddress es la ip del túnel que se va a asignar en cada extremo del servidor.\nAllowedIPs es las ip permitidas hacia el servidor\nEndpoint es la ip pública del servidor y el puerto que se ha configurado en el servidor opuesto.\nPersistentKeepAlive es el tiempo en el que se realizan las comprobaciones de conexión.\n\n\nAhora entraremos a cada cliente y realizaremos la comprobación de que pueden conectarse:\n\n\n![wireguard-site-1.png](/images/wireguard-site-1.png)\n\n\n## Cliente Windows\n\n\nAhora vamos a proceder a conectar un segundo cliente windows:\n\n\n![wireguard-site-2.png](/images/wireguard-site-2.png)\n\n\nAhora cambiaremos la interfaz para establecer una ip estática:\n\n\n![wireguard-site-2.png](/images/wireguard-site-3.png)\n\nUna vez hecho esto probamos a hacer un ping para ver que podemos comunicarnos en remoto a través de la VPN\n\n![wireguard-site-2.png](/images/wireguard-site-4.png)\n\n\n# Point to Site\n\nLa misma configuración que en el site to site, solo que no activaremos el bit de forwarding en el cliente final ya que este mismo no hará de router.\n\n\n```\n[Interface]\nAddress = 10.99.99.1\nPrivateKey = 4GLQzZT6G/Oq69aAitajxl7ZRtzuV1cFrsI0j4Cqjk4=\nListenPort = 51820\n\n[Peer]\nPublickey = fKWBm53DKrAAukk6nssSZ0DuVy9jEBIRKbqOS22sdg8=\nAllowedIPs = 0.0.0.0/0\nPersistentKeepAlive = 25\nEndpoint = 192.188.188.20:51820\n\n```\n\n\n![wireguard-site-1.png](/images/vpn-cliente-C-lin.png)\n\n\n\nLuego conectaremos la interfaz en windows como explicamos anteriormente y activaremos la configuración de la VPN como hemos hecho en linux, solo que esta vez su ip de la ruta será \n10.99.99.4/32\n\n![wireguard-site-1.png](/images/vpn-cliente-C-win2.png)\n\n\nFinalmente copiamos la configuración en el servidor con la clave pública de la vpn de windows y de esta manera reiniciando el servicio con wg-quick down wg0 y wg-quick up wg0 ya tendremos la vpn funcionando.\n\n```\n[Peer]\nPublickey = I/Gj50Ue+qmv+a4Q+C1VcJ4VptBVnU3QfDgo//vq+Fw=\nAllowedIPs = 0.0.0.0/0\nPersistentKeepAlive = 25\nEndpoint = 192.188.188.21:51820\n```\n\n\n![wireguard-site-1.png](/images/vpn-cliente-C-win.png)\n\n","source":"_posts/vpn-wireguard.md","raw":"---\ntitle: VPN Wireguard\ncategories: Seguridad\ntags: Seguridad\n---\n\n![wireguard-site-1.png](/images/logo-wireguard.png)\n\n# Site to Site\n\n## Linux\n\nPrimero vamos a cada cliente y vamos a establecer la ruta por defecto\n\n```\nCliente 1:\n    sudo ip route del default\n    sudo ip route add default via 192.168.200.1\n```\n\n```\nCliente 2:\n\n    sudo ip route del default\n    sudo ip route add default via 192.168.100.1\n```\n\n\nAhora nos conectarems a **cada servidor** de manera que en cada uno realizaremos los siguientes comandos:\n```\nInstalamos wireguard\n    sudo apt update\n    sudo apt install wireguard\n```\n\nCreamos la clave privada y pública\n\n`wg genkey | sudo tee /etc/wireguard/server_private.key | wg pubkey | sudo tee /etc/wireguard/server_public.key`\n\n```\ncat /etc/wireguard/server_private.key\ncat /etc/wireguard/server_public.key\n```\nEl resultado de los comandos será cada clave pública y privada de los servidores\n\nCreo el fichero de configuración en el que la interfaz se llamará wg0.conf\n\n    sudo nano /etc/wireguard/wg0.conf\n\nDespués de esto en vpn1 quedará el archivo de configuración de la siguiente manera:\n\n```\n[Interface]\nAddress = 10.99.99.1\nPrivateKey = UKn7oartqeJjRPk8jUtACSTYn/e23wszOBxT/Ymo1Uk=\nListenPort = 51820\n\n[Peer]\nPublicKey = PWrfuUd1UODnjTPuFCJfy/eixRTEsCq/KioI74/vDFo=\nAllowedIPs = 0.0.0.0/0\nEndpoint = 10.0.0.1:51820\nPersistentKeepAlive = 25\n\n```\n\n\nEl siguiente archivo de configuración es el de vpn2:\n\n```\n[Interface]\nAddress = 10.99.99.2\nPrivateKey = MCL13K+q/43eyF8qLtBxz9cNhvcFxQ2s98LOiseZy3w=\nListenPort = 51820\n\n[Peer]\nPublicKey = 2az5T5rW/7x1Z/YLRfX7saNteaOsoupFh07Z6VkeUjI=\nAllowedIPs = 0.0.0.0/0\nEndpoint = 10.0.0.10:51820\n```\n\nAhora en **cada servidor** emplearemos \n\n`wg-quick up wg0` para activar el servicio\n`wg-quick down wg0` para desactivar el servicio\n`wg` para poder ver el estado del servicio\n\nEn los servidores hay que intercambiar las respectivas claves públicas e ingresarlo en PublicKey.\nAddress es la ip del túnel que se va a asignar en cada extremo del servidor.\nAllowedIPs es las ip permitidas hacia el servidor\nEndpoint es la ip pública del servidor y el puerto que se ha configurado en el servidor opuesto.\nPersistentKeepAlive es el tiempo en el que se realizan las comprobaciones de conexión.\n\n\nAhora entraremos a cada cliente y realizaremos la comprobación de que pueden conectarse:\n\n\n![wireguard-site-1.png](/images/wireguard-site-1.png)\n\n\n## Cliente Windows\n\n\nAhora vamos a proceder a conectar un segundo cliente windows:\n\n\n![wireguard-site-2.png](/images/wireguard-site-2.png)\n\n\nAhora cambiaremos la interfaz para establecer una ip estática:\n\n\n![wireguard-site-2.png](/images/wireguard-site-3.png)\n\nUna vez hecho esto probamos a hacer un ping para ver que podemos comunicarnos en remoto a través de la VPN\n\n![wireguard-site-2.png](/images/wireguard-site-4.png)\n\n\n# Point to Site\n\nLa misma configuración que en el site to site, solo que no activaremos el bit de forwarding en el cliente final ya que este mismo no hará de router.\n\n\n```\n[Interface]\nAddress = 10.99.99.1\nPrivateKey = 4GLQzZT6G/Oq69aAitajxl7ZRtzuV1cFrsI0j4Cqjk4=\nListenPort = 51820\n\n[Peer]\nPublickey = fKWBm53DKrAAukk6nssSZ0DuVy9jEBIRKbqOS22sdg8=\nAllowedIPs = 0.0.0.0/0\nPersistentKeepAlive = 25\nEndpoint = 192.188.188.20:51820\n\n```\n\n\n![wireguard-site-1.png](/images/vpn-cliente-C-lin.png)\n\n\n\nLuego conectaremos la interfaz en windows como explicamos anteriormente y activaremos la configuración de la VPN como hemos hecho en linux, solo que esta vez su ip de la ruta será \n10.99.99.4/32\n\n![wireguard-site-1.png](/images/vpn-cliente-C-win2.png)\n\n\nFinalmente copiamos la configuración en el servidor con la clave pública de la vpn de windows y de esta manera reiniciando el servicio con wg-quick down wg0 y wg-quick up wg0 ya tendremos la vpn funcionando.\n\n```\n[Peer]\nPublickey = I/Gj50Ue+qmv+a4Q+C1VcJ4VptBVnU3QfDgo//vq+Fw=\nAllowedIPs = 0.0.0.0/0\nPersistentKeepAlive = 25\nEndpoint = 192.188.188.21:51820\n```\n\n\n![wireguard-site-1.png](/images/vpn-cliente-C-win.png)\n\n","slug":"vpn-wireguard","published":1,"date":"2023-01-26T18:57:47.828Z","updated":"2023-01-31T13:33:29.550Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cldl8a0pd000w2fi56vmqgnph","content":"<p><img src=\"/images/logo-wireguard.png\" alt=\"wireguard-site-1.png\"></p>\n<h1 id=\"site-to-site\"><a class=\"markdownIt-Anchor\" href=\"#site-to-site\">#</a> Site to Site</h1>\n<h2 id=\"linux\"><a class=\"markdownIt-Anchor\" href=\"#linux\">#</a> Linux</h2>\n<p>Primero vamos a cada cliente y vamos a establecer la ruta por defecto</p>\n<pre><code>Cliente 1:\n    sudo ip route del default\n    sudo ip route add default via 192.168.200.1\n</code></pre>\n<pre><code>Cliente 2:\n\n    sudo ip route del default\n    sudo ip route add default via 192.168.100.1\n</code></pre>\n<p>Ahora nos conectarems a <strong>cada servidor</strong> de manera que en cada uno realizaremos los siguientes comandos:</p>\n<pre><code>Instalamos wireguard\n    sudo apt update\n    sudo apt install wireguard\n</code></pre>\n<p>Creamos la clave privada y pública</p>\n<p><code>wg genkey | sudo tee /etc/wireguard/server_private.key | wg pubkey | sudo tee /etc/wireguard/server_public.key</code></p>\n<pre><code>cat /etc/wireguard/server_private.key\ncat /etc/wireguard/server_public.key\n</code></pre>\n<p>El resultado de los comandos será cada clave pública y privada de los servidores</p>\n<p>Creo el fichero de configuración en el que la interfaz se llamará wg0.conf</p>\n<pre><code>sudo nano /etc/wireguard/wg0.conf\n</code></pre>\n<p>Después de esto en vpn1 quedará el archivo de configuración de la siguiente manera:</p>\n<pre><code>[Interface]\nAddress = 10.99.99.1\nPrivateKey = UKn7oartqeJjRPk8jUtACSTYn/e23wszOBxT/Ymo1Uk=\nListenPort = 51820\n\n[Peer]\nPublicKey = PWrfuUd1UODnjTPuFCJfy/eixRTEsCq/KioI74/vDFo=\nAllowedIPs = 0.0.0.0/0\nEndpoint = 10.0.0.1:51820\nPersistentKeepAlive = 25\n\n</code></pre>\n<p>El siguiente archivo de configuración es el de vpn2:</p>\n<pre><code>[Interface]\nAddress = 10.99.99.2\nPrivateKey = MCL13K+q/43eyF8qLtBxz9cNhvcFxQ2s98LOiseZy3w=\nListenPort = 51820\n\n[Peer]\nPublicKey = 2az5T5rW/7x1Z/YLRfX7saNteaOsoupFh07Z6VkeUjI=\nAllowedIPs = 0.0.0.0/0\nEndpoint = 10.0.0.10:51820\n</code></pre>\n<p>Ahora en <strong>cada servidor</strong> emplearemos</p>\n<p><code>wg-quick up wg0</code>  para activar el servicio<br>\n <code>wg-quick down wg0</code>  para desactivar el servicio<br>\n <code>wg</code>  para poder ver el estado del servicio</p>\n<p>En los servidores hay que intercambiar las respectivas claves públicas e ingresarlo en PublicKey.<br>\nAddress es la ip del túnel que se va a asignar en cada extremo del servidor.<br>\nAllowedIPs es las ip permitidas hacia el servidor<br>\nEndpoint es la ip pública del servidor y el puerto que se ha configurado en el servidor opuesto.<br>\nPersistentKeepAlive es el tiempo en el que se realizan las comprobaciones de conexión.</p>\n<p>Ahora entraremos a cada cliente y realizaremos la comprobación de que pueden conectarse:</p>\n<p><img src=\"/images/wireguard-site-1.png\" alt=\"wireguard-site-1.png\"></p>\n<h2 id=\"cliente-windows\"><a class=\"markdownIt-Anchor\" href=\"#cliente-windows\">#</a> Cliente Windows</h2>\n<p>Ahora vamos a proceder a conectar un segundo cliente windows:</p>\n<p><img src=\"/images/wireguard-site-2.png\" alt=\"wireguard-site-2.png\"></p>\n<p>Ahora cambiaremos la interfaz para establecer una ip estática:</p>\n<p><img src=\"/images/wireguard-site-3.png\" alt=\"wireguard-site-2.png\"></p>\n<p>Una vez hecho esto probamos a hacer un ping para ver que podemos comunicarnos en remoto a través de la VPN</p>\n<p><img src=\"/images/wireguard-site-4.png\" alt=\"wireguard-site-2.png\"></p>\n<h1 id=\"point-to-site\"><a class=\"markdownIt-Anchor\" href=\"#point-to-site\">#</a> Point to Site</h1>\n<p>La misma configuración que en el site to site, solo que no activaremos el bit de forwarding en el cliente final ya que este mismo no hará de router.</p>\n<pre><code>[Interface]\nAddress = 10.99.99.1\nPrivateKey = 4GLQzZT6G/Oq69aAitajxl7ZRtzuV1cFrsI0j4Cqjk4=\nListenPort = 51820\n\n[Peer]\nPublickey = fKWBm53DKrAAukk6nssSZ0DuVy9jEBIRKbqOS22sdg8=\nAllowedIPs = 0.0.0.0/0\nPersistentKeepAlive = 25\nEndpoint = 192.188.188.20:51820\n\n</code></pre>\n<p><img src=\"/images/vpn-cliente-C-lin.png\" alt=\"wireguard-site-1.png\"></p>\n<p>Luego conectaremos la interfaz en windows como explicamos anteriormente y activaremos la configuración de la VPN como hemos hecho en linux, solo que esta vez su ip de la ruta será<br>\n10.99.99.4/32</p>\n<p><img src=\"/images/vpn-cliente-C-win2.png\" alt=\"wireguard-site-1.png\"></p>\n<p>Finalmente copiamos la configuración en el servidor con la clave pública de la vpn de windows y de esta manera reiniciando el servicio con wg-quick down wg0 y wg-quick up wg0 ya tendremos la vpn funcionando.</p>\n<pre><code>[Peer]\nPublickey = I/Gj50Ue+qmv+a4Q+C1VcJ4VptBVnU3QfDgo//vq+Fw=\nAllowedIPs = 0.0.0.0/0\nPersistentKeepAlive = 25\nEndpoint = 192.188.188.21:51820\n</code></pre>\n<p><img src=\"/images/vpn-cliente-C-win.png\" alt=\"wireguard-site-1.png\"></p>\n","site":{"data":{}},"length":2837,"excerpt":"","more":"<p><img src=\"/images/logo-wireguard.png\" alt=\"wireguard-site-1.png\"></p>\n<h1 id=\"site-to-site\"><a class=\"markdownIt-Anchor\" href=\"#site-to-site\">#</a> Site to Site</h1>\n<h2 id=\"linux\"><a class=\"markdownIt-Anchor\" href=\"#linux\">#</a> Linux</h2>\n<p>Primero vamos a cada cliente y vamos a establecer la ruta por defecto</p>\n<pre><code>Cliente 1:\n    sudo ip route del default\n    sudo ip route add default via 192.168.200.1\n</code></pre>\n<pre><code>Cliente 2:\n\n    sudo ip route del default\n    sudo ip route add default via 192.168.100.1\n</code></pre>\n<p>Ahora nos conectarems a <strong>cada servidor</strong> de manera que en cada uno realizaremos los siguientes comandos:</p>\n<pre><code>Instalamos wireguard\n    sudo apt update\n    sudo apt install wireguard\n</code></pre>\n<p>Creamos la clave privada y pública</p>\n<p><code>wg genkey | sudo tee /etc/wireguard/server_private.key | wg pubkey | sudo tee /etc/wireguard/server_public.key</code></p>\n<pre><code>cat /etc/wireguard/server_private.key\ncat /etc/wireguard/server_public.key\n</code></pre>\n<p>El resultado de los comandos será cada clave pública y privada de los servidores</p>\n<p>Creo el fichero de configuración en el que la interfaz se llamará wg0.conf</p>\n<pre><code>sudo nano /etc/wireguard/wg0.conf\n</code></pre>\n<p>Después de esto en vpn1 quedará el archivo de configuración de la siguiente manera:</p>\n<pre><code>[Interface]\nAddress = 10.99.99.1\nPrivateKey = UKn7oartqeJjRPk8jUtACSTYn/e23wszOBxT/Ymo1Uk=\nListenPort = 51820\n\n[Peer]\nPublicKey = PWrfuUd1UODnjTPuFCJfy/eixRTEsCq/KioI74/vDFo=\nAllowedIPs = 0.0.0.0/0\nEndpoint = 10.0.0.1:51820\nPersistentKeepAlive = 25\n\n</code></pre>\n<p>El siguiente archivo de configuración es el de vpn2:</p>\n<pre><code>[Interface]\nAddress = 10.99.99.2\nPrivateKey = MCL13K+q/43eyF8qLtBxz9cNhvcFxQ2s98LOiseZy3w=\nListenPort = 51820\n\n[Peer]\nPublicKey = 2az5T5rW/7x1Z/YLRfX7saNteaOsoupFh07Z6VkeUjI=\nAllowedIPs = 0.0.0.0/0\nEndpoint = 10.0.0.10:51820\n</code></pre>\n<p>Ahora en <strong>cada servidor</strong> emplearemos</p>\n<p><code>wg-quick up wg0</code>  para activar el servicio<br>\n <code>wg-quick down wg0</code>  para desactivar el servicio<br>\n <code>wg</code>  para poder ver el estado del servicio</p>\n<p>En los servidores hay que intercambiar las respectivas claves públicas e ingresarlo en PublicKey.<br>\nAddress es la ip del túnel que se va a asignar en cada extremo del servidor.<br>\nAllowedIPs es las ip permitidas hacia el servidor<br>\nEndpoint es la ip pública del servidor y el puerto que se ha configurado en el servidor opuesto.<br>\nPersistentKeepAlive es el tiempo en el que se realizan las comprobaciones de conexión.</p>\n<p>Ahora entraremos a cada cliente y realizaremos la comprobación de que pueden conectarse:</p>\n<p><img src=\"/images/wireguard-site-1.png\" alt=\"wireguard-site-1.png\"></p>\n<h2 id=\"cliente-windows\"><a class=\"markdownIt-Anchor\" href=\"#cliente-windows\">#</a> Cliente Windows</h2>\n<p>Ahora vamos a proceder a conectar un segundo cliente windows:</p>\n<p><img src=\"/images/wireguard-site-2.png\" alt=\"wireguard-site-2.png\"></p>\n<p>Ahora cambiaremos la interfaz para establecer una ip estática:</p>\n<p><img src=\"/images/wireguard-site-3.png\" alt=\"wireguard-site-2.png\"></p>\n<p>Una vez hecho esto probamos a hacer un ping para ver que podemos comunicarnos en remoto a través de la VPN</p>\n<p><img src=\"/images/wireguard-site-4.png\" alt=\"wireguard-site-2.png\"></p>\n<h1 id=\"point-to-site\"><a class=\"markdownIt-Anchor\" href=\"#point-to-site\">#</a> Point to Site</h1>\n<p>La misma configuración que en el site to site, solo que no activaremos el bit de forwarding en el cliente final ya que este mismo no hará de router.</p>\n<pre><code>[Interface]\nAddress = 10.99.99.1\nPrivateKey = 4GLQzZT6G/Oq69aAitajxl7ZRtzuV1cFrsI0j4Cqjk4=\nListenPort = 51820\n\n[Peer]\nPublickey = fKWBm53DKrAAukk6nssSZ0DuVy9jEBIRKbqOS22sdg8=\nAllowedIPs = 0.0.0.0/0\nPersistentKeepAlive = 25\nEndpoint = 192.188.188.20:51820\n\n</code></pre>\n<p><img src=\"/images/vpn-cliente-C-lin.png\" alt=\"wireguard-site-1.png\"></p>\n<p>Luego conectaremos la interfaz en windows como explicamos anteriormente y activaremos la configuración de la VPN como hemos hecho en linux, solo que esta vez su ip de la ruta será<br>\n10.99.99.4/32</p>\n<p><img src=\"/images/vpn-cliente-C-win2.png\" alt=\"wireguard-site-1.png\"></p>\n<p>Finalmente copiamos la configuración en el servidor con la clave pública de la vpn de windows y de esta manera reiniciando el servicio con wg-quick down wg0 y wg-quick up wg0 ya tendremos la vpn funcionando.</p>\n<pre><code>[Peer]\nPublickey = I/Gj50Ue+qmv+a4Q+C1VcJ4VptBVnU3QfDgo//vq+Fw=\nAllowedIPs = 0.0.0.0/0\nPersistentKeepAlive = 25\nEndpoint = 192.188.188.21:51820\n</code></pre>\n<p><img src=\"/images/vpn-cliente-C-win.png\" alt=\"wireguard-site-1.png\"></p>\n"},{"title":"Directorios centralizados con LDAP y NFS","_content":"\n\n![Descripción de la imagen](/images/LOGO-LDAP.png)\n\n\n# Directorios centralizados con LDAP y NFS\n\n## Introducción\n\nEn este post vamos a ver como crear un directorio centralizado con LDAP y NFS.\n\n## Instalación de LDAP\n\nPara instalar LDAP vamos a usar el paquete slapd, que es el servidor LDAP.\n\n```bash\napt install slapd\n```\n\nUna vez instalado vamos a configurarlo, para ello ejecutamos el comando:\n\n```bash\ndpkg-reconfigure slap-utils\n```\n\nNos pedirá que introduzcamos la contraseña de del usuario root del servidor slapd, y nos preguntará si queremos usar el dominio de la máquina o no, en este caso vamos a usar el dominio de la máquina.\n\nCon el siguiente comando podremos ver la información del usuario root en el dominio gonzanonazareno.org\n\n```bash\nldapsearch -x -D \"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org\" -b \"dc=antonio,dc=gonzalonazareno,dc=org\" -W\n```\n\n\n![Descripción de la imagen](/images/slap1-1.png)\n\nAhora crearemos una unidad organizativa, en este caso la llamaremos Organizacion.ldif, y le daremos el siguiente contenido:\n\n```bash\ndn: ou=Personas,dc=antonio,dc=gonzalonazareno,dc=org\nobjectClass: organizationalUnit\nou: Personas\n\ndn: ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org\nobjectClass: organizationalUnit\nou: Grupos\n```\n\n\"dn\" significa Distinguished Name, e indica el nombre distintivo que el objeto tendrá dentro de la jerarquía de directorios, y \"objectClass\" es la clase de objeto, en este caso es una unidad organizativa.\n\nProcedemos a ejecutar el siguiente comando para inyectar los nuevos objetos en el árbol de slapd:\n\n```bash\nldapadd -x -D \"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org\" -f UnidadesOrganizativas.ldif -W\n```\n\n![Descripción de la imagen](/images/slap1-2.png)\n\n\nAhora si volvemos a ejecutar el comando \n```bash\nldapsearch -x -D \"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org\" -b \"dc=antonio,dc=gonzalonazareno,dc=org\" -W\n```\n\nPodremos ver que se han creado los nuevos objetos llamados Personas y Grupos.\n\n![Descripción de la imagen](/images/slap1-3.png)\n\nAhora vamos a crear un usuario, para ello crearemos un fichero llamado usuarios.ldif, y le daremos el siguiente contenido:\n\n```bash\ndn: uid=prueba,ou=Personas,dc=antonio,dc=gonzalonazareno,dc=org\nobjectClass: posixAccount\nobjectClass: inetOrgPerson\nobjectClass: top\ncn: prueba\ngidNumber: 2001\nhomeDirectory: /home/prueba\nloginShell: /bin/bash\nsn: prueba\nuid: prueba\nuidNumber: 2001\nuserPassword: {SSHA}sfqp8j+/1HHe7N6qcbDIrLkf3T2c4wIW\n\ndn: uid=macarena,ou=Personas,dc=antonio,dc=gonzalonazareno,dc=org\nobjectClass: posixAccount\nobjectClass: inetOrgPerson\nobjectClass: top\ncn: macarena\ngidNumber: 2002\nhomeDirectory: /home/macarena\nloginShell: /bin/bash\nsn: macarena\nuid: macarena\nuidNumber: 2002\nuserPassword: {SSHA}sCwMT7CqCloD4bzvED/1QB9xvUnZ0N5P\n\n```\n\nPara los hash de contraseñas la hemos creado con la utilidad slappasswd, que viene instalada con slapd.\n\n```bash\nroot@alfa:/home/antonio# slappasswd\nNew password: \nRe-enter new password: \n{SSHA}sfqp8j+/1HHe7N6qcbDIrLkf3T2c4wIW\n```\n\nPara agregar al usuario prueba y al usuario macarena debemos de volver a inyectar el fichero Usuario.ldif en el árbol de slapd, para ello ejecutamos el siguiente comando:\n\n```bash\nldapadd -x -D \"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org\" -f usuarios.ldif -W\n```\n\n![Descripción de la imagen](/images/slap1-4.png)\n\nLo que hemos hecho ha sido insertar registros en el objeto de personas, ahora vamos a crear un grupo, para ello crearemos un fichero llamado grupos.ldif, y le daremos el siguiente contenido:\n\n```bash\ndn: cn=desarrollo,ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org\nobjectClass: top\nobjectClass: groupOfNames\ncn: desarrollo\nmember:\n\ndn: cn=sistemas,ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org\nobjectClass: top\nobjectClass: groupOfNames\ncn: sistemas\nmember:\n```\n\nA continuación vamos a inyectar el fichero grupos.ldif en el árbol de slapd, para ello ejecutamos el siguiente comando:\n\n```bash\nldapadd -x -D \"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org\" -f grupos.ldif -W\n```\n\n![Descripción de la imagen](/images/slap1-5.png)\n\nLuego vamos a añadir a los usuarios a los grupos, para ello crearemos un fichero llamado personas-grupos.ldif, y le daremos el siguiente contenido:\n\n```bash\n# Al grupo de desarrollo\ndn: cn=desarrollo,ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org\nchangetype:modify\nadd: member\nmember: uid=prueba,ou=Personas,dc=antonio,dc=gonzalonazareno,dc=org\n\n# Al grupo de desarrollo y sistemas\ndn: cn=desarrollo,ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org\nchangetype:modify\nadd: member\nmember: uid=macarena,ou=Personas,dc=antonio,dc=gonzalonazareno,dc=org\n\ndn: cn=sistemas,ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org\nchangetype:modify\nadd: member\nmember: uid=macarena,ou=Personas,dc=antonio,dc=gonzalonazareno,dc=org\n```\n\nA continuación vamos a inyectar el fichero personas-grupos.ldif en el árbol de slapd, para ello ejecutamos el siguiente comando:\n\n```bash\nldapmodify -x -D \"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org\" -f personas-grupos.ldif -W\n```\n\n![Descripción de la imagen](/images/slap1-6.png)\n\nPodríamos usar también ldapmodify que es una herramiente enfocada a la modificación, pero para nuestro caso ambas nos sirven.\n\nUsando el comando ldapsearch podemos ver que los usuarios están en los grupos:\n\n```bash\nldapsearch -x -D \"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org\" -b \"cn=desarrollo,ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org\" -W\n```\n\n```bash\nroot@alfa:/home/antonio# ldapsearch -x -b ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org\n# extended LDIF\n#\n# LDAPv3\n# base <ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org> with scope subtree\n# filter: (objectclass=*)\n# requesting: ALL\n#\n\n# Grupos, antonio.gonzalonazareno.org\ndn: ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org\nobjectClass: organizationalUnit\nou: Grupos\n\n# sistemas, Grupos, antonio.gonzalonazareno.org\ndn: cn=sistemas,ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org\nobjectClass: top\nobjectClass: groupOfNames\ncn: sistemas\nmember:\nmember: uid=macarena,ou=Personas,dc=antonio,dc=gonzalonazareno,dc=org\n\n# desarrollo, Grupos, antonio.gonzalonazareno.org\ndn: cn=desarrollo,ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org\nobjectClass: top\nobjectClass: groupOfNames\ncn: desarrollo\nmember:\nmember: uid=prueba,ou=Personas,dc=antonio,dc=gonzalonazareno,dc=org\nmember: uid=macarena,ou=Personas,dc=antonio,dc=gonzalonazareno,dc=org\n\n# search result\nsearch: 2\nresult: 0 Success\n\n# numResponses: 6\n# numEntries: 5\n```\n\nSi queremos borrar un elemento del árbol podemos realizarlo gracias a la siguiente instrucción:\n\n```bash\nldapdelete -x -D 'cn=admin,dc=antonio,dc=gonzalonazareno,dc=org' -W cn=reabastecimiento,ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org\n```\n\n\nDesplegar árbol a través de NFS:\n\n\napt-get install nfs-kernel-server -y\n\nNos vamos a /etc/exportfs y añadimos la siguiente línea:\n```bash\n/home/antonio/nfs *(rw,fsid=0,subtree_check,no_root_squash)\n```\n\nAhora ejecutamos `exportfs -a`\n\n```bash\nroot@alfa:/home/antonio# mkdir nfs\nroot@alfa:/home/antonio# mkdir nfs/almacenamiento\n```\n\n\nComenzamos con la configuración del paquete nscd. Este es un demonio de caché para el servicio de nombres, lo cual evitará repetir consultas de las bases de datos de passwd, group y hosts.\n\n\n```bash\napt install libnss-ldapd libpam-ldapd nscd -y\n```\n\nLuego de configurar el instalador de forma que capture la ip 127.0.0.1 y el nombre dc=antonio,dc=gonzalonazareno,dc=org, debemos editar el fichero /etc/nsswitch.conf, y añadir las siguientes líneas:\n\n![Descripción de la imagen](/images/slap1-7.png)\n\n\n## Cliente Ubuntu\n\n```bash\napt-get install libnss-ldapd libpam-ldapd nscd nfs-kernel-server -y\n```\n\nIntroducimos la dirección IP del servidor LDAP y el nombre del dominio:\n\n![Descripción de la imagen](/images/slap1-8.png)\n\nEn el fichero /etc/ldap/ldap.conf se establecen los parámetros de configuración del cliente LDAP. En este fichero se establece la dirección del servidor LDAP, el puerto, el dominio, el tipo de autenticación, etc.\n\n```bash\n#\n# LDAP Defaults\n#\n\n# See ldap.conf(5) for details\n# This file should be world readable but not world writable.\n\nBASE    dc=antonio,dc=gonzalonazareno,dc=org\nURI     ldap://192.168.0.1\n\nSIZELIMIT       12\nTIMELIMIT       15\nDEREF           never\n\n# TLS certificates (needed for GnuTLS)\nTLS_CACERT      /etc/ssl/certs/ca-certificates.crt\n```\n\n\nAhora necesitaremos configurar el cliente para que al iniciar sesión cree el home del usuario. Para ello editamos el fichero /etc/pam.d/common-account y añadimos la siguiente línea:\n\n```bash\nsession required pam_mkhomedir.so skel=/etc/skel/ umask=0022\n\n```\n\nVamos a probar montando de manera efímera el directorio en el cual se va a crear el home del usuario macarena:\n\n```bash\nmount -t nfs 192.168.0.1:/home/antonio/nfs/ /home\n```\n\n\nAhora cuando el usuario macarena inicie sesión este se verá reflejado en nuestro servidor nfs, probaremos creando un documento txt:\n\n\n![Descripción de la imagen](/images/slap1-9.png)\n\nAhora vamos a hacer que este recurso funcione de manera permanente, para ello podríamos editar el fichero fstab, o bien crear una unidad de systemd, que en este caso es lo que vamos a emplear.\n\n\nnano /etc/systemd/system/home.mount\n```bash\n[Unit]\nDescription= Montaje de carpeta home para NFS\n\n[Mount]\nWhat=192.168.0.1:/home/antonio/nfs\nWhere=/home   \nType=nfs\nOptions=defaults\n\n[Install]\nWantedBy=multi-user.target\n\n```\n\nsystemctl daemon-reload\nsystemctl enable home.mount\nsystemctl start home.mount\nsystemctl status home.mount\n\n![Descripción de la imagen](/images/slap1-10.png)\n\n## Cliente Rocky Linux\n\n```bash\ndnf install openldap-clients sssd sssd-ldap oddjob-mkhomedir sssd-tools -y\n```\n\n```bash\nauthselect list\n```\n\n```bash\n[root@bravo antonio]# authselect list\n- minimal\t Local users only for minimal installations\n- sssd   \t Enable SSSD for system authentication (also for local users only)\n- winbind\t Enable winbind for system authentication\n\n```\n\n```bash\nauthselect select sssd with-mkhomedir --force\n```\n\nvolvemos a especificar la dirección IP del servidor LDAP y el nombre del dominio en /etc/openldap/ldap.conf:\n\n```bash\nBASE dc=antonio,dc=gonzalonazareno,dc=org\nURI ldap://172.16.0.1\n\n\nSIZELIMIT       12\nTIMELIMIT       15\nDEREF           never\n```\n\nsudo nano /etc/sssd/sssd.conf\n\n```bash\n[domain/default]\nid_provider = ldap\nautofs_provider = ldap\nauth_provider = ldap\nchpass_provider = ldap\nldap_uri = ldap://172.0.16.1\nldap_search_base = dc=antonio,dc=gonzalonazareno,dc=org\nldap_id_use_start_tls = True\nldap_tls_cacertdir = /etc/openldap/cacerts\ncache_credentials = True\nldap_tls_reqcert = allow\n\n[sssd]\nservices = nss, pam, autofs\ndomains = default\n\n[nss]\nhomedir_substring = /home/nfs\n\n```\n\n\n```bash\nchmod 0600 /etc/sssd/sssd.conf\nsystemctl restart sssd\n```\n\nauthconfig --enablemkhomedir --updateall\n\n\n\n```bash\nauthconfig --enableldap \\\n--enableldapauth \\\n--ldapserver=antonio.gonzalonazareno.org \\\n--ldapbasedn=\"dc=antonio,dc=gonzalonazareno,dc=org\" \\\n--enablemkhomedir \\\n--update\n```\n\n![Descripción de la imagen](/images/slap1-11.png)\n\n","source":"_posts/slap-nfs.md","raw":"---\ntitle: Directorios centralizados con LDAP y NFS\ncategories: Administración de Sistemas\n---\n\n\n![Descripción de la imagen](/images/LOGO-LDAP.png)\n\n\n# Directorios centralizados con LDAP y NFS\n\n## Introducción\n\nEn este post vamos a ver como crear un directorio centralizado con LDAP y NFS.\n\n## Instalación de LDAP\n\nPara instalar LDAP vamos a usar el paquete slapd, que es el servidor LDAP.\n\n```bash\napt install slapd\n```\n\nUna vez instalado vamos a configurarlo, para ello ejecutamos el comando:\n\n```bash\ndpkg-reconfigure slap-utils\n```\n\nNos pedirá que introduzcamos la contraseña de del usuario root del servidor slapd, y nos preguntará si queremos usar el dominio de la máquina o no, en este caso vamos a usar el dominio de la máquina.\n\nCon el siguiente comando podremos ver la información del usuario root en el dominio gonzanonazareno.org\n\n```bash\nldapsearch -x -D \"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org\" -b \"dc=antonio,dc=gonzalonazareno,dc=org\" -W\n```\n\n\n![Descripción de la imagen](/images/slap1-1.png)\n\nAhora crearemos una unidad organizativa, en este caso la llamaremos Organizacion.ldif, y le daremos el siguiente contenido:\n\n```bash\ndn: ou=Personas,dc=antonio,dc=gonzalonazareno,dc=org\nobjectClass: organizationalUnit\nou: Personas\n\ndn: ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org\nobjectClass: organizationalUnit\nou: Grupos\n```\n\n\"dn\" significa Distinguished Name, e indica el nombre distintivo que el objeto tendrá dentro de la jerarquía de directorios, y \"objectClass\" es la clase de objeto, en este caso es una unidad organizativa.\n\nProcedemos a ejecutar el siguiente comando para inyectar los nuevos objetos en el árbol de slapd:\n\n```bash\nldapadd -x -D \"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org\" -f UnidadesOrganizativas.ldif -W\n```\n\n![Descripción de la imagen](/images/slap1-2.png)\n\n\nAhora si volvemos a ejecutar el comando \n```bash\nldapsearch -x -D \"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org\" -b \"dc=antonio,dc=gonzalonazareno,dc=org\" -W\n```\n\nPodremos ver que se han creado los nuevos objetos llamados Personas y Grupos.\n\n![Descripción de la imagen](/images/slap1-3.png)\n\nAhora vamos a crear un usuario, para ello crearemos un fichero llamado usuarios.ldif, y le daremos el siguiente contenido:\n\n```bash\ndn: uid=prueba,ou=Personas,dc=antonio,dc=gonzalonazareno,dc=org\nobjectClass: posixAccount\nobjectClass: inetOrgPerson\nobjectClass: top\ncn: prueba\ngidNumber: 2001\nhomeDirectory: /home/prueba\nloginShell: /bin/bash\nsn: prueba\nuid: prueba\nuidNumber: 2001\nuserPassword: {SSHA}sfqp8j+/1HHe7N6qcbDIrLkf3T2c4wIW\n\ndn: uid=macarena,ou=Personas,dc=antonio,dc=gonzalonazareno,dc=org\nobjectClass: posixAccount\nobjectClass: inetOrgPerson\nobjectClass: top\ncn: macarena\ngidNumber: 2002\nhomeDirectory: /home/macarena\nloginShell: /bin/bash\nsn: macarena\nuid: macarena\nuidNumber: 2002\nuserPassword: {SSHA}sCwMT7CqCloD4bzvED/1QB9xvUnZ0N5P\n\n```\n\nPara los hash de contraseñas la hemos creado con la utilidad slappasswd, que viene instalada con slapd.\n\n```bash\nroot@alfa:/home/antonio# slappasswd\nNew password: \nRe-enter new password: \n{SSHA}sfqp8j+/1HHe7N6qcbDIrLkf3T2c4wIW\n```\n\nPara agregar al usuario prueba y al usuario macarena debemos de volver a inyectar el fichero Usuario.ldif en el árbol de slapd, para ello ejecutamos el siguiente comando:\n\n```bash\nldapadd -x -D \"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org\" -f usuarios.ldif -W\n```\n\n![Descripción de la imagen](/images/slap1-4.png)\n\nLo que hemos hecho ha sido insertar registros en el objeto de personas, ahora vamos a crear un grupo, para ello crearemos un fichero llamado grupos.ldif, y le daremos el siguiente contenido:\n\n```bash\ndn: cn=desarrollo,ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org\nobjectClass: top\nobjectClass: groupOfNames\ncn: desarrollo\nmember:\n\ndn: cn=sistemas,ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org\nobjectClass: top\nobjectClass: groupOfNames\ncn: sistemas\nmember:\n```\n\nA continuación vamos a inyectar el fichero grupos.ldif en el árbol de slapd, para ello ejecutamos el siguiente comando:\n\n```bash\nldapadd -x -D \"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org\" -f grupos.ldif -W\n```\n\n![Descripción de la imagen](/images/slap1-5.png)\n\nLuego vamos a añadir a los usuarios a los grupos, para ello crearemos un fichero llamado personas-grupos.ldif, y le daremos el siguiente contenido:\n\n```bash\n# Al grupo de desarrollo\ndn: cn=desarrollo,ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org\nchangetype:modify\nadd: member\nmember: uid=prueba,ou=Personas,dc=antonio,dc=gonzalonazareno,dc=org\n\n# Al grupo de desarrollo y sistemas\ndn: cn=desarrollo,ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org\nchangetype:modify\nadd: member\nmember: uid=macarena,ou=Personas,dc=antonio,dc=gonzalonazareno,dc=org\n\ndn: cn=sistemas,ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org\nchangetype:modify\nadd: member\nmember: uid=macarena,ou=Personas,dc=antonio,dc=gonzalonazareno,dc=org\n```\n\nA continuación vamos a inyectar el fichero personas-grupos.ldif en el árbol de slapd, para ello ejecutamos el siguiente comando:\n\n```bash\nldapmodify -x -D \"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org\" -f personas-grupos.ldif -W\n```\n\n![Descripción de la imagen](/images/slap1-6.png)\n\nPodríamos usar también ldapmodify que es una herramiente enfocada a la modificación, pero para nuestro caso ambas nos sirven.\n\nUsando el comando ldapsearch podemos ver que los usuarios están en los grupos:\n\n```bash\nldapsearch -x -D \"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org\" -b \"cn=desarrollo,ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org\" -W\n```\n\n```bash\nroot@alfa:/home/antonio# ldapsearch -x -b ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org\n# extended LDIF\n#\n# LDAPv3\n# base <ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org> with scope subtree\n# filter: (objectclass=*)\n# requesting: ALL\n#\n\n# Grupos, antonio.gonzalonazareno.org\ndn: ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org\nobjectClass: organizationalUnit\nou: Grupos\n\n# sistemas, Grupos, antonio.gonzalonazareno.org\ndn: cn=sistemas,ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org\nobjectClass: top\nobjectClass: groupOfNames\ncn: sistemas\nmember:\nmember: uid=macarena,ou=Personas,dc=antonio,dc=gonzalonazareno,dc=org\n\n# desarrollo, Grupos, antonio.gonzalonazareno.org\ndn: cn=desarrollo,ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org\nobjectClass: top\nobjectClass: groupOfNames\ncn: desarrollo\nmember:\nmember: uid=prueba,ou=Personas,dc=antonio,dc=gonzalonazareno,dc=org\nmember: uid=macarena,ou=Personas,dc=antonio,dc=gonzalonazareno,dc=org\n\n# search result\nsearch: 2\nresult: 0 Success\n\n# numResponses: 6\n# numEntries: 5\n```\n\nSi queremos borrar un elemento del árbol podemos realizarlo gracias a la siguiente instrucción:\n\n```bash\nldapdelete -x -D 'cn=admin,dc=antonio,dc=gonzalonazareno,dc=org' -W cn=reabastecimiento,ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org\n```\n\n\nDesplegar árbol a través de NFS:\n\n\napt-get install nfs-kernel-server -y\n\nNos vamos a /etc/exportfs y añadimos la siguiente línea:\n```bash\n/home/antonio/nfs *(rw,fsid=0,subtree_check,no_root_squash)\n```\n\nAhora ejecutamos `exportfs -a`\n\n```bash\nroot@alfa:/home/antonio# mkdir nfs\nroot@alfa:/home/antonio# mkdir nfs/almacenamiento\n```\n\n\nComenzamos con la configuración del paquete nscd. Este es un demonio de caché para el servicio de nombres, lo cual evitará repetir consultas de las bases de datos de passwd, group y hosts.\n\n\n```bash\napt install libnss-ldapd libpam-ldapd nscd -y\n```\n\nLuego de configurar el instalador de forma que capture la ip 127.0.0.1 y el nombre dc=antonio,dc=gonzalonazareno,dc=org, debemos editar el fichero /etc/nsswitch.conf, y añadir las siguientes líneas:\n\n![Descripción de la imagen](/images/slap1-7.png)\n\n\n## Cliente Ubuntu\n\n```bash\napt-get install libnss-ldapd libpam-ldapd nscd nfs-kernel-server -y\n```\n\nIntroducimos la dirección IP del servidor LDAP y el nombre del dominio:\n\n![Descripción de la imagen](/images/slap1-8.png)\n\nEn el fichero /etc/ldap/ldap.conf se establecen los parámetros de configuración del cliente LDAP. En este fichero se establece la dirección del servidor LDAP, el puerto, el dominio, el tipo de autenticación, etc.\n\n```bash\n#\n# LDAP Defaults\n#\n\n# See ldap.conf(5) for details\n# This file should be world readable but not world writable.\n\nBASE    dc=antonio,dc=gonzalonazareno,dc=org\nURI     ldap://192.168.0.1\n\nSIZELIMIT       12\nTIMELIMIT       15\nDEREF           never\n\n# TLS certificates (needed for GnuTLS)\nTLS_CACERT      /etc/ssl/certs/ca-certificates.crt\n```\n\n\nAhora necesitaremos configurar el cliente para que al iniciar sesión cree el home del usuario. Para ello editamos el fichero /etc/pam.d/common-account y añadimos la siguiente línea:\n\n```bash\nsession required pam_mkhomedir.so skel=/etc/skel/ umask=0022\n\n```\n\nVamos a probar montando de manera efímera el directorio en el cual se va a crear el home del usuario macarena:\n\n```bash\nmount -t nfs 192.168.0.1:/home/antonio/nfs/ /home\n```\n\n\nAhora cuando el usuario macarena inicie sesión este se verá reflejado en nuestro servidor nfs, probaremos creando un documento txt:\n\n\n![Descripción de la imagen](/images/slap1-9.png)\n\nAhora vamos a hacer que este recurso funcione de manera permanente, para ello podríamos editar el fichero fstab, o bien crear una unidad de systemd, que en este caso es lo que vamos a emplear.\n\n\nnano /etc/systemd/system/home.mount\n```bash\n[Unit]\nDescription= Montaje de carpeta home para NFS\n\n[Mount]\nWhat=192.168.0.1:/home/antonio/nfs\nWhere=/home   \nType=nfs\nOptions=defaults\n\n[Install]\nWantedBy=multi-user.target\n\n```\n\nsystemctl daemon-reload\nsystemctl enable home.mount\nsystemctl start home.mount\nsystemctl status home.mount\n\n![Descripción de la imagen](/images/slap1-10.png)\n\n## Cliente Rocky Linux\n\n```bash\ndnf install openldap-clients sssd sssd-ldap oddjob-mkhomedir sssd-tools -y\n```\n\n```bash\nauthselect list\n```\n\n```bash\n[root@bravo antonio]# authselect list\n- minimal\t Local users only for minimal installations\n- sssd   \t Enable SSSD for system authentication (also for local users only)\n- winbind\t Enable winbind for system authentication\n\n```\n\n```bash\nauthselect select sssd with-mkhomedir --force\n```\n\nvolvemos a especificar la dirección IP del servidor LDAP y el nombre del dominio en /etc/openldap/ldap.conf:\n\n```bash\nBASE dc=antonio,dc=gonzalonazareno,dc=org\nURI ldap://172.16.0.1\n\n\nSIZELIMIT       12\nTIMELIMIT       15\nDEREF           never\n```\n\nsudo nano /etc/sssd/sssd.conf\n\n```bash\n[domain/default]\nid_provider = ldap\nautofs_provider = ldap\nauth_provider = ldap\nchpass_provider = ldap\nldap_uri = ldap://172.0.16.1\nldap_search_base = dc=antonio,dc=gonzalonazareno,dc=org\nldap_id_use_start_tls = True\nldap_tls_cacertdir = /etc/openldap/cacerts\ncache_credentials = True\nldap_tls_reqcert = allow\n\n[sssd]\nservices = nss, pam, autofs\ndomains = default\n\n[nss]\nhomedir_substring = /home/nfs\n\n```\n\n\n```bash\nchmod 0600 /etc/sssd/sssd.conf\nsystemctl restart sssd\n```\n\nauthconfig --enablemkhomedir --updateall\n\n\n\n```bash\nauthconfig --enableldap \\\n--enableldapauth \\\n--ldapserver=antonio.gonzalonazareno.org \\\n--ldapbasedn=\"dc=antonio,dc=gonzalonazareno,dc=org\" \\\n--enablemkhomedir \\\n--update\n```\n\n![Descripción de la imagen](/images/slap1-11.png)\n\n","slug":"slap-nfs","published":1,"date":"2023-01-31T23:48:29.644Z","updated":"2023-02-01T05:18:03.220Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cldl8a0pe000x2fi58sishr95","content":"<p><img src=\"/images/LOGO-LDAP.png\" alt=\"Descripción de la imagen\"></p>\n<h1 id=\"directorios-centralizados-con-ldap-y-nfs\"><a class=\"markdownIt-Anchor\" href=\"#directorios-centralizados-con-ldap-y-nfs\">#</a> Directorios centralizados con LDAP y NFS</h1>\n<h2 id=\"introducción\"><a class=\"markdownIt-Anchor\" href=\"#introducción\">#</a> Introducción</h2>\n<p>En este post vamos a ver como crear un directorio centralizado con LDAP y NFS.</p>\n<h2 id=\"instalación-de-ldap\"><a class=\"markdownIt-Anchor\" href=\"#instalación-de-ldap\">#</a> Instalación de LDAP</h2>\n<p>Para instalar LDAP vamos a usar el paquete slapd, que es el servidor LDAP.</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">apt</span> <span class=\"token function\">install</span> slapd</pre></td></tr></table></figure><p>Una vez instalado vamos a configurarlo, para ello ejecutamos el comando:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>dpkg-reconfigure slap-utils</pre></td></tr></table></figure><p>Nos pedirá que introduzcamos la contraseña de del usuario root del servidor slapd, y nos preguntará si queremos usar el dominio de la máquina o no, en este caso vamos a usar el dominio de la máquina.</p>\n<p>Con el siguiente comando podremos ver la información del usuario root en el dominio <a href=\"http://gonzanonazareno.org\">gonzanonazareno.org</a></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ldapsearch <span class=\"token parameter variable\">-x</span> <span class=\"token parameter variable\">-D</span> <span class=\"token string\">\"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org\"</span> <span class=\"token parameter variable\">-b</span> <span class=\"token string\">\"dc=antonio,dc=gonzalonazareno,dc=org\"</span> <span class=\"token parameter variable\">-W</span></pre></td></tr></table></figure><p><img src=\"/images/slap1-1.png\" alt=\"Descripción de la imagen\"></p>\n<p>Ahora crearemos una unidad organizativa, en este caso la llamaremos Organizacion.ldif, y le daremos el siguiente contenido:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>dn: <span class=\"token assign-left variable\">ou</span><span class=\"token operator\">=</span>Personas,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>objectClass: organizationalUnit</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>ou: Personas</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>dn: <span class=\"token assign-left variable\">ou</span><span class=\"token operator\">=</span>Grupos,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>objectClass: organizationalUnit</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>ou: Grupos</pre></td></tr></table></figure><p>“dn” significa Distinguished Name, e indica el nombre distintivo que el objeto tendrá dentro de la jerarquía de directorios, y “objectClass” es la clase de objeto, en este caso es una unidad organizativa.</p>\n<p>Procedemos a ejecutar el siguiente comando para inyectar los nuevos objetos en el árbol de slapd:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ldapadd <span class=\"token parameter variable\">-x</span> <span class=\"token parameter variable\">-D</span> <span class=\"token string\">\"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org\"</span> <span class=\"token parameter variable\">-f</span> UnidadesOrganizativas.ldif <span class=\"token parameter variable\">-W</span></pre></td></tr></table></figure><p><img src=\"/images/slap1-2.png\" alt=\"Descripción de la imagen\"></p>\n<p>Ahora si volvemos a ejecutar el comando</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ldapsearch <span class=\"token parameter variable\">-x</span> <span class=\"token parameter variable\">-D</span> <span class=\"token string\">\"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org\"</span> <span class=\"token parameter variable\">-b</span> <span class=\"token string\">\"dc=antonio,dc=gonzalonazareno,dc=org\"</span> <span class=\"token parameter variable\">-W</span></pre></td></tr></table></figure><p>Podremos ver que se han creado los nuevos objetos llamados Personas y Grupos.</p>\n<p><img src=\"/images/slap1-3.png\" alt=\"Descripción de la imagen\"></p>\n<p>Ahora vamos a crear un usuario, para ello crearemos un fichero llamado usuarios.ldif, y le daremos el siguiente contenido:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>dn: <span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span>prueba,ou<span class=\"token operator\">=</span>Personas,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>objectClass: posixAccount</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>objectClass: inetOrgPerson</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>objectClass: <span class=\"token function\">top</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>cn: prueba</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>gidNumber: <span class=\"token number\">2001</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>homeDirectory: /home/prueba</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>loginShell: /bin/bash</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>sn: prueba</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>uid: prueba</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>uidNumber: <span class=\"token number\">2001</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>userPassword: <span class=\"token punctuation\">&#123;</span>SSHA<span class=\"token punctuation\">&#125;</span>sfqp8j+/1HHe7N6qcbDIrLkf3T2c4wIW</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>dn: <span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span>macarena,ou<span class=\"token operator\">=</span>Personas,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>objectClass: posixAccount</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>objectClass: inetOrgPerson</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>objectClass: <span class=\"token function\">top</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>cn: macarena</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>gidNumber: <span class=\"token number\">2002</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>homeDirectory: /home/macarena</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>loginShell: /bin/bash</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>sn: macarena</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>uid: macarena</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>uidNumber: <span class=\"token number\">2002</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>userPassword: <span class=\"token punctuation\">&#123;</span>SSHA<span class=\"token punctuation\">&#125;</span>sCwMT7CqCloD4bzvED/1QB9xvUnZ0N5P</pre></td></tr></table></figure><p>Para los hash de contraseñas la hemos creado con la utilidad slappasswd, que viene instalada con slapd.</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>root@alfa:/home/antonio<span class=\"token comment\"># slappasswd</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>New password: </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Re-enter new password: </pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#123;</span>SSHA<span class=\"token punctuation\">&#125;</span>sfqp8j+/1HHe7N6qcbDIrLkf3T2c4wIW</pre></td></tr></table></figure><p>Para agregar al usuario prueba y al usuario macarena debemos de volver a inyectar el fichero Usuario.ldif en el árbol de slapd, para ello ejecutamos el siguiente comando:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ldapadd <span class=\"token parameter variable\">-x</span> <span class=\"token parameter variable\">-D</span> <span class=\"token string\">\"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org\"</span> <span class=\"token parameter variable\">-f</span> usuarios.ldif <span class=\"token parameter variable\">-W</span></pre></td></tr></table></figure><p><img src=\"/images/slap1-4.png\" alt=\"Descripción de la imagen\"></p>\n<p>Lo que hemos hecho ha sido insertar registros en el objeto de personas, ahora vamos a crear un grupo, para ello crearemos un fichero llamado grupos.ldif, y le daremos el siguiente contenido:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>dn: <span class=\"token assign-left variable\">cn</span><span class=\"token operator\">=</span>desarrollo,ou<span class=\"token operator\">=</span>Grupos,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>objectClass: <span class=\"token function\">top</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>objectClass: groupOfNames</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>cn: desarrollo</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>member:</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>dn: <span class=\"token assign-left variable\">cn</span><span class=\"token operator\">=</span>sistemas,ou<span class=\"token operator\">=</span>Grupos,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>objectClass: <span class=\"token function\">top</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>objectClass: groupOfNames</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>cn: sistemas</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>member:</pre></td></tr></table></figure><p>A continuación vamos a inyectar el fichero grupos.ldif en el árbol de slapd, para ello ejecutamos el siguiente comando:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ldapadd <span class=\"token parameter variable\">-x</span> <span class=\"token parameter variable\">-D</span> <span class=\"token string\">\"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org\"</span> <span class=\"token parameter variable\">-f</span> grupos.ldif <span class=\"token parameter variable\">-W</span></pre></td></tr></table></figure><p><img src=\"/images/slap1-5.png\" alt=\"Descripción de la imagen\"></p>\n<p>Luego vamos a añadir a los usuarios a los grupos, para ello crearemos un fichero llamado personas-grupos.ldif, y le daremos el siguiente contenido:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># Al grupo de desarrollo</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>dn: <span class=\"token assign-left variable\">cn</span><span class=\"token operator\">=</span>desarrollo,ou<span class=\"token operator\">=</span>Grupos,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>changetype:modify</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>add: member</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>member: <span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span>prueba,ou<span class=\"token operator\">=</span>Personas,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># Al grupo de desarrollo y sistemas</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>dn: <span class=\"token assign-left variable\">cn</span><span class=\"token operator\">=</span>desarrollo,ou<span class=\"token operator\">=</span>Grupos,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>changetype:modify</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>add: member</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>member: <span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span>macarena,ou<span class=\"token operator\">=</span>Personas,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>dn: <span class=\"token assign-left variable\">cn</span><span class=\"token operator\">=</span>sistemas,ou<span class=\"token operator\">=</span>Grupos,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>changetype:modify</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>add: member</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>member: <span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span>macarena,ou<span class=\"token operator\">=</span>Personas,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr></table></figure><p>A continuación vamos a inyectar el fichero personas-grupos.ldif en el árbol de slapd, para ello ejecutamos el siguiente comando:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ldapmodify <span class=\"token parameter variable\">-x</span> <span class=\"token parameter variable\">-D</span> <span class=\"token string\">\"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org\"</span> <span class=\"token parameter variable\">-f</span> personas-grupos.ldif <span class=\"token parameter variable\">-W</span></pre></td></tr></table></figure><p><img src=\"/images/slap1-6.png\" alt=\"Descripción de la imagen\"></p>\n<p>Podríamos usar también ldapmodify que es una herramiente enfocada a la modificación, pero para nuestro caso ambas nos sirven.</p>\n<p>Usando el comando ldapsearch podemos ver que los usuarios están en los grupos:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ldapsearch <span class=\"token parameter variable\">-x</span> <span class=\"token parameter variable\">-D</span> <span class=\"token string\">\"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org\"</span> <span class=\"token parameter variable\">-b</span> <span class=\"token string\">\"cn=desarrollo,ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org\"</span> <span class=\"token parameter variable\">-W</span></pre></td></tr></table></figure><figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>root@alfa:/home/antonio<span class=\"token comment\"># ldapsearch -x -b ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># extended LDIF</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># LDAPv3</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># base &lt;ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org> with scope subtree</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># filter: (objectclass=*)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># requesting: ALL</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># Grupos, antonio.gonzalonazareno.org</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>dn: <span class=\"token assign-left variable\">ou</span><span class=\"token operator\">=</span>Grupos,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>objectClass: organizationalUnit</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>ou: Grupos</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\"># sistemas, Grupos, antonio.gonzalonazareno.org</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>dn: <span class=\"token assign-left variable\">cn</span><span class=\"token operator\">=</span>sistemas,ou<span class=\"token operator\">=</span>Grupos,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>objectClass: <span class=\"token function\">top</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>objectClass: groupOfNames</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>cn: sistemas</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>member:</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>member: <span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span>macarena,ou<span class=\"token operator\">=</span>Personas,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\"># desarrollo, Grupos, antonio.gonzalonazareno.org</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>dn: <span class=\"token assign-left variable\">cn</span><span class=\"token operator\">=</span>desarrollo,ou<span class=\"token operator\">=</span>Grupos,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>objectClass: <span class=\"token function\">top</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>objectClass: groupOfNames</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>cn: desarrollo</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>member:</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>member: <span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span>prueba,ou<span class=\"token operator\">=</span>Personas,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>member: <span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span>macarena,ou<span class=\"token operator\">=</span>Personas,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\"># search result</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>search: <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>result: <span class=\"token number\">0</span> Success</pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\"># numResponses: 6</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token comment\"># numEntries: 5</span></pre></td></tr></table></figure><p>Si queremos borrar un elemento del árbol podemos realizarlo gracias a la siguiente instrucción:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ldapdelete <span class=\"token parameter variable\">-x</span> <span class=\"token parameter variable\">-D</span> <span class=\"token string\">'cn=admin,dc=antonio,dc=gonzalonazareno,dc=org'</span> <span class=\"token parameter variable\">-W</span> <span class=\"token assign-left variable\">cn</span><span class=\"token operator\">=</span>reabastecimiento,ou<span class=\"token operator\">=</span>Grupos,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr></table></figure><p>Desplegar árbol a través de NFS:</p>\n<p>apt-get install nfs-kernel-server -y</p>\n<p>Nos vamos a /etc/exportfs y añadimos la siguiente línea:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>/home/antonio/nfs *<span class=\"token punctuation\">(</span>rw,fsid<span class=\"token operator\">=</span><span class=\"token number\">0</span>,subtree_check,no_root_squash<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>Ahora ejecutamos  <code>exportfs -a</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>root@alfa:/home/antonio<span class=\"token comment\"># mkdir nfs</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>root@alfa:/home/antonio<span class=\"token comment\"># mkdir nfs/almacenamiento</span></pre></td></tr></table></figure><p>Comenzamos con la configuración del paquete nscd. Este es un demonio de caché para el servicio de nombres, lo cual evitará repetir consultas de las bases de datos de passwd, group y hosts.</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">apt</span> <span class=\"token function\">install</span> libnss-ldapd libpam-ldapd nscd <span class=\"token parameter variable\">-y</span></pre></td></tr></table></figure><p>Luego de configurar el instalador de forma que capture la ip 127.0.0.1 y el nombre dc=antonio,dc=gonzalonazareno,dc=org, debemos editar el fichero /etc/nsswitch.conf, y añadir las siguientes líneas:</p>\n<p><img src=\"/images/slap1-7.png\" alt=\"Descripción de la imagen\"></p>\n<h2 id=\"cliente-ubuntu\"><a class=\"markdownIt-Anchor\" href=\"#cliente-ubuntu\">#</a> Cliente Ubuntu</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> libnss-ldapd libpam-ldapd nscd nfs-kernel-server <span class=\"token parameter variable\">-y</span></pre></td></tr></table></figure><p>Introducimos la dirección IP del servidor LDAP y el nombre del dominio:</p>\n<p><img src=\"/images/slap1-8.png\" alt=\"Descripción de la imagen\"></p>\n<p>En el fichero /etc/ldap/ldap.conf se establecen los parámetros de configuración del cliente LDAP. En este fichero se establece la dirección del servidor LDAP, el puerto, el dominio, el tipo de autenticación, etc.</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># LDAP Defaults</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># See ldap.conf(5) for details</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># This file should be world readable but not world writable.</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>BASE    <span class=\"token assign-left variable\">dc</span><span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>URI     ldap://192.168.0.1</pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>SIZELIMIT       <span class=\"token number\">12</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>TIMELIMIT       <span class=\"token number\">15</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>DEREF           never</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\"># TLS certificates (needed for GnuTLS)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>TLS_CACERT      /etc/ssl/certs/ca-certificates.crt</pre></td></tr></table></figure><p>Ahora necesitaremos configurar el cliente para que al iniciar sesión cree el home del usuario. Para ello editamos el fichero /etc/pam.d/common-account y añadimos la siguiente línea:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>session required pam_mkhomedir.so <span class=\"token assign-left variable\">skel</span><span class=\"token operator\">=</span>/etc/skel/ <span class=\"token assign-left variable\">umask</span><span class=\"token operator\">=</span>0022</pre></td></tr></table></figure><p>Vamos a probar montando de manera efímera el directorio en el cual se va a crear el home del usuario macarena:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">mount</span> <span class=\"token parameter variable\">-t</span> nfs <span class=\"token number\">192.168</span>.0.1:/home/antonio/nfs/ /home</pre></td></tr></table></figure><p>Ahora cuando el usuario macarena inicie sesión este se verá reflejado en nuestro servidor nfs, probaremos creando un documento txt:</p>\n<p><img src=\"/images/slap1-9.png\" alt=\"Descripción de la imagen\"></p>\n<p>Ahora vamos a hacer que este recurso funcione de manera permanente, para ello podríamos editar el fichero fstab, o bien crear una unidad de systemd, que en este caso es lo que vamos a emplear.</p>\n<p>nano /etc/systemd/system/home.mount</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>Unit<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">Description</span><span class=\"token operator\">=</span> Montaje de carpeta home para NFS</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>Mount<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token assign-left variable\">What</span><span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.0.1:/home/antonio/nfs</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token assign-left variable\">Where</span><span class=\"token operator\">=</span>/home   </pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">Type</span><span class=\"token operator\">=</span>nfs</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token assign-left variable\">Options</span><span class=\"token operator\">=</span>defaults</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>Install<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token assign-left variable\">WantedBy</span><span class=\"token operator\">=</span>multi-user.target</pre></td></tr></table></figure><p>systemctl daemon-reload<br>\nsystemctl enable home.mount<br>\nsystemctl start home.mount<br>\nsystemctl status home.mount</p>\n<p><img src=\"/images/slap1-10.png\" alt=\"Descripción de la imagen\"></p>\n<h2 id=\"cliente-rocky-linux\"><a class=\"markdownIt-Anchor\" href=\"#cliente-rocky-linux\">#</a> Cliente Rocky Linux</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>dnf <span class=\"token function\">install</span> openldap-clients sssd sssd-ldap oddjob-mkhomedir sssd-tools <span class=\"token parameter variable\">-y</span></pre></td></tr></table></figure><figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>authselect list</pre></td></tr></table></figure><figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@bravo antonio<span class=\"token punctuation\">]</span><span class=\"token comment\"># authselect list</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>- minimal\t Local <span class=\"token function\">users</span> only <span class=\"token keyword\">for</span> minimal installations</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>- sssd   \t Enable SSSD <span class=\"token keyword\">for</span> system authentication <span class=\"token punctuation\">(</span>also <span class=\"token keyword\">for</span> <span class=\"token builtin class-name\">local</span> <span class=\"token function\">users</span> only<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>- winbind\t Enable winbind <span class=\"token keyword\">for</span> system authentication</pre></td></tr></table></figure><figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>authselect <span class=\"token keyword\">select</span> sssd with-mkhomedir <span class=\"token parameter variable\">--force</span></pre></td></tr></table></figure><p>volvemos a especificar la dirección IP del servidor LDAP y el nombre del dominio en /etc/openldap/ldap.conf:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>BASE <span class=\"token assign-left variable\">dc</span><span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>URI ldap://172.16.0.1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>SIZELIMIT       <span class=\"token number\">12</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>TIMELIMIT       <span class=\"token number\">15</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>DEREF           never</pre></td></tr></table></figure><p>sudo nano /etc/sssd/sssd.conf</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>domain/default<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>id_provider <span class=\"token operator\">=</span> ldap</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>autofs_provider <span class=\"token operator\">=</span> ldap</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>auth_provider <span class=\"token operator\">=</span> ldap</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>chpass_provider <span class=\"token operator\">=</span> ldap</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>ldap_uri <span class=\"token operator\">=</span> ldap://172.0.16.1</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>ldap_search_base <span class=\"token operator\">=</span> <span class=\"token assign-left variable\">dc</span><span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>ldap_id_use_start_tls <span class=\"token operator\">=</span> True</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>ldap_tls_cacertdir <span class=\"token operator\">=</span> /etc/openldap/cacerts</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>cache_credentials <span class=\"token operator\">=</span> True</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>ldap_tls_reqcert <span class=\"token operator\">=</span> allow</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">[</span>sssd<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>services <span class=\"token operator\">=</span> nss, pam, autofs</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>domains <span class=\"token operator\">=</span> default</pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">[</span>nss<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>homedir_substring <span class=\"token operator\">=</span> /home/nfs</pre></td></tr></table></figure><figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">chmod</span> 0600 /etc/sssd/sssd.conf</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>systemctl restart sssd</pre></td></tr></table></figure><p>authconfig --enablemkhomedir --updateall</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>authconfig <span class=\"token parameter variable\">--enableldap</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token parameter variable\">--enableldapauth</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token parameter variable\">--ldapserver</span><span class=\"token operator\">=</span>antonio.gonzalonazareno.org <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token parameter variable\">--ldapbasedn</span><span class=\"token operator\">=</span><span class=\"token string\">\"dc=antonio,dc=gonzalonazareno,dc=org\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token parameter variable\">--enablemkhomedir</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token parameter variable\">--update</span></pre></td></tr></table></figure><p><img src=\"/images/slap1-11.png\" alt=\"Descripción de la imagen\"></p>\n","site":{"data":{}},"length":8704,"excerpt":"","more":"<p><img src=\"/images/LOGO-LDAP.png\" alt=\"Descripción de la imagen\"></p>\n<h1 id=\"directorios-centralizados-con-ldap-y-nfs\"><a class=\"markdownIt-Anchor\" href=\"#directorios-centralizados-con-ldap-y-nfs\">#</a> Directorios centralizados con LDAP y NFS</h1>\n<h2 id=\"introducción\"><a class=\"markdownIt-Anchor\" href=\"#introducción\">#</a> Introducción</h2>\n<p>En este post vamos a ver como crear un directorio centralizado con LDAP y NFS.</p>\n<h2 id=\"instalación-de-ldap\"><a class=\"markdownIt-Anchor\" href=\"#instalación-de-ldap\">#</a> Instalación de LDAP</h2>\n<p>Para instalar LDAP vamos a usar el paquete slapd, que es el servidor LDAP.</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">apt</span> <span class=\"token function\">install</span> slapd</pre></td></tr></table></figure><p>Una vez instalado vamos a configurarlo, para ello ejecutamos el comando:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>dpkg-reconfigure slap-utils</pre></td></tr></table></figure><p>Nos pedirá que introduzcamos la contraseña de del usuario root del servidor slapd, y nos preguntará si queremos usar el dominio de la máquina o no, en este caso vamos a usar el dominio de la máquina.</p>\n<p>Con el siguiente comando podremos ver la información del usuario root en el dominio <a href=\"http://gonzanonazareno.org\">gonzanonazareno.org</a></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ldapsearch <span class=\"token parameter variable\">-x</span> <span class=\"token parameter variable\">-D</span> <span class=\"token string\">\"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org\"</span> <span class=\"token parameter variable\">-b</span> <span class=\"token string\">\"dc=antonio,dc=gonzalonazareno,dc=org\"</span> <span class=\"token parameter variable\">-W</span></pre></td></tr></table></figure><p><img src=\"/images/slap1-1.png\" alt=\"Descripción de la imagen\"></p>\n<p>Ahora crearemos una unidad organizativa, en este caso la llamaremos Organizacion.ldif, y le daremos el siguiente contenido:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>dn: <span class=\"token assign-left variable\">ou</span><span class=\"token operator\">=</span>Personas,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>objectClass: organizationalUnit</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>ou: Personas</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>dn: <span class=\"token assign-left variable\">ou</span><span class=\"token operator\">=</span>Grupos,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>objectClass: organizationalUnit</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>ou: Grupos</pre></td></tr></table></figure><p>“dn” significa Distinguished Name, e indica el nombre distintivo que el objeto tendrá dentro de la jerarquía de directorios, y “objectClass” es la clase de objeto, en este caso es una unidad organizativa.</p>\n<p>Procedemos a ejecutar el siguiente comando para inyectar los nuevos objetos en el árbol de slapd:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ldapadd <span class=\"token parameter variable\">-x</span> <span class=\"token parameter variable\">-D</span> <span class=\"token string\">\"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org\"</span> <span class=\"token parameter variable\">-f</span> UnidadesOrganizativas.ldif <span class=\"token parameter variable\">-W</span></pre></td></tr></table></figure><p><img src=\"/images/slap1-2.png\" alt=\"Descripción de la imagen\"></p>\n<p>Ahora si volvemos a ejecutar el comando</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ldapsearch <span class=\"token parameter variable\">-x</span> <span class=\"token parameter variable\">-D</span> <span class=\"token string\">\"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org\"</span> <span class=\"token parameter variable\">-b</span> <span class=\"token string\">\"dc=antonio,dc=gonzalonazareno,dc=org\"</span> <span class=\"token parameter variable\">-W</span></pre></td></tr></table></figure><p>Podremos ver que se han creado los nuevos objetos llamados Personas y Grupos.</p>\n<p><img src=\"/images/slap1-3.png\" alt=\"Descripción de la imagen\"></p>\n<p>Ahora vamos a crear un usuario, para ello crearemos un fichero llamado usuarios.ldif, y le daremos el siguiente contenido:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>dn: <span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span>prueba,ou<span class=\"token operator\">=</span>Personas,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>objectClass: posixAccount</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>objectClass: inetOrgPerson</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>objectClass: <span class=\"token function\">top</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>cn: prueba</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>gidNumber: <span class=\"token number\">2001</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>homeDirectory: /home/prueba</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>loginShell: /bin/bash</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>sn: prueba</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>uid: prueba</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>uidNumber: <span class=\"token number\">2001</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>userPassword: <span class=\"token punctuation\">&#123;</span>SSHA<span class=\"token punctuation\">&#125;</span>sfqp8j+/1HHe7N6qcbDIrLkf3T2c4wIW</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>dn: <span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span>macarena,ou<span class=\"token operator\">=</span>Personas,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>objectClass: posixAccount</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>objectClass: inetOrgPerson</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>objectClass: <span class=\"token function\">top</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>cn: macarena</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>gidNumber: <span class=\"token number\">2002</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>homeDirectory: /home/macarena</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>loginShell: /bin/bash</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>sn: macarena</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>uid: macarena</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>uidNumber: <span class=\"token number\">2002</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>userPassword: <span class=\"token punctuation\">&#123;</span>SSHA<span class=\"token punctuation\">&#125;</span>sCwMT7CqCloD4bzvED/1QB9xvUnZ0N5P</pre></td></tr></table></figure><p>Para los hash de contraseñas la hemos creado con la utilidad slappasswd, que viene instalada con slapd.</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>root@alfa:/home/antonio<span class=\"token comment\"># slappasswd</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>New password: </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Re-enter new password: </pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#123;</span>SSHA<span class=\"token punctuation\">&#125;</span>sfqp8j+/1HHe7N6qcbDIrLkf3T2c4wIW</pre></td></tr></table></figure><p>Para agregar al usuario prueba y al usuario macarena debemos de volver a inyectar el fichero Usuario.ldif en el árbol de slapd, para ello ejecutamos el siguiente comando:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ldapadd <span class=\"token parameter variable\">-x</span> <span class=\"token parameter variable\">-D</span> <span class=\"token string\">\"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org\"</span> <span class=\"token parameter variable\">-f</span> usuarios.ldif <span class=\"token parameter variable\">-W</span></pre></td></tr></table></figure><p><img src=\"/images/slap1-4.png\" alt=\"Descripción de la imagen\"></p>\n<p>Lo que hemos hecho ha sido insertar registros en el objeto de personas, ahora vamos a crear un grupo, para ello crearemos un fichero llamado grupos.ldif, y le daremos el siguiente contenido:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>dn: <span class=\"token assign-left variable\">cn</span><span class=\"token operator\">=</span>desarrollo,ou<span class=\"token operator\">=</span>Grupos,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>objectClass: <span class=\"token function\">top</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>objectClass: groupOfNames</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>cn: desarrollo</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>member:</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>dn: <span class=\"token assign-left variable\">cn</span><span class=\"token operator\">=</span>sistemas,ou<span class=\"token operator\">=</span>Grupos,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>objectClass: <span class=\"token function\">top</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>objectClass: groupOfNames</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>cn: sistemas</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>member:</pre></td></tr></table></figure><p>A continuación vamos a inyectar el fichero grupos.ldif en el árbol de slapd, para ello ejecutamos el siguiente comando:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ldapadd <span class=\"token parameter variable\">-x</span> <span class=\"token parameter variable\">-D</span> <span class=\"token string\">\"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org\"</span> <span class=\"token parameter variable\">-f</span> grupos.ldif <span class=\"token parameter variable\">-W</span></pre></td></tr></table></figure><p><img src=\"/images/slap1-5.png\" alt=\"Descripción de la imagen\"></p>\n<p>Luego vamos a añadir a los usuarios a los grupos, para ello crearemos un fichero llamado personas-grupos.ldif, y le daremos el siguiente contenido:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># Al grupo de desarrollo</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>dn: <span class=\"token assign-left variable\">cn</span><span class=\"token operator\">=</span>desarrollo,ou<span class=\"token operator\">=</span>Grupos,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>changetype:modify</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>add: member</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>member: <span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span>prueba,ou<span class=\"token operator\">=</span>Personas,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># Al grupo de desarrollo y sistemas</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>dn: <span class=\"token assign-left variable\">cn</span><span class=\"token operator\">=</span>desarrollo,ou<span class=\"token operator\">=</span>Grupos,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>changetype:modify</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>add: member</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>member: <span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span>macarena,ou<span class=\"token operator\">=</span>Personas,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>dn: <span class=\"token assign-left variable\">cn</span><span class=\"token operator\">=</span>sistemas,ou<span class=\"token operator\">=</span>Grupos,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>changetype:modify</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>add: member</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>member: <span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span>macarena,ou<span class=\"token operator\">=</span>Personas,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr></table></figure><p>A continuación vamos a inyectar el fichero personas-grupos.ldif en el árbol de slapd, para ello ejecutamos el siguiente comando:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ldapmodify <span class=\"token parameter variable\">-x</span> <span class=\"token parameter variable\">-D</span> <span class=\"token string\">\"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org\"</span> <span class=\"token parameter variable\">-f</span> personas-grupos.ldif <span class=\"token parameter variable\">-W</span></pre></td></tr></table></figure><p><img src=\"/images/slap1-6.png\" alt=\"Descripción de la imagen\"></p>\n<p>Podríamos usar también ldapmodify que es una herramiente enfocada a la modificación, pero para nuestro caso ambas nos sirven.</p>\n<p>Usando el comando ldapsearch podemos ver que los usuarios están en los grupos:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ldapsearch <span class=\"token parameter variable\">-x</span> <span class=\"token parameter variable\">-D</span> <span class=\"token string\">\"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org\"</span> <span class=\"token parameter variable\">-b</span> <span class=\"token string\">\"cn=desarrollo,ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org\"</span> <span class=\"token parameter variable\">-W</span></pre></td></tr></table></figure><figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>root@alfa:/home/antonio<span class=\"token comment\"># ldapsearch -x -b ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># extended LDIF</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># LDAPv3</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># base &lt;ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org> with scope subtree</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># filter: (objectclass=*)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># requesting: ALL</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># Grupos, antonio.gonzalonazareno.org</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>dn: <span class=\"token assign-left variable\">ou</span><span class=\"token operator\">=</span>Grupos,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>objectClass: organizationalUnit</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>ou: Grupos</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\"># sistemas, Grupos, antonio.gonzalonazareno.org</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>dn: <span class=\"token assign-left variable\">cn</span><span class=\"token operator\">=</span>sistemas,ou<span class=\"token operator\">=</span>Grupos,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>objectClass: <span class=\"token function\">top</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>objectClass: groupOfNames</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>cn: sistemas</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>member:</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>member: <span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span>macarena,ou<span class=\"token operator\">=</span>Personas,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\"># desarrollo, Grupos, antonio.gonzalonazareno.org</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>dn: <span class=\"token assign-left variable\">cn</span><span class=\"token operator\">=</span>desarrollo,ou<span class=\"token operator\">=</span>Grupos,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>objectClass: <span class=\"token function\">top</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>objectClass: groupOfNames</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>cn: desarrollo</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>member:</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>member: <span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span>prueba,ou<span class=\"token operator\">=</span>Personas,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>member: <span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span>macarena,ou<span class=\"token operator\">=</span>Personas,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\"># search result</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>search: <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>result: <span class=\"token number\">0</span> Success</pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\"># numResponses: 6</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token comment\"># numEntries: 5</span></pre></td></tr></table></figure><p>Si queremos borrar un elemento del árbol podemos realizarlo gracias a la siguiente instrucción:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ldapdelete <span class=\"token parameter variable\">-x</span> <span class=\"token parameter variable\">-D</span> <span class=\"token string\">'cn=admin,dc=antonio,dc=gonzalonazareno,dc=org'</span> <span class=\"token parameter variable\">-W</span> <span class=\"token assign-left variable\">cn</span><span class=\"token operator\">=</span>reabastecimiento,ou<span class=\"token operator\">=</span>Grupos,dc<span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr></table></figure><p>Desplegar árbol a través de NFS:</p>\n<p>apt-get install nfs-kernel-server -y</p>\n<p>Nos vamos a /etc/exportfs y añadimos la siguiente línea:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>/home/antonio/nfs *<span class=\"token punctuation\">(</span>rw,fsid<span class=\"token operator\">=</span><span class=\"token number\">0</span>,subtree_check,no_root_squash<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>Ahora ejecutamos  <code>exportfs -a</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>root@alfa:/home/antonio<span class=\"token comment\"># mkdir nfs</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>root@alfa:/home/antonio<span class=\"token comment\"># mkdir nfs/almacenamiento</span></pre></td></tr></table></figure><p>Comenzamos con la configuración del paquete nscd. Este es un demonio de caché para el servicio de nombres, lo cual evitará repetir consultas de las bases de datos de passwd, group y hosts.</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">apt</span> <span class=\"token function\">install</span> libnss-ldapd libpam-ldapd nscd <span class=\"token parameter variable\">-y</span></pre></td></tr></table></figure><p>Luego de configurar el instalador de forma que capture la ip 127.0.0.1 y el nombre dc=antonio,dc=gonzalonazareno,dc=org, debemos editar el fichero /etc/nsswitch.conf, y añadir las siguientes líneas:</p>\n<p><img src=\"/images/slap1-7.png\" alt=\"Descripción de la imagen\"></p>\n<h2 id=\"cliente-ubuntu\"><a class=\"markdownIt-Anchor\" href=\"#cliente-ubuntu\">#</a> Cliente Ubuntu</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> libnss-ldapd libpam-ldapd nscd nfs-kernel-server <span class=\"token parameter variable\">-y</span></pre></td></tr></table></figure><p>Introducimos la dirección IP del servidor LDAP y el nombre del dominio:</p>\n<p><img src=\"/images/slap1-8.png\" alt=\"Descripción de la imagen\"></p>\n<p>En el fichero /etc/ldap/ldap.conf se establecen los parámetros de configuración del cliente LDAP. En este fichero se establece la dirección del servidor LDAP, el puerto, el dominio, el tipo de autenticación, etc.</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># LDAP Defaults</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># See ldap.conf(5) for details</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># This file should be world readable but not world writable.</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>BASE    <span class=\"token assign-left variable\">dc</span><span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>URI     ldap://192.168.0.1</pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>SIZELIMIT       <span class=\"token number\">12</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>TIMELIMIT       <span class=\"token number\">15</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>DEREF           never</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\"># TLS certificates (needed for GnuTLS)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>TLS_CACERT      /etc/ssl/certs/ca-certificates.crt</pre></td></tr></table></figure><p>Ahora necesitaremos configurar el cliente para que al iniciar sesión cree el home del usuario. Para ello editamos el fichero /etc/pam.d/common-account y añadimos la siguiente línea:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>session required pam_mkhomedir.so <span class=\"token assign-left variable\">skel</span><span class=\"token operator\">=</span>/etc/skel/ <span class=\"token assign-left variable\">umask</span><span class=\"token operator\">=</span>0022</pre></td></tr></table></figure><p>Vamos a probar montando de manera efímera el directorio en el cual se va a crear el home del usuario macarena:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">mount</span> <span class=\"token parameter variable\">-t</span> nfs <span class=\"token number\">192.168</span>.0.1:/home/antonio/nfs/ /home</pre></td></tr></table></figure><p>Ahora cuando el usuario macarena inicie sesión este se verá reflejado en nuestro servidor nfs, probaremos creando un documento txt:</p>\n<p><img src=\"/images/slap1-9.png\" alt=\"Descripción de la imagen\"></p>\n<p>Ahora vamos a hacer que este recurso funcione de manera permanente, para ello podríamos editar el fichero fstab, o bien crear una unidad de systemd, que en este caso es lo que vamos a emplear.</p>\n<p>nano /etc/systemd/system/home.mount</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>Unit<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">Description</span><span class=\"token operator\">=</span> Montaje de carpeta home para NFS</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>Mount<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token assign-left variable\">What</span><span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.0.1:/home/antonio/nfs</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token assign-left variable\">Where</span><span class=\"token operator\">=</span>/home   </pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">Type</span><span class=\"token operator\">=</span>nfs</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token assign-left variable\">Options</span><span class=\"token operator\">=</span>defaults</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>Install<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token assign-left variable\">WantedBy</span><span class=\"token operator\">=</span>multi-user.target</pre></td></tr></table></figure><p>systemctl daemon-reload<br>\nsystemctl enable home.mount<br>\nsystemctl start home.mount<br>\nsystemctl status home.mount</p>\n<p><img src=\"/images/slap1-10.png\" alt=\"Descripción de la imagen\"></p>\n<h2 id=\"cliente-rocky-linux\"><a class=\"markdownIt-Anchor\" href=\"#cliente-rocky-linux\">#</a> Cliente Rocky Linux</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>dnf <span class=\"token function\">install</span> openldap-clients sssd sssd-ldap oddjob-mkhomedir sssd-tools <span class=\"token parameter variable\">-y</span></pre></td></tr></table></figure><figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>authselect list</pre></td></tr></table></figure><figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@bravo antonio<span class=\"token punctuation\">]</span><span class=\"token comment\"># authselect list</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>- minimal\t Local <span class=\"token function\">users</span> only <span class=\"token keyword\">for</span> minimal installations</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>- sssd   \t Enable SSSD <span class=\"token keyword\">for</span> system authentication <span class=\"token punctuation\">(</span>also <span class=\"token keyword\">for</span> <span class=\"token builtin class-name\">local</span> <span class=\"token function\">users</span> only<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>- winbind\t Enable winbind <span class=\"token keyword\">for</span> system authentication</pre></td></tr></table></figure><figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>authselect <span class=\"token keyword\">select</span> sssd with-mkhomedir <span class=\"token parameter variable\">--force</span></pre></td></tr></table></figure><p>volvemos a especificar la dirección IP del servidor LDAP y el nombre del dominio en /etc/openldap/ldap.conf:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>BASE <span class=\"token assign-left variable\">dc</span><span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>URI ldap://172.16.0.1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>SIZELIMIT       <span class=\"token number\">12</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>TIMELIMIT       <span class=\"token number\">15</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>DEREF           never</pre></td></tr></table></figure><p>sudo nano /etc/sssd/sssd.conf</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>domain/default<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>id_provider <span class=\"token operator\">=</span> ldap</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>autofs_provider <span class=\"token operator\">=</span> ldap</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>auth_provider <span class=\"token operator\">=</span> ldap</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>chpass_provider <span class=\"token operator\">=</span> ldap</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>ldap_uri <span class=\"token operator\">=</span> ldap://172.0.16.1</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>ldap_search_base <span class=\"token operator\">=</span> <span class=\"token assign-left variable\">dc</span><span class=\"token operator\">=</span>antonio,dc<span class=\"token operator\">=</span>gonzalonazareno,dc<span class=\"token operator\">=</span>org</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>ldap_id_use_start_tls <span class=\"token operator\">=</span> True</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>ldap_tls_cacertdir <span class=\"token operator\">=</span> /etc/openldap/cacerts</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>cache_credentials <span class=\"token operator\">=</span> True</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>ldap_tls_reqcert <span class=\"token operator\">=</span> allow</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">[</span>sssd<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>services <span class=\"token operator\">=</span> nss, pam, autofs</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>domains <span class=\"token operator\">=</span> default</pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">[</span>nss<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>homedir_substring <span class=\"token operator\">=</span> /home/nfs</pre></td></tr></table></figure><figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">chmod</span> 0600 /etc/sssd/sssd.conf</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>systemctl restart sssd</pre></td></tr></table></figure><p>authconfig --enablemkhomedir --updateall</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>authconfig <span class=\"token parameter variable\">--enableldap</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token parameter variable\">--enableldapauth</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token parameter variable\">--ldapserver</span><span class=\"token operator\">=</span>antonio.gonzalonazareno.org <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token parameter variable\">--ldapbasedn</span><span class=\"token operator\">=</span><span class=\"token string\">\"dc=antonio,dc=gonzalonazareno,dc=org\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token parameter variable\">--enablemkhomedir</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token parameter variable\">--update</span></pre></td></tr></table></figure><p><img src=\"/images/slap1-11.png\" alt=\"Descripción de la imagen\"></p>\n"},{"title":"Cliente-Servidor Openvpn","_content":"\n\n![Descripción de la imagen](/images/vpn-logo.png)\n\n\n# Cliente-Servidor Openvpn\n\n\n\n## Servidor\n\nTendremos un escenario en vagrant en el cual constará de 3 máquinas, un cliente externo, el servidor vpn \n\n\n\n\nEntramos en el servidor vpn y haremos apt update, y después instalaremos openvpn que servirá tanto para el cliente como para el servidor.\n\n\nActivamos el bit de forwarding en `/etc/sysctl.conf`  net.ipv4.ip_forward=1\nEjecutamos `sudo sysctl -p` para que lea el archivo sysctl.conf\n\n\n`sudo cp -r /usr/share/easy-rsa /etc/openvpn`\n\n\n`cd /etc/openvpn/easy-rsa`\n\nActivamos el servicio de infraestructura pública:\n\n`sudo ./easyrsa init-pki`\n\nTras esto generamos la entidad certificadora con su respectiva clave privada gracias al binario easyrsa.\n\n`./easyrsa build-ca`\n\nAhora vamos a montar el servidor de certificaciones:\n\n`./easyrsa build-server-full server nopass`\n\nGeneramos parámetros de Diffie-Helman, el objetivo del algoritmo de cifrado Diffie-Hellman es lograr el intercambio de una clave secreta por medio de un canal inseguro como es internet. Para que este algoritmo funcione, los datos informáticos deben traducirse a números, lo cual es posible por medio de sistemas como el código ASCII, combinado con otros.\n\n`sudo ./easyrsa gen-dh`\n\nGeneramos el par de claves del cliente:\n`./easyrsa build-client-full clientevpn nopass`\n\nAhora pasamos las claves al servidor cliente\n\n```\nsudo cp -rp /etc/openvpn/easy-rsa/pki/{ca.crt,issued/clientevpn.crt,private/clientevpn.key} /home/vagrant/\ncd /home/vagrant\nsudo chown vagrant:vagrant {ca.crt,clientevpn.crt,clientevpn.key}\nscp {ca.crt,clientevpn.crt,clientevpn.key} vagrant@vpn-cli:\n```\n\nAhora configuraremos los parámetros del servidor y sus saltos:\n\n\n`/etc/openvpn/server/servidor.conf`\n\n``` \nport 1194\nproto udp\ndev tun\n\n\nca /etc/openvpn/easy-rsa/pki/ca.crt\ncert /etc/openvpn/easy-rsa/pki/issued/server.crt\nkey /etc/openvpn/easy-rsa/pki/private/server.key\ndh /etc/openvpn/easy-rsa/pki/dh.pem\n\n\ntopology subnet\n\n\nserver 9.8.7.0 255.255.255.0\nifconfig-pool-persist /var/log/openvpn/ipp.txt\n\n\npush \"route 192.168.0.0 255.255.255.0\"\n\n\nkeepalive 10 120\ncipher AES-256-CBC\npersist-key\npersist-tun\nstatus /var/log/openvpn/openvpn-status.log\nverb 3\nexplicit-exit-notify 1\n\n```\n\n\n`sudo systemctl enable --now openvpn-server@servidor`\n\n\n## Cliente\n\n```\nsudo apt update\nsudo apt install openvpn\n```\n\nMovemos las claves al directorio de openvpn y le cambiamos el propietario:\n\n```\nsudo mv {ca.crt,clientevpn.crt,clientevpn.key} /etc/openvpn/client\nsudo chown root: /etc/openvpn/client/*\n```\n\nAhora vamos a crear el fichero /etc/openvpn/client/cliente.conf\n\n```\nclient\ndev tun\nproto udp\n\nremote 192.22.23.1 1194\nresolv-retry infinite\nnobind\n\npersist-key\npersist-tun\n\nca /etc/openvpn/client/ca.crt\ncert /etc/openvpn/client/clientevpn.crt\nkey /etc/openvpn/client/clientevpn.key\n\nremote-cert-tls server\ncipher AES-256-CBC\nverb 3\n```\n\nE iniciamos la el servicio de la configuración:\n\nsudo systemctl enable --now openvpn-client@cliente\n\n\n## Máquina interna\n\n\nQuitamos la ip de la ruta por defecto que viene en vagrant:\n\nsudo ip route del default\n\n\nAñadimos la ruta que creamos hacia la vpn:\n\nsudo ip route add default via 192.168.0.1\n\n\n\ncomprobaciones\n\n\n![Descripción de la imagen](/images/vpn-acceso-remoto-ssh-openvpn.png)\n\n\n![Descripción de la imagen](/images/traceroute-openvpn.png)\n\n\n\n# Site-To-Site Openvpn\n\n\n![Descripción de la imagen](/images/vpn-site-esquema.png)\n\n\n\n\n## Servidor\n\nEntramos en el servidor vpn y haremos apt update, y después instalaremos openvpn que servirá tanto para el cliente como para el servidor.\n\n\nActivamos el bit de forwarding en `/etc/sysctl.conf`  net.ipv4.ip_forward=1\nEjecutamos `sudo sysctl -p` para que lea el archivo sysctl.conf\n\n\n`sudo cp -r /usr/share/easy-rsa /etc/openvpn`\n\n\n`cd /etc/openvpn/easy-rsa`\n\nActivamos el servicio de infraestructura pública:\n\n`sudo ./easyrsa init-pki`\nTras esto generamos la entidad certificadora con su respectiva clave privada gracias al binario easyrsa.\n\n`./easyrsa build-ca`\nAhora vamos a montar el servidor de certificaciones:\n\n`./easyrsa build-server-full server nopass`\n\n\n`sudo ./easyrsa gen-dh`\n\nGeneramos el par de claves del cliente:\n`./easyrsa build-client-full clientevpn nopass`\n\nAhora pasamos las claves al servidor cliente\n\n```\nsudo cp -rp /etc/openvpn/easy-rsa/pki/{ca.crt,issued/clientevpn.crt,private/clientevpn.key} /home/vagrant/\ncd /home/vagrant\nsudo chown vagrant:vagrant {ca.crt,clientevpn.crt,clientevpn.key}\nscp {ca.crt,clientevpn.crt,clientevpn.key} vagrant@vpn-cli:\n```\n\nA partir de aquí la configuración varía respecto a la parte de cliente-servidor:\n\n``` \ndev tun\nifconfig 10.99.99.1 10.99.99.2\nroute 192.168.100.0 255.255.255.0\ntls-server\n\ndh /etc/openvpn/easy-rsa/pki/dh.pem\nca /etc/openvpn/easy-rsa/pki/ca.crt\ncert /etc/openvpn/easy-rsa/pki/issued/server.crt\nkey /etc/openvpn/easy-rsa/pki/private/server.key\n\ncomp-lzo\nkeepalive 10 60\n\nverb 3\n```\n\n\n`sudo systemctl enable --now openvpn-server@servidor`\n\n\n## Cliente\n\n``` \nsudo apt update\nsudo apt install openvpn\nsudo mv {ca.crt,clientevpn.crt,clientevpn.key} /etc/openvpn/client\nsudo chown root: /etc/openvpn/client/*\n```\n\nAhora vamos a crear el fichero /etc/openvpn/client/cliente.conf\n\n``` \ndev tun\nremote 10.0.0.1\nifconfig 10.99.99.2 10.99.99.1\nroute 192.168.200.0 255.255.255.0\ntls-client\n\nca /etc/openvpn/client/ca.crt\ncert /etc/openvpn/client/clientevpn.crt\nkey /etc/openvpn/client/clientevpn.key\n\ncomp-lzo\nkeepalive 10 60\n\nverb 3\n```\n\nsudo systemctl enable --now openvpn-client@cliente\n\n\n\n## Cliente 1\n\nsudo ip route del default\nsudo ip route add default via 192.168.200.1\n\n\n![Descripción de la imagen](/images/vpn-cliente2-traceroute.png)\n![Descripción de la imagen](/images/vpn-cliente1.png)\n\n## Cliente 2\n\nsudo ip route del default\nsudo ip route add default via 192.168.100.1\n\n\n![Descripción de la imagen](/images/vpn-cliente2-traceroute.png)\n![Descripción de la imagen](/images/vpn-cliente2.png)\n\n","source":"_posts/vpn.md","raw":"---\ntitle: Cliente-Servidor Openvpn\ncategories: Seguridad\ntags: Seguridad\n---\n\n\n![Descripción de la imagen](/images/vpn-logo.png)\n\n\n# Cliente-Servidor Openvpn\n\n\n\n## Servidor\n\nTendremos un escenario en vagrant en el cual constará de 3 máquinas, un cliente externo, el servidor vpn \n\n\n\n\nEntramos en el servidor vpn y haremos apt update, y después instalaremos openvpn que servirá tanto para el cliente como para el servidor.\n\n\nActivamos el bit de forwarding en `/etc/sysctl.conf`  net.ipv4.ip_forward=1\nEjecutamos `sudo sysctl -p` para que lea el archivo sysctl.conf\n\n\n`sudo cp -r /usr/share/easy-rsa /etc/openvpn`\n\n\n`cd /etc/openvpn/easy-rsa`\n\nActivamos el servicio de infraestructura pública:\n\n`sudo ./easyrsa init-pki`\n\nTras esto generamos la entidad certificadora con su respectiva clave privada gracias al binario easyrsa.\n\n`./easyrsa build-ca`\n\nAhora vamos a montar el servidor de certificaciones:\n\n`./easyrsa build-server-full server nopass`\n\nGeneramos parámetros de Diffie-Helman, el objetivo del algoritmo de cifrado Diffie-Hellman es lograr el intercambio de una clave secreta por medio de un canal inseguro como es internet. Para que este algoritmo funcione, los datos informáticos deben traducirse a números, lo cual es posible por medio de sistemas como el código ASCII, combinado con otros.\n\n`sudo ./easyrsa gen-dh`\n\nGeneramos el par de claves del cliente:\n`./easyrsa build-client-full clientevpn nopass`\n\nAhora pasamos las claves al servidor cliente\n\n```\nsudo cp -rp /etc/openvpn/easy-rsa/pki/{ca.crt,issued/clientevpn.crt,private/clientevpn.key} /home/vagrant/\ncd /home/vagrant\nsudo chown vagrant:vagrant {ca.crt,clientevpn.crt,clientevpn.key}\nscp {ca.crt,clientevpn.crt,clientevpn.key} vagrant@vpn-cli:\n```\n\nAhora configuraremos los parámetros del servidor y sus saltos:\n\n\n`/etc/openvpn/server/servidor.conf`\n\n``` \nport 1194\nproto udp\ndev tun\n\n\nca /etc/openvpn/easy-rsa/pki/ca.crt\ncert /etc/openvpn/easy-rsa/pki/issued/server.crt\nkey /etc/openvpn/easy-rsa/pki/private/server.key\ndh /etc/openvpn/easy-rsa/pki/dh.pem\n\n\ntopology subnet\n\n\nserver 9.8.7.0 255.255.255.0\nifconfig-pool-persist /var/log/openvpn/ipp.txt\n\n\npush \"route 192.168.0.0 255.255.255.0\"\n\n\nkeepalive 10 120\ncipher AES-256-CBC\npersist-key\npersist-tun\nstatus /var/log/openvpn/openvpn-status.log\nverb 3\nexplicit-exit-notify 1\n\n```\n\n\n`sudo systemctl enable --now openvpn-server@servidor`\n\n\n## Cliente\n\n```\nsudo apt update\nsudo apt install openvpn\n```\n\nMovemos las claves al directorio de openvpn y le cambiamos el propietario:\n\n```\nsudo mv {ca.crt,clientevpn.crt,clientevpn.key} /etc/openvpn/client\nsudo chown root: /etc/openvpn/client/*\n```\n\nAhora vamos a crear el fichero /etc/openvpn/client/cliente.conf\n\n```\nclient\ndev tun\nproto udp\n\nremote 192.22.23.1 1194\nresolv-retry infinite\nnobind\n\npersist-key\npersist-tun\n\nca /etc/openvpn/client/ca.crt\ncert /etc/openvpn/client/clientevpn.crt\nkey /etc/openvpn/client/clientevpn.key\n\nremote-cert-tls server\ncipher AES-256-CBC\nverb 3\n```\n\nE iniciamos la el servicio de la configuración:\n\nsudo systemctl enable --now openvpn-client@cliente\n\n\n## Máquina interna\n\n\nQuitamos la ip de la ruta por defecto que viene en vagrant:\n\nsudo ip route del default\n\n\nAñadimos la ruta que creamos hacia la vpn:\n\nsudo ip route add default via 192.168.0.1\n\n\n\ncomprobaciones\n\n\n![Descripción de la imagen](/images/vpn-acceso-remoto-ssh-openvpn.png)\n\n\n![Descripción de la imagen](/images/traceroute-openvpn.png)\n\n\n\n# Site-To-Site Openvpn\n\n\n![Descripción de la imagen](/images/vpn-site-esquema.png)\n\n\n\n\n## Servidor\n\nEntramos en el servidor vpn y haremos apt update, y después instalaremos openvpn que servirá tanto para el cliente como para el servidor.\n\n\nActivamos el bit de forwarding en `/etc/sysctl.conf`  net.ipv4.ip_forward=1\nEjecutamos `sudo sysctl -p` para que lea el archivo sysctl.conf\n\n\n`sudo cp -r /usr/share/easy-rsa /etc/openvpn`\n\n\n`cd /etc/openvpn/easy-rsa`\n\nActivamos el servicio de infraestructura pública:\n\n`sudo ./easyrsa init-pki`\nTras esto generamos la entidad certificadora con su respectiva clave privada gracias al binario easyrsa.\n\n`./easyrsa build-ca`\nAhora vamos a montar el servidor de certificaciones:\n\n`./easyrsa build-server-full server nopass`\n\n\n`sudo ./easyrsa gen-dh`\n\nGeneramos el par de claves del cliente:\n`./easyrsa build-client-full clientevpn nopass`\n\nAhora pasamos las claves al servidor cliente\n\n```\nsudo cp -rp /etc/openvpn/easy-rsa/pki/{ca.crt,issued/clientevpn.crt,private/clientevpn.key} /home/vagrant/\ncd /home/vagrant\nsudo chown vagrant:vagrant {ca.crt,clientevpn.crt,clientevpn.key}\nscp {ca.crt,clientevpn.crt,clientevpn.key} vagrant@vpn-cli:\n```\n\nA partir de aquí la configuración varía respecto a la parte de cliente-servidor:\n\n``` \ndev tun\nifconfig 10.99.99.1 10.99.99.2\nroute 192.168.100.0 255.255.255.0\ntls-server\n\ndh /etc/openvpn/easy-rsa/pki/dh.pem\nca /etc/openvpn/easy-rsa/pki/ca.crt\ncert /etc/openvpn/easy-rsa/pki/issued/server.crt\nkey /etc/openvpn/easy-rsa/pki/private/server.key\n\ncomp-lzo\nkeepalive 10 60\n\nverb 3\n```\n\n\n`sudo systemctl enable --now openvpn-server@servidor`\n\n\n## Cliente\n\n``` \nsudo apt update\nsudo apt install openvpn\nsudo mv {ca.crt,clientevpn.crt,clientevpn.key} /etc/openvpn/client\nsudo chown root: /etc/openvpn/client/*\n```\n\nAhora vamos a crear el fichero /etc/openvpn/client/cliente.conf\n\n``` \ndev tun\nremote 10.0.0.1\nifconfig 10.99.99.2 10.99.99.1\nroute 192.168.200.0 255.255.255.0\ntls-client\n\nca /etc/openvpn/client/ca.crt\ncert /etc/openvpn/client/clientevpn.crt\nkey /etc/openvpn/client/clientevpn.key\n\ncomp-lzo\nkeepalive 10 60\n\nverb 3\n```\n\nsudo systemctl enable --now openvpn-client@cliente\n\n\n\n## Cliente 1\n\nsudo ip route del default\nsudo ip route add default via 192.168.200.1\n\n\n![Descripción de la imagen](/images/vpn-cliente2-traceroute.png)\n![Descripción de la imagen](/images/vpn-cliente1.png)\n\n## Cliente 2\n\nsudo ip route del default\nsudo ip route add default via 192.168.100.1\n\n\n![Descripción de la imagen](/images/vpn-cliente2-traceroute.png)\n![Descripción de la imagen](/images/vpn-cliente2.png)\n\n","slug":"vpn","published":1,"date":"2023-01-24T10:06:01.371Z","updated":"2023-01-28T21:56:44.525Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cldl8a0pf00102fi5dld45tzy","content":"<p><img src=\"/images/vpn-logo.png\" alt=\"Descripción de la imagen\"></p>\n<h1 id=\"cliente-servidor-openvpn\"><a class=\"markdownIt-Anchor\" href=\"#cliente-servidor-openvpn\">#</a> Cliente-Servidor Openvpn</h1>\n<h2 id=\"servidor\"><a class=\"markdownIt-Anchor\" href=\"#servidor\">#</a> Servidor</h2>\n<p>Tendremos un escenario en vagrant en el cual constará de 3 máquinas, un cliente externo, el servidor vpn</p>\n<p>Entramos en el servidor vpn y haremos apt update, y después instalaremos openvpn que servirá tanto para el cliente como para el servidor.</p>\n<p>Activamos el bit de forwarding en  <code>/etc/sysctl.conf</code>   net.ipv4.ip_forward=1<br>\nEjecutamos  <code>sudo sysctl -p</code>  para que lea el archivo sysctl.conf</p>\n<p><code>sudo cp -r /usr/share/easy-rsa /etc/openvpn</code></p>\n<p><code>cd /etc/openvpn/easy-rsa</code></p>\n<p>Activamos el servicio de infraestructura pública:</p>\n<p><code>sudo ./easyrsa init-pki</code></p>\n<p>Tras esto generamos la entidad certificadora con su respectiva clave privada gracias al binario easyrsa.</p>\n<p><code>./easyrsa build-ca</code></p>\n<p>Ahora vamos a montar el servidor de certificaciones:</p>\n<p><code>./easyrsa build-server-full server nopass</code></p>\n<p>Generamos parámetros de Diffie-Helman, el objetivo del algoritmo de cifrado Diffie-Hellman es lograr el intercambio de una clave secreta por medio de un canal inseguro como es internet. Para que este algoritmo funcione, los datos informáticos deben traducirse a números, lo cual es posible por medio de sistemas como el código ASCII, combinado con otros.</p>\n<p><code>sudo ./easyrsa gen-dh</code></p>\n<p>Generamos el par de claves del cliente:<br>\n <code>./easyrsa build-client-full clientevpn nopass</code></p>\n<p>Ahora pasamos las claves al servidor cliente</p>\n<pre><code>sudo cp -rp /etc/openvpn/easy-rsa/pki/&#123;ca.crt,issued/clientevpn.crt,private/clientevpn.key&#125; /home/vagrant/\ncd /home/vagrant\nsudo chown vagrant:vagrant &#123;ca.crt,clientevpn.crt,clientevpn.key&#125;\nscp &#123;ca.crt,clientevpn.crt,clientevpn.key&#125; vagrant@vpn-cli:\n</code></pre>\n<p>Ahora configuraremos los parámetros del servidor y sus saltos:</p>\n<p><code>/etc/openvpn/server/servidor.conf</code></p>\n<pre><code>port 1194\nproto udp\ndev tun\n\n\nca /etc/openvpn/easy-rsa/pki/ca.crt\ncert /etc/openvpn/easy-rsa/pki/issued/server.crt\nkey /etc/openvpn/easy-rsa/pki/private/server.key\ndh /etc/openvpn/easy-rsa/pki/dh.pem\n\n\ntopology subnet\n\n\nserver 9.8.7.0 255.255.255.0\nifconfig-pool-persist /var/log/openvpn/ipp.txt\n\n\npush &quot;route 192.168.0.0 255.255.255.0&quot;\n\n\nkeepalive 10 120\ncipher AES-256-CBC\npersist-key\npersist-tun\nstatus /var/log/openvpn/openvpn-status.log\nverb 3\nexplicit-exit-notify 1\n\n</code></pre>\n<p><code>sudo systemctl enable --now openvpn-server@servidor</code></p>\n<h2 id=\"cliente\"><a class=\"markdownIt-Anchor\" href=\"#cliente\">#</a> Cliente</h2>\n<pre><code>sudo apt update\nsudo apt install openvpn\n</code></pre>\n<p>Movemos las claves al directorio de openvpn y le cambiamos el propietario:</p>\n<pre><code>sudo mv &#123;ca.crt,clientevpn.crt,clientevpn.key&#125; /etc/openvpn/client\nsudo chown root: /etc/openvpn/client/*\n</code></pre>\n<p>Ahora vamos a crear el fichero /etc/openvpn/client/cliente.conf</p>\n<pre><code>client\ndev tun\nproto udp\n\nremote 192.22.23.1 1194\nresolv-retry infinite\nnobind\n\npersist-key\npersist-tun\n\nca /etc/openvpn/client/ca.crt\ncert /etc/openvpn/client/clientevpn.crt\nkey /etc/openvpn/client/clientevpn.key\n\nremote-cert-tls server\ncipher AES-256-CBC\nverb 3\n</code></pre>\n<p>E iniciamos la el servicio de la configuración:</p>\n<p>sudo systemctl enable --now openvpn-client@cliente</p>\n<h2 id=\"máquina-interna\"><a class=\"markdownIt-Anchor\" href=\"#máquina-interna\">#</a> Máquina interna</h2>\n<p>Quitamos la ip de la ruta por defecto que viene en vagrant:</p>\n<p>sudo ip route del default</p>\n<p>Añadimos la ruta que creamos hacia la vpn:</p>\n<p>sudo ip route add default via 192.168.0.1</p>\n<p>comprobaciones</p>\n<p><img src=\"/images/vpn-acceso-remoto-ssh-openvpn.png\" alt=\"Descripción de la imagen\"></p>\n<p><img src=\"/images/traceroute-openvpn.png\" alt=\"Descripción de la imagen\"></p>\n<h1 id=\"site-to-site-openvpn\"><a class=\"markdownIt-Anchor\" href=\"#site-to-site-openvpn\">#</a> Site-To-Site Openvpn</h1>\n<p><img src=\"/images/vpn-site-esquema.png\" alt=\"Descripción de la imagen\"></p>\n<h2 id=\"servidor-2\"><a class=\"markdownIt-Anchor\" href=\"#servidor-2\">#</a> Servidor</h2>\n<p>Entramos en el servidor vpn y haremos apt update, y después instalaremos openvpn que servirá tanto para el cliente como para el servidor.</p>\n<p>Activamos el bit de forwarding en  <code>/etc/sysctl.conf</code>   net.ipv4.ip_forward=1<br>\nEjecutamos  <code>sudo sysctl -p</code>  para que lea el archivo sysctl.conf</p>\n<p><code>sudo cp -r /usr/share/easy-rsa /etc/openvpn</code></p>\n<p><code>cd /etc/openvpn/easy-rsa</code></p>\n<p>Activamos el servicio de infraestructura pública:</p>\n<p><code>sudo ./easyrsa init-pki</code> <br>\nTras esto generamos la entidad certificadora con su respectiva clave privada gracias al binario easyrsa.</p>\n<p><code>./easyrsa build-ca</code> <br>\nAhora vamos a montar el servidor de certificaciones:</p>\n<p><code>./easyrsa build-server-full server nopass</code></p>\n<p><code>sudo ./easyrsa gen-dh</code></p>\n<p>Generamos el par de claves del cliente:<br>\n <code>./easyrsa build-client-full clientevpn nopass</code></p>\n<p>Ahora pasamos las claves al servidor cliente</p>\n<pre><code>sudo cp -rp /etc/openvpn/easy-rsa/pki/&#123;ca.crt,issued/clientevpn.crt,private/clientevpn.key&#125; /home/vagrant/\ncd /home/vagrant\nsudo chown vagrant:vagrant &#123;ca.crt,clientevpn.crt,clientevpn.key&#125;\nscp &#123;ca.crt,clientevpn.crt,clientevpn.key&#125; vagrant@vpn-cli:\n</code></pre>\n<p>A partir de aquí la configuración varía respecto a la parte de cliente-servidor:</p>\n<pre><code>dev tun\nifconfig 10.99.99.1 10.99.99.2\nroute 192.168.100.0 255.255.255.0\ntls-server\n\ndh /etc/openvpn/easy-rsa/pki/dh.pem\nca /etc/openvpn/easy-rsa/pki/ca.crt\ncert /etc/openvpn/easy-rsa/pki/issued/server.crt\nkey /etc/openvpn/easy-rsa/pki/private/server.key\n\ncomp-lzo\nkeepalive 10 60\n\nverb 3\n</code></pre>\n<p><code>sudo systemctl enable --now openvpn-server@servidor</code></p>\n<h2 id=\"cliente-2\"><a class=\"markdownIt-Anchor\" href=\"#cliente-2\">#</a> Cliente</h2>\n<pre><code>sudo apt update\nsudo apt install openvpn\nsudo mv &#123;ca.crt,clientevpn.crt,clientevpn.key&#125; /etc/openvpn/client\nsudo chown root: /etc/openvpn/client/*\n</code></pre>\n<p>Ahora vamos a crear el fichero /etc/openvpn/client/cliente.conf</p>\n<pre><code>dev tun\nremote 10.0.0.1\nifconfig 10.99.99.2 10.99.99.1\nroute 192.168.200.0 255.255.255.0\ntls-client\n\nca /etc/openvpn/client/ca.crt\ncert /etc/openvpn/client/clientevpn.crt\nkey /etc/openvpn/client/clientevpn.key\n\ncomp-lzo\nkeepalive 10 60\n\nverb 3\n</code></pre>\n<p>sudo systemctl enable --now openvpn-client@cliente</p>\n<h2 id=\"cliente-1\"><a class=\"markdownIt-Anchor\" href=\"#cliente-1\">#</a> Cliente 1</h2>\n<p>sudo ip route del default<br>\nsudo ip route add default via 192.168.200.1</p>\n<p><img src=\"/images/vpn-cliente2-traceroute.png\" alt=\"Descripción de la imagen\"><br>\n<img src=\"/images/vpn-cliente1.png\" alt=\"Descripción de la imagen\"></p>\n<h2 id=\"cliente-2\"><a class=\"markdownIt-Anchor\" href=\"#cliente-2\">#</a> Cliente 2</h2>\n<p>sudo ip route del default<br>\nsudo ip route add default via 192.168.100.1</p>\n<p><img src=\"/images/vpn-cliente2-traceroute.png\" alt=\"Descripción de la imagen\"><br>\n<img src=\"/images/vpn-cliente2.png\" alt=\"Descripción de la imagen\"></p>\n","site":{"data":{}},"length":4653,"excerpt":"","more":"<p><img src=\"/images/vpn-logo.png\" alt=\"Descripción de la imagen\"></p>\n<h1 id=\"cliente-servidor-openvpn\"><a class=\"markdownIt-Anchor\" href=\"#cliente-servidor-openvpn\">#</a> Cliente-Servidor Openvpn</h1>\n<h2 id=\"servidor\"><a class=\"markdownIt-Anchor\" href=\"#servidor\">#</a> Servidor</h2>\n<p>Tendremos un escenario en vagrant en el cual constará de 3 máquinas, un cliente externo, el servidor vpn</p>\n<p>Entramos en el servidor vpn y haremos apt update, y después instalaremos openvpn que servirá tanto para el cliente como para el servidor.</p>\n<p>Activamos el bit de forwarding en  <code>/etc/sysctl.conf</code>   net.ipv4.ip_forward=1<br>\nEjecutamos  <code>sudo sysctl -p</code>  para que lea el archivo sysctl.conf</p>\n<p><code>sudo cp -r /usr/share/easy-rsa /etc/openvpn</code></p>\n<p><code>cd /etc/openvpn/easy-rsa</code></p>\n<p>Activamos el servicio de infraestructura pública:</p>\n<p><code>sudo ./easyrsa init-pki</code></p>\n<p>Tras esto generamos la entidad certificadora con su respectiva clave privada gracias al binario easyrsa.</p>\n<p><code>./easyrsa build-ca</code></p>\n<p>Ahora vamos a montar el servidor de certificaciones:</p>\n<p><code>./easyrsa build-server-full server nopass</code></p>\n<p>Generamos parámetros de Diffie-Helman, el objetivo del algoritmo de cifrado Diffie-Hellman es lograr el intercambio de una clave secreta por medio de un canal inseguro como es internet. Para que este algoritmo funcione, los datos informáticos deben traducirse a números, lo cual es posible por medio de sistemas como el código ASCII, combinado con otros.</p>\n<p><code>sudo ./easyrsa gen-dh</code></p>\n<p>Generamos el par de claves del cliente:<br>\n <code>./easyrsa build-client-full clientevpn nopass</code></p>\n<p>Ahora pasamos las claves al servidor cliente</p>\n<pre><code>sudo cp -rp /etc/openvpn/easy-rsa/pki/&#123;ca.crt,issued/clientevpn.crt,private/clientevpn.key&#125; /home/vagrant/\ncd /home/vagrant\nsudo chown vagrant:vagrant &#123;ca.crt,clientevpn.crt,clientevpn.key&#125;\nscp &#123;ca.crt,clientevpn.crt,clientevpn.key&#125; vagrant@vpn-cli:\n</code></pre>\n<p>Ahora configuraremos los parámetros del servidor y sus saltos:</p>\n<p><code>/etc/openvpn/server/servidor.conf</code></p>\n<pre><code>port 1194\nproto udp\ndev tun\n\n\nca /etc/openvpn/easy-rsa/pki/ca.crt\ncert /etc/openvpn/easy-rsa/pki/issued/server.crt\nkey /etc/openvpn/easy-rsa/pki/private/server.key\ndh /etc/openvpn/easy-rsa/pki/dh.pem\n\n\ntopology subnet\n\n\nserver 9.8.7.0 255.255.255.0\nifconfig-pool-persist /var/log/openvpn/ipp.txt\n\n\npush &quot;route 192.168.0.0 255.255.255.0&quot;\n\n\nkeepalive 10 120\ncipher AES-256-CBC\npersist-key\npersist-tun\nstatus /var/log/openvpn/openvpn-status.log\nverb 3\nexplicit-exit-notify 1\n\n</code></pre>\n<p><code>sudo systemctl enable --now openvpn-server@servidor</code></p>\n<h2 id=\"cliente\"><a class=\"markdownIt-Anchor\" href=\"#cliente\">#</a> Cliente</h2>\n<pre><code>sudo apt update\nsudo apt install openvpn\n</code></pre>\n<p>Movemos las claves al directorio de openvpn y le cambiamos el propietario:</p>\n<pre><code>sudo mv &#123;ca.crt,clientevpn.crt,clientevpn.key&#125; /etc/openvpn/client\nsudo chown root: /etc/openvpn/client/*\n</code></pre>\n<p>Ahora vamos a crear el fichero /etc/openvpn/client/cliente.conf</p>\n<pre><code>client\ndev tun\nproto udp\n\nremote 192.22.23.1 1194\nresolv-retry infinite\nnobind\n\npersist-key\npersist-tun\n\nca /etc/openvpn/client/ca.crt\ncert /etc/openvpn/client/clientevpn.crt\nkey /etc/openvpn/client/clientevpn.key\n\nremote-cert-tls server\ncipher AES-256-CBC\nverb 3\n</code></pre>\n<p>E iniciamos la el servicio de la configuración:</p>\n<p>sudo systemctl enable --now openvpn-client@cliente</p>\n<h2 id=\"máquina-interna\"><a class=\"markdownIt-Anchor\" href=\"#máquina-interna\">#</a> Máquina interna</h2>\n<p>Quitamos la ip de la ruta por defecto que viene en vagrant:</p>\n<p>sudo ip route del default</p>\n<p>Añadimos la ruta que creamos hacia la vpn:</p>\n<p>sudo ip route add default via 192.168.0.1</p>\n<p>comprobaciones</p>\n<p><img src=\"/images/vpn-acceso-remoto-ssh-openvpn.png\" alt=\"Descripción de la imagen\"></p>\n<p><img src=\"/images/traceroute-openvpn.png\" alt=\"Descripción de la imagen\"></p>\n<h1 id=\"site-to-site-openvpn\"><a class=\"markdownIt-Anchor\" href=\"#site-to-site-openvpn\">#</a> Site-To-Site Openvpn</h1>\n<p><img src=\"/images/vpn-site-esquema.png\" alt=\"Descripción de la imagen\"></p>\n<h2 id=\"servidor-2\"><a class=\"markdownIt-Anchor\" href=\"#servidor-2\">#</a> Servidor</h2>\n<p>Entramos en el servidor vpn y haremos apt update, y después instalaremos openvpn que servirá tanto para el cliente como para el servidor.</p>\n<p>Activamos el bit de forwarding en  <code>/etc/sysctl.conf</code>   net.ipv4.ip_forward=1<br>\nEjecutamos  <code>sudo sysctl -p</code>  para que lea el archivo sysctl.conf</p>\n<p><code>sudo cp -r /usr/share/easy-rsa /etc/openvpn</code></p>\n<p><code>cd /etc/openvpn/easy-rsa</code></p>\n<p>Activamos el servicio de infraestructura pública:</p>\n<p><code>sudo ./easyrsa init-pki</code> <br>\nTras esto generamos la entidad certificadora con su respectiva clave privada gracias al binario easyrsa.</p>\n<p><code>./easyrsa build-ca</code> <br>\nAhora vamos a montar el servidor de certificaciones:</p>\n<p><code>./easyrsa build-server-full server nopass</code></p>\n<p><code>sudo ./easyrsa gen-dh</code></p>\n<p>Generamos el par de claves del cliente:<br>\n <code>./easyrsa build-client-full clientevpn nopass</code></p>\n<p>Ahora pasamos las claves al servidor cliente</p>\n<pre><code>sudo cp -rp /etc/openvpn/easy-rsa/pki/&#123;ca.crt,issued/clientevpn.crt,private/clientevpn.key&#125; /home/vagrant/\ncd /home/vagrant\nsudo chown vagrant:vagrant &#123;ca.crt,clientevpn.crt,clientevpn.key&#125;\nscp &#123;ca.crt,clientevpn.crt,clientevpn.key&#125; vagrant@vpn-cli:\n</code></pre>\n<p>A partir de aquí la configuración varía respecto a la parte de cliente-servidor:</p>\n<pre><code>dev tun\nifconfig 10.99.99.1 10.99.99.2\nroute 192.168.100.0 255.255.255.0\ntls-server\n\ndh /etc/openvpn/easy-rsa/pki/dh.pem\nca /etc/openvpn/easy-rsa/pki/ca.crt\ncert /etc/openvpn/easy-rsa/pki/issued/server.crt\nkey /etc/openvpn/easy-rsa/pki/private/server.key\n\ncomp-lzo\nkeepalive 10 60\n\nverb 3\n</code></pre>\n<p><code>sudo systemctl enable --now openvpn-server@servidor</code></p>\n<h2 id=\"cliente-2\"><a class=\"markdownIt-Anchor\" href=\"#cliente-2\">#</a> Cliente</h2>\n<pre><code>sudo apt update\nsudo apt install openvpn\nsudo mv &#123;ca.crt,clientevpn.crt,clientevpn.key&#125; /etc/openvpn/client\nsudo chown root: /etc/openvpn/client/*\n</code></pre>\n<p>Ahora vamos a crear el fichero /etc/openvpn/client/cliente.conf</p>\n<pre><code>dev tun\nremote 10.0.0.1\nifconfig 10.99.99.2 10.99.99.1\nroute 192.168.200.0 255.255.255.0\ntls-client\n\nca /etc/openvpn/client/ca.crt\ncert /etc/openvpn/client/clientevpn.crt\nkey /etc/openvpn/client/clientevpn.key\n\ncomp-lzo\nkeepalive 10 60\n\nverb 3\n</code></pre>\n<p>sudo systemctl enable --now openvpn-client@cliente</p>\n<h2 id=\"cliente-1\"><a class=\"markdownIt-Anchor\" href=\"#cliente-1\">#</a> Cliente 1</h2>\n<p>sudo ip route del default<br>\nsudo ip route add default via 192.168.200.1</p>\n<p><img src=\"/images/vpn-cliente2-traceroute.png\" alt=\"Descripción de la imagen\"><br>\n<img src=\"/images/vpn-cliente1.png\" alt=\"Descripción de la imagen\"></p>\n<h2 id=\"cliente-2\"><a class=\"markdownIt-Anchor\" href=\"#cliente-2\">#</a> Cliente 2</h2>\n<p>sudo ip route del default<br>\nsudo ip route add default via 192.168.100.1</p>\n<p><img src=\"/images/vpn-cliente2-traceroute.png\" alt=\"Descripción de la imagen\"><br>\n<img src=\"/images/vpn-cliente2.png\" alt=\"Descripción de la imagen\"></p>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"cldl8a0oy00012fi5gkzic1ri","category_id":"cldl8a0p200042fi5c1wu7fjk","_id":"cldl8a0p8000g2fi5ha9ef9px"},{"post_id":"cldl8a0p7000e2fi503vkcv8z","category_id":"cldl8a0p200042fi5c1wu7fjk","_id":"cldl8a0pa000m2fi5az411ej8"},{"post_id":"cldl8a0p400072fi5b1yh1ank","category_id":"cldl8a0p6000b2fi5dj8ifaxg","_id":"cldl8a0pb000p2fi56ocfannc"},{"post_id":"cldl8a0p8000f2fi5dnewbw0b","category_id":"cldl8a0p200042fi5c1wu7fjk","_id":"cldl8a0pb000q2fi5e94zb9ur"},{"post_id":"cldl8a0p9000j2fi59hza4e4e","category_id":"cldl8a0p6000b2fi5dj8ifaxg","_id":"cldl8a0pb000r2fi542tog1cv"},{"post_id":"cldl8a0p500092fi5chzsbi8c","category_id":"cldl8a0p8000h2fi53a7za8oj","_id":"cldl8a0pc000s2fi5hs1r0jlf"},{"post_id":"cldl8a0p9000l2fi581r8aiod","category_id":"cldl8a0p6000b2fi5dj8ifaxg","_id":"cldl8a0pc000t2fi5g77w7s6p"},{"post_id":"cldl8a0p6000a2fi533dvex6r","category_id":"cldl8a0p6000b2fi5dj8ifaxg","_id":"cldl8a0pc000u2fi59kxn452z"},{"post_id":"cldl8a0pd000v2fi5czj71bgg","category_id":"cldl8a0p8000h2fi53a7za8oj","_id":"cldl8a0pf00112fi5geexfg0y"},{"post_id":"cldl8a0pd000w2fi56vmqgnph","category_id":"cldl8a0pf000y2fi57w27d65j","_id":"cldl8a0pg00152fi5f07602zm"},{"post_id":"cldl8a0pe000x2fi58sishr95","category_id":"cldl8a0pf00122fi5dh1f1o1b","_id":"cldl8a0ph00182fi502yfcway"},{"post_id":"cldl8a0pf00102fi5dld45tzy","category_id":"cldl8a0pf000y2fi57w27d65j","_id":"cldl8a0ph00192fi55kkm7l61"}],"PostTag":[{"post_id":"cldl8a0oy00012fi5gkzic1ri","tag_id":"cldl8a0p300052fi58k5o0vko","_id":"cldl8a0p7000d2fi5hzt42ztz"},{"post_id":"cldl8a0p7000e2fi503vkcv8z","tag_id":"cldl8a0p300052fi58k5o0vko","_id":"cldl8a0p8000i2fi507ighhk1"},{"post_id":"cldl8a0p400072fi5b1yh1ank","tag_id":"cldl8a0p7000c2fi55kcjh2l8","_id":"cldl8a0p9000k2fi56yfohtg2"},{"post_id":"cldl8a0p8000f2fi5dnewbw0b","tag_id":"cldl8a0p300052fi58k5o0vko","_id":"cldl8a0pa000o2fi5gcae98jo"},{"post_id":"cldl8a0pd000w2fi56vmqgnph","tag_id":"cldl8a0pf000z2fi52ajtbddf","_id":"cldl8a0pg00142fi5efaoe46y"},{"post_id":"cldl8a0pf00102fi5dld45tzy","tag_id":"cldl8a0pf000z2fi52ajtbddf","_id":"cldl8a0pg00172fi5go4hcbxl"}],"Tag":[{"name":"Servicios de Red e Internet","_id":"cldl8a0p300052fi58k5o0vko"},{"name":"Sistemas Operativos","_id":"cldl8a0p7000c2fi55kcjh2l8"},{"name":"Seguridad","_id":"cldl8a0pf000z2fi52ajtbddf"}]}}