---
title: iSCSI
categories: Almacenamiento
---

## Servidor

Actualizamos los paquetes e instalamos:

```bash
apt update
apt install tgt
```

este programa funciona con targets, crearemos uno:
`sudo tgtadm --lld iscsi --op new --mode target --tid 1 -T iqn.2021-11.org.example:target1`

Añadimos una unidad lógica llamada LUM:
`sudo tgtadm --lld iscsi --op new --mode logicalunit --tid 1 --lun 1 -b /dev/vdb`

![Descripción de la imagen](/images/iscsi-1.png)

sudo tgtadm --lld iscsi --op bind --mode target --tid 1 -I ALL

para hacerlo persistente:

`tgt-admin -s`
`tgt-admin --dump > /etc/tgt/conf.d/example.es.conf`



## Cliente

Escaneamos los dispositivos iSCSI disponibles, he empleado el nombre servidor porque Vagrant tiene resolución interna de nombres:

sudo iscsiadm --mode discovery --type sendtargets --portal servidor


iscsiadm --mode node -T iqn.2021-11.org.example:target1 --portal servidor --login


Luego le damos formato al nuevo dispositivo:

sudo mkfs.ext4 /dev/sda
mkdir /mnt/iscsi
lo montamos en /mnt/iscsi

![Descripción de la imagen](/images/iscsi-3.png)

Para hacerlo persistente:


sudo iscsiadm --mode node -T iqn.2021-11.org.example:target1 --portal servidor -o update -n node.startup -v automatic

sudo nano /etc/systemd/system/mnt-iscsi.mount

```
[Unit]
Description=Disco iSCSI

[Mount]
What=/dev/sda
Where=/mnt/iscsi
Type=ext4
Options=_netdev

[Install]
WantedBy=multi-user.target

```

![Descripción de la imagen](/images/iscsi-2.png)


